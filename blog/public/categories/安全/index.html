<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å®‰å…¨ | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content><meta name=description content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·ï¼šåˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒ"><meta name=author content="util.cn Team"><link rel=canonical href=/blog/categories/%E5%AE%89%E5%85%A8/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/categories/%E5%AE%89%E5%85%A8/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/categories/%E5%AE%89%E5%85%A8/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/categories/%E5%AE%89%E5%85%A8/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="å®‰å…¨"><meta property="og:description" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·ï¼šåˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒ"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="å®‰å…¨"><meta name=twitter:description content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·ï¼šåˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒ"></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>å®‰å…¨</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>å‰ç«¯å®‰å…¨é˜²æŠ¤æœ€ä½³å®è·µï¼šæ„å»ºå®‰å…¨çš„Webåº”ç”¨</h2></header><div class=entry-content><p>å‰ç«¯å®‰å…¨å¨èƒæ¦‚è¿° å‰ç«¯å®‰å…¨æ˜¯Webåº”ç”¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä¸»è¦çš„å®‰å…¨å¨èƒåŒ…æ‹¬ï¼š
XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰ CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ ç‚¹å‡»åŠ«æŒ ä¸­é—´äººæ”»å‡» æ•æ„Ÿä¿¡æ¯æ³„éœ² XSSé˜²æŠ¤ å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // é€šè¿‡HTTPå¤´è®¾ç½®CSP // Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.example.com // åœ¨HTMLä¸­è®¾ç½® &lt;meta http-equiv="Content-Security-Policy" content=" default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.trusted.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://api.example.com; "> // Nuxté…ç½® export default defineNuxtConfig({ app: { head: { meta: [ { 'http-equiv': 'Content-Security-Policy', content: "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';" } ] } } }) è¾“å…¥è½¬ä¹‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // HTMLè½¬ä¹‰å‡½æ•° function escapeHtml(unsafe) { return unsafe .replace(/&/g, "&amp;amp;") .replace(/&lt;/g, "&amp;lt;") .replace(/>/g, "&amp;gt;") .replace(/"/g, "&amp;quot;") .replace(/'/g, "&amp;#039;") } // URLè½¬ä¹‰ function escapeUrl(unsafe) { return encodeURIComponent(unsafe) } // ä½¿ç”¨DOM APIè€ŒéinnerHTML const div = document.createElement('div') div.textContent = userInput // è‡ªåŠ¨è½¬ä¹‰ document.body.appendChild(div) Vueè‡ªåŠ¨è½¬ä¹‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 &lt;template> &lt;!-- Vueè‡ªåŠ¨è½¬ä¹‰ --> &lt;div>{{ userInput }}&lt;/div> &lt;!-- ä½¿ç”¨v-htmlæ—¶éœ€è¦ç‰¹åˆ«å°å¿ƒ --> &lt;div v-html="sanitizedHtml">&lt;/div> &lt;/template> &lt;script setup> import DOMPurify from 'dompurify' const userInput = ref('&lt;script>alert("XSS")&lt;\/script>') // ä½¿ç”¨DOMPurifyæ¸…ç†HTML const sanitizedHtml = computed(() => { return DOMPurify.sanitize(userInput.value) }) &lt;/script> CSRFé˜²æŠ¤ CSRF Token 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // ç”ŸæˆCSRF Token function generateCsrfToken() { const array = new Uint8Array(32) crypto.getRandomValues(array) return Array.from(array, b => b.toString(16).padStart(2, '0')).join('') } // å­˜å‚¨Token document.cookie = `csrf_token=${generateCsrfToken()}; SameSite=Strict; Secure` // å‘é€è¯·æ±‚æ—¶æºå¸¦Token fetch('/api/data', { method: 'POST', headers: { 'X-CSRF-Token': getCsrfToken() }, body: JSON.stringify(data) }) SameSite Cookie 1 2 3 4 5 // è®¾ç½®SameSiteå±æ€§ document.cookie = 'session_id=xxx; SameSite=Strict; Secure; HttpOnly' // æœåŠ¡å™¨ç«¯è®¾ç½®Cookie Set-Cookie: session_id=xxx; SameSite=Strict; Secure; HttpOnly ç‚¹å‡»åŠ«æŒé˜²æŠ¤ X-Frame-Options 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // é€šè¿‡HTTPå¤´è®¾ç½® X-Frame-Options: DENY X-Frame-Options: SAMEORIGIN // Nuxté…ç½® export default defineNuxtConfig({ routeRules: { '/**': { headers: { 'X-Frame-Options': 'DENY' } } } }) Frame Ancestors CSP 1 2 3 // ä½¿ç”¨CSP frame-ancestors Content-Security-Policy: frame-ancestors 'none'; Content-Security-Policy: frame-ancestors 'self'; æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ ä¸åœ¨æœ¬åœ°å­˜å‚¨æ•æ„Ÿä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 // âŒ ä¸è¦å­˜å‚¨å¯†ç  localStorage.setItem('password', password) // âŒ ä¸è¦å­˜å‚¨æ•æ„Ÿtoken localStorage.setItem('api_key', api_key) // âœ… ä½¿ç”¨httpOnly cookie // æœåŠ¡å™¨ç«¯è®¾ç½® Set-Cookie: token=xxx; HttpOnly; Secure; SameSite=Strict // âœ… ä½¿ç”¨sessionStorageï¼ˆå…³é—­æµè§ˆå™¨å³æ¸…é™¤ï¼‰ sessionStorage.setItem('temp_data', data) å®‰å…¨çš„æ•°æ®ä¼ è¾“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // å§‹ç»ˆä½¿ç”¨HTTPS fetch('https://api.example.com/data', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) }) // å¯ç”¨HSTS Strict-Transport-Security: max-age=31536000; includeSubDomains // å­åŸŸåèµ„æºé™åˆ¶ Content-Security-Policy: frame-ancestors 'self' https://trusted.example.com; å¯†ç å®‰å…¨ å‰ç«¯å¯†ç éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 function validatePassword(password) { const checks = { length: password.length >= 8, uppercase: /[A-Z]/.test(password), lowercase: /[a-z]/.test(password), numbers: /\d/.test(password), special: /[!@#$%^&*]/.test(password) } return { valid: Object.values(checks).every(Boolean), checks } } // å¯†ç å¼ºåº¦è¯„ä¼° function getPasswordStrength(password) { let score = 0 if (password.length >= 8) score++ if (password.length >= 12) score++ if (/[a-z]/.test(password)) score++ if (/[A-Z]/.test(password)) score++ if (/\d/.test(password)) score++ if (/[!@#$%^&*]/.test(password)) score++ return ['weak', 'fair', 'good', 'strong'][score] } å®‰å…¨çš„å¯†ç è¾“å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 &lt;template> &lt;div class="password-input"> &lt;input :type="showPassword ? 'text' : 'password'" v-model="password" @input="validate" /> &lt;button @click="showPassword = !showPassword"> {{ showPassword ? 'Hide' : 'Show' }} &lt;/button> &lt;div v-if="error" class="error">{{ error }}&lt;/div> &lt;/div> &lt;/template> &lt;script setup> const password = ref('') const showPassword = ref(false) const error = ref('') function validate() { const result = validatePassword(password.value) if (!result.valid) { const failedChecks = Object.entries(result.checks) .filter(([, valid]) => !valid) .map(([check]) => check) error.value = `Password fails: ${failedChecks.join(', ')}` } else { error.value = '' } } &lt;/script> APIå®‰å…¨ è¯·æ±‚ç­¾å 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 async function makeSecureRequest(url, data) { const timestamp = Date.now() const nonce = generateNonce() // æ„å»ºç­¾åå†…å®¹ const signatureContent = `${timestamp}${nonce}${JSON.stringify(data)}` const signature = await hmac(signatureContent, secretKey) return fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Timestamp': timestamp, 'X-Nonce': nonce, 'X-Signature': signature }, body: JSON.stringify(data) }) } å“åº”æ•°æ®éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 async function fetchAndValidate(url) { const response = await fetch(url) const data = await response.json() // éªŒè¯å“åº”æ•°æ®ç»“æ„ const validatedData = validateResponseSchema(data, { required: ['id', 'name'], types: { id: 'number', name: 'string', email: 'string' } }) return validatedData } function validateResponseSchema(data, schema) { const errors = [] for (const field of schema.required) { if (!(field in data)) { errors.push(`Missing required field: ${field}`) } } for (const [field, type] of Object.entries(schema.types)) { if (field in data && typeof data[field] !== type) { errors.push(`Invalid type for ${field}: expected ${type}`) } } if (errors.length > 0) { throw new Error(`Validation error: ${errors.join(', ')}`) } return data } ç¬¬ä¸‰æ–¹èµ„æºå®‰å…¨ Subresource Integrity (SRI) 1 2 3 4 5 6 &lt;!-- ä½¿ç”¨SRIç¡®ä¿CDNèµ„æºæœªè¢«ç¯¡æ”¹ --> &lt;script src="https://cdn.example.com/library.js" integrity="sha384-..." crossorigin="anonymous" >&lt;/script> é¢„åŠ è½½å®‰å…¨æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 // éªŒè¯å¤–éƒ¨è„šæœ¬ async function validateExternalScript(url) { const response = await fetch(url) const content = await response.text() // æ£€æŸ¥æ˜¯å¦åŒ…å«å¯ç–‘ä»£ç  if (content.includes('eval') || content.includes('innerHTML')) { console.warn('Potentially unsafe script detected') return false } return true } å®‰å…¨å®¡è®¡ ä¾èµ–æ£€æŸ¥ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ä¾èµ–æ¼æ´ npm audit # è‡ªåŠ¨ä¿®å¤æ¼æ´ npm audit fix # ä½¿ç”¨Snykè¿›è¡Œæ·±åº¦æ‰«æ npx snyk test ä»£ç å®‰å…¨æ‰«æ 1 2 3 4 5 6 7 8 // ESLintå®‰å…¨è§„åˆ™ // .eslintrc.js module.exports = { extends: [ 'plugin:security/recommended' ], plugins: ['security'] } å®‰å…¨ç›‘æ§ å®æ—¶ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 class SecurityMonitor { constructor() { this.init() } init() { // ç›‘æ§XSSå°è¯• this.monitorXSS() // ç›‘æ§å¼‚å¸¸è¯·æ±‚ this.monitorRequests() // ç›‘æ§æ§åˆ¶å°é”™è¯¯ this.monitorErrors() } monitorXSS() { const originalCreateElement = document.createElement document.createElement = function(tagName) { const element = originalCreateElement.call(this, tagName) if (tagName === 'script') { let originalSrc = '' Object.defineProperty(element, 'src', { get() { return originalSrc }, set(value) { // æ£€æŸ¥è„šæœ¬æ¥æº if (!this.isTrustedSource(value)) { console.warn('Untrusted script source:', value) securityEvent('untrusted_script', { src: value }) } originalSrc = value } }) } return element } } monitorRequests() { const originalFetch = window.fetch window.fetch = function(...args) { const url = args[0] // æ£€æŸ¥è¯·æ±‚ç›®æ ‡ if (!this.isTrustedDomain(url)) { console.warn('Request to untrusted domain:', url) securityEvent('untrusted_request', { url }) } return originalFetch.apply(this, args) } } monitorErrors() { window.addEventListener('error', (event) => { if (event.message.includes('Script error')) { securityEvent('possible_xss', { message: event.message, filename: event.filename }) } }) } isTrustedSource(url) { const trusted = ['https://cdn.trusted.com', 'https://api.trusted.com'] return trusted.some(domain => url.startsWith(domain)) } isTrustedDomain(url) { try { const urlObj = new URL(url, window.location.origin) return urlObj.origin === window.location.origin } catch { return false } } } æœ€ä½³å®è·µæ€»ç»“ æ°¸è¿œä¸è¦ä¿¡ä»»ç”¨æˆ·è¾“å…¥ - å§‹ç»ˆéªŒè¯å’Œè½¬ä¹‰ ä½¿ç”¨HTTPS - ä¿æŠ¤æ•°æ®ä¼ è¾“ è®¾ç½®CSP - é™åˆ¶èµ„æºåŠ è½½ ä½¿ç”¨HttpOnly Cookie - é˜²æ­¢XSSçªƒå– å®šæœŸå®¡è®¡ - æ£€æŸ¥ä¾èµ–å’Œä»£ç å®‰å…¨æ€§ æ€»ç»“ å‰ç«¯å®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ã€‚é€šè¿‡å®æ–½è¿™äº›å®‰å…¨æªæ–½ï¼Œå¯ä»¥å¤§å¤§é™ä½åº”ç”¨çš„å®‰å…¨é£é™©ï¼Œä¿æŠ¤ç”¨æˆ·æ•°æ®å®‰å…¨ã€‚
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/ class=category-link>å‰ç«¯æŠ€æœ¯</a><a href=/blog/categories/%E5%AE%89%E5%85%A8/ class=category-link>å®‰å…¨</a></div><span class=post-date>2026-01-04</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to å‰ç«¯å®‰å…¨é˜²æŠ¤æœ€ä½³å®è·µï¼šæ„å»ºå®‰å…¨çš„Webåº”ç”¨" href=/blog/articles/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%9E%84%E5%BB%BA%E5%AE%89%E5%85%A8%E7%9A%84web%E5%BA%94%E7%94%A8/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>WebCrypto APIå®æˆ˜ï¼šå‰ç«¯åŠ å¯†ä¸å®‰å…¨é€šä¿¡å®Œå…¨æŒ‡å—</h2></header><div class=entry-content><p>WebCrypto APIç®€ä»‹ WebCrypto APIæ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„åŸç”ŸåŠ å¯†APIï¼Œæä¾›äº†å®‰å…¨çš„åŠ å¯†æ“ä½œèƒ½åŠ›ã€‚ä¸ç¬¬ä¸‰æ–¹åº“ç›¸æ¯”ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š
æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œæ— éœ€é¢å¤–ä¾èµ– ä½¿ç”¨ç³»ç»Ÿçº§åŠ å¯†åº“ï¼Œæ€§èƒ½æ›´ä¼˜ å®‰å…¨çš„å¯†é’¥ç®¡ç†ï¼Œå¯†é’¥ä¸æš´éœ²ç»™JavaScript åŒæ­¥å’Œå¼‚æ­¥APIæ”¯æŒ å¯¹ç§°åŠ å¯†ï¼ˆAESï¼‰ ç”Ÿæˆå¯†é’¥ 1 2 3 4 5 6 7 8 9 10 11 12 // ç”ŸæˆAESå¯†é’¥ async function generateAesKey() { const key = await crypto.subtle.generateKey( { name: 'AES-GCM', length: 256 }, true, ['encrypt', 'decrypt'] ) return key } åŠ å¯†æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 async function encryptData(data, key) { const encoder = new TextEncoder() const iv = crypto.getRandomValues(new Uint8Array(12)) const encrypted = await crypto.subtle.encrypt( { name: 'AES-GCM', iv: iv }, key, encoder.encode(data) ) return { ciphertext: new Uint8Array(encrypted), iv: iv } } è§£å¯†æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 12 13 async function decryptData(encryptedData, key, iv) { const decrypted = await crypto.subtle.decrypt( { name: 'AES-GCM', iv: iv }, key, encryptedData ) const decoder = new TextDecoder() return decoder.decode(decrypted) } éå¯¹ç§°åŠ å¯†ï¼ˆRSAï¼‰ ç”Ÿæˆå¯†é’¥å¯¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 async function generateRsaKeyPair() { const keyPair = await crypto.subtle.generateKey( { name: 'RSA-OAEP', modulusLength: 2048, publicExponent: new Uint8Array([1, 0, 1]), hash: 'SHA-256' }, true, ['encrypt', 'decrypt'] ) return keyPair } å¯¼å‡ºå’Œå¯¼å…¥å¯†é’¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // å¯¼å‡ºå…¬é’¥ async function exportPublicKey(key) { const exported = await crypto.subtle.exportKey( 'spki', key ) return new Uint8Array(exported) } // å¯¼å…¥å…¬é’¥ async function importPublicKey(keyData) { return await crypto.subtle.importKey( 'spki', keyData, { name: 'RSA-OAEP', hash: 'SHA-256' }, true, ['encrypt'] ) } å“ˆå¸Œç®—æ³• è®¡ç®—å“ˆå¸Œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 async function hashData(data, algorithm = 'SHA-256') { const encoder = new TextEncoder() const dataBuffer = encoder.encode(data) const hashBuffer = await crypto.subtle.digest( algorithm, dataBuffer ) const hashArray = Array.from(new Uint8Array(hashBuffer)) return hashArray.map(b => b.toString(16).padStart(2, '0')).join('') } // ä½¿ç”¨ const hash = await hashData('Hello, WebCrypto!', 'SHA-256') console.log(hash) // 64ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸² HMAC 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 async function hmac(key, message) { const encoder = new TextEncoder() const cryptoKey = await crypto.subtle.importKey( 'raw', encoder.encode(key), { name: 'HMAC', hash: 'SHA-256' }, false, ['sign'] ) const signature = await crypto.subtle.sign( 'HMAC', cryptoKey, encoder.encode(message) ) const hashArray = Array.from(new Uint8Array(signature)) return hashArray.map(b => b.toString(16).padStart(2, '0')).join('') } æ•°å­—ç­¾å ç”Ÿæˆç­¾å 1 2 3 4 5 6 7 8 9 10 11 12 13 14 async function signData(data, privateKey) { const encoder = new TextEncoder() const signature = await crypto.subtle.sign( { name: 'RSA-PSS', saltLength: 32 }, privateKey, encoder.encode(data) ) return new Uint8Array(signature) } éªŒè¯ç­¾å 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 async function verifySignature(data, signature, publicKey) { const encoder = new TextEncoder() const result = await crypto.subtle.verify( { name: 'RSA-PSS', saltLength: 32 }, publicKey, signature, encoder.encode(data) ) return result } å¯†é’¥æ´¾ç”Ÿï¼ˆPBKDF2ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 async function deriveKey(password, salt) { const encoder = new TextEncoder() const keyMaterial = await crypto.subtle.importKey( 'raw', encoder.encode(password), 'PBKDF2', false, ['deriveKey'] ) const key = await crypto.subtle.deriveKey( { name: 'PBKDF2', salt: encoder.encode(salt), iterations: 100000, hash: 'SHA-256' }, keyMaterial, { name: 'AES-GCM', length: 256 }, true, ['encrypt', 'decrypt'] ) return key } å®æˆ˜æ¡ˆä¾‹ ç«¯åˆ°ç«¯åŠ å¯†èŠå¤© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 class E2EChat { constructor() { this.keyPair = null this.peerKeys = new Map() } async init() { // ç”Ÿæˆå¯†é’¥å¯¹ this.keyPair = await crypto.subtle.generateKey( { name: 'RSA-OAEP', modulusLength: 2048, publicExponent: new Uint8Array([1, 0, 1]), hash: 'SHA-256' }, true, ['encrypt', 'decrypt'] ) } async getPublicKey() { const exported = await crypto.subtle.exportKey('spki', this.keyPair.publicKey) return btoa(String.fromCharCode(...new Uint8Array(exported))) } async addPeer(id, publicKeyData) { const binaryString = atob(publicKeyData) const bytes = new Uint8Array(binaryString.length) for (let i = 0; i &lt; binaryString.length; i++) { bytes[i] = binaryString.charCodeAt(i) } const publicKey = await crypto.subtle.importKey( 'spki', bytes, { name: 'RSA-OAEP', hash: 'SHA-256' }, true, ['encrypt'] ) this.peerKeys.set(id, publicKey) } async sendMessage(peerId, message) { const publicKey = this.peerKeys.get(peerId) if (!publicKey) throw new Error('Peer not found') // ç”Ÿæˆä¼šè¯å¯†é’¥ const sessionKey = await this.generateSessionKey() // åŠ å¯†æ¶ˆæ¯ const encryptedMessage = await this.encryptMessage(message, sessionKey) // åŠ å¯†ä¼šè¯å¯†é’¥ const encryptedKey = await this.encryptSessionKey(sessionKey, publicKey) return { message: encryptedMessage, key: encryptedKey } } async receiveMessage(data) { // è§£å¯†ä¼šè¯å¯†é’¥ const sessionKey = await this.decryptSessionKey(data.key) // è§£å¯†æ¶ˆæ¯ return await this.decryptMessage(data.message, sessionKey) } async generateSessionKey() { return await crypto.subtle.generateKey( { name: 'AES-GCM', length: 256 }, true, ['encrypt', 'decrypt'] ) } async encryptMessage(message, key) { const encoder = new TextEncoder() const iv = crypto.getRandomValues(new Uint8Array(12)) const encrypted = await crypto.subtle.encrypt( { name: 'AES-GCM', iv: iv }, key, encoder.encode(message) ) return { data: btoa(String.fromCharCode(...new Uint8Array(encrypted))), iv: btoa(String.fromCharCode(...iv)) } } async decryptMessage(data, key) { const ciphertext = Uint8Array.from(atob(data.data), c => c.charCodeAt(0)) const iv = Uint8Array.from(atob(data.iv), c => c.charCodeAt(0)) const decrypted = await crypto.subtle.decrypt( { name: 'AES-GCM', iv: iv }, key, ciphertext ) const decoder = new TextDecoder() return decoder.decode(decrypted) } } å®‰å…¨æœ€ä½³å®è·µ å¯†é’¥ç®¡ç†
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/ class=category-link>å‰ç«¯æŠ€æœ¯</a><a href=/blog/categories/%E5%AE%89%E5%85%A8/ class=category-link>å®‰å…¨</a></div><span class=post-date>2026-01-04</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to WebCrypto APIå®æˆ˜ï¼šå‰ç«¯åŠ å¯†ä¸å®‰å…¨é€šä¿¡å®Œå…¨æŒ‡å—" href=/blog/articles/webcrypto-api%E5%AE%9E%E6%88%98%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86%E4%B8%8E%E5%AE%89%E5%85%A8%E9%80%9A%E4%BF%A1%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>é›¶ä¿¡ä»»æ¶æ„ä»ç†è®ºåˆ°å®è·µï¼šæ„å»ºæ°¸ä¸ä¿¡ä»»ã€å§‹ç»ˆéªŒè¯çš„å®‰å…¨ä½“ç³»</h2></header><div class=entry-content><p>å¼•è¨€ ä¼ ç»Ÿè¾¹ç•Œå®‰å…¨æ¨¡å‹å·²æ— æ³•åº”å¯¹ç°ä»£å¨èƒã€‚é›¶ä¿¡ä»»æ¶æ„ï¼ˆZero Trustï¼‰ä»¥"æ°¸ä¸ä¿¡ä»»ï¼Œå§‹ç»ˆéªŒè¯"ä¸ºæ ¸å¿ƒç†å¿µï¼Œæ­£åœ¨æˆä¸ºå®‰å…¨æ¶æ„çš„æ–°æ ‡å‡†ã€‚
ä¸€ã€é›¶ä¿¡ä»»æ ¸å¿ƒåŸåˆ™ 1.1 æ ¸å¿ƒæ¦‚å¿µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # é›¶ä¿¡ä»»æ¶æ„åŸåˆ™ class ZeroTrustPrinciples: """é›¶ä¿¡ä»»æ ¸å¿ƒåŸåˆ™""" principles = { "Verify Explicitly": "å§‹ç»ˆéªŒè¯ï¼Œæ°¸ä¸ä¿¡ä»»", "Use Least Privilege": "æœ€å°æƒé™è®¿é—®", "Assume Breach": "å‡è®¾å·²è¢«æ”»ç ´" } def __init__(self): # ä¿¡ä»»è¯„ä¼°æ¨¡å‹ self.trust_score = 0 self.context_factors = [ 'identity', 'device_health', 'location', 'behavior_pattern', 'time' ] 1.2 èº«ä»½ä¸è®¿é—®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 # ç°ä»£èº«ä»½è®¤è¯ç³»ç»Ÿ from datetime import datetime, timedelta import secrets class IdentityProvider: """èº«ä»½æä¾›å•†""" def __init__(self): self.sessions = {} self.mfa_providers = {} async def authenticate(self, credentials, context): """å¤šå› ç´ è®¤è¯""" # 1. éªŒè¯èº«ä»½ user = await self._verify_identity(credentials) # 2. æ£€æŸ¥è®¾å¤‡å¥åº· device_trust = await self._check_device_health(context['device_id']) # 3. è¯„ä¼°ä¸Šä¸‹æ–‡é£é™© risk_score = await self._assess_risk(context) # 4. å†³å®šè®¤è¯è¦æ±‚ if risk_score > 0.7: # é«˜é£é™©ï¼šéœ€è¦MFA mfa_required = True else: mfa_required = False # 5. æ‰§è¡Œè®¤è¯ if mfa_required: mfa_result = await self._perform_mfa(user['id']) if not mfa_result['success']: raise AuthenticationException("MFA failed") # 6. é¢å‘ä»¤ç‰Œ token = await self._issue_token(user, context) return { 'access_token': token, 'expires_in': 3600, 'refresh_enabled': True } async def _issue_token(self, user, context): """é¢å‘ä»¤ç‰Œ""" # JWTä»¤ç‰Œ payload = { 'user_id': user['id'], 'roles': user['roles'], 'permissions': user['permissions'], 'device_id': context['device_id'], 'location': context['location'], 'iat': datetime.now().timestamp(), 'exp': (datetime.now() + timedelta(hours=1)).timestamp() } # æ·»åŠ ä¿¡ä»»è¯„åˆ† trust_score = await self._calculate_trust_score(user, context) payload['trust_score'] = trust_score return self._encode_jwt(payload) # ç»†ç²’åº¦è®¿é—®æ§åˆ¶ class AccessControlEngine: """è®¿é—®æ§åˆ¶å¼•æ“""" def __init__(self, policy_engine): self.policy_engine = policy_engine async def check_access(self, request): """æ£€æŸ¥è®¿é—®æƒé™""" # ç­–ç•¥è¯„ä¼° decision = await self.policy_engine.evaluate({ 'subject': request.subject, 'action': request.action, 'resource': request.resource, 'context': request.context }) return decision['allow'], decision['reason'] # ç­–ç•¥å®šä¹‰ç¤ºä¾‹ ABAC_POLICIES = [ { "name": "Document Access Policy", "conditions": { "resource.type": "document", "resource.classification": ["public", "internal", "confidential"], "subject.roles": ["employee", "contractor", "partner"], "context.location": ["office", "remote"], "context.time": ["business_hours", "any"] }, "rules": [ { "effect": "allow", "conditions": { "resource.classification": "public", "subject.roles": ["employee", "contractor", "partner"] } }, { "effect": "allow", "conditions": { "resource.classification": "internal", "subject.roles": ["employee"], "context.location": ["office"] } }, { "effect": "deny", "conditions": { "resource.classification": "confidential", "subject.roles": ["contractor", "partner"] } } ] } ] 1.3 å¾®åˆ†æ®µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 # ç½‘ç»œå¾®åˆ†æ®µå®ç° class MicroSegmentation: """ç½‘ç»œå¾®åˆ†æ®µ""" def __init__(self): self.segments = {} self.policies = {} def create_segment(self, segment_config): """åˆ›å»ºç½‘æ®µ""" segment_id = segment_config['id'] self.segments[segment_id] = { 'name': segment_config['name'], 'workloads': [], 'allowed_traffic': segment_config['allowed_traffic'], 'inspection_level': segment_config['inspection_level'] } def apply_policy(self, policy): """åº”ç”¨ç­–ç•¥""" policy_id = policy['id'] self.policies[policy_id] = { 'source': policy['source_segment'], 'destination': policy['destination_segment'], 'ports': policy['ports'], 'protocols': policy['protocols'], 'action': policy['action'], # allow/deny/inspect 'inspection': policy.get('inspection', 'none') } def enforce_policy(self, traffic): """å¼ºåˆ¶æ‰§è¡Œç­–ç•¥""" # æŸ¥æ‰¾åŒ¹é…çš„ç­–ç•¥ for policy_id, policy in self.policies.items(): if self._traffic_matches_policy(traffic, policy): if policy['action'] == 'deny': return False, "Policy denied" elif policy['action'] == 'inspect': # æ·±åº¦åŒ…æ£€æµ‹ if not self._deep_inspect(traffic, policy['inspection']): return False, "Inspection failed" return True, "Allowed" äºŒã€é›¶ä¿¡ä»»æ¶æ„å®æ–½ 2.1 å®æ–½è·¯çº¿å›¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 # é›¶ä¿¡ä»»å®æ–½é˜¶æ®µ class ZeroTrustRoadmap: """é›¶ä¿¡ä»»å®æ–½è·¯çº¿å›¾""" phases = [ { "phase": 1, "name": "å‘ç°ä¸è¯„ä¼°", "duration": "1-3ä¸ªæœˆ", "tasks": [ "èµ„äº§å‘ç°ä¸åˆ†ç±»", "æ•°æ®æµåˆ†æ", "ç°æœ‰å®‰å…¨è¯„ä¼°", "åŸºçº¿å»ºç«‹" ] }, { "phase": 2, "name": "èº«ä»½ç°ä»£åŒ–", "duration": "3-6ä¸ªæœˆ", "tasks": [ "éƒ¨ç½²MFA", "å®æ–½SSO", "å»ºç«‹ç‰¹æƒè®¿é—®ç®¡ç†", "éƒ¨ç½²IAMç³»ç»Ÿ" ] }, { "phase": 3, "name": "è®¾å¤‡ä¿¡ä»»", "duration": "3-6ä¸ªæœˆ", "tasks": [ "éƒ¨ç½²MDM", "å®æ–½è®¾å¤‡å¥åº·æ£€æŸ¥", "å»ºç«‹è®¾å¤‡ä¿¡ä»»è¯„åˆ†", "éƒ¨ç½²EDR" ] }, { "phase": 4, "name": "ç½‘ç»œåˆ†æ®µ", "duration": "6-12ä¸ªæœˆ", "tasks": [ "å®æ–½è½¯ä»¶å®šä¹‰è¾¹ç•Œ", "éƒ¨ç½²å¾®éš”ç¦»", "å»ºç«‹é›¶ä¿¡ä»»ç½‘ç»œè®¿é—®", "å®æ–½ä¸œè¥¿å‘æµé‡ç›‘æ§" ] }, { "phase": 5, "name": "æ•°æ®ä¿æŠ¤", "duration": "6-12ä¸ªæœˆ", "tasks": [ "å®æ–½æ•°æ®åˆ†ç±»", "éƒ¨ç½²åŠ å¯†", "å»ºç«‹DLP", "å®æ–½CASB" ] } ] 2.2 ç›‘æ§ä¸å®¡è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 # é›¶ä¿¡ä»»ç›‘æ§ç³»ç»Ÿ class ZeroTrustMonitor: """é›¶ä¿¡ä»»ç›‘æ§""" def __init__(self): self.events = [] self.alerts = [] def log_access_event(self, event): """è®°å½•è®¿é—®äº‹ä»¶""" event_data = { 'timestamp': datetime.now(), 'subject': event['subject'], 'action': event['action'], 'resource': event['resource'], 'result': event['result'], 'context': event['context'], 'trust_score': event['trust_score'] } self.events.append(event_data) # å®æ—¶é£é™©è¯„ä¼° self._assess_risk(event_data) def _assess_risk(self, event): """è¯„ä¼°é£é™©""" # å¼‚å¸¸æ£€æµ‹ anomalies = self._detect_anomalies(event) if anomalies: alert = { 'level': 'high', 'type': 'anomaly_detected', 'details': anomalies, 'event': event } self.alerts.append(alert) self._trigger_alert(alert) def _detect_anomalies(self, event): """æ£€æµ‹å¼‚å¸¸""" anomalies = [] # 1. å¼‚å¸¸æ—¶é—´è®¿é—® hour = event['timestamp'].hour if hour &lt; 6 or hour > 22: anomalies.append("éå·¥ä½œæ—¶é—´è®¿é—®") # 2. å¼‚å¸¸ä½ç½®è®¿é—® if event['context']['location'] == 'unknown': anomalies.append("æœªçŸ¥ä½ç½®è®¿é—®") # 3. å¼‚å¸¸è®¾å¤‡ if event['context']['device_trust'] &lt; 0.5: anomalies.append("ä½ä¿¡ä»»è®¾å¤‡è®¿é—®") # 4. å¼‚å¸¸è¡Œä¸ºæ¨¡å¼ if self._is_unusual_behavior(event): anomalies.append("å¼‚å¸¸è¡Œä¸ºæ¨¡å¼") return anomalies æ€»ç»“ é›¶ä¿¡ä»»æ¶æ„æ˜¯ç°ä»£å®‰å…¨çš„å¿…ç„¶é€‰æ‹©ã€‚æˆåŠŸå®æ–½éœ€è¦ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%AE%89%E5%85%A8/ class=category-link>å®‰å…¨</a><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2025-12-31</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to é›¶ä¿¡ä»»æ¶æ„ä»ç†è®ºåˆ°å®è·µï¼šæ„å»ºæ°¸ä¸ä¿¡ä»»ã€å§‹ç»ˆéªŒè¯çš„å®‰å…¨ä½“ç³»" href=/blog/articles/%E9%9B%B6%E4%BF%A1%E4%BB%BB%E6%9E%B6%E6%9E%84%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E6%9E%84%E5%BB%BA%E6%B0%B8%E4%B8%8D%E4%BF%A1%E4%BB%BB%E5%A7%8B%E7%BB%88%E9%AA%8C%E8%AF%81%E7%9A%84%E5%AE%89%E5%85%A8%E4%BD%93%E7%B3%BB/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>ç½‘ç»œå®‰å…¨ä¸æ¼æ´æ·±åº¦åˆ†æï¼šä»æ”»å‡»åˆ°é˜²å¾¡çš„å®Œæ•´æŒ‡å—</h2></header><div class=entry-content><p>å¼•è¨€ ç½‘ç»œå®‰å…¨æ˜¯æ•°å­—åŒ–æ—¶ä»£çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚éšç€æ”»å‡»æ‰‹æ®µçš„ä¸æ–­æ¼”è¿›ï¼Œäº†è§£å¸¸è§æ¼æ´ã€æ”»å‡»æ–¹æ³•å’Œé˜²å¾¡ç­–ç•¥å˜å¾—è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æç½‘ç»œå®‰å…¨é¢†åŸŸçš„æ ¸å¿ƒä¸»é¢˜ï¼Œå¸®åŠ©è¯»è€…æ„å»ºæ›´å®‰å…¨çš„ç³»ç»Ÿã€‚
ä¸€ã€OWASP Top 10æ·±åº¦è§£æ 1.1 æ³¨å…¥æ¼æ´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 # ========== SQLæ³¨å…¥ ========== # ä¸å®‰å…¨çš„ä»£ç ç¤ºä¾‹ def get_user_by_id(user_id): """å±é™©ï¼šç›´æ¥æ‹¼æ¥SQL""" query = f"SELECT * FROM users WHERE id = {user_id}" return db.execute(query) # æ”»å‡»ç¤ºä¾‹ # user_id = "1 OR 1=1" # å®é™…æ‰§è¡Œçš„SQL: SELECT * FROM users WHERE id = 1 OR 1=1 # ç»“æœï¼šè¿”å›æ‰€æœ‰ç”¨æˆ·æ•°æ® # å®‰å…¨çš„ä»£ç ç¤ºä¾‹ import sqlite3 from typing import Optional class UserRepository: """å®‰å…¨çš„ç”¨æˆ·ä»“åº“""" def __init__(self, db_path: str): self.conn = sqlite3.connect(db_path) def get_user_by_id(self, user_id: int) -> Optional[dict]: """ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢""" cursor = self.conn.cursor() # ä½¿ç”¨?å ä½ç¬¦ï¼Œæ•°æ®åº“é©±åŠ¨ä¼šæ­£ç¡®è½¬ä¹‰å‚æ•° query = "SELECT * FROM users WHERE id = ?" cursor.execute(query, (user_id,)) row = cursor.fetchone() if row: return { 'id': row[0], 'username': row[1], 'email': row[2] } return None def search_users(self, keyword: str) -> list: """å®‰å…¨çš„æœç´¢åŠŸèƒ½""" cursor = self.conn.cursor() query = """ SELECT id, username, email FROM users WHERE username LIKE ? OR email LIKE ? """ # ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œæ¨¡ç³Šæœç´¢ pattern = f"%{keyword}%" cursor.execute(query, (pattern, pattern)) return cursor.fetchall() # ========== SQLæ³¨å…¥æ£€æµ‹ä¸é˜²å¾¡ ========== class SQLInjectionDetector: """SQLæ³¨å…¥æ£€æµ‹å™¨""" # å¸¸è§SQLæ³¨å…¥ç‰¹å¾ INJECTION_PATTERNS = [ r"(\%27)|(\')", # å•å¼•å· r"(\-\-)|(#)", # æ³¨é‡Šç¬¦ r"(\bor\b|\band\b).*?=.*?", # é€»è¾‘è¿ç®—ç¬¦ r"(\bunion\b.*\bselect\b)", # UNIONæŸ¥è¯¢ r"(\bselect\b.*\bfrom\b)", # SELECTæŸ¥è¯¢ r"(\bexec\b|\bexecute\b)", # æ‰§è¡Œå‘½ä»¤ r"(;|\bxp_cmdshell\b)", # å‘½ä»¤åˆ†éš”ç¬¦å’Œå­˜å‚¨è¿‡ç¨‹ r"(\bdrop\b|\bdelete\b|\btruncate\b)", # å±é™©æ“ä½œ ] @classmethod def detect_injection(cls, input_string: str) -> bool: """æ£€æµ‹SQLæ³¨å…¥""" import re for pattern in cls.INJECTION_PATTERNS: if re.search(pattern, input_string, re.IGNORECASE): return True return False @classmethod def sanitize_input(cls, input_string: str) -> str: """æ¸…ç†è¾“å…¥""" import re # ç§»é™¤å±é™©å­—ç¬¦ sanitized = re.sub(r"[\'\"\;\-\-]", "", input_string) # é™åˆ¶é•¿åº¦ max_length = 100 sanitized = sanitized[:max_length] return sanitized # ========== ORMå®‰å…¨ä½¿ç”¨ ========== from sqlalchemy import create_engine, Column, Integer, String from sqlalchemy.ext.declarative import declarative_base from sqlalchemy.orm import sessionmaker Base = declarative_base() class User(Base): """ç”¨æˆ·æ¨¡å‹""" __tablename__ = 'users' id = Column(Integer, primary_key=True) username = Column(String(50), nullable=False) email = Column(String(100), nullable=False) class SecureUserRepository: """ä½¿ç”¨ORMçš„å®‰å…¨ä»“åº“""" def __init__(self, database_url: str): self.engine = create_engine(database_url) Session = sessionmaker(bind=self.engine) self.session = Session() def get_user_by_id(self, user_id: int) -> Optional[User]: """ORMè‡ªåŠ¨å¤„ç†å‚æ•°åŒ–""" return self.session.query(User).filter( User.id == user_id ).first() def search_users(self, keyword: str) -> list: """å®‰å…¨çš„æœç´¢""" return self.session.query(User).filter( (User.username.like(f"%{keyword}%")) | (User.email.like(f"%{keyword}%")) ).all() 1.2 è·¨ç«™è„šæœ¬æ”»å‡»(XSS) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 # ========== XSSæ”»å‡»ç±»å‹ ========== """ 1. åå°„å‹XSS (Reflected XSS) - æ¶æ„ä»£ç é€šè¿‡URLå‚æ•°åå°„ - ä¾‹å¦‚: http://example.com/search?q=&lt;script>alert('XSS')&lt;/script> 2. å­˜å‚¨å‹XSS (Stored XSS) - æ¶æ„ä»£ç å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œæ¯æ¬¡è®¿é—®æ—¶æ‰§è¡Œ - ä¾‹å¦‚: è¯„è®ºã€ç”¨æˆ·èµ„æ–™ç­‰å¯å­˜å‚¨çš„å†…å®¹ 3. DOMå‹XSS (DOM-based XSS) - æ¶æ„ä»£ç é€šè¿‡DOMæ“ä½œæ‰§è¡Œ - ä¾‹å¦‚: #&lt;img src=x onerror=alert('XSS')> """ # ========== XSSé˜²å¾¡ ========== import html import re from typing import Dict, Any class XSSProtection: """XSSé˜²æŠ¤""" @staticmethod def escape_html(text: str) -> str: """HTMLè½¬ä¹‰""" return html.escape(text, quote=True) @staticmethod def escape_js(text: str) -> str: """JavaScriptå­—ç¬¦ä¸²è½¬ä¹‰""" escape_map = { '\\': '\\\\', '"': '\\"', "'": "\\'", '\n': '\\n', '\r': '\\r', '\t': '\\t', '\b': '\\b', '\f': '\\f', } for char, escaped in escape_map.items(): text = text.replace(char, escaped) return text @staticmethod def sanitize_html(content: str, allowed_tags: list = None) -> str: """HTMLå‡€åŒ–ï¼Œåªå…è®¸å®‰å…¨çš„æ ‡ç­¾""" if allowed_tags is None: allowed_tags = ['p', 'br', 'strong', 'em', 'u', 'a'] import bleach return bleach.clean( content, tags=allowed_tags, attributes={ 'a': ['href', 'title'], '*': ['class'] }, strip=True ) @staticmethod def validate_url(url: str) -> bool: """éªŒè¯URLå®‰å…¨æ€§""" import urllib.parse try: parsed = urllib.parse.urlparse(url) # æ£€æŸ¥åè®® if parsed.scheme not in ['http', 'https']: return False # æ£€æŸ¥æ˜¯å¦ä¸ºJavaScriptä¼ªåè®® if parsed.scheme.lower() == 'javascript': return False return True except Exception: return False # Webæ¡†æ¶é›†æˆç¤ºä¾‹ from flask import Flask, request, render_template_string app = Flask(__name__) # ä¸å®‰å…¨çš„ç¤ºä¾‹ @app.route('/unsafe') def unsafe_search(): query = request.args.get('q', '') # å±é™©ï¼šç›´æ¥æ¸²æŸ“ç”¨æˆ·è¾“å…¥ return render_template_string(f'&lt;p>æœç´¢ç»“æœ: {query}&lt;/p>') # å®‰å…¨çš„ç¤ºä¾‹ @app.route('/safe') def safe_search(): query = request.args.get('q', '') # è½¬ä¹‰ç”¨æˆ·è¾“å…¥ safe_query = XSSProtection.escape_html(query) # æˆ–ä½¿ç”¨æ¨¡æ¿å¼•æ“çš„è‡ªåŠ¨è½¬ä¹‰ return render_template_string( '&lt;p>æœç´¢ç»“æœ: {{ query }}&lt;/p>', query=safe_query ) # Content Security Policy (CSP) @app.after_request def add_security_headers(response): """æ·»åŠ å®‰å…¨å¤´""" csp = ( "default-src 'self'; " "script-src 'self' 'unsafe-inline' https://cdn.example.com; " "style-src 'self' 'unsafe-inline'; " "img-src 'self' data: https:; " "font-src 'self' data:; " "connect-src 'self'; " "frame-ancestors 'none';" ) response.headers['Content-Security-Policy'] = csp response.headers['X-Content-Type-Options'] = 'nosniff' response.headers['X-Frame-Options'] = 'DENY' response.headers['X-XSS-Protection'] = '1; mode=block' return response # ========== è¾“å…¥éªŒè¯ ========== class InputValidator: """è¾“å…¥éªŒè¯å™¨""" @staticmethod def validate_username(username: str) -> bool: """éªŒè¯ç”¨æˆ·å""" # é•¿åº¦æ£€æŸ¥ if len(username) &lt; 3 or len(username) > 20: return False # å­—ç¬¦æ£€æŸ¥ï¼šåªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ import re pattern = r'^[a-zA-Z0-9_]+$' return bool(re.match(pattern, username)) @staticmethod def validate_email(email: str) -> bool: """éªŒè¯é‚®ç®±""" import re pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$' return bool(re.match(pattern, email)) @staticmethod def validate_phone(phone: str) -> bool: """éªŒè¯æ‰‹æœºå·""" import re pattern = r'^1[3-9]\d{9}$' return bool(re.match(pattern, phone)) 1.3 CSRFé˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 # ========== CSRFæ”»å‡»åŸç† ========== """ CSRF (Cross-Site Request Forgery) è·¨ç«™è¯·æ±‚ä¼ªé€  æ”»å‡»åœºæ™¯ï¼š 1. ç”¨æˆ·ç™»å½•äº†é“¶è¡Œç½‘ç«™ bank.com 2. ç”¨æˆ·è®¿é—®äº†æ¶æ„ç½‘ç«™ evil.com 3. evil.com åŒ…å«æŒ‡å‘ bank.com çš„è¯·æ±‚ &lt;img src="http://bank.com/transfer?to=attacker&amp;amount=10000"> 4. æµè§ˆå™¨è‡ªåŠ¨æºå¸¦ bank.com çš„ cookie 5. é“¶è¡Œç½‘ç«™å¤„ç†è½¬è´¦è¯·æ±‚ é˜²å¾¡æªæ–½ï¼š 1. CSRF Token 2. SameSite Cookieå±æ€§ 3. éªŒè¯Referer/Originå¤´ 4. åŒé‡æäº¤Cookie """ # ========== CSRFé˜²æŠ¤å®ç° ========== import secrets from flask import Flask, request, session, render_template app = Flask(__name__) app.secret_key = secrets.token_hex(32) class CSRFProtection: """CSRFé˜²æŠ¤""" @staticmethod def generate_token() -> str: """ç”ŸæˆCSRF Token""" return secrets.token_hex(32) @staticmethod def validate_token(token: str, stored_token: str) -> bool: """éªŒè¯Token""" return secrets.compare_digest(token, stored_token) # åœ¨Flaskä¸­ä½¿ç”¨CSRFä¿æŠ¤ @app.before_request def csrf_protect(): """CSRFä¿æŠ¤ä¸­é—´ä»¶""" # è±å…å®‰å…¨çš„æ–¹æ³• if request.method in ['GET', 'HEAD', 'OPTIONS', 'TRACE']: return # æ£€æŸ¥CSRF Token token = request.headers.get('X-CSRF-Token') or request.form.get('csrf_token') if not token or token != session.get('csrf_token'): return 'Invalid CSRF token', 403 @app.route('/form') def show_form(): """æ˜¾ç¤ºè¡¨å•""" # ç”Ÿæˆå¹¶å­˜å‚¨CSRF Token csrf_token = CSRFProtection.generate_token() session['csrf_token'] = csrf_token return f''' &lt;form method="POST" action="/submit"> &lt;input type="hidden" name="csrf_token" value="{csrf_token}"> &lt;input type="text" name="username"> &lt;button type="submit">æäº¤&lt;/button> &lt;/form> ''' @app.route('/submit', methods=['POST']) def handle_submit(): """å¤„ç†è¡¨å•æäº¤""" # Tokenå·²åœ¨ä¸­é—´ä»¶éªŒè¯ username = request.form.get('username') # ä¸šåŠ¡é€»è¾‘ return f'Hello, {username}!' # ========== SameSite Cookie ========== @app.route('/login', methods=['POST']) def login(): """ç™»å½•""" # è®¾ç½®SameSiteå±æ€§ response = app.make_response('Login successful') # Strict: ä¸¥æ ¼æ¨¡å¼ï¼Œåªåœ¨åŒç«™ç‚¹è¯·æ±‚ä¸­å‘é€ response.set_cookie( 'session_id', value='session_data', httponly=True, secure=True, samesite='Strict' ) return response # ========== åŒé‡CookieéªŒè¯ ========== class DoubleSubmitCookie: """åŒé‡Cookie CSRFé˜²æŠ¤""" @staticmethod def generate_token(): """ç”ŸæˆTokenå¹¶è®¾ç½®åˆ°Cookie""" token = secrets.token_hex(32) @app.after_this_request def add_cookie(response): response.set_cookie( 'csrf_token', token, httponly=True, secure=True, samesite='Strict' ) return response return token @staticmethod def validate(request): """éªŒè¯Token""" cookie_token = request.cookies.get('csrf_token') request_token = request.form.get('csrf_token') or \ request.headers.get('X-CSRF-Token') return secrets.compare_digest(cookie_token, request_token) äºŒã€å…¶ä»–å¸¸è§Webæ¼æ´ 2.1 æ–‡ä»¶ä¸Šä¼ æ¼æ´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 # ========== æ–‡ä»¶ä¸Šä¼ å®‰å…¨ ========== import os import magic from werkzeug.utils import secure_filename from typing import Tuple class SecureFileUpload: """å®‰å…¨çš„æ–‡ä»¶ä¸Šä¼ """ # å…è®¸çš„æ–‡ä»¶ç±»å‹ ALLOWED_EXTENSIONS = { 'image': {'jpg', 'jpeg', 'png', 'gif', 'webp'}, 'document': {'pdf', 'doc', 'docx', 'txt'}, 'media': {'mp4', 'mp3', 'wav'} } # å…è®¸çš„MIMEç±»å‹ ALLOWED_MIME_TYPES = { 'image/jpeg', 'image/png', 'image/gif', 'image/webp', 'application/pdf', 'video/mp4', 'audio/mpeg' } # æœ€å¤§æ–‡ä»¶å¤§å° (10MB) MAX_FILE_SIZE = 10 * 1024 * 1024 def __init__(self, upload_dir: str): self.upload_dir = upload_dir os.makedirs(upload_dir, exist_ok=True) def validate_file(self, file) -> Tuple[bool, str]: """éªŒè¯æ–‡ä»¶""" # æ£€æŸ¥æ–‡ä»¶å filename = secure_filename(file.filename) if not filename: return False, "Invalid filename" # æ£€æŸ¥æ–‡ä»¶æ‰©å±•å ext = filename.rsplit('.', 1)[1].lower() if '.' in filename else '' if ext not in set().union(*self.ALLOWED_EXTENSIONS.values()): return False, f"File extension '{ext}' not allowed" # æ£€æŸ¥æ–‡ä»¶å¤§å° file.seek(0, os.SEEK_END) file_size = file.tell() file.seek(0) if file_size > self.MAX_FILE_SIZE: return False, f"File size exceeds {self.MAX_FILE_SIZE} bytes" # æ£€æŸ¥MIMEç±»å‹ file_content = file.read() mime_type = magic.from_buffer(file_content, mime=True) if mime_type not in self.ALLOWED_MIME_TYPES: return False, f"MIME type '{mime_type}' not allowed" # éªŒè¯æ‰©å±•åå’ŒMIMEç±»å‹æ˜¯å¦åŒ¹é… ext_mime_map = { 'jpg': 'image/jpeg', 'jpeg': 'image/jpeg', 'png': 'image/png', 'gif': 'image/gif', 'pdf': 'application/pdf' } if ext in ext_mime_map and ext_mime_map[ext] != mime_type: return False, "File extension does not match content" return True, "Valid file" def save_file(self, file) -> Tuple[bool, str]: """ä¿å­˜æ–‡ä»¶""" # éªŒè¯æ–‡ä»¶ is_valid, message = self.validate_file(file) if not is_valid: return False, message # ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶å import uuid original_filename = secure_filename(file.filename) ext = original_filename.rsplit('.', 1)[1].lower() safe_filename = f"{uuid.uuid4().hex}.{ext}" # ä¿å­˜æ–‡ä»¶ filepath = os.path.join(self.upload_dir, safe_filename) file.seek(0) file.save(filepath) # è®¾ç½®æ–‡ä»¶æƒé™ os.chmod(filepath, 0o644) return True, safe_filename # Flaskè·¯ç”±ç¤ºä¾‹ from flask import Flask, request, jsonify app = Flask(__name__) uploader = SecureFileUpload('/var/uploads') @app.route('/upload', methods=['POST']) def upload_file(): """æ–‡ä»¶ä¸Šä¼ æ¥å£""" if 'file' not in request.files: return jsonify({'error': 'No file provided'}), 400 file = request.files['file'] if file.filename == '': return jsonify({'error': 'Empty filename'}), 400 # ä¿å­˜æ–‡ä»¶ success, message = uploader.save_file(file) if success: return jsonify({ 'success': True, 'filename': message }) else: return jsonify({ 'success': False, 'error': message }), 400 2.2 æƒé™ç»•è¿‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 # ========== æƒé™æ§åˆ¶ ========== from functools import wraps from flask import session, request, jsonify class PermissionChecker: """æƒé™æ£€æŸ¥å™¨""" # æƒé™å®šä¹‰ PERMISSIONS = { 'user:read': 'æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯', 'user:write': 'ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯', 'user:delete': 'åˆ é™¤ç”¨æˆ·', 'admin:panel': 'è®¿é—®ç®¡ç†é¢æ¿', 'system:config': 'ä¿®æ”¹ç³»ç»Ÿé…ç½®' } # è§’è‰²æƒé™æ˜ å°„ ROLE_PERMISSIONS = { 'guest': ['user:read'], 'user': ['user:read', 'user:write'], 'moderator': ['user:read', 'user:write', 'user:delete'], 'admin': ['admin:panel', 'system:config'], 'superadmin': ['*'] # æ‰€æœ‰æƒé™ } @classmethod def has_permission(cls, role: str, required_permission: str) -> bool: """æ£€æŸ¥è§’è‰²æ˜¯å¦æœ‰æƒé™""" if role not in cls.ROLE_PERMISSIONS: return False permissions = cls.ROLE_PERMISSIONS[role] # è¶…çº§ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™ if '*' in permissions: return True return required_permission in permissions # è£…é¥°å™¨å®ç°æƒé™æ§åˆ¶ def require_permission(permission: str): """æƒé™æ£€æŸ¥è£…é¥°å™¨""" def decorator(f): @wraps(f) def decorated_function(*args, **kwargs): # ä»sessionè·å–ç”¨æˆ·è§’è‰² role = session.get('role', 'guest') # æ£€æŸ¥æƒé™ if not PermissionChecker.has_permission(role, permission): return jsonify({ 'error': 'Permission denied', 'required': permission }), 403 return f(*args, **kwargs) return decorated_function return decorator # èµ„æºæ‰€æœ‰è€…æ£€æŸ¥ def require_owner_or_admin(model_name: str, id_param: str = 'id'): """èµ„æºæ‰€æœ‰è€…æˆ–ç®¡ç†å‘˜æƒé™æ£€æŸ¥""" def decorator(f): @wraps(f) def decorated_function(*args, **kwargs): user_id = session.get('user_id') role = session.get('role', 'guest') # ç®¡ç†å‘˜è·³è¿‡æ£€æŸ¥ if role == 'superadmin': return f(*args, **kwargs) # è·å–èµ„æºID resource_id = kwargs.get(id_param) or request.view_args.get(id_param) # æ£€æŸ¥èµ„æºæ‰€æœ‰è€… from database import get_db db = get_db() resource = db.query(model_name).get(resource_id) if resource and resource.owner_id == user_id: return f(*args, **kwargs) return jsonify({'error': 'Resource access denied'}), 403 return decorated_function return decorator # ä½¿ç”¨ç¤ºä¾‹ @app.route('/users/&lt;int:id>', methods=['GET']) @require_permission('user:read') def get_user(id): """è·å–ç”¨æˆ·ä¿¡æ¯""" return jsonify({'user': f'User {id}'}) @app.route('/users/&lt;int:id>', methods=['PUT']) @require_permission('user:write') @require_owner_or_admin('User', 'id') def update_user(id): """æ›´æ–°ç”¨æˆ·ä¿¡æ¯""" return jsonify({'success': True}) @app.route('/users/&lt;int:id>', methods=['DELETE']) @require_permission('user:delete') def delete_user(id): """åˆ é™¤ç”¨æˆ·""" return jsonify({'success': True}) # ========== æ°´å¹³è¶Šæƒé˜²æŠ¤ ========== class AccessControl: """è®¿é—®æ§åˆ¶""" @staticmethod def check_resource_access(user_id: int, resource_id: int, resource_type: str) -> bool: """æ£€æŸ¥èµ„æºè®¿é—®æƒé™""" from database import get_db db = get_db() # æ£€æŸ¥èµ„æºæ˜¯å¦å­˜åœ¨ resource = db.query(resource_type).get(resource_id) if not resource: return False # æ£€æŸ¥èµ„æºæ‰€æœ‰è€… if resource.owner_id == user_id: return True # æ£€æŸ¥å…±äº«æƒé™ if hasattr(resource, 'shared_with'): if user_id in resource.shared_with: return True return False @staticmethod def check_id_or_id_list(user_input, max_length: int = 1000) -> bool: """æ£€æŸ¥IDå‚æ•°ï¼Œé˜²æ­¢IDéå†æ”»å‡»""" # å•ä¸ªID if isinstance(user_input, int): return 0 &lt; user_input &lt; max_length # IDåˆ—è¡¨ if isinstance(user_input, list): if len(user_input) > 100: # é™åˆ¶åˆ—è¡¨é•¿åº¦ return False return all( isinstance(id, int) and 0 &lt; id &lt; max_length for id in user_input ) return False ä¸‰ã€æ¸—é€æµ‹è¯•ä¸æ¼æ´æŒ–æ˜ 3.1 ä¿¡æ¯æ”¶é›† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 # ========== ä¿¡æ¯æ”¶é›†å·¥å…· ========== import requests import dns.resolver import socket from typing import List, Dict, Set from urllib.parse import urlparse import re class InformationGathering: """ä¿¡æ¯æ”¶é›†""" def __init__(self, target: str): self.target = target self.results = { 'subdomains': set(), 'open_ports': [], 'technologies': [], 'sensitive_files': [], 'emails': set(), 'social_accounts': set() } def enumerate_subdomains(self) -> Set[str]: """å­åŸŸåæšä¸¾""" wordlist = [ 'www', 'mail', 'ftp', 'admin', 'blog', 'api', 'dev', 'staging', 'test', 'app', 'mobile' ] for subdomain in wordlist: domain = f"{subdomain}.{self.target}" try: # DNSæŸ¥è¯¢ dns.resolver.resolve(domain, 'A') self.results['subdomains'].add(domain) except (dns.resolver.NXDOMAIN, dns.resolver.NoAnswer): continue return self.results['subdomains'] def scan_ports(self, ports: List[int] = None) -> List[int]: """ç«¯å£æ‰«æ""" if ports is None: ports = [21, 22, 23, 25, 53, 80, 110, 443, 445, 3306, 3389, 8080] open_ports = [] for port in ports: sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.settimeout(1) try: sock.connect((self.target, port)) open_ports.append(port) except socket.error: pass finally: sock.close() self.results['open_ports'] = open_ports return open_ports def identify_technologies(self) -> List[str]: """æŠ€æœ¯æ ˆè¯†åˆ«""" url = f"http://{self.target}" try: response = requests.get(url, timeout=10) # æ£€æŸ¥å“åº”å¤´ headers = response.headers technologies = [] # Serverå¤´ if 'Server' in headers: technologies.append(f"Server: {headers['Server']}") # X-Powered-Byå¤´ if 'X-Powered-By' in headers: technologies.append(f"PoweredBy: {headers['X-Powered-By']}") # æ£€æŸ¥HTMLä¸­çš„æŠ€æœ¯ç‰¹å¾ content = response.text # WordPress if 'wp-content' in content: technologies.append("WordPress") # jQuery if 'jquery' in content.lower(): technologies.append("jQuery") # React if 'react' in content.lower(): technologies.append("React") # Vue if 'vue' in content.lower(): technologies.append("Vue") self.results['technologies'] = technologies except requests.RequestException: pass return self.results['technologies'] def find_sensitive_files(self) -> List[str]: """æ•æ„Ÿæ–‡ä»¶æ‰«æ""" sensitive_paths = [ '/robots.txt', '/.git/config', '/.env', '/wp-config.php', '/web.config', '/.htaccess', '/admin', '/phpmyadmin', '/backup.zip', '/database.sql' ] found_files = [] for path in sensitive_paths: url = f"http://{self.target}{path}" try: response = requests.get(url, timeout=5) if response.status_code in [200, 301, 302]: found_files.append(path) except requests.RequestException: continue self.results['sensitive_files'] = found_files return found_files def extract_emails(self) -> Set[str]: """æå–é‚®ç®±åœ°å€""" url = f"http://{self.target}" try: response = requests.get(url, timeout=10) content = response.text # é‚®ç®±æ­£åˆ™ email_pattern = r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b' emails = set(re.findall(email_pattern, content, re.IGNORECASE)) self.results['emails'] = emails except requests.RequestException: pass return self.results['emails'] def generate_report(self) -> Dict: """ç”ŸæˆæŠ¥å‘Š""" return { 'target': self.target, 'subdomains': list(self.results['subdomains']), 'open_ports': self.results['open_ports'], 'technologies': self.results['technologies'], 'sensitive_files': self.results['sensitive_files'], 'emails': list(self.results['emails']), 'social_accounts': list(self.results['social_accounts']) } 3.2 æ¼æ´æ‰«æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 # ========== æ¼æ´æ‰«æå™¨ ========== import requests from typing import Dict, List import re class VulnerabilityScanner: """æ¼æ´æ‰«æå™¨""" def __init__(self, target: str): self.target = target self.vulnerabilities = [] def scan_sql_injection(self, urls: List[str]) -> List[Dict]: """SQLæ³¨å…¥æ‰«æ""" payloads = [ "'", "' OR '1'='1", "' OR '1'='1'--", "admin'--", "1' ORDER BY 1--", "1' UNION SELECT NULL--" ] found = [] for url in urls: for payload in payloads: try: # æµ‹è¯•GETå‚æ•° if '?' in url: test_url = f"{url}{payload}" response = requests.get(test_url, timeout=5) # æ£€æŸ¥SQLé”™è¯¯ç‰¹å¾ sql_errors = [ "You have an error in your SQL syntax", "Warning: mysql_fetch_array()", "ORA-01756: quoted string not properly terminated", "Unclosed quotation mark after the character string" ] if any(error in response.text for error in sql_errors): found.append({ 'type': 'SQL Injection', 'url': url, 'payload': payload, 'severity': 'High' }) except requests.RequestException: continue self.vulnerabilities.extend(found) return found def scan_xss(self, urls: List[str]) -> List[Dict]: """XSSæ‰«æ""" payloads = [ "&lt;script>alert('XSS')&lt;/script>", "&lt;img src=x onerror=alert('XSS')>", "&lt;svg onload=alert('XSS')>", "javascript:alert('XSS')", "'>&lt;script>alert('XSS')&lt;/script>" ] found = [] for url in urls: for payload in payloads: try: # URLç¼–ç payload import urllib.parse encoded_payload = urllib.parse.quote(payload) test_url = f"{url}{encoded_payload}" response = requests.get(test_url, timeout=5) # æ£€æŸ¥payloadæ˜¯å¦è¢«åå°„ if payload in response.text or encoded_payload in response.text: found.append({ 'type': 'XSS', 'url': url, 'payload': payload, 'severity': 'High' }) except requests.RequestException: continue self.vulnerabilities.extend(found) return found def check_security_headers(self, url: str) -> Dict: """å®‰å…¨å¤´æ£€æŸ¥""" try: response = requests.get(url, timeout=10) headers = response.headers missing_headers = [] # æ£€æŸ¥å¿…è¦çš„å®‰å…¨å¤´ security_headers = { 'X-Frame-Options': 'é˜²æ­¢ç‚¹å‡»åŠ«æŒ', 'X-Content-Type-Options': 'é˜²æ­¢MIMEç±»å‹å—…æ¢', 'X-XSS-Protection': 'XSSè¿‡æ»¤', 'Content-Security-Policy': 'å†…å®¹å®‰å…¨ç­–ç•¥', 'Strict-Transport-Security': 'å¼ºåˆ¶HTTPS' } for header, description in security_headers.items(): if header not in headers: missing_headers.append({ 'header': header, 'description': description }) return { 'url': url, 'missing_headers': missing_headers, 'severity': 'Medium' if missing_headers else 'Low' } except requests.RequestException: return {'error': 'Failed to check headers'} def scan_directory_traversal(self, base_url: str) -> List[Dict]: """ç›®å½•éå†æ‰«æ""" payloads = [ '../../../etc/passwd', '..\\..\\..\\windows\\win.ini', '....//....//....//etc/passwd', '%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd' ] found = [] # å¸¸è§çš„å¯æµ‹è¯•ç«¯ç‚¹ test_paths = [ '/download', '/file', '/image', '/document' ] for path in test_paths: for payload in payloads: try: test_url = f"{base_url}{path}?file={payload}" response = requests.get(test_url, timeout=5) # æ£€æŸ¥å“åº”å†…å®¹ if 'root:' in response.text or '[extensions]' in response.text: found.append({ 'type': 'Directory Traversal', 'url': test_url, 'payload': payload, 'severity': 'High' }) except requests.RequestException: continue self.vulnerabilities.extend(found) return found def generate_report(self) -> Dict: """ç”Ÿæˆæ‰«ææŠ¥å‘Š""" # ç»Ÿè®¡æ¼æ´ vuln_count = { 'Critical': 0, 'High': 0, 'Medium': 0, 'Low': 0 } for vuln in self.vulnerabilities: severity = vuln.get('severity', 'Low') vuln_count[severity] = vuln_count.get(severity, 0) + 1 return { 'target': self.target, 'total_vulnerabilities': len(self.vulnerabilities), 'by_severity': vuln_count, 'vulnerabilities': self.vulnerabilities } å››ã€å®‰å…¨ç¼–ç æœ€ä½³å®è·µ 4.1 å¯†ç å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 # ========== å¯†ç å“ˆå¸Œä¸éªŒè¯ ========== import bcrypt import secrets import hashlib from typing import Tuple class PasswordSecurity: """å¯†ç å®‰å…¨""" @staticmethod def hash_password(password: str) -> str: """å“ˆå¸Œå¯†ç """ # ç”Ÿæˆç›å€¼ salt = bcrypt.gensalt(rounds=12) # å“ˆå¸Œå¯†ç  hashed = bcrypt.hashpw(password.encode('utf-8'), salt) return hashed.decode('utf-8') @staticmethod def verify_password(password: str, hashed: str) -> bool: """éªŒè¯å¯†ç """ try: return bcrypt.checkpw( password.encode('utf-8'), hashed.encode('utf-8') ) except Exception: return False @staticmethod def validate_password_strength(password: str) -> Tuple[bool, list]: """éªŒè¯å¯†ç å¼ºåº¦""" errors = [] # é•¿åº¦æ£€æŸ¥ if len(password) &lt; 8: errors.append("å¯†ç é•¿åº¦è‡³å°‘8ä½") if len(password) > 128: errors.append("å¯†ç é•¿åº¦ä¸è¶…è¿‡128ä½") # å¤æ‚åº¦æ£€æŸ¥ has_upper = any(c.isupper() for c in password) has_lower = any(c.islower() for c in password) has_digit = any(c.isdigit() for c in password) has_special = any(c in "!@#$%^&*()_+-=[]{}|;:,.&lt;>?" for c in password) if not (has_upper and has_lower): errors.append("å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯") if not has_digit: errors.append("å¯†ç å¿…é¡»åŒ…å«æ•°å­—") if not has_special: errors.append("å¯†ç å¿…é¡»åŒ…å«ç‰¹æ®Šå­—ç¬¦") # å¸¸è§å¼±å¯†ç æ£€æŸ¥ common_passwords = [ 'password', '12345678', 'qwerty', 'abc123', 'admin', 'welcome', 'password123' ] if password.lower() in common_passwords: errors.append("å¯†ç è¿‡äºå¸¸è§") return len(errors) == 0, errors @staticmethod def generate_reset_token() -> str: """ç”Ÿæˆå¯†ç é‡ç½®ä»¤ç‰Œ""" return secrets.token_urlsafe(32) @staticmethod def hash_reset_token(token: str) -> str: """å“ˆå¸Œé‡ç½®ä»¤ç‰Œç”¨äºå­˜å‚¨""" return hashlib.sha256(token.encode()).hexdigest() # ========== å¯†ç ç­–ç•¥ ========== class PasswordPolicy: """å¯†ç ç­–ç•¥""" def __init__( self, min_length: int = 8, max_length: int = 128, require_uppercase: bool = True, require_lowercase: bool = True, require_digit: bool = True, require_special: bool = True, expire_days: int = 90, prevent_reuse: int = 5 ): self.min_length = min_length self.max_length = max_length self.require_uppercase = require_uppercase self.require_lowercase = require_lowercase self.require_digit = require_digit self.require_special = require_special self.expire_days = expire_days self.prevent_reuse = prevent_reuse def validate(self, password: str, user_history: list = None) -> Tuple[bool, list]: """éªŒè¯å¯†ç """ errors = [] # é•¿åº¦ if len(password) &lt; self.min_length: errors.append(f"å¯†ç é•¿åº¦è‡³å°‘{self.min_length}ä½") if len(password) > self.max_length: errors.append(f"å¯†ç é•¿åº¦ä¸è¶…è¿‡{self.max_length}ä½") # å¤æ‚åº¦ if self.require_uppercase and not any(c.isupper() for c in password): errors.append("å¯†ç å¿…é¡»åŒ…å«å¤§å†™å­—æ¯") if self.require_lowercase and not any(c.islower() for c in password): errors.append("å¯†ç å¿…é¡»åŒ…å«å°å†™å­—æ¯") if self.require_digit and not any(c.isdigit() for c in password): errors.append("å¯†ç å¿…é¡»åŒ…å«æ•°å­—") if self.require_special and not any( c in "!@#$%^&*()_+-=[]{}|;:,.&lt;>?" for c in password ): errors.append("å¯†ç å¿…é¡»åŒ…å«ç‰¹æ®Šå­—ç¬¦") # å†å²å¯†ç æ£€æŸ¥ if user_history and self.prevent_reuse: recent_passwords = user_history[:self.prevent_reuse] for old_hashed in recent_passwords: if PasswordSecurity.verify_password(password, old_hashed): errors.append(f"ä¸èƒ½ä½¿ç”¨æœ€è¿‘{self.prevent_reuse}æ¬¡ä½¿ç”¨è¿‡çš„å¯†ç ") break return len(errors) == 0, errors 4.2 æ•æ„Ÿæ•°æ®ä¿æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 # ========== æ•æ„Ÿæ•°æ®åŠ å¯† ========== from cryptography.fernet import Fernet from cryptography.hazmat.primitives import hashes from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2 import os import base64 from typing import Any import json class DataEncryption: """æ•°æ®åŠ å¯†""" @staticmethod def generate_key() -> bytes: """ç”ŸæˆåŠ å¯†å¯†é’¥""" return Fernet.generate_key() @staticmethod def encrypt_data(data: str, key: bytes) -> str: """åŠ å¯†æ•°æ®""" f = Fernet(key) encrypted = f.encrypt(data.encode()) return base64.b64encode(encrypted).decode() @staticmethod def decrypt_data(encrypted_data: str, key: bytes) -> str: """è§£å¯†æ•°æ®""" f = Fernet(key) encrypted = base64.b64decode(encrypted_data.encode()) decrypted = f.decrypt(encrypted) return decrypted.decode() @staticmethod def encrypt_dict(data: dict, key: bytes) -> str: """åŠ å¯†å­—å…¸æ•°æ®""" json_str = json.dumps(data) return DataEncryption.encrypt_data(json_str, key) @staticmethod def decrypt_dict(encrypted_data: str, key: bytes) -> dict: """è§£å¯†å­—å…¸æ•°æ®""" json_str = DataEncryption.decrypt_data(encrypted_data, key) return json.loads(json_str) class SecureStorage: """å®‰å…¨å­˜å‚¨""" def __init__(self, encryption_key: bytes): self.encryption_key = encryption_key def store_sensitive_data(self, key: str, data: Any): """å­˜å‚¨æ•æ„Ÿæ•°æ®""" # åºåˆ—åŒ–æ•°æ® if isinstance(data, dict): encrypted = DataEncryption.encrypt_dict(data, self.encryption_key) else: encrypted = DataEncryption.encrypt_data(str(data), self.encryption_key) # å­˜å‚¨åˆ°æ•°æ®åº“æˆ–æ–‡ä»¶ # è¿™é‡Œç®€åŒ–ä¸ºå†…å­˜å­˜å‚¨ self.storage[key] = encrypted def retrieve_sensitive_data(self, key: str) -> Any: """æ£€ç´¢æ•æ„Ÿæ•°æ®""" encrypted = self.storage.get(key) if not encrypted: return None # å°è¯•è§£å¯†ä¸ºå­—å…¸ try: return DataEncryption.decrypt_dict(encrypted, self.encryption_key) except: return DataEncryption.decrypt_data(encrypted, self.encryption_key) # ========== æ—¥å¿—è„±æ• ========== import re class LogSanitizer: """æ—¥å¿—è„±æ•""" # æ•æ„Ÿä¿¡æ¯æ­£åˆ™æ¨¡å¼ PATTERNS = { 'email': r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b', 'phone': r'\b1[3-9]\d{9}\b', 'id_card': r'\b\d{17}[\dXx]\b', 'credit_card': r'\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}\b', 'password': r'(password|pwd|passwd)\s*[=:]\s*\S+', 'token': r'(token|api_key|secret)\s*[=:]\s*\S+', 'ip': r'\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b' } @classmethod def sanitize(cls, log_message: str) -> str: """è„±æ•æ—¥å¿—""" sanitized = log_message for pattern_type, pattern in cls.PATTERNS.items(): if pattern_type == 'email': sanitized = re.sub( pattern, lambda m: f"{m.group(0)[0]}***@{m.group(0).split('@')[1]}", sanitized ) elif pattern_type == 'phone': sanitized = re.sub( pattern, lambda m: f"{m.group(0)[:3]}****{m.group(0)[7:]}", sanitized ) elif pattern_type == 'id_card': sanitized = re.sub( pattern, lambda m: f"{m.group(0)[:6]}********{m.group(0)[14:]}", sanitized ) elif pattern_type in ['password', 'token', 'credit_card']: sanitized = re.sub( pattern, lambda m: f"{m.group(0).split('=')[0].split(':')[0]}=***", sanitized ) elif pattern_type == 'ip': sanitized = re.sub( pattern, lambda m: f"{m.group(0).rsplit('.', 1)[0]}.*", sanitized ) return sanitized @classmethod def sanitize_dict(cls, data: dict) -> dict: """è„±æ•å­—å…¸æ•°æ®""" sanitized = {} for key, value in data.items(): if isinstance(value, str): sanitized[key] = cls.sanitize(value) elif isinstance(value, dict): sanitized[key] = cls.sanitize_dict(value) else: sanitized[key] = value return sanitized æ€»ç»“ ç½‘ç»œå®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%AE%89%E5%85%A8/ class=category-link>å®‰å…¨</a><a href=/blog/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/ class=category-link>ç½‘ç»œå®‰å…¨</a></div><span class=post-date>2025-12-30</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to ç½‘ç»œå®‰å…¨ä¸æ¼æ´æ·±åº¦åˆ†æï¼šä»æ”»å‡»åˆ°é˜²å¾¡çš„å®Œæ•´æŒ‡å—" href=/blog/articles/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E4%B8%8E%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E4%BB%8E%E6%94%BB%E5%87%BB%E5%88%B0%E9%98%B2%E5%BE%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/></a></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>