<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ç”¨Rustæ„å»ºé«˜æ€§èƒ½CLIå·¥å…·ï¼šä»é›¶åˆ°éƒ¨ç½²å®Œæ•´æŒ‡å— | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="Rust,CLI,å¼€å‘å·¥å…·,è·¨å¹³å°,æ€§èƒ½ä¼˜åŒ–"><meta name=description content="è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Rustè¯­è¨€æ„å»ºè·¨å¹³å°ã€é«˜æ€§èƒ½çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ¶µç›–é¡¹ç›®ç»“æ„ã€ä¾èµ–ç®¡ç†ã€é”™è¯¯å¤„ç†ã€å‘å¸ƒéƒ¨ç½²ç­‰å®Œæ•´æµç¨‹"><meta name=author content="æŠ€æœ¯å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/%E7%94%A8rust%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BDcli%E5%B7%A5%E5%85%B7%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/%E7%94%A8rust%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BDcli%E5%B7%A5%E5%85%B7%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/%E7%94%A8rust%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BDcli%E5%B7%A5%E5%85%B7%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/%E7%94%A8rust%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BDcli%E5%B7%A5%E5%85%B7%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="ç”¨Rustæ„å»ºé«˜æ€§èƒ½CLIå·¥å…·ï¼šä»é›¶åˆ°éƒ¨ç½²å®Œæ•´æŒ‡å—"><meta property="og:description" content="è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Rustè¯­è¨€æ„å»ºè·¨å¹³å°ã€é«˜æ€§èƒ½çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ¶µç›–é¡¹ç›®ç»“æ„ã€ä¾èµ–ç®¡ç†ã€é”™è¯¯å¤„ç†ã€å‘å¸ƒéƒ¨ç½²ç­‰å®Œæ•´æµç¨‹"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-04T11:00:00+08:00"><meta property="article:modified_time" content="2026-01-04T11:00:00+08:00"><meta property="article:tag" content="Rust"><meta property="article:tag" content="CLI"><meta property="article:tag" content="å¼€å‘å·¥å…·"><meta property="article:tag" content="è·¨å¹³å°"><meta property="article:tag" content="æ€§èƒ½ä¼˜åŒ–"><meta name=twitter:card content="summary"><meta name=twitter:title content="ç”¨Rustæ„å»ºé«˜æ€§èƒ½CLIå·¥å…·ï¼šä»é›¶åˆ°éƒ¨ç½²å®Œæ•´æŒ‡å—"><meta name=twitter:description content="è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Rustè¯­è¨€æ„å»ºè·¨å¹³å°ã€é«˜æ€§èƒ½çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ¶µç›–é¡¹ç›®ç»“æ„ã€ä¾èµ–ç®¡ç†ã€é”™è¯¯å¤„ç†ã€å‘å¸ƒéƒ¨ç½²ç­‰å®Œæ•´æµç¨‹"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"ç”¨Rustæ„å»ºé«˜æ€§èƒ½CLIå·¥å…·ï¼šä»é›¶åˆ°éƒ¨ç½²å®Œæ•´æŒ‡å—","item":"/blog/articles/%E7%94%A8rust%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BDcli%E5%B7%A5%E5%85%B7%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ç”¨Rustæ„å»ºé«˜æ€§èƒ½CLIå·¥å…·ï¼šä»é›¶åˆ°éƒ¨ç½²å®Œæ•´æŒ‡å—","name":"ç”¨Rustæ„å»ºé«˜æ€§èƒ½CLIå·¥å…·ï¼šä»é›¶åˆ°éƒ¨ç½²å®Œæ•´æŒ‡å—","description":"è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Rustè¯­è¨€æ„å»ºè·¨å¹³å°ã€é«˜æ€§èƒ½çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ¶µç›–é¡¹ç›®ç»“æ„ã€ä¾èµ–ç®¡ç†ã€é”™è¯¯å¤„ç†ã€å‘å¸ƒéƒ¨ç½²ç­‰å®Œæ•´æµç¨‹","keywords":["Rust","CLI","å¼€å‘å·¥å…·","è·¨å¹³å°","æ€§èƒ½ä¼˜åŒ–"],"articleBody":"å‰è¨€ å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰æ˜¯å¼€å‘è€…æ—¥å¸¸å·¥ä½œä¸­ä¸å¯æˆ–ç¼ºçš„åˆ©å™¨ã€‚ä¼ ç»Ÿçš„Node.jsæˆ–Pythonè„šæœ¬åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶å¾€å¾€é¢ä¸´æ€§èƒ½ç“¶é¢ˆã€‚Rustè¯­è¨€å‡­å€Ÿå…¶é›¶æˆæœ¬æŠ½è±¡ã€å†…å­˜å®‰å…¨å’Œå“è¶Šçš„æ€§èƒ½ï¼Œæˆä¸ºæ„å»ºCLIå·¥å…·çš„ç†æƒ³é€‰æ‹©ã€‚\næœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªå®é™…é¡¹ç›®â€”â€”æ‰¹é‡å›¾ç‰‡å¤„ç†å·¥å…·ï¼Œå®Œæ•´å±•ç¤ºä½¿ç”¨Rustæ„å»ºCLIå·¥å…·çš„å…¨è¿‡ç¨‹ã€‚\né¡¹ç›®åˆå§‹åŒ– 1. åˆ›å»ºé¡¹ç›® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®‰è£…Rustå·¥å…·é“¾ curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh # åˆ›å»ºæ–°çš„äºŒè¿›åˆ¶é¡¹ç›® cargo new imgproc --bin cd imgproc # æ·»åŠ å¸¸ç”¨ä¾èµ– cargo add clap --features derive cargo add anyhow cargo add thiserror cargo add tokio --features full cargo add indicatif cargo add console 2. é¡¹ç›®ç»“æ„ imgproc/ â”œâ”€â”€ Cargo.toml # ä¾èµ–é…ç½® â”œâ”€â”€ src/ â”‚ â”œâ”€â”€ main.rs # å…¥å£æ–‡ä»¶ â”‚ â”œâ”€â”€ cli.rs # å‘½ä»¤è¡Œå‚æ•°å®šä¹‰ â”‚ â”œâ”€â”€ processor.rs # æ ¸å¿ƒå¤„ç†é€»è¾‘ â”‚ â”œâ”€â”€ error.rs # é”™è¯¯ç±»å‹å®šä¹‰ â”‚ â””â”€â”€ utils.rs # å·¥å…·å‡½æ•° â”œâ”€â”€ tests/ â”‚ â””â”€â”€ integration_test.rs â””â”€â”€ README.md å‘½ä»¤è¡Œå‚æ•°å¤„ç† ä½¿ç”¨clapåº“å®šä¹‰å‘½ä»¤è¡Œæ¥å£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 // src/cli.rs use clap::Parser; #[derive(Parser, Debug)] #[command(name = \"imgproc\")] #[command(about = \"A high-performance image processing tool\", long_about = None)] pub struct Args { /// Input file or directory #[arg(short, long)] pub input: String, /// Output directory #[arg(short, long)] pub output: Option\u003cString\u003e, /// Operation to perform #[arg(short, long)] pub operation: Operation, /// Resize width (for resize operation) #[arg(long)] pub width: Option\u003cu32\u003e, /// Resize height (for resize operation) #[arg(long)] pub height: Option\u003cu32\u003e, /// JPEG quality (1-100) #[arg(short, long, default_value_t = 85)] pub quality: u8, /// Enable verbose output #[arg(short, long)] pub verbose: bool, /// Number of threads to use #[arg(short, long, default_value_t = 4)] pub threads: usize, } #[derive(Clone, Debug, PartialEq)] pub enum Operation { Resize, Compress, Convert, Grayscale, Thumbnail, } é”™è¯¯å¤„ç†ä½“ç³» å®šä¹‰æ¸…æ™°çš„é”™è¯¯ç±»å‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // src/error.rs use thiserror::Error; #[derive(Error, Debug)] pub enum ImgProcError { #[error(\"IO error: {0}\")] Io(#[from] std::io::Error), #[error(\"Image processing error: {0}\")] Image(String), #[error(\"Invalid configuration: {0}\")] Config(String), #[error(\"Operation cancelled by user\")] Cancelled, } pub type Result\u003cT\u003e = std::result::Result\u003cT, ImgProcError\u003e; æ ¸å¿ƒå¤„ç†é€»è¾‘ å¹¶å‘å¤„ç†æ¡†æ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 // src/processor.rs use anyhow::Context; use image::{DynamicImage, ImageEncoder, ImageFormat}; use rayon::prelude::*; use std::path::Path; use tokio::fs; pub struct ImageProcessor { config: ProcessingConfig, progress: indicatif::ProgressBar, } #[derive(Clone)] pub struct ProcessingConfig { pub operation: Operation, pub quality: u8, pub width: Option\u003cu32\u003e, pub height: Option\u003cu32\u003e, pub threads: usize, } impl ImageProcessor { pub fn new(config: ProcessingConfig) -\u003e Self { let progress = indicatif::ProgressBar::new_spinner(); progress.set_style(indicatif::ProgressStyle::default_bar() .template(\"{spinner:.green} [{elapsed_precise}] [{bar:40.cyan/blue}] {pos}/{len} ({eta})\") .unwrap() .progress_chars(\"#\u003e-\")); Self { config, progress } } pub async fn process_directory(\u0026self, input_dir: \u0026Path, output_dir: \u0026Path) -\u003e Result\u003c()\u003e { let entries = fs::read_dir(input_dir).await?; let images: Vec\u003c_\u003e = entries .filter_map(|e| e.ok()) .filter(|e| { e.path().extension() .and_then(|s| s.to_str()) .map(|s| matches!(s.to_lowercase().as_str(), \"jpg\" | \"jpeg\" | \"png\" | \"webp\")) .unwrap_or(false) }) .collect(); self.progress.set_length(images.len() as u64); // ä½¿ç”¨rayonå¹¶è¡Œå¤„ç† let pool = rayon::ThreadPoolBuilder::new() .num_threads(self.config.threads) .build() .context(\"Failed to create thread pool\")?; pool.install(|| { images.par_iter().for_each(|entry| { if let Err(e) = self.process_single_image(entry.path(), output_dir) { eprintln!(\"Error processing {:?}: {}\", entry.path(), e); } self.progress.inc(1); }); }); self.progress.finish_with_message(\"Processing complete!\"); Ok(()) } fn process_single_image(\u0026self, input_path: std::path::PathBuf, output_dir: \u0026Path) -\u003e Result\u003c()\u003e { let img = image::open(\u0026input_path) .map_err(|e| ImgProcError::Image(format!(\"Failed to load image: {}\", e)))?; let processed = match self.config.operation { Operation::Resize =\u003e self.resize_image(img), Operation::Compress =\u003e self.compress_image(img), Operation::Grayscale =\u003e self.grayscale_image(img), Operation::Convert =\u003e self.convert_format(img, ImageFormat::Jpeg), Operation::Thumbnail =\u003e self.create_thumbnail(img), }?; let filename = input_path .file_name() .ok_or_else(|| ImgProcError::Config(\"Invalid filename\".to_string()))?; let output_path = output_dir.join(filename); processed.save(output_path) .map_err(|e| ImgProcError::Image(format!(\"Failed to save: {}\", e)))?; Ok(()) } fn resize_image(\u0026self, img: DynamicImage) -\u003e Result\u003cDynamicImage\u003e { let (width, height) = ( self.config.width.unwrap_or(img.width()), self.config.height.unwrap_or(img.height()), ); Ok(img.resize( width, height, image::imageops::FilterType::Lanczos3, )) } fn compress_image(\u0026self, img: DynamicImage) -\u003e Result\u003cDynamicImage\u003e { // å¯¹äºJPEGï¼Œç›´æ¥è°ƒæ•´è´¨é‡å‚æ•° Ok(img) } fn grayscale_image(\u0026self, img: DynamicImage) -\u003e Result\u003cDynamicImage\u003e { Ok(img.grayscale()) } fn convert_format(\u0026self, img: DynamicImage, format: ImageFormat) -\u003e Result\u003cDynamicImage\u003e { Ok(img) // æ ¼å¼è½¬æ¢åœ¨ä¿å­˜æ—¶å¤„ç† } fn create_thumbnail(\u0026self, img: DynamicImage) -\u003e Result\u003cDynamicImage\u003e { const THUMB_SIZE: u32 = 150; Ok(img.thumbnail(THUMB_SIZE, THUMB_SIZE)) } } ä¼˜é›…çš„è¿›åº¦æ˜¾ç¤º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 use console::{Style, Term}; use indicatif::{HumanDuration, MultiProgress, ProgressBar}; pub fn setup_progress_bars() -\u003e (MultiProgress, ProgressBar, ProgressBar) { let m = MultiProgress::new(); let style = ProgressStyle::default_bar() .tick_chars(\"â â ‚â „â¡€â¢€â  â â ˆ \") .template( \"{spinner:.green} [{elapsed_precise}] [{bar:40.cyan/blue}] {pos}/{len} ({eta}) {wide_msg}\", ) .unwrap() .progress_chars(\"#\u003e-\"); let main = m.add(ProgressBar::new(100)); main.set_style(style.clone()); let detail = m.add(ProgressBar::new(100)); detail.set_style( ProgressStyle::default_bar() .template(\" {spinner:.blue} {msg}\") .unwrap(), ); (m, main, detail) } ä¸»ç¨‹åºå…¥å£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 // src/main.rs mod cli; mod error; mod processor; mod utils; use clap::Parser; use console::Term; use anyhow::Result; #[tokio::main] async fn main() -\u003e Result\u003c()\u003e { let args = cli::Args::parse(); if args.verbose { env_logger::Builder::from_env(env_logger::Env::default().default_filter_or(\"debug\")) .init(); } let terminal = Term::stdout(); terminal.set_title(\"Image Processor\"); println!( \"{}\", Style::new() .bold() .cyan() .apply_to(\"ğŸ–¼ï¸ High-Performance Image Processor\") ); let config = processor::ProcessingConfig { operation: args.operation.clone(), quality: args.quality, width: args.width, height: args.height, threads: args.threads, }; let processor = processor::ImageProcessor::new(config); let input_path = std::path::Path::new(\u0026args.input); let output_path = args.output .map(std::path::PathBuf::from) .unwrap_or_else(|| input_path.join(\"output\")); // åˆ›å»ºè¾“å‡ºç›®å½• tokio::fs::create_dir_all(\u0026output_path).await?; // å¤„ç†å›¾ç‰‡ if input_path.is_dir() { processor.process_directory(input_path, \u0026output_path).await?; } else { processor.process_single_image(input_path.to_path_buf(), \u0026output_path)?; } println!( \"{}\", Style::new() .bold() .green() .apply_to(\"âœ“ Processing completed successfully!\") ); Ok(()) } è·¨å¹³å°ç¼–è¯‘é…ç½® Cargo.tomlä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 [package] name = \"imgproc\" version = \"1.0.0\" edition = \"2021\" description = \"A high-performance image processing CLI tool\" authors = [\"Your Name \"] license = \"MIT\" repository = \"https://github.com/yourusername/imgproc\" [dependencies] clap = { version = \"4.4\", features = [\"derive\"] } anyhow = \"1.0\" thiserror = \"1.0\" tokio = { version = \"1.35\", features = [\"full\"] } rayon = \"1.8\" image = \"0.24\" indicatif = \"0.17\" console = \"0.15\" env_logger = \"0.10\" [target.'cfg(windows)'.dependencies] winapi = { version = \"0.3\", features = [\"winuser\"] } [profile.release] opt-level = 3 lto = true codegen-units = 1 strip = true panic = \"abort\" æ„å»ºä¸åˆ†å‘ æœ¬åœ°æ„å»º 1 2 3 4 5 6 7 8 9 10 11 # å¼€å‘æ„å»º cargo build # ä¼˜åŒ–æ„å»º cargo build --release # è¿è¡Œæµ‹è¯• cargo test # è¿è¡Œç¤ºä¾‹ ./target/release/imgproc -i ./images -o ./output --operation resize --width 1920 äº¤å‰ç¼–è¯‘ 1 2 3 4 5 6 7 8 9 10 11 # macOS (Intel) cargo build --release --target x86_64-apple-darwin # macOS (Apple Silicon) cargo build --release --target aarch64-apple-darwin # Linux cargo build --release --target x86_64-unknown-linux-gnu # Windows cargo build --release --target x86_64-pc-windows-msvc ä½¿ç”¨GitHub Actionsè‡ªåŠ¨æ„å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 # .github/workflows/release.yml name: Release on: push: tags: - 'v*' jobs: build: strategy: matrix: include: - target: x86_64-pc-windows-msvc os: windows-latest name: imgproc-windows-amd64.exe - target: x86_64-apple-darwin os: macos-latest name: imgproc-macos-amd64 - target: aarch64-apple-darwin os: macos-latest name: imgproc-macos-arm64 - target: x86_64-unknown-linux-gnu os: ubuntu-latest name: imgproc-linux-amd64 runs-on: ${{ matrix.os }} steps: - uses: actions/checkout@v3 - uses: actions-rs/toolchain@v1 with: profile: release target: ${{ matrix.target }} - uses: actions-rs/cargo@v1 with: use-cross: true command: build args: --release --target ${{ matrix.target }} - uses: actions/upload-artifact@v3 with: name: ${{ matrix.name }} path: target/${{ matrix.target }}/release/imgproc${{ matrix.target == 'x86_64-pc-windows-msvc' \u0026\u0026 '.exe' || '' }} æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1. é›¶æ‹·è´æ¶æ„ 1 2 3 4 5 6 7 8 9 // é¿å…ä¸å¿…è¦çš„æ•°æ®æ‹·è´ pub fn process_image_fast(data: \u0026[u8]) -\u003e Result\u003cVec\u003cu8\u003e\u003e { let img = image::load_from_memory(data)?; // ä½¿ç”¨ç¼“å†²åŒºå¤ç”¨ let mut output = Vec::with_capacity(data.len()); // ... å¤„ç†é€»è¾‘ Ok(output) } 2. å†…å­˜æ±  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use bytes::{BytesMut, BufMut}; pub struct BufferPool { buffers: Vec\u003cBytesMut\u003e, capacity: usize, } impl BufferPool { pub fn get(\u0026mut self) -\u003e BytesMut { selfbuffers.pop() .unwrap_or_else(|| BytesMut::with_capacity(self.capacity)) } pub fn put(\u0026mut self, mut buf: BytesMut) { buf.clear(); self.buffers.push(buf); } } 3. SIMDä¼˜åŒ– 1 2 3 4 5 6 7 #[cfg(target_arch = \"x86_64\")] use std::arch::x86_64::*; #[target_feature(enable = \"avx2\")] unsafe fn process_avx2(data: \u0026[f32]) -\u003e Vec\u003cf32\u003e { // ä½¿ç”¨AVX2æŒ‡ä»¤é›†åŠ é€Ÿå¤„ç† } æµ‹è¯•ç­–ç•¥ å•å…ƒæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 #[cfg(test)] mod tests { use super::*; #[test] fn test_resize() { let img = DynamicImage::new_rgb8(1000, 1000); let resized = resize_image(\u0026img, 500, 500).unwrap(); assert_eq!(resized.width(), 500); assert_eq!(resized.height(), 500); } } é›†æˆæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 // tests/integration_test.rs use std::process::Command; #[test] fn test_cli_basic_workflow() { let output = Command::new(\"./target/release/imgproc\") .args(\u0026[\"-i\", \"tests/fixtures/sample.jpg\", \"-o\", \"tests/output/\"]) .output() .expect(\"Failed to execute process\"); assert!(output.status.success()); } æœ€ä½³å®è·µæ€»ç»“ ä½¿ç”¨åˆé€‚çš„Crateï¼šclapï¼ˆå‚æ•°è§£æï¼‰ã€anyhowï¼ˆé”™è¯¯å¤„ç†ï¼‰ã€tokioï¼ˆå¼‚æ­¥è¿è¡Œæ—¶ï¼‰ æ€§èƒ½ä¼˜å…ˆï¼šå¯ç”¨LTOã€codegen-units=1ã€stripç¬¦å· ç”¨æˆ·ä½“éªŒï¼šæ¸…æ™°çš„è¿›åº¦æ¡ã€å‹å¥½çš„é”™è¯¯ä¿¡æ¯ã€è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜ è·¨å¹³å°æ”¯æŒï¼šæ¡ä»¶ç¼–è¯‘ã€è‡ªåŠ¨æ„å»ºã€å¤šå¹³å°æµ‹è¯• æ–‡æ¡£å®Œå–„ï¼šREADMEã€ç¤ºä¾‹ä»£ç ã€APIæ–‡æ¡£ ç»“è®º Rustä¸ºCLIå·¥å…·å¼€å‘æä¾›äº†å¼ºå¤§çš„åŸºç¡€è®¾æ–½ã€‚é€šè¿‡æœ¬æ–‡çš„å®æˆ˜æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å±•ç¤ºäº†ä»é¡¹ç›®åˆå§‹åŒ–åˆ°æœ€ç»ˆéƒ¨ç½²çš„å®Œæ•´æµç¨‹ã€‚ä½¿ç”¨Rustæ„å»ºçš„CLIå·¥å…·ä¸ä»…æ€§èƒ½å“è¶Šï¼Œè€Œä¸”å…·å¤‡å†…å­˜å®‰å…¨å’Œè·¨å¹³å°èƒ½åŠ›ï¼Œæ˜¯æ›¿ä»£ä¼ ç»Ÿè„šæœ¬è¯­è¨€çš„ç†æƒ³é€‰æ‹©ã€‚\nå‚è€ƒèµ„æ–™ Rust CLI Book Command Line Applications in Rust Rust Performance Book ","wordCount":"1562","inLanguage":"zh-cn","datePublished":"2026-01-04T11:00:00+08:00","dateModified":"2026-01-04T11:00:00+08:00","author":{"@type":"Person","name":"æŠ€æœ¯å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/%E7%94%A8rust%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BDcli%E5%B7%A5%E5%85%B7%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">ç”¨Rustæ„å»ºé«˜æ€§èƒ½CLIå·¥å…·ï¼šä»é›¶åˆ°éƒ¨ç½²å®Œæ•´æŒ‡å—</h1><div class=post-description>è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Rustè¯­è¨€æ„å»ºè·¨å¹³å°ã€é«˜æ€§èƒ½çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ¶µç›–é¡¹ç›®ç»“æ„ã€ä¾èµ–ç®¡ç†ã€é”™è¯¯å¤„ç†ã€å‘å¸ƒéƒ¨ç½²ç­‰å®Œæ•´æµç¨‹</div><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/rust/ class=category-link>Rust</a><a href=/blog/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/ class=category-link>å¼€å‘å·¥å…·</a></div><span class=post-date>2026-01-04</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><h2 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><p>å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰æ˜¯å¼€å‘è€…æ—¥å¸¸å·¥ä½œä¸­ä¸å¯æˆ–ç¼ºçš„åˆ©å™¨ã€‚ä¼ ç»Ÿçš„Node.jsæˆ–Pythonè„šæœ¬åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶å¾€å¾€é¢ä¸´æ€§èƒ½ç“¶é¢ˆã€‚Rustè¯­è¨€å‡­å€Ÿå…¶é›¶æˆæœ¬æŠ½è±¡ã€å†…å­˜å®‰å…¨å’Œå“è¶Šçš„æ€§èƒ½ï¼Œæˆä¸ºæ„å»ºCLIå·¥å…·çš„ç†æƒ³é€‰æ‹©ã€‚</p><p>æœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªå®é™…é¡¹ç›®â€”â€”æ‰¹é‡å›¾ç‰‡å¤„ç†å·¥å…·ï¼Œå®Œæ•´å±•ç¤ºä½¿ç”¨Rustæ„å»ºCLIå·¥å…·çš„å…¨è¿‡ç¨‹ã€‚</p><h2 id=é¡¹ç›®åˆå§‹åŒ–>é¡¹ç›®åˆå§‹åŒ–<a hidden class=anchor aria-hidden=true href=#é¡¹ç›®åˆå§‹åŒ–>#</a></h2><h3 id=1-åˆ›å»ºé¡¹ç›®>1. åˆ›å»ºé¡¹ç›®<a hidden class=anchor aria-hidden=true href=#1-åˆ›å»ºé¡¹ç›®>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å®‰è£…Rustå·¥å…·é“¾</span>
</span></span><span style=display:flex><span>curl --proto <span style=color:#a5d6ff>&#39;=https&#39;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># åˆ›å»ºæ–°çš„äºŒè¿›åˆ¶é¡¹ç›®</span>
</span></span><span style=display:flex><span>cargo new imgproc --bin
</span></span><span style=display:flex><span>cd imgproc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æ·»åŠ å¸¸ç”¨ä¾èµ–</span>
</span></span><span style=display:flex><span>cargo add clap --features derive
</span></span><span style=display:flex><span>cargo add anyhow
</span></span><span style=display:flex><span>cargo add thiserror
</span></span><span style=display:flex><span>cargo add tokio --features full
</span></span><span style=display:flex><span>cargo add indicatif
</span></span><span style=display:flex><span>cargo add console
</span></span></code></pre></td></tr></table></div></div><h3 id=2-é¡¹ç›®ç»“æ„>2. é¡¹ç›®ç»“æ„<a hidden class=anchor aria-hidden=true href=#2-é¡¹ç›®ç»“æ„>#</a></h3><pre tabindex=0><code>imgproc/
â”œâ”€â”€ Cargo.toml           # ä¾èµ–é…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs          # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ cli.rs           # å‘½ä»¤è¡Œå‚æ•°å®šä¹‰
â”‚   â”œâ”€â”€ processor.rs     # æ ¸å¿ƒå¤„ç†é€»è¾‘
â”‚   â”œâ”€â”€ error.rs         # é”™è¯¯ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ utils.rs         # å·¥å…·å‡½æ•°
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ integration_test.rs
â””â”€â”€ README.md
</code></pre><h2 id=å‘½ä»¤è¡Œå‚æ•°å¤„ç†>å‘½ä»¤è¡Œå‚æ•°å¤„ç†<a hidden class=anchor aria-hidden=true href=#å‘½ä»¤è¡Œå‚æ•°å¤„ç†>#</a></h2><p>ä½¿ç”¨<code>clap</code>åº“å®šä¹‰å‘½ä»¤è¡Œæ¥å£ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// src/cli.rs
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>clap::Parser;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#8b949e;font-weight:700;font-style:italic>#[derive(Parser, Debug)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#8b949e;font-weight:700;font-style:italic>#[command(name = </span><span style=color:#a5d6ff>&#34;imgproc&#34;</span><span style=color:#8b949e;font-weight:700;font-style:italic>)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#8b949e;font-weight:700;font-style:italic>#[command(about = </span><span style=color:#a5d6ff>&#34;A high-performance image processing tool&#34;</span><span style=color:#8b949e;font-weight:700;font-style:italic>, long_about = None)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>struct</span> <span style=color:#f0883e;font-weight:700>Args</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#a5d6ff>/// Input file or directory
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[arg(short, long)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>input: String,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#a5d6ff>/// Output directory
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[arg(short, long)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>output: Option<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>&gt;</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#a5d6ff>/// Operation to perform
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[arg(short, long)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>operation: <span style=color:#f0883e;font-weight:700>Operation</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#a5d6ff>/// Resize width (for resize operation)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[arg(long)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>width: Option<span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#ff7b72>u32</span><span style=color:#ff7b72;font-weight:700>&gt;</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#a5d6ff>/// Resize height (for resize operation)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[arg(long)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>height: Option<span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#ff7b72>u32</span><span style=color:#ff7b72;font-weight:700>&gt;</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#a5d6ff>/// JPEG quality (1-100)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[arg(short, long, default_value_t = 85)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>quality: <span style=color:#ff7b72>u8</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#a5d6ff>/// Enable verbose output
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[arg(short, long)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>verbose: <span style=color:#ff7b72>bool</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#a5d6ff>/// Number of threads to use
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[arg(short, long, default_value_t = 4)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>threads: <span style=color:#ff7b72>usize</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#8b949e;font-weight:700;font-style:italic>#[derive(Clone, Debug, PartialEq)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>enum</span> <span style=color:#f0883e;font-weight:700>Operation</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Resize,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Compress,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Convert,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Grayscale,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Thumbnail,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=é”™è¯¯å¤„ç†ä½“ç³»>é”™è¯¯å¤„ç†ä½“ç³»<a hidden class=anchor aria-hidden=true href=#é”™è¯¯å¤„ç†ä½“ç³»>#</a></h2><p>å®šä¹‰æ¸…æ™°çš„é”™è¯¯ç±»å‹ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// src/error.rs
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>thiserror::Error;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#8b949e;font-weight:700;font-style:italic>#[derive(Error, Debug)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>enum</span> <span style=color:#f0883e;font-weight:700>ImgProcError</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[error(</span><span style=color:#a5d6ff>&#34;IO error: {0}&#34;</span><span style=color:#8b949e;font-weight:700;font-style:italic>)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Io(<span style=color:#8b949e;font-weight:700;font-style:italic>#[from]</span><span style=color:#6e7681> </span>std::io::Error),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[error(</span><span style=color:#a5d6ff>&#34;Image processing error: {0}&#34;</span><span style=color:#8b949e;font-weight:700;font-style:italic>)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Image(String),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[error(</span><span style=color:#a5d6ff>&#34;Invalid configuration: {0}&#34;</span><span style=color:#8b949e;font-weight:700;font-style:italic>)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Config(String),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[error(</span><span style=color:#a5d6ff>&#34;Operation cancelled by user&#34;</span><span style=color:#8b949e;font-weight:700;font-style:italic>)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Cancelled,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>type</span> Result<span style=color:#ff7b72;font-weight:700>&lt;</span>T<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>std::result::Result<span style=color:#ff7b72;font-weight:700>&lt;</span>T,<span style=color:#6e7681> </span>ImgProcError<span style=color:#ff7b72;font-weight:700>&gt;</span>;<span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=æ ¸å¿ƒå¤„ç†é€»è¾‘>æ ¸å¿ƒå¤„ç†é€»è¾‘<a hidden class=anchor aria-hidden=true href=#æ ¸å¿ƒå¤„ç†é€»è¾‘>#</a></h2><h3 id=å¹¶å‘å¤„ç†æ¡†æ¶>å¹¶å‘å¤„ç†æ¡†æ¶<a hidden class=anchor aria-hidden=true href=#å¹¶å‘å¤„ç†æ¡†æ¶>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// src/processor.rs
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>anyhow::Context;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>image::{DynamicImage,<span style=color:#6e7681> </span>ImageEncoder,<span style=color:#6e7681> </span>ImageFormat};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>rayon::prelude::<span style=color:#ff7b72;font-weight:700>*</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>std::path::Path;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>tokio::fs;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>struct</span> <span style=color:#f0883e;font-weight:700>ImageProcessor</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>config: <span style=color:#f0883e;font-weight:700>ProcessingConfig</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>progress: <span style=color:#f0883e;font-weight:700>indicatif</span>::ProgressBar,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#8b949e;font-weight:700;font-style:italic>#[derive(Clone)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>struct</span> <span style=color:#f0883e;font-weight:700>ProcessingConfig</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>operation: <span style=color:#f0883e;font-weight:700>Operation</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>quality: <span style=color:#ff7b72>u8</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>width: Option<span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#ff7b72>u32</span><span style=color:#ff7b72;font-weight:700>&gt;</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>height: Option<span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#ff7b72>u32</span><span style=color:#ff7b72;font-weight:700>&gt;</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span>threads: <span style=color:#ff7b72>usize</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>impl</span><span style=color:#6e7681> </span>ImageProcessor<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>new</span>(config: <span style=color:#f0883e;font-weight:700>ProcessingConfig</span>)<span style=color:#6e7681> </span>-&gt; <span style=color:#f0883e;font-weight:700>Self</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>progress<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>indicatif::ProgressBar::new_spinner();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>progress.set_style(indicatif::ProgressStyle::default_bar()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.template(<span style=color:#a5d6ff>&#34;{spinner:.green} [{elapsed_precise}] [{bar:40.cyan/blue}] {pos}/{len} ({eta})&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.unwrap()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.progress_chars(<span style=color:#a5d6ff>&#34;#&gt;-&#34;</span>));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Self<span style=color:#6e7681> </span>{<span style=color:#6e7681> </span>config,<span style=color:#6e7681> </span>progress<span style=color:#6e7681> </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>async</span><span style=color:#6e7681> </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>process_directory</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>self,<span style=color:#6e7681> </span>input_dir: <span style=color:#79c0ff>&amp;</span><span style=color:#f0883e;font-weight:700>Path</span>,<span style=color:#6e7681> </span>output_dir: <span style=color:#79c0ff>&amp;</span><span style=color:#f0883e;font-weight:700>Path</span>)<span style=color:#6e7681> </span>-&gt; Result<span style=color:#ff7b72;font-weight:700>&lt;</span>()<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>entries<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>fs::read_dir(input_dir).<span style=color:#ff7b72>await</span><span style=color:#ff7b72;font-weight:700>?</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>images: Vec<span style=color:#ff7b72;font-weight:700>&lt;</span>_<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>entries<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.filter_map(<span style=color:#ff7b72;font-weight:700>|</span>e<span style=color:#ff7b72;font-weight:700>|</span><span style=color:#6e7681> </span>e.ok())<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.filter(<span style=color:#ff7b72;font-weight:700>|</span>e<span style=color:#ff7b72;font-weight:700>|</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span>e.path().extension()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                    </span>.and_then(<span style=color:#ff7b72;font-weight:700>|</span>s<span style=color:#ff7b72;font-weight:700>|</span><span style=color:#6e7681> </span>s.to_str())<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                    </span>.map(<span style=color:#ff7b72;font-weight:700>|</span>s<span style=color:#ff7b72;font-weight:700>|</span><span style=color:#6e7681> </span><span style=color:#d2a8ff;font-weight:700>matches!</span>(s.to_lowercase().as_str(),<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;jpg&#34;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>|</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;jpeg&#34;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>|</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;png&#34;</span><span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>|</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;webp&#34;</span>))<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                    </span>.unwrap_or(<span style=color:#79c0ff>false</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>})<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.collect();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>self.progress.set_length(images.len()<span style=color:#6e7681> </span><span style=color:#ff7b72>as</span><span style=color:#6e7681> </span><span style=color:#ff7b72>u64</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨rayonå¹¶è¡Œå¤„ç†
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>pool<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>rayon::ThreadPoolBuilder::new()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.num_threads(self.config.threads)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.build()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.context(<span style=color:#a5d6ff>&#34;Failed to create thread pool&#34;</span>)<span style=color:#ff7b72;font-weight:700>?</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>pool.install(<span style=color:#ff7b72;font-weight:700>||</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>images.par_iter().for_each(<span style=color:#ff7b72;font-weight:700>|</span>entry<span style=color:#ff7b72;font-weight:700>|</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>Err(e)<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>self.process_single_image(entry.path(),<span style=color:#6e7681> </span>output_dir)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                    </span><span style=color:#d2a8ff;font-weight:700>eprintln!</span>(<span style=color:#a5d6ff>&#34;Error processing </span><span style=color:#a5d6ff>{:?}</span><span style=color:#a5d6ff>: </span><span style=color:#a5d6ff>{}</span><span style=color:#a5d6ff>&#34;</span>,<span style=color:#6e7681> </span>entry.path(),<span style=color:#6e7681> </span>e);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>                </span>self.progress.inc(<span style=color:#a5d6ff>1</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>});<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>});<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>self.progress.finish_with_message(<span style=color:#a5d6ff>&#34;Processing complete!&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Ok(())<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>process_single_image</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>self,<span style=color:#6e7681> </span>input_path: <span style=color:#f0883e;font-weight:700>std</span>::path::PathBuf,<span style=color:#6e7681> </span>output_dir: <span style=color:#79c0ff>&amp;</span><span style=color:#f0883e;font-weight:700>Path</span>)<span style=color:#6e7681> </span>-&gt; Result<span style=color:#ff7b72;font-weight:700>&lt;</span>()<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>img<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>image::open(<span style=color:#ff7b72;font-weight:700>&amp;</span>input_path)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.map_err(<span style=color:#ff7b72;font-weight:700>|</span>e<span style=color:#ff7b72;font-weight:700>|</span><span style=color:#6e7681> </span>ImgProcError::Image(<span style=color:#d2a8ff;font-weight:700>format!</span>(<span style=color:#a5d6ff>&#34;Failed to load image: </span><span style=color:#a5d6ff>{}</span><span style=color:#a5d6ff>&#34;</span>,<span style=color:#6e7681> </span>e)))<span style=color:#ff7b72;font-weight:700>?</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>processed<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#ff7b72>match</span><span style=color:#6e7681> </span>self.config.operation<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>Operation::Resize<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=&gt;</span><span style=color:#6e7681> </span>self.resize_image(img),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>Operation::Compress<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=&gt;</span><span style=color:#6e7681> </span>self.compress_image(img),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>Operation::Grayscale<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=&gt;</span><span style=color:#6e7681> </span>self.grayscale_image(img),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>Operation::Convert<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=&gt;</span><span style=color:#6e7681> </span>self.convert_format(img,<span style=color:#6e7681> </span>ImageFormat::Jpeg),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>Operation::Thumbnail<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=&gt;</span><span style=color:#6e7681> </span>self.create_thumbnail(img),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>}<span style=color:#ff7b72;font-weight:700>?</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>filename<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>input_path<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.file_name()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.ok_or_else(<span style=color:#ff7b72;font-weight:700>||</span><span style=color:#6e7681> </span>ImgProcError::Config(<span style=color:#a5d6ff>&#34;Invalid filename&#34;</span>.to_string()))<span style=color:#ff7b72;font-weight:700>?</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>output_path<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>output_dir.join(filename);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>processed.save(output_path)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.map_err(<span style=color:#ff7b72;font-weight:700>|</span>e<span style=color:#ff7b72;font-weight:700>|</span><span style=color:#6e7681> </span>ImgProcError::Image(<span style=color:#d2a8ff;font-weight:700>format!</span>(<span style=color:#a5d6ff>&#34;Failed to save: </span><span style=color:#a5d6ff>{}</span><span style=color:#a5d6ff>&#34;</span>,<span style=color:#6e7681> </span>e)))<span style=color:#ff7b72;font-weight:700>?</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Ok(())<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>resize_image</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>self,<span style=color:#6e7681> </span>img: <span style=color:#f0883e;font-weight:700>DynamicImage</span>)<span style=color:#6e7681> </span>-&gt; Result<span style=color:#ff7b72;font-weight:700>&lt;</span>DynamicImage<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>(width,<span style=color:#6e7681> </span>height)<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>(<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>self.config.width.unwrap_or(img.width()),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>self.config.height.unwrap_or(img.height()),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Ok(img.resize(<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>width,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>height,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>image::imageops::FilterType::Lanczos3,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>))<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>compress_image</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>self,<span style=color:#6e7681> </span>img: <span style=color:#f0883e;font-weight:700>DynamicImage</span>)<span style=color:#6e7681> </span>-&gt; Result<span style=color:#ff7b72;font-weight:700>&lt;</span>DynamicImage<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#8b949e;font-style:italic>// å¯¹äºJPEGï¼Œç›´æ¥è°ƒæ•´è´¨é‡å‚æ•°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#6e7681>        </span>Ok(img)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>grayscale_image</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>self,<span style=color:#6e7681> </span>img: <span style=color:#f0883e;font-weight:700>DynamicImage</span>)<span style=color:#6e7681> </span>-&gt; Result<span style=color:#ff7b72;font-weight:700>&lt;</span>DynamicImage<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Ok(img.grayscale())<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>convert_format</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>self,<span style=color:#6e7681> </span>img: <span style=color:#f0883e;font-weight:700>DynamicImage</span>,<span style=color:#6e7681> </span>format: <span style=color:#f0883e;font-weight:700>ImageFormat</span>)<span style=color:#6e7681> </span>-&gt; Result<span style=color:#ff7b72;font-weight:700>&lt;</span>DynamicImage<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Ok(img)<span style=color:#6e7681> </span><span style=color:#8b949e;font-style:italic>// æ ¼å¼è½¬æ¢åœ¨ä¿å­˜æ—¶å¤„ç†
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>create_thumbnail</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span>self,<span style=color:#6e7681> </span>img: <span style=color:#f0883e;font-weight:700>DynamicImage</span>)<span style=color:#6e7681> </span>-&gt; Result<span style=color:#ff7b72;font-weight:700>&lt;</span>DynamicImage<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>const</span><span style=color:#6e7681> </span><span style=color:#79c0ff;font-weight:700>THUMB_SIZE</span>: <span style=color:#ff7b72>u32</span> <span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span><span style=color:#a5d6ff>150</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Ok(img.thumbnail(<span style=color:#79c0ff;font-weight:700>THUMB_SIZE</span>,<span style=color:#6e7681> </span><span style=color:#79c0ff;font-weight:700>THUMB_SIZE</span>))<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=ä¼˜é›…çš„è¿›åº¦æ˜¾ç¤º>ä¼˜é›…çš„è¿›åº¦æ˜¾ç¤º<a hidden class=anchor aria-hidden=true href=#ä¼˜é›…çš„è¿›åº¦æ˜¾ç¤º>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>console::{Style,<span style=color:#6e7681> </span>Term};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>indicatif::{HumanDuration,<span style=color:#6e7681> </span>MultiProgress,<span style=color:#6e7681> </span>ProgressBar};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>setup_progress_bars</span>()<span style=color:#6e7681> </span>-&gt; (MultiProgress,<span style=color:#6e7681> </span>ProgressBar,<span style=color:#6e7681> </span>ProgressBar)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>m<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>MultiProgress::new();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>style<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>ProgressStyle::default_bar()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>.tick_chars(<span style=color:#a5d6ff>&#34;â â ‚â „â¡€â¢€â  â â ˆ &#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>.template(<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#a5d6ff>&#34;{spinner:.green} [{elapsed_precise}] [{bar:40.cyan/blue}] {pos}/{len} ({eta}) {wide_msg}&#34;</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>.unwrap()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>.progress_chars(<span style=color:#a5d6ff>&#34;#&gt;-&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>main<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>m.add(ProgressBar::new(<span style=color:#a5d6ff>100</span>));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>main.set_style(style.clone());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>detail<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>m.add(ProgressBar::new(<span style=color:#a5d6ff>100</span>));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>detail.set_style(<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>ProgressStyle::default_bar()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.template(<span style=color:#a5d6ff>&#34;  {spinner:.blue} {msg}&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.unwrap(),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>(m,<span style=color:#6e7681> </span>main,<span style=color:#6e7681> </span>detail)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=ä¸»ç¨‹åºå…¥å£>ä¸»ç¨‹åºå…¥å£<a hidden class=anchor aria-hidden=true href=#ä¸»ç¨‹åºå…¥å£>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// src/main.rs
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>mod</span> <span style=color:#ff7b72>cli</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>mod</span> <span style=color:#ff7b72>error</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>mod</span> <span style=color:#ff7b72>processor</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>mod</span> <span style=color:#ff7b72>utils</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>clap::Parser;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>console::Term;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>anyhow::Result;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#8b949e;font-weight:700;font-style:italic>#[tokio::main]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>async</span><span style=color:#6e7681> </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>main</span>()<span style=color:#6e7681> </span>-&gt; Result<span style=color:#ff7b72;font-weight:700>&lt;</span>()<span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>args<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>cli::Args::parse();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>args.verbose<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>env_logger::Builder::from_env(env_logger::Env::default().default_filter_or(<span style=color:#a5d6ff>&#34;debug&#34;</span>))<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.init();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>terminal<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>Term::stdout();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>terminal.set_title(<span style=color:#a5d6ff>&#34;Image Processor&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>println!</span>(<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{}</span><span style=color:#a5d6ff>&#34;</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Style::new()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.bold()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.cyan()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.apply_to(<span style=color:#a5d6ff>&#34;ğŸ–¼ï¸  High-Performance Image Processor&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>config<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>processor::ProcessingConfig<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>operation: <span style=color:#f0883e;font-weight:700>args</span>.operation.clone(),<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>quality: <span style=color:#f0883e;font-weight:700>args</span>.quality,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>width: <span style=color:#f0883e;font-weight:700>args</span>.width,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>height: <span style=color:#f0883e;font-weight:700>args</span>.height,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>threads: <span style=color:#f0883e;font-weight:700>args</span>.threads,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>processor<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>processor::ImageProcessor::new(config);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>input_path<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>std::path::Path::new(<span style=color:#ff7b72;font-weight:700>&amp;</span>args.input);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>output_path<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>args.output<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>.map(std::path::PathBuf::from)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>.unwrap_or_else(<span style=color:#ff7b72;font-weight:700>||</span><span style=color:#6e7681> </span>input_path.join(<span style=color:#a5d6ff>&#34;output&#34;</span>));<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-style:italic>// åˆ›å»ºè¾“å‡ºç›®å½•
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#6e7681>    </span>tokio::fs::create_dir_all(<span style=color:#ff7b72;font-weight:700>&amp;</span>output_path).<span style=color:#ff7b72>await</span><span style=color:#ff7b72;font-weight:700>?</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-style:italic>// å¤„ç†å›¾ç‰‡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#6e7681>    </span><span style=color:#ff7b72>if</span><span style=color:#6e7681> </span>input_path.is_dir()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>processor.process_directory(input_path,<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>&amp;</span>output_path).<span style=color:#ff7b72>await</span><span style=color:#ff7b72;font-weight:700>?</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681> </span><span style=color:#ff7b72>else</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>processor.process_single_image(input_path.to_path_buf(),<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>&amp;</span>output_path)<span style=color:#ff7b72;font-weight:700>?</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>println!</span>(<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{}</span><span style=color:#a5d6ff>&#34;</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>Style::new()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.bold()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.green()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.apply_to(<span style=color:#a5d6ff>&#34;âœ“ Processing completed successfully!&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>Ok(())<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=è·¨å¹³å°ç¼–è¯‘é…ç½®>è·¨å¹³å°ç¼–è¯‘é…ç½®<a hidden class=anchor aria-hidden=true href=#è·¨å¹³å°ç¼–è¯‘é…ç½®>#</a></h2><h3 id=cargotomlä¼˜åŒ–>Cargo.tomlä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#cargotomlä¼˜åŒ–>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-toml data-lang=toml><span style=display:flex><span>[package]
</span></span><span style=display:flex><span>name = <span style=color:#a5d6ff>&#34;imgproc&#34;</span>
</span></span><span style=display:flex><span>version = <span style=color:#a5d6ff>&#34;1.0.0&#34;</span>
</span></span><span style=display:flex><span>edition = <span style=color:#a5d6ff>&#34;2021&#34;</span>
</span></span><span style=display:flex><span>description = <span style=color:#a5d6ff>&#34;A high-performance image processing CLI tool&#34;</span>
</span></span><span style=display:flex><span>authors = [<span style=color:#a5d6ff>&#34;Your Name &lt;you@example.com&gt;&#34;</span>]
</span></span><span style=display:flex><span>license = <span style=color:#a5d6ff>&#34;MIT&#34;</span>
</span></span><span style=display:flex><span>repository = <span style=color:#a5d6ff>&#34;https://github.com/yourusername/imgproc&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[dependencies]
</span></span><span style=display:flex><span>clap = { version = <span style=color:#a5d6ff>&#34;4.4&#34;</span>, features = [<span style=color:#a5d6ff>&#34;derive&#34;</span>] }
</span></span><span style=display:flex><span>anyhow = <span style=color:#a5d6ff>&#34;1.0&#34;</span>
</span></span><span style=display:flex><span>thiserror = <span style=color:#a5d6ff>&#34;1.0&#34;</span>
</span></span><span style=display:flex><span>tokio = { version = <span style=color:#a5d6ff>&#34;1.35&#34;</span>, features = [<span style=color:#a5d6ff>&#34;full&#34;</span>] }
</span></span><span style=display:flex><span>rayon = <span style=color:#a5d6ff>&#34;1.8&#34;</span>
</span></span><span style=display:flex><span>image = <span style=color:#a5d6ff>&#34;0.24&#34;</span>
</span></span><span style=display:flex><span>indicatif = <span style=color:#a5d6ff>&#34;0.17&#34;</span>
</span></span><span style=display:flex><span>console = <span style=color:#a5d6ff>&#34;0.15&#34;</span>
</span></span><span style=display:flex><span>env_logger = <span style=color:#a5d6ff>&#34;0.10&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[target.<span style=color:#a5d6ff>&#39;cfg(windows)&#39;</span>.dependencies]
</span></span><span style=display:flex><span>winapi = { version = <span style=color:#a5d6ff>&#34;0.3&#34;</span>, features = [<span style=color:#a5d6ff>&#34;winuser&#34;</span>] }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[profile.release]
</span></span><span style=display:flex><span>opt-level = <span style=color:#a5d6ff>3</span>
</span></span><span style=display:flex><span>lto = <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>codegen-units = <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>strip = <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>panic = <span style=color:#a5d6ff>&#34;abort&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=æ„å»ºä¸åˆ†å‘>æ„å»ºä¸åˆ†å‘<a hidden class=anchor aria-hidden=true href=#æ„å»ºä¸åˆ†å‘>#</a></h2><h3 id=æœ¬åœ°æ„å»º>æœ¬åœ°æ„å»º<a hidden class=anchor aria-hidden=true href=#æœ¬åœ°æ„å»º>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å¼€å‘æ„å»º</span>
</span></span><span style=display:flex><span>cargo build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä¼˜åŒ–æ„å»º</span>
</span></span><span style=display:flex><span>cargo build --release
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># è¿è¡Œæµ‹è¯•</span>
</span></span><span style=display:flex><span>cargo test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># è¿è¡Œç¤ºä¾‹</span>
</span></span><span style=display:flex><span>./target/release/imgproc -i ./images -o ./output --operation resize --width <span style=color:#a5d6ff>1920</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=äº¤å‰ç¼–è¯‘>äº¤å‰ç¼–è¯‘<a hidden class=anchor aria-hidden=true href=#äº¤å‰ç¼–è¯‘>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># macOS (Intel)</span>
</span></span><span style=display:flex><span>cargo build --release --target x86_64-apple-darwin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># macOS (Apple Silicon)</span>
</span></span><span style=display:flex><span>cargo build --release --target aarch64-apple-darwin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Linux</span>
</span></span><span style=display:flex><span>cargo build --release --target x86_64-unknown-linux-gnu
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Windows</span>
</span></span><span style=display:flex><span>cargo build --release --target x86_64-pc-windows-msvc
</span></span></code></pre></td></tr></table></div></div><h3 id=ä½¿ç”¨github-actionsè‡ªåŠ¨æ„å»º>ä½¿ç”¨GitHub Actionsè‡ªåŠ¨æ„å»º<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨github-actionsè‡ªåŠ¨æ„å»º>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8b949e;font-style:italic># .github/workflows/release.yml</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Release</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>on</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>push</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>tags</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>&#39;v*&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>jobs</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>build</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>strategy</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>matrix</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>include</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span>- <span style=color:#7ee787>target</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>x86_64-pc-windows-msvc</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>os</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>windows-latest</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>imgproc-windows-amd64.exe</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span>- <span style=color:#7ee787>target</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>x86_64-apple-darwin</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>os</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>macos-latest</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>imgproc-macos-amd64</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span>- <span style=color:#7ee787>target</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>aarch64-apple-darwin</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>os</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>macos-latest</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>imgproc-macos-arm64</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span>- <span style=color:#7ee787>target</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>x86_64-unknown-linux-gnu</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>os</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ubuntu-latest</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>imgproc-linux-amd64</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>runs-on</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>${{ matrix.os }}</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>steps</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>uses</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>actions/checkout@v3</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>uses</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>actions-rs/toolchain@v1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>with</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>profile</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>release</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>target</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>${{ matrix.target }}</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>uses</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>actions-rs/cargo@v1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>with</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>use-cross</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>true</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>command</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>build</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>args</span>:<span style=color:#6e7681> </span>--<span style=color:#a5d6ff>release --target ${{ matrix.target }}</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>uses</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>actions/upload-artifact@v3</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>with</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>${{ matrix.name }}</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>path</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>target/${{ matrix.target }}/release/imgproc${{ matrix.target == &#39;x86_64-pc-windows-msvc&#39; &amp;&amp; &#39;.exe&#39; || &#39;&#39; }}</span><span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=æ€§èƒ½ä¼˜åŒ–æŠ€å·§>æ€§èƒ½ä¼˜åŒ–æŠ€å·§<a hidden class=anchor aria-hidden=true href=#æ€§èƒ½ä¼˜åŒ–æŠ€å·§>#</a></h2><h3 id=1-é›¶æ‹·è´æ¶æ„>1. é›¶æ‹·è´æ¶æ„<a hidden class=anchor aria-hidden=true href=#1-é›¶æ‹·è´æ¶æ„>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// é¿å…ä¸å¿…è¦çš„æ•°æ®æ‹·è´
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>process_image_fast</span>(data: <span style=color:#79c0ff>&amp;</span>[<span style=color:#ff7b72>u8</span>])<span style=color:#6e7681> </span>-&gt; Result<span style=color:#ff7b72;font-weight:700>&lt;</span>Vec<span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#ff7b72>u8</span><span style=color:#ff7b72;font-weight:700>&gt;&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>img<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>image::load_from_memory(data)<span style=color:#ff7b72;font-weight:700>?</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨ç¼“å†²åŒºå¤ç”¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span><span style=color:#ff7b72>mut</span><span style=color:#6e7681> </span>output<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>Vec::with_capacity(data.len());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-style:italic>// ... å¤„ç†é€»è¾‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#6e7681>    </span>Ok(output)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=2-å†…å­˜æ± >2. å†…å­˜æ± <a hidden class=anchor aria-hidden=true href=#2-å†…å­˜æ± >#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>bytes::{BytesMut,<span style=color:#6e7681> </span>BufMut};<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>struct</span> <span style=color:#f0883e;font-weight:700>BufferPool</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>buffers: Vec<span style=color:#ff7b72;font-weight:700>&lt;</span>BytesMut<span style=color:#ff7b72;font-weight:700>&gt;</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>capacity: <span style=color:#ff7b72>usize</span>,<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>impl</span><span style=color:#6e7681> </span>BufferPool<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>get</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span><span style=color:#ff7b72>mut</span><span style=color:#6e7681> </span>self)<span style=color:#6e7681> </span>-&gt; <span style=color:#f0883e;font-weight:700>BytesMut</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>selfbuffers.pop()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span>.unwrap_or_else(<span style=color:#ff7b72;font-weight:700>||</span><span style=color:#6e7681> </span>BytesMut::with_capacity(self.capacity))<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>pub</span><span style=color:#6e7681> </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>put</span>(<span style=color:#ff7b72;font-weight:700>&amp;</span><span style=color:#ff7b72>mut</span><span style=color:#6e7681> </span>self,<span style=color:#6e7681> </span><span style=color:#ff7b72>mut</span><span style=color:#6e7681> </span>buf: <span style=color:#f0883e;font-weight:700>BytesMut</span>)<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>buf.clear();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>self.buffers.push(buf);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=3-simdä¼˜åŒ–>3. SIMDä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#3-simdä¼˜åŒ–>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic>#[cfg(target_arch = </span><span style=color:#a5d6ff>&#34;x86_64&#34;</span><span style=color:#8b949e;font-weight:700;font-style:italic>)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>std::arch::x86_64::<span style=color:#ff7b72;font-weight:700>*</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#8b949e;font-weight:700;font-style:italic>#[target_feature(enable = </span><span style=color:#a5d6ff>&#34;avx2&#34;</span><span style=color:#8b949e;font-weight:700;font-style:italic>)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>unsafe</span><span style=color:#6e7681> </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>process_avx2</span>(data: <span style=color:#79c0ff>&amp;</span>[<span style=color:#ff7b72>f32</span>])<span style=color:#6e7681> </span>-&gt; Vec<span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#ff7b72>f32</span><span style=color:#ff7b72;font-weight:700>&gt;</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨AVX2æŒ‡ä»¤é›†åŠ é€Ÿå¤„ç†
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>}<span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=æµ‹è¯•ç­–ç•¥>æµ‹è¯•ç­–ç•¥<a hidden class=anchor aria-hidden=true href=#æµ‹è¯•ç­–ç•¥>#</a></h2><h3 id=å•å…ƒæµ‹è¯•>å•å…ƒæµ‹è¯•<a hidden class=anchor aria-hidden=true href=#å•å…ƒæµ‹è¯•>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic>#[cfg(test)]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>mod</span> <span style=color:#ff7b72>tests</span><span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span><span style=color:#ff7b72>super</span>::<span style=color:#ff7b72;font-weight:700>*</span>;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#8b949e;font-weight:700;font-style:italic>#[test]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>test_resize</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>img<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>DynamicImage::new_rgb8(<span style=color:#a5d6ff>1000</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>1000</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>resized<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>resize_image(<span style=color:#ff7b72;font-weight:700>&amp;</span>img,<span style=color:#6e7681> </span><span style=color:#a5d6ff>500</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>500</span>).unwrap();<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#d2a8ff;font-weight:700>assert_eq!</span>(resized.width(),<span style=color:#6e7681> </span><span style=color:#a5d6ff>500</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#d2a8ff;font-weight:700>assert_eq!</span>(resized.height(),<span style=color:#6e7681> </span><span style=color:#a5d6ff>500</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>}<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=é›†æˆæµ‹è¯•>é›†æˆæµ‹è¯•<a hidden class=anchor aria-hidden=true href=#é›†æˆæµ‹è¯•>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// tests/integration_test.rs
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>use</span><span style=color:#6e7681> </span>std::process::Command;<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#8b949e;font-weight:700;font-style:italic>#[test]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#ff7b72>fn</span> <span style=color:#d2a8ff;font-weight:700>test_cli_basic_workflow</span>()<span style=color:#6e7681> </span>{<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#ff7b72>let</span><span style=color:#6e7681> </span>output<span style=color:#6e7681> </span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#6e7681> </span>Command::new(<span style=color:#a5d6ff>&#34;./target/release/imgproc&#34;</span>)<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>.args(<span style=color:#ff7b72;font-weight:700>&amp;</span>[<span style=color:#a5d6ff>&#34;-i&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;tests/fixtures/sample.jpg&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;-o&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;tests/output/&#34;</span>])<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>.output()<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>.expect(<span style=color:#a5d6ff>&#34;Failed to execute process&#34;</span>);<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#d2a8ff;font-weight:700>assert!</span>(output.status.success());<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span>}<span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=æœ€ä½³å®è·µæ€»ç»“>æœ€ä½³å®è·µæ€»ç»“<a hidden class=anchor aria-hidden=true href=#æœ€ä½³å®è·µæ€»ç»“>#</a></h2><ol><li><strong>ä½¿ç”¨åˆé€‚çš„Crate</strong>ï¼šclapï¼ˆå‚æ•°è§£æï¼‰ã€anyhowï¼ˆé”™è¯¯å¤„ç†ï¼‰ã€tokioï¼ˆå¼‚æ­¥è¿è¡Œæ—¶ï¼‰</li><li><strong>æ€§èƒ½ä¼˜å…ˆ</strong>ï¼šå¯ç”¨LTOã€codegen-units=1ã€stripç¬¦å·</li><li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šæ¸…æ™°çš„è¿›åº¦æ¡ã€å‹å¥½çš„é”™è¯¯ä¿¡æ¯ã€è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜</li><li><strong>è·¨å¹³å°æ”¯æŒ</strong>ï¼šæ¡ä»¶ç¼–è¯‘ã€è‡ªåŠ¨æ„å»ºã€å¤šå¹³å°æµ‹è¯•</li><li><strong>æ–‡æ¡£å®Œå–„</strong>ï¼šREADMEã€ç¤ºä¾‹ä»£ç ã€APIæ–‡æ¡£</li></ol><h2 id=ç»“è®º>ç»“è®º<a hidden class=anchor aria-hidden=true href=#ç»“è®º>#</a></h2><p>Rustä¸ºCLIå·¥å…·å¼€å‘æä¾›äº†å¼ºå¤§çš„åŸºç¡€è®¾æ–½ã€‚é€šè¿‡æœ¬æ–‡çš„å®æˆ˜æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å±•ç¤ºäº†ä»é¡¹ç›®åˆå§‹åŒ–åˆ°æœ€ç»ˆéƒ¨ç½²çš„å®Œæ•´æµç¨‹ã€‚ä½¿ç”¨Rustæ„å»ºçš„CLIå·¥å…·ä¸ä»…æ€§èƒ½å“è¶Šï¼Œè€Œä¸”å…·å¤‡å†…å­˜å®‰å…¨å’Œè·¨å¹³å°èƒ½åŠ›ï¼Œæ˜¯æ›¿ä»£ä¼ ç»Ÿè„šæœ¬è¯­è¨€çš„ç†æƒ³é€‰æ‹©ã€‚</p><h2 id=å‚è€ƒèµ„æ–™>å‚è€ƒèµ„æ–™<a hidden class=anchor aria-hidden=true href=#å‚è€ƒèµ„æ–™>#</a></h2><ul><li><a href=https://rust-cli.github.io/book/index.html>Rust CLI Book</a></li><li><a href=https://github.com/kbknapp/cli-rs>Command Line Applications in Rust</a></li><li><a href=https://nnethercote.github.io/perf-book/intro.html>Rust Performance Book</a></li></ul></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/rust/ class=tag-pill>Rust
</a><a href=/blog/tags/cli/ class=tag-pill>CLI
</a><a href=/blog/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/ class=tag-pill>å¼€å‘å·¥å…·
</a><a href=/blog/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0/ class=tag-pill>è·¨å¹³å°
</a><a href=/blog/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/ class=tag-pill>æ€§èƒ½ä¼˜åŒ–</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/webassembly%E5%9C%A8%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5%E7%AA%81%E7%A0%B4javascript%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>WebAssemblyåœ¨å‰ç«¯å·¥ç¨‹ä¸­çš„å®è·µï¼šçªç ´JavaScriptæ€§èƒ½ç“¶é¢ˆ</div></div></a><a href=/blog/articles/vue-3.5%E6%96%B0%E7%89%B9%E6%80%A7%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%87%8D%E5%A4%A7%E5%8D%87%E7%BA%A7/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>Vue 3.5æ–°ç‰¹æ€§æ·±åº¦è§£æï¼šå“åº”å¼ç³»ç»Ÿçš„é‡å¤§å‡çº§</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>å‰è¨€</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>é¡¹ç›®åˆå§‹åŒ–</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>å‘½ä»¤è¡Œå‚æ•°å¤„ç†</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>é”™è¯¯å¤„ç†ä½“ç³»</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>æ ¸å¿ƒå¤„ç†é€»è¾‘</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>ä¼˜é›…çš„è¿›åº¦æ˜¾ç¤º</span></a></li><li class="toc-item toc-h2"><a href=#h2-6 class=toc-item-link><span class=toc-item-text>ä¸»ç¨‹åºå…¥å£</span></a></li><li class="toc-item toc-h2"><a href=#h2-7 class=toc-item-link><span class=toc-item-text>è·¨å¹³å°ç¼–è¯‘é…ç½®</span></a></li><li class="toc-item toc-h2"><a href=#h2-8 class=toc-item-link><span class=toc-item-text>æ„å»ºä¸åˆ†å‘</span></a></li><li class="toc-item toc-h2"><a href=#h2-9 class=toc-item-link><span class=toc-item-text>æ€§èƒ½ä¼˜åŒ–æŠ€å·§</span></a></li><li class="toc-item toc-h2"><a href=#h2-10 class=toc-item-link><span class=toc-item-text>æµ‹è¯•ç­–ç•¥</span></a></li><li class="toc-item toc-h2"><a href=#h2-11 class=toc-item-link><span class=toc-item-text>æœ€ä½³å®è·µæ€»ç»“</span></a></li><li class="toc-item toc-h2"><a href=#h2-12 class=toc-item-link><span class=toc-item-text>ç»“è®º</span></a></li><li class="toc-item toc-h2"><a href=#h2-13 class=toc-item-link><span class=toc-item-text>å‚è€ƒèµ„æ–™</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>