<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å— | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="AWS Lambda,æ— æœåŠ¡å™¨,æ€§èƒ½ä¼˜åŒ–,å†·å¯åŠ¨,æˆæœ¬æ§åˆ¶"><meta name=description content="æ·±å…¥æ¢è®¨AWS Lambdaçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ŒåŒ…æ‹¬å†·å¯åŠ¨ä¼˜åŒ–ã€å†…å­˜é…ç½®ã€å¹¶å‘æ§åˆ¶å’Œæˆæœ¬ç®¡ç†ã€‚"><meta name=author content="æŠ€æœ¯å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/aws-lambda-optimization/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/aws-lambda-optimization/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/aws-lambda-optimization/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/aws-lambda-optimization/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—"><meta property="og:description" content="æ·±å…¥æ¢è®¨AWS Lambdaçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ŒåŒ…æ‹¬å†·å¯åŠ¨ä¼˜åŒ–ã€å†…å­˜é…ç½®ã€å¹¶å‘æ§åˆ¶å’Œæˆæœ¬ç®¡ç†ã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-19T18:00:00+08:00"><meta property="article:modified_time" content="2025-12-19T18:00:00+08:00"><meta property="article:tag" content="AWS"><meta property="article:tag" content="Lambda"><meta property="article:tag" content="æ— æœåŠ¡å™¨"><meta property="article:tag" content="æ€§èƒ½ä¼˜åŒ–"><meta property="article:tag" content="Serverless"><meta name=twitter:card content="summary"><meta name=twitter:title content="AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—"><meta name=twitter:description content="æ·±å…¥æ¢è®¨AWS Lambdaçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ŒåŒ…æ‹¬å†·å¯åŠ¨ä¼˜åŒ–ã€å†…å­˜é…ç½®ã€å¹¶å‘æ§åˆ¶å’Œæˆæœ¬ç®¡ç†ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—","item":"/blog/articles/aws-lambda-optimization/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—","name":"AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—","description":"æ·±å…¥æ¢è®¨AWS Lambdaçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ŒåŒ…æ‹¬å†·å¯åŠ¨ä¼˜åŒ–ã€å†…å­˜é…ç½®ã€å¹¶å‘æ§åˆ¶å’Œæˆæœ¬ç®¡ç†ã€‚","keywords":["AWS Lambda","æ— æœåŠ¡å™¨","æ€§èƒ½ä¼˜åŒ–","å†·å¯åŠ¨","æˆæœ¬æ§åˆ¶"],"articleBody":"AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å— AWS Lambdaä½œä¸ºæ— æœåŠ¡å™¨è®¡ç®—çš„æ ¸å¿ƒæœåŠ¡ï¼Œå…¶æ€§èƒ½ä¼˜åŒ–å¯¹äºæ„å»ºé«˜æ•ˆåº”ç”¨è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å„ç§ä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©æ‚¨å……åˆ†å‘æŒ¥Lambdaçš„æ½œåŠ›ã€‚\nå†·å¯åŠ¨ä¼˜åŒ– 1. ç†è§£å†·å¯åŠ¨ å†·å¯åŠ¨æ˜¯æŒ‡Lambdaå‡½æ•°åœ¨ä¸€æ®µæ—¶é—´æœªè¢«è°ƒç”¨åï¼Œé¦–æ¬¡æ‰§è¡Œæ—¶çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # lambda_function.py - ä¼˜åŒ–åˆå§‹åŒ–ä»£ç  import json import boto3 import os # åœ¨å…¨å±€èŒƒå›´åˆå§‹åŒ–SDKå’Œè¿æ¥ s3_client = boto3.client('s3') dynamodb = boto3.resource('dynamodb') # é¢„çƒ­è¿æ¥ table = dynamodb.Table(os.environ['TABLE_NAME']) # ç¼“å­˜é…ç½® CONFIG = { 'bucket_name': os.environ['BUCKET_NAME'], 'max_retries': 3 } def lambda_handler(event, context): \"\"\"å¤„ç†Lambdaè¯·æ±‚\"\"\" try: # å‡½æ•°é€»è¾‘ result = process_event(event) return { 'statusCode': 200, 'body': json.dumps(result) } except Exception as e: return { 'statusCode': 500, 'body': json.dumps({'error': str(e)}) } def process_event(event): \"\"\"å¤„ç†äº‹ä»¶é€»è¾‘\"\"\" # ä¸šåŠ¡é€»è¾‘ pass 2. é¢„çƒ­ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # warmer.py - Lambdaé¢„çƒ­å‡½æ•° import json import boto3 import time lambda_client = boto3.client('lambda') def warmup_handler(event, context): \"\"\"é¢„çƒ­Lambdaå‡½æ•°\"\"\" function_names = [ 'my-app-api-handler', 'my-app-processor', 'my-app-notifier' ] for function_name in function_names: # å‘é€é¢„çƒ­è¯·æ±‚ try: lambda_client.invoke( FunctionName=function_name, InvocationType='Event', # å¼‚æ­¥è°ƒç”¨ Payload=json.dumps({'warmup': True}) ) except Exception as e: print(f\"Failed to warm up {function_name}: {e}\") return { 'statusCode': 200, 'body': json.dumps({'message': 'Warmup completed'}) } # ä½¿ç”¨EventBridgeå®šæœŸé¢„çƒ­ # æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡é¢„çƒ­ 3. è¿è¡Œæ—¶ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // node.js - ä½¿ç”¨esbuildä¼˜åŒ–æ‰“åŒ… // build.js const esbuild = require('esbuild'); esbuild.build({ entryPoints: ['index.js'], bundle: true, minify: true, platform: 'node', target: ['node14'], outfile: 'dist/lambda.js', external: ['aws-sdk'], define: { 'process.env.NODE_ENV': '\"production\"' } }).catch(() =\u003e process.exit(1)); // package.json { \"scripts\": { \"build\": \"node build.js\", \"deploy\": \"npm run build \u0026\u0026 serverless deploy\" } } å†…å­˜å’ŒCPUé…ç½® 1. æœ€ä¼˜å†…å­˜é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 # memory_optimizer.py - å†…å­˜ä¼˜åŒ–å·¥å…· import time import json import boto3 import statistics lambda_client = boto3.client('lambda') def test_memory_performance(function_name): \"\"\"æµ‹è¯•ä¸åŒå†…å­˜é…ç½®çš„æ€§èƒ½\"\"\" memory_sizes = [128, 256, 512, 1024, 2048, 3008] results = [] for memory_size in memory_sizes: # æ›´æ–°å‡½æ•°é…ç½® lambda_client.update_function_configuration( FunctionName=function_name, MemorySize=memory_size ) # ç­‰å¾…é…ç½®æ›´æ–° time.sleep(5) # æ‰§è¡Œæµ‹è¯• durations = [] for _ in range(10): start_time = time.time() response = lambda_client.invoke( FunctionName=function_name, Payload=json.dumps({'test': True}) ) # ç­‰å¾…æ‰§è¡Œå®Œæˆ response['Payload'].read() end_time = time.time() durations.append((end_time - start_time) * 1000) avg_duration = statistics.mean(durations) results.append({ 'memory_size': memory_size, 'avg_duration': avg_duration, 'cost_per_invocation': calculate_cost(memory_size, avg_duration) }) # æ‰¾åˆ°æ€§ä»·æ¯”æœ€ä¼˜çš„é…ç½® optimal_config = min(results, key=lambda x: x['cost_per_invocation']) return optimal_config, results def calculate_cost(memory_mb, duration_ms): \"\"\"è®¡ç®—å•æ¬¡è°ƒç”¨æˆæœ¬\"\"\" # AWS Lambda å®šä»·ï¼ˆç¤ºä¾‹ï¼‰ cost_per_mb_second = 0.0000166667 duration_seconds = duration_ms / 1000 return memory_mb * duration_seconds * cost_per_mb_second 2. åŠ¨æ€å†…å­˜è°ƒæ•´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 # adaptive_memory.py - è‡ªé€‚åº”å†…å­˜ç®¡ç† import os import boto3 import time class AdaptiveMemoryManager: def __init__(self, function_name): self.function_name = function_name self.lambda_client = boto3.client('lambda') self.cloudwatch = boto3.client('cloudwatch') def monitor_and_adjust(self): \"\"\"ç›‘æ§æ€§èƒ½å¹¶è°ƒæ•´å†…å­˜\"\"\" # è·å–æ€§èƒ½æŒ‡æ ‡ metrics = self.get_performance_metrics() # æ ¹æ®æŒ‡æ ‡è°ƒæ•´å†…å­˜ new_memory = self.calculate_optimal_memory(metrics) if self.should_adjust_memory(new_memory): self.adjust_memory(new_memory) def get_performance_metrics(self): \"\"\"è·å–æ€§èƒ½æŒ‡æ ‡\"\"\" end_time = int(time.time()) start_time = end_time - 3600 # æœ€è¿‘1å°æ—¶ response = self.cloudwatch.get_metric_statistics( Namespace='AWS/Lambda', MetricName='Duration', Dimensions=[ { 'Name': 'FunctionName', 'Value': self.function_name } ], StartTime=start_time, EndTime=end_time, Period=60, Statistics=['Average', 'Maximum'] ) return response['Datapoints'] def calculate_optimal_memory(self, metrics): \"\"\"è®¡ç®—æœ€ä¼˜å†…å­˜é…ç½®\"\"\" if not metrics: return 512 # é»˜è®¤å€¼ # åŸºäºæœ€å¤§æ‰§è¡Œæ—¶é—´è®¡ç®—å†…å­˜éœ€æ±‚ max_duration = max(m['Average'] for m in metrics) # æ ¹æ®ç»éªŒå…¬å¼è°ƒæ•´ if max_duration \u003c 100: # 100ms return 256 elif max_duration \u003c 500: return 512 elif max_duration \u003c 1500: return 1024 else: return 2048 å¹¶å‘æ§åˆ¶ 1. é¢„ç•™å¹¶å‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 # concurrent_control.py - å¹¶å‘æ§åˆ¶é…ç½® import boto3 lambda_client = boto3.client('lambda') def configure_reserved_concurrency(): \"\"\"é…ç½®é¢„ç•™å¹¶å‘\"\"\" functions = { 'critical-api': 100, # å…³é”®API 'batch-processor': 50, # æ‰¹å¤„ç†ä»»åŠ¡ 'notification-sender': 20 # é€šçŸ¥å‘é€ } for function_name, concurrency in functions.items(): lambda_client.put_function_concurrency( FunctionName=function_name, ReservedConcurrentExecutions=concurrency ) print(f\"Set {concurrency} reserved concurrency for {function_name}\") def configure_provisioned_concurrency(): \"\"\"é…ç½®é¢„ç½®å¹¶å‘ï¼ˆç”¨äºåˆ«åï¼‰\"\"\" lambda_client.put_provisioned_concurrency_config( FunctionName='my-api-function', Qualifier='production', ProvisionedConcurrentExecutions=50 ) # Serverless Frameworké…ç½® # serverless.yml service: my-app provider: name: aws runtime: python3.9 functions: criticalFunction: handler: handler.main reservedConcurrency: 10 provisionedConcurrency: 5 events: - http: path: /critical method: get 2. é™æµå’Œé™çº§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 # rate_limiter.py - é™æµå®ç° import time import json from collections import defaultdict import threading class RateLimiter: def __init__(self, max_requests, time_window): self.max_requests = max_requests self.time_window = time_window self.requests = defaultdict(list) self.lock = threading.Lock() def is_allowed(self, key): \"\"\"æ£€æŸ¥æ˜¯å¦å…è®¸è¯·æ±‚\"\"\" with self.lock: now = time.time() # æ¸…ç†è¿‡æœŸè¯·æ±‚ self.requests[key] = [ req_time for req_time in self.requests[key] if now - req_time \u003c self.time_window ] # æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶ if len(self.requests[key]) \u003e= self.max_requests: return False # è®°å½•æ–°è¯·æ±‚ self.requests[key].append(now) return True # åœ¨Lambdaä¸­ä½¿ç”¨ rate_limiter = RateLimiter(max_requests=100, time_window=60) def lambda_handler(event, context): client_ip = event['requestContext']['identity']['sourceIp'] if not rate_limiter.is_allowed(client_ip): return { 'statusCode': 429, 'body': json.dumps({'error': 'Too many requests'}) } # å¤„ç†æ­£å¸¸è¯·æ±‚ pass ä»£ç ä¼˜åŒ– 1. å¼‚æ­¥å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 # async_handler.py - å¼‚æ­¥å¤„ç†æ¨¡å¼ import asyncio import aiohttp import json from concurrent.futures import ThreadPoolExecutor # ä½¿ç”¨asyncioè¿›è¡Œå¼‚æ­¥å¤„ç† async def process_multiple_apis(urls): \"\"\"å¹¶å‘è°ƒç”¨å¤šä¸ªAPI\"\"\" async with aiohttp.ClientSession() as session: tasks = [fetch_url(session, url) for url in urls] results = await asyncio.gather(*tasks) return results async def fetch_url(session, url): \"\"\"è·å–å•ä¸ªURL\"\"\" async with session.get(url) as response: return await response.json() def lambda_handler(event, context): \"\"\"Lambdaå¤„ç†å‡½æ•°\"\"\" urls = [ 'https://api1.example.com/data', 'https://api2.example.com/data', 'https://api3.example.com/data' ] # è¿è¡Œå¼‚æ­¥ä»£ç  loop = asyncio.get_event_loop() results = loop.run_until_complete(process_multiple_apis(urls)) return { 'statusCode': 200, 'body': json.dumps(results) } # ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†CPUå¯†é›†å‹ä»»åŠ¡ def cpu_intensive_task(data): \"\"\"CPUå¯†é›†å‹ä»»åŠ¡\"\"\" result = sum(i * i for i in range(data)) return result def lambda_handler(event, context): with ThreadPoolExecutor(max_workers=4) as executor: futures = [] for item in event['items']: future = executor.submit(cpu_intensive_task, item) futures.append(future) results = [future.result() for future in futures] return { 'statusCode': 200, 'body': json.dumps(results) } 2. æ•°æ®å¤„ç†ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 # data_optimization.py - æ•°æ®å¤„ç†ä¼˜åŒ– import json import gzip import io import csv # å‹ç¼©å“åº”æ•°æ® def compress_response(data): \"\"\"å‹ç¼©å“åº”æ•°æ®\"\"\" json_str = json.dumps(data) buffer = io.BytesIO() with gzip.GzipFile(fileobj=buffer, mode='w') as gz: gz.write(json_str.encode('utf-8')) return buffer.getvalue() # æµå¼å¤„ç†å¤§æ–‡ä»¶ def process_large_csv(event, context): \"\"\"æµå¼å¤„ç†å¤§CSVæ–‡ä»¶\"\"\" s3 = boto3.client('s3') # è·å–S3äº‹ä»¶ bucket = event['Records'][0]['s3']['bucket']['name'] key = event['Records'][0]['s3']['object']['key'] # æµå¼è¯»å– response = s3.get_object(Bucket=bucket, Key=key) results = [] for line in response['Body'].iter_lines(): # é€è¡Œå¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º row = json.loads(line) processed = process_row(row) results.append(processed) return { 'processed_rows': len(results) } # æ‰¹é‡å¤„ç†ä¼˜åŒ– def batch_process_items(items, batch_size=100): \"\"\"æ‰¹é‡å¤„ç†é¡¹ç›®\"\"\" batches = [items[i:i + batch_size] for i in range(0, len(items), batch_size)] for batch in batches: process_batch(batch) ç›‘æ§å’Œè°ƒè¯• 1. æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 # monitoring.py - æ€§èƒ½ç›‘æ§è£…é¥°å™¨ import time import functools import boto3 import os cloudwatch = boto3.client('cloudwatch') def monitor_performance(metric_name): \"\"\"æ€§èƒ½ç›‘æ§è£…é¥°å™¨\"\"\" def decorator(func): @functools.wraps(func) def wrapper(*args, **kwargs): start_time = time.time() try: result = func(*args, **kwargs) success = True except Exception as e: success = False raise finally: duration = (time.time() - start_time) * 1000 # å‘é€æŒ‡æ ‡åˆ°CloudWatch cloudwatch.put_metric_data( Namespace='Lambda/Performance', MetricData=[ { 'MetricName': metric_name, 'Value': duration, 'Unit': 'Milliseconds', 'Dimensions': [ { 'Name': 'FunctionName', 'Value': os.environ.get('AWS_LAMBDA_FUNCTION_NAME', 'Unknown') } ] }, { 'MetricName': f'{metric_name}_Success', 'Value': 1 if success else 0, 'Unit': 'Count', 'Dimensions': [ { 'Name': 'FunctionName', 'Value': os.environ.get('AWS_LAMBDA_FUNCTION_NAME', 'Unknown') } ] } ] ) return result return wrapper return decorator # ä½¿ç”¨ç¤ºä¾‹ @monitor_performance('api_request') def lambda_handler(event, context): \"\"\"APIè¯·æ±‚å¤„ç†\"\"\" # ä¸šåŠ¡é€»è¾‘ pass 2. é”™è¯¯å¤„ç†å’Œé‡è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 # retry_handler.py - é‡è¯•æœºåˆ¶ import time import random from functools import wraps def exponential_backoff(max_retries=3, base_delay=0.1, max_delay=2): \"\"\"æŒ‡æ•°é€€é¿é‡è¯•è£…é¥°å™¨\"\"\" def decorator(func): @wraps(func) def wrapper(*args, **kwargs): for attempt in range(max_retries + 1): try: return func(*args, **kwargs) except Exception as e: if attempt == max_retries: raise delay = min(base_delay * (2 ** attempt) + random.uniform(0, 0.1), max_delay) time.sleep(delay) return wrapper return decorator # æ–­è·¯å™¨æ¨¡å¼ class CircuitBreaker: def __init__(self, failure_threshold=5, timeout=60): self.failure_threshold = failure_threshold self.timeout = timeout self.failure_count = 0 self.last_failure_time = None self.state = 'CLOSED' # CLOSED, OPEN, HALF_OPEN def call(self, func, *args, **kwargs): \"\"\"æ–­è·¯å™¨è°ƒç”¨\"\"\" if self.state == 'OPEN': if time.time() - self.last_failure_time \u003e self.timeout: self.state = 'HALF_OPEN' else: raise Exception('Circuit breaker is OPEN') try: result = func(*args, **kwargs) self.reset() return result except Exception as e: self.record_failure() raise def record_failure(self): \"\"\"è®°å½•å¤±è´¥\"\"\" self.failure_count += 1 self.last_failure_time = time.time() if self.failure_count \u003e= self.failure_threshold: self.state = 'OPEN' def reset(self): \"\"\"é‡ç½®æ–­è·¯å™¨\"\"\" self.failure_count = 0 self.state = 'CLOSED' æˆæœ¬ä¼˜åŒ– 1. è®¡ç®—ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 # cost_optimizer.py - æˆæœ¬ä¼˜åŒ– import json import boto3 from datetime import datetime, timedelta class LambdaCostOptimizer: def __init__(self): self.ce_client = boto3.client('ce') self.lambda_client = boto3.client('lambda') def analyze_costs(self): \"\"\"åˆ†æLambdaæˆæœ¬\"\"\" end_date = datetime.now().date() start_date = end_date - timedelta(days=30) response = self.ce_client.get_cost_and_usage( TimePeriod={ 'Start': start_date.isoformat(), 'End': end_date.isoformat() }, Granularity='DAILY', Metrics=['BlendedCost'], GroupBy=[ { 'Type': 'DIMENSION', 'Key': 'SERVICE' } ], Filter={ 'Dimensions': { 'Key': 'SERVICE', 'Values': ['AWS Lambda'] } } ) return response['ResultsByTime'] def optimize_functions(self): \"\"\"ä¼˜åŒ–å‡½æ•°é…ç½®\"\"\" functions = self.get_all_functions() for function in functions: metrics = self.get_function_metrics(function['FunctionName']) if metrics: # æ ¹æ®ä½¿ç”¨æ¨¡å¼ä¼˜åŒ–é…ç½® optimal_memory = self.calculate_optimal_memory(metrics) optimal_timeout = self.calculate_optimal_timeout(metrics) self.update_function_config( function['FunctionName'], optimal_memory, optimal_timeout ) def calculate_optimal_memory(self, metrics): \"\"\"è®¡ç®—æœ€ä¼˜å†…å­˜é…ç½®\"\"\" avg_duration = metrics.get('avg_duration', 100) max_duration = metrics.get('max_duration', 500) # åŸºäºæ‰§è¡Œæ—¶é—´è®¡ç®—å†…å­˜éœ€æ±‚ if avg_duration \u003c 100: return 128 elif avg_duration \u003c 500: return 256 elif avg_duration \u003c 2000: return 512 else: return 1024 å®æˆ˜æ¡ˆä¾‹ 1. å›¾åƒå¤„ç†æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 # image_processor.py - å›¾åƒå¤„ç†Lambda import boto3 import io from PIL import Image s3_client = boto3.client('s3') s3_resource = boto3.resource('s3') def resize_image_handler(event, context): \"\"\"å›¾åƒç¼©æ”¾å¤„ç†\"\"\" for record in event['Records']: # è§£æS3äº‹ä»¶ bucket = record['s3']['bucket']['name'] key = record['s3']['object']['key'] # ä¸‹è½½å›¾åƒ obj = s3_resource.Object(bucket, key) image_data = obj.get()['Body'].read() # å¤„ç†å›¾åƒ image = Image.open(io.BytesIO(image_data)) # ç”Ÿæˆå¤šä¸ªå°ºå¯¸ sizes = [ ('thumbnail', (150, 150)), ('medium', (500, 500)), ('large', (1000, 1000)) ] for size_name, size in sizes: resized = image.copy() resized.thumbnail(size, Image.LANCZOS) # ä¿å­˜åˆ°S3 output_key = f\"processed/{size_name}/{key}\" output_buffer = io.BytesIO() resized.save(output_buffer, format='JPEG', quality=85) s3_client.put_object( Bucket=bucket, Key=output_key, Body=output_buffer.getvalue(), ContentType='image/jpeg' ) # ä¼˜åŒ–ç‰ˆæœ¬ï¼šä½¿ç”¨é¢„åˆ†é…å†…å­˜ def optimized_resize_handler(event, context): \"\"\"ä¼˜åŒ–çš„å›¾åƒå¤„ç†\"\"\" # é¢„å…ˆåˆ†é…è¶³å¤Ÿçš„å†…å­˜ import os os.environ['PYTHONMALLOC'] = 'malloc' resize_image_handler(event, context) 2. APIç½‘å…³é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 # api_gateway.py - APIç½‘å…³é›†æˆä¼˜åŒ– import json import boto3 from decimal import Decimal dynamodb = boto3.resource('dynamodb') class DecimalEncoder(json.JSONEncoder): \"\"\"å¤„ç†Decimalç±»å‹\"\"\" def default(self, obj): if isinstance(obj, Decimal): return float(obj) return super(DecimalEncoder, self).default(obj) def api_handler(event, context): \"\"\"APIå¤„ç†å‡½æ•°\"\"\" http_method = event['httpMethod'] path = event['path'] # è·¯ç”±å¤„ç† if path == '/users' and http_method == 'GET': return get_users(event) elif path == '/users' and http_method == 'POST': return create_user(event) else: return { 'statusCode': 404, 'body': json.dumps({'error': 'Not found'}) } def get_users(event): \"\"\"è·å–ç”¨æˆ·åˆ—è¡¨\"\"\" table = dynamodb.Table('users') # åˆ†é¡µå‚æ•° limit = int(event.get('queryStringParameters', {}).get('limit', 10)) last_key = event.get('queryStringParameters', {}).get('last_key') scan_kwargs = {'Limit': limit} if last_key: scan_kwargs['ExclusiveStartKey'] = {'id': last_key} response = table.scan(**scan_kwargs) return { 'statusCode': 200, 'headers': { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }, 'body': json.dumps( { 'users': response['Items'], 'last_key': response.get('LastEvaluatedKey', {}).get('id') }, cls=DecimalEncoder ) } æœ€ä½³å®è·µæ€»ç»“ å†·å¯åŠ¨ä¼˜åŒ–ï¼šå…¨å±€åˆå§‹åŒ–ã€é¢„çƒ­ç­–ç•¥ã€è¿è¡Œæ—¶ä¼˜åŒ– èµ„æºé…ç½®ï¼šåŠ¨æ€è°ƒæ•´ã€é¢„ç•™å¹¶å‘ã€æ€§èƒ½ç›‘æ§ ä»£ç ä¼˜åŒ–ï¼šå¼‚æ­¥å¤„ç†ã€æ‰¹é‡æ“ä½œã€å†…å­˜ç®¡ç† é”™è¯¯å¤„ç†ï¼šé‡è¯•æœºåˆ¶ã€æ–­è·¯å™¨ã€ä¼˜é›…é™çº§ æˆæœ¬æ§åˆ¶ï¼šä½¿ç”¨æ¨¡å¼åˆ†æã€èµ„æºä¼˜åŒ–ã€ç›‘æ§å‘Šè­¦ æ€»ç»“ AWS Lambdaä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š\nå‡å°‘å†·å¯åŠ¨ï¼šé¢„çƒ­å’Œä¼˜åŒ–åˆå§‹åŒ– åˆç†é…ç½®ï¼šæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å†…å­˜å’Œå¹¶å‘ ä¼˜åŒ–ä»£ç ï¼šä½¿ç”¨å¼‚æ­¥å’Œæ‰¹å¤„ç†æŠ€æœ¯ æŒç»­ç›‘æ§ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³» æˆæœ¬æ§åˆ¶ï¼šå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬ é€šè¿‡è¿™äº›ä¼˜åŒ–ç­–ç•¥ï¼Œå¯ä»¥æ„å»ºé«˜æ€§èƒ½ã€ä½æˆæœ¬çš„æ— æœåŠ¡å™¨åº”ç”¨ã€‚\nç›¸å…³èµ„æº AWS Lambdaå¼€å‘è€…æŒ‡å— Lambdaæœ€ä½³å®è·µ AWSæ— æœåŠ¡å™¨æ¶æ„ ","wordCount":"2209","inLanguage":"zh-cn","datePublished":"2025-12-19T18:00:00+08:00","dateModified":"2025-12-19T18:00:00+08:00","author":{"@type":"Person","name":"æŠ€æœ¯å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/aws-lambda-optimization/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—</h1><div class=post-description>æ·±å…¥æ¢è®¨AWS Lambdaçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ŒåŒ…æ‹¬å†·å¯åŠ¨ä¼˜åŒ–ã€å†…å­˜é…ç½®ã€å¹¶å‘æ§åˆ¶å’Œæˆæœ¬ç®¡ç†ã€‚</div><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/ class=category-link>äº‘åŸç”Ÿ</a></div><span class=post-date>2025-12-19</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><h2 id=aws-lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—>AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—<a hidden class=anchor aria-hidden=true href=#aws-lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—>#</a></h2><p>AWS Lambdaä½œä¸ºæ— æœåŠ¡å™¨è®¡ç®—çš„æ ¸å¿ƒæœåŠ¡ï¼Œå…¶æ€§èƒ½ä¼˜åŒ–å¯¹äºæ„å»ºé«˜æ•ˆåº”ç”¨è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å„ç§ä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©æ‚¨å……åˆ†å‘æŒ¥Lambdaçš„æ½œåŠ›ã€‚</p><h3 id=å†·å¯åŠ¨ä¼˜åŒ–>å†·å¯åŠ¨ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#å†·å¯åŠ¨ä¼˜åŒ–>#</a></h3><h4 id=1-ç†è§£å†·å¯åŠ¨>1. ç†è§£å†·å¯åŠ¨<a hidden class=anchor aria-hidden=true href=#1-ç†è§£å†·å¯åŠ¨>#</a></h4><p>å†·å¯åŠ¨æ˜¯æŒ‡Lambdaå‡½æ•°åœ¨ä¸€æ®µæ—¶é—´æœªè¢«è°ƒç”¨åï¼Œé¦–æ¬¡æ‰§è¡Œæ—¶çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># lambda_function.py - ä¼˜åŒ–åˆå§‹åŒ–ä»£ç </span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>boto3</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>os</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># åœ¨å…¨å±€èŒƒå›´åˆå§‹åŒ–SDKå’Œè¿æ¥</span>
</span></span><span style=display:flex><span>s3_client <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;s3&#39;</span>)
</span></span><span style=display:flex><span>dynamodb <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>resource(<span style=color:#a5d6ff>&#39;dynamodb&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># é¢„çƒ­è¿æ¥</span>
</span></span><span style=display:flex><span>table <span style=color:#ff7b72;font-weight:700>=</span> dynamodb<span style=color:#ff7b72;font-weight:700>.</span>Table(os<span style=color:#ff7b72;font-weight:700>.</span>environ[<span style=color:#a5d6ff>&#39;TABLE_NAME&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ç¼“å­˜é…ç½®</span>
</span></span><span style=display:flex><span>CONFIG <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;bucket_name&#39;</span>: os<span style=color:#ff7b72;font-weight:700>.</span>environ[<span style=color:#a5d6ff>&#39;BUCKET_NAME&#39;</span>],
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;max_retries&#39;</span>: <span style=color:#a5d6ff>3</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>lambda_handler</span>(event, context):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å¤„ç†Lambdaè¯·æ±‚&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å‡½æ•°é€»è¾‘</span>
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> process_event(event)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;statusCode&#39;</span>: <span style=color:#a5d6ff>200</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;body&#39;</span>: json<span style=color:#ff7b72;font-weight:700>.</span>dumps(result)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;statusCode&#39;</span>: <span style=color:#a5d6ff>500</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;body&#39;</span>: json<span style=color:#ff7b72;font-weight:700>.</span>dumps({<span style=color:#a5d6ff>&#39;error&#39;</span>: str(e)})
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>process_event</span>(event):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å¤„ç†äº‹ä»¶é€»è¾‘&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ä¸šåŠ¡é€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>pass</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2-é¢„çƒ­ç­–ç•¥>2. é¢„çƒ­ç­–ç•¥<a hidden class=anchor aria-hidden=true href=#2-é¢„çƒ­ç­–ç•¥>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># warmer.py - Lambdaé¢„çƒ­å‡½æ•°</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>boto3</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>time</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lambda_client <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;lambda&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>warmup_handler</span>(event, context):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;é¢„çƒ­Lambdaå‡½æ•°&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    function_names <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;my-app-api-handler&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;my-app-processor&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;my-app-notifier&#39;</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> function_name <span style=color:#ff7b72;font-weight:700>in</span> function_names:
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å‘é€é¢„çƒ­è¯·æ±‚</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            lambda_client<span style=color:#ff7b72;font-weight:700>.</span>invoke(
</span></span><span style=display:flex><span>                FunctionName<span style=color:#ff7b72;font-weight:700>=</span>function_name,
</span></span><span style=display:flex><span>                InvocationType<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Event&#39;</span>,  <span style=color:#8b949e;font-style:italic># å¼‚æ­¥è°ƒç”¨</span>
</span></span><span style=display:flex><span>                Payload<span style=color:#ff7b72;font-weight:700>=</span>json<span style=color:#ff7b72;font-weight:700>.</span>dumps({<span style=color:#a5d6ff>&#39;warmup&#39;</span>: <span style=color:#79c0ff>True</span>})
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>            print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Failed to warm up </span><span style=color:#a5d6ff>{</span>function_name<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>: </span><span style=color:#a5d6ff>{</span>e<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;statusCode&#39;</span>: <span style=color:#a5d6ff>200</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;body&#39;</span>: json<span style=color:#ff7b72;font-weight:700>.</span>dumps({<span style=color:#a5d6ff>&#39;message&#39;</span>: <span style=color:#a5d6ff>&#39;Warmup completed&#39;</span>})
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä½¿ç”¨EventBridgeå®šæœŸé¢„çƒ­</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡é¢„çƒ­</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=3-è¿è¡Œæ—¶ä¼˜åŒ–>3. è¿è¡Œæ—¶ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#3-è¿è¡Œæ—¶ä¼˜åŒ–>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// node.js - ä½¿ç”¨esbuildä¼˜åŒ–æ‰“åŒ…
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// build.js
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> esbuild <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;esbuild&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>esbuild.build({
</span></span><span style=display:flex><span>  entryPoints<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;index.js&#39;</span>],
</span></span><span style=display:flex><span>  bundle<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>  minify<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>  platform<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;node&#39;</span>,
</span></span><span style=display:flex><span>  target<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;node14&#39;</span>],
</span></span><span style=display:flex><span>  outfile<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;dist/lambda.js&#39;</span>,
</span></span><span style=display:flex><span>  external<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;aws-sdk&#39;</span>],
</span></span><span style=display:flex><span>  define<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;process.env.NODE_ENV&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;&#34;production&#34;&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}).<span style=color:#ff7b72>catch</span>(() =&gt; process.exit(<span style=color:#a5d6ff>1</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// package.json
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>{
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>&#34;scripts&#34;</span><span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;build&#34;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;node build.js&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;deploy&#34;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;npm run build &amp;&amp; serverless deploy&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=å†…å­˜å’Œcpué…ç½®>å†…å­˜å’ŒCPUé…ç½®<a hidden class=anchor aria-hidden=true href=#å†…å­˜å’Œcpué…ç½®>#</a></h3><h4 id=1-æœ€ä¼˜å†…å­˜é…ç½®>1. æœ€ä¼˜å†…å­˜é…ç½®<a hidden class=anchor aria-hidden=true href=#1-æœ€ä¼˜å†…å­˜é…ç½®>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># memory_optimizer.py - å†…å­˜ä¼˜åŒ–å·¥å…·</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>time</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>boto3</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>statistics</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lambda_client <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;lambda&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>test_memory_performance</span>(function_name):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æµ‹è¯•ä¸åŒå†…å­˜é…ç½®çš„æ€§èƒ½&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    memory_sizes <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>128</span>, <span style=color:#a5d6ff>256</span>, <span style=color:#a5d6ff>512</span>, <span style=color:#a5d6ff>1024</span>, <span style=color:#a5d6ff>2048</span>, <span style=color:#a5d6ff>3008</span>]
</span></span><span style=display:flex><span>    results <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> memory_size <span style=color:#ff7b72;font-weight:700>in</span> memory_sizes:
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ›´æ–°å‡½æ•°é…ç½®</span>
</span></span><span style=display:flex><span>        lambda_client<span style=color:#ff7b72;font-weight:700>.</span>update_function_configuration(
</span></span><span style=display:flex><span>            FunctionName<span style=color:#ff7b72;font-weight:700>=</span>function_name,
</span></span><span style=display:flex><span>            MemorySize<span style=color:#ff7b72;font-weight:700>=</span>memory_size
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç­‰å¾…é…ç½®æ›´æ–°</span>
</span></span><span style=display:flex><span>        time<span style=color:#ff7b72;font-weight:700>.</span>sleep(<span style=color:#a5d6ff>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ‰§è¡Œæµ‹è¯•</span>
</span></span><span style=display:flex><span>        durations <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> _ <span style=color:#ff7b72;font-weight:700>in</span> range(<span style=color:#a5d6ff>10</span>):
</span></span><span style=display:flex><span>            start_time <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            response <span style=color:#ff7b72;font-weight:700>=</span> lambda_client<span style=color:#ff7b72;font-weight:700>.</span>invoke(
</span></span><span style=display:flex><span>                FunctionName<span style=color:#ff7b72;font-weight:700>=</span>function_name,
</span></span><span style=display:flex><span>                Payload<span style=color:#ff7b72;font-weight:700>=</span>json<span style=color:#ff7b72;font-weight:700>.</span>dumps({<span style=color:#a5d6ff>&#39;test&#39;</span>: <span style=color:#79c0ff>True</span>})
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ç­‰å¾…æ‰§è¡Œå®Œæˆ</span>
</span></span><span style=display:flex><span>            response[<span style=color:#a5d6ff>&#39;Payload&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>read()
</span></span><span style=display:flex><span>            end_time <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            durations<span style=color:#ff7b72;font-weight:700>.</span>append((end_time <span style=color:#ff7b72;font-weight:700>-</span> start_time) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        avg_duration <span style=color:#ff7b72;font-weight:700>=</span> statistics<span style=color:#ff7b72;font-weight:700>.</span>mean(durations)
</span></span><span style=display:flex><span>        results<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;memory_size&#39;</span>: memory_size,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;avg_duration&#39;</span>: avg_duration,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;cost_per_invocation&#39;</span>: calculate_cost(memory_size, avg_duration)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æ‰¾åˆ°æ€§ä»·æ¯”æœ€ä¼˜çš„é…ç½®</span>
</span></span><span style=display:flex><span>    optimal_config <span style=color:#ff7b72;font-weight:700>=</span> min(results, key<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>lambda</span> x: x[<span style=color:#a5d6ff>&#39;cost_per_invocation&#39;</span>])
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> optimal_config, results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>calculate_cost</span>(memory_mb, duration_ms):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è®¡ç®—å•æ¬¡è°ƒç”¨æˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># AWS Lambda å®šä»·ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span style=display:flex><span>    cost_per_mb_second <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0.0000166667</span>
</span></span><span style=display:flex><span>    duration_seconds <span style=color:#ff7b72;font-weight:700>=</span> duration_ms <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#a5d6ff>1000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> memory_mb <span style=color:#ff7b72;font-weight:700>*</span> duration_seconds <span style=color:#ff7b72;font-weight:700>*</span> cost_per_mb_second
</span></span></code></pre></td></tr></table></div></div><h4 id=2-åŠ¨æ€å†…å­˜è°ƒæ•´>2. åŠ¨æ€å†…å­˜è°ƒæ•´<a hidden class=anchor aria-hidden=true href=#2-åŠ¨æ€å†…å­˜è°ƒæ•´>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># adaptive_memory.py - è‡ªé€‚åº”å†…å­˜ç®¡ç†</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>os</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>boto3</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>time</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>AdaptiveMemoryManager</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, function_name):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>function_name <span style=color:#ff7b72;font-weight:700>=</span> function_name
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>lambda_client <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;lambda&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>cloudwatch <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;cloudwatch&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>monitor_and_adjust</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç›‘æ§æ€§èƒ½å¹¶è°ƒæ•´å†…å­˜&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è·å–æ€§èƒ½æŒ‡æ ‡</span>
</span></span><span style=display:flex><span>        metrics <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>get_performance_metrics()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ ¹æ®æŒ‡æ ‡è°ƒæ•´å†…å­˜</span>
</span></span><span style=display:flex><span>        new_memory <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>calculate_optimal_memory(metrics)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>should_adjust_memory(new_memory):
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>adjust_memory(new_memory)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_performance_metrics</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–æ€§èƒ½æŒ‡æ ‡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        end_time <span style=color:#ff7b72;font-weight:700>=</span> int(time<span style=color:#ff7b72;font-weight:700>.</span>time())
</span></span><span style=display:flex><span>        start_time <span style=color:#ff7b72;font-weight:700>=</span> end_time <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#a5d6ff>3600</span>  <span style=color:#8b949e;font-style:italic># æœ€è¿‘1å°æ—¶</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        response <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>cloudwatch<span style=color:#ff7b72;font-weight:700>.</span>get_metric_statistics(
</span></span><span style=display:flex><span>            Namespace<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;AWS/Lambda&#39;</span>,
</span></span><span style=display:flex><span>            MetricName<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Duration&#39;</span>,
</span></span><span style=display:flex><span>            Dimensions<span style=color:#ff7b72;font-weight:700>=</span>[
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;Name&#39;</span>: <span style=color:#a5d6ff>&#39;FunctionName&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;Value&#39;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>function_name
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            StartTime<span style=color:#ff7b72;font-weight:700>=</span>start_time,
</span></span><span style=display:flex><span>            EndTime<span style=color:#ff7b72;font-weight:700>=</span>end_time,
</span></span><span style=display:flex><span>            Period<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>60</span>,
</span></span><span style=display:flex><span>            Statistics<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;Average&#39;</span>, <span style=color:#a5d6ff>&#39;Maximum&#39;</span>]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> response[<span style=color:#a5d6ff>&#39;Datapoints&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>calculate_optimal_memory</span>(self, metrics):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¡ç®—æœ€ä¼˜å†…å­˜é…ç½®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> metrics:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>512</span>  <span style=color:#8b949e;font-style:italic># é»˜è®¤å€¼</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åŸºäºæœ€å¤§æ‰§è¡Œæ—¶é—´è®¡ç®—å†…å­˜éœ€æ±‚</span>
</span></span><span style=display:flex><span>        max_duration <span style=color:#ff7b72;font-weight:700>=</span> max(m[<span style=color:#a5d6ff>&#39;Average&#39;</span>] <span style=color:#ff7b72>for</span> m <span style=color:#ff7b72;font-weight:700>in</span> metrics)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ ¹æ®ç»éªŒå…¬å¼è°ƒæ•´</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> max_duration <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>100</span>:  <span style=color:#8b949e;font-style:italic># 100ms</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>256</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> max_duration <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>500</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>512</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> max_duration <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>1500</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>1024</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>2048</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å¹¶å‘æ§åˆ¶>å¹¶å‘æ§åˆ¶<a hidden class=anchor aria-hidden=true href=#å¹¶å‘æ§åˆ¶>#</a></h3><h4 id=1-é¢„ç•™å¹¶å‘>1. é¢„ç•™å¹¶å‘<a hidden class=anchor aria-hidden=true href=#1-é¢„ç•™å¹¶å‘>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># concurrent_control.py - å¹¶å‘æ§åˆ¶é…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>boto3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lambda_client <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;lambda&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>configure_reserved_concurrency</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;é…ç½®é¢„ç•™å¹¶å‘&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    functions <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;critical-api&#39;</span>: <span style=color:#a5d6ff>100</span>,    <span style=color:#8b949e;font-style:italic># å…³é”®API</span>
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;batch-processor&#39;</span>: <span style=color:#a5d6ff>50</span>,   <span style=color:#8b949e;font-style:italic># æ‰¹å¤„ç†ä»»åŠ¡</span>
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;notification-sender&#39;</span>: <span style=color:#a5d6ff>20</span> <span style=color:#8b949e;font-style:italic># é€šçŸ¥å‘é€</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> function_name, concurrency <span style=color:#ff7b72;font-weight:700>in</span> functions<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>        lambda_client<span style=color:#ff7b72;font-weight:700>.</span>put_function_concurrency(
</span></span><span style=display:flex><span>            FunctionName<span style=color:#ff7b72;font-weight:700>=</span>function_name,
</span></span><span style=display:flex><span>            ReservedConcurrentExecutions<span style=color:#ff7b72;font-weight:700>=</span>concurrency
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Set </span><span style=color:#a5d6ff>{</span>concurrency<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> reserved concurrency for </span><span style=color:#a5d6ff>{</span>function_name<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>configure_provisioned_concurrency</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;é…ç½®é¢„ç½®å¹¶å‘ï¼ˆç”¨äºåˆ«åï¼‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    lambda_client<span style=color:#ff7b72;font-weight:700>.</span>put_provisioned_concurrency_config(
</span></span><span style=display:flex><span>        FunctionName<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;my-api-function&#39;</span>,
</span></span><span style=display:flex><span>        Qualifier<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;production&#39;</span>,
</span></span><span style=display:flex><span>        ProvisionedConcurrentExecutions<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>50</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Serverless Frameworké…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># serverless.yml</span>
</span></span><span style=display:flex><span>service: my<span style=color:#ff7b72;font-weight:700>-</span>app
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>provider:
</span></span><span style=display:flex><span>  name: aws
</span></span><span style=display:flex><span>  runtime: python3<span style=color:#a5d6ff>.9</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>functions:
</span></span><span style=display:flex><span>  criticalFunction:
</span></span><span style=display:flex><span>    handler: handler<span style=color:#ff7b72;font-weight:700>.</span>main
</span></span><span style=display:flex><span>    reservedConcurrency: <span style=color:#a5d6ff>10</span>
</span></span><span style=display:flex><span>    provisionedConcurrency: <span style=color:#a5d6ff>5</span>
</span></span><span style=display:flex><span>    events:
</span></span><span style=display:flex><span>      <span style=color:#ff7b72;font-weight:700>-</span> http:
</span></span><span style=display:flex><span>          path: <span style=color:#ff7b72;font-weight:700>/</span>critical
</span></span><span style=display:flex><span>          method: get
</span></span></code></pre></td></tr></table></div></div><h4 id=2-é™æµå’Œé™çº§>2. é™æµå’Œé™çº§<a hidden class=anchor aria-hidden=true href=#2-é™æµå’Œé™çº§>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># rate_limiter.py - é™æµå®ç°</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>time</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>collections</span> <span style=color:#ff7b72>import</span> defaultdict
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>threading</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RateLimiter</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, max_requests, time_window):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>max_requests <span style=color:#ff7b72;font-weight:700>=</span> max_requests
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>time_window <span style=color:#ff7b72;font-weight:700>=</span> time_window
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>requests <span style=color:#ff7b72;font-weight:700>=</span> defaultdict(list)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>lock <span style=color:#ff7b72;font-weight:700>=</span> threading<span style=color:#ff7b72;font-weight:700>.</span>Lock()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>is_allowed</span>(self, key):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€æŸ¥æ˜¯å¦å…è®¸è¯·æ±‚&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>with</span> self<span style=color:#ff7b72;font-weight:700>.</span>lock:
</span></span><span style=display:flex><span>            now <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ¸…ç†è¿‡æœŸè¯·æ±‚</span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>requests[key] <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>                req_time <span style=color:#ff7b72>for</span> req_time <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>requests[key]
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> now <span style=color:#ff7b72;font-weight:700>-</span> req_time <span style=color:#ff7b72;font-weight:700>&lt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>time_window
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>requests[key]) <span style=color:#ff7b72;font-weight:700>&gt;=</span> self<span style=color:#ff7b72;font-weight:700>.</span>max_requests:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è®°å½•æ–°è¯·æ±‚</span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>requests[key]<span style=color:#ff7b72;font-weight:700>.</span>append(now)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># åœ¨Lambdaä¸­ä½¿ç”¨</span>
</span></span><span style=display:flex><span>rate_limiter <span style=color:#ff7b72;font-weight:700>=</span> RateLimiter(max_requests<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>100</span>, time_window<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>60</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>lambda_handler</span>(event, context):
</span></span><span style=display:flex><span>    client_ip <span style=color:#ff7b72;font-weight:700>=</span> event[<span style=color:#a5d6ff>&#39;requestContext&#39;</span>][<span style=color:#a5d6ff>&#39;identity&#39;</span>][<span style=color:#a5d6ff>&#39;sourceIp&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> rate_limiter<span style=color:#ff7b72;font-weight:700>.</span>is_allowed(client_ip):
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;statusCode&#39;</span>: <span style=color:#a5d6ff>429</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;body&#39;</span>: json<span style=color:#ff7b72;font-weight:700>.</span>dumps({<span style=color:#a5d6ff>&#39;error&#39;</span>: <span style=color:#a5d6ff>&#39;Too many requests&#39;</span>})
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># å¤„ç†æ­£å¸¸è¯·æ±‚</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>pass</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ä»£ç ä¼˜åŒ–>ä»£ç ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#ä»£ç ä¼˜åŒ–>#</a></h3><h4 id=1-å¼‚æ­¥å¤„ç†>1. å¼‚æ­¥å¤„ç†<a hidden class=anchor aria-hidden=true href=#1-å¼‚æ­¥å¤„ç†>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># async_handler.py - å¼‚æ­¥å¤„ç†æ¨¡å¼</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>asyncio</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>aiohttp</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>concurrent.futures</span> <span style=color:#ff7b72>import</span> ThreadPoolExecutor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä½¿ç”¨asyncioè¿›è¡Œå¼‚æ­¥å¤„ç†</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>process_multiple_apis</span>(urls):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å¹¶å‘è°ƒç”¨å¤šä¸ªAPI&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>with</span> aiohttp<span style=color:#ff7b72;font-weight:700>.</span>ClientSession() <span style=color:#ff7b72>as</span> session:
</span></span><span style=display:flex><span>        tasks <span style=color:#ff7b72;font-weight:700>=</span> [fetch_url(session, url) <span style=color:#ff7b72>for</span> url <span style=color:#ff7b72;font-weight:700>in</span> urls]
</span></span><span style=display:flex><span>        results <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> asyncio<span style=color:#ff7b72;font-weight:700>.</span>gather(<span style=color:#ff7b72;font-weight:700>*</span>tasks)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>fetch_url</span>(session, url):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–å•ä¸ªURL&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>with</span> session<span style=color:#ff7b72;font-weight:700>.</span>get(url) <span style=color:#ff7b72>as</span> response:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> response<span style=color:#ff7b72;font-weight:700>.</span>json()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>lambda_handler</span>(event, context):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;Lambdaå¤„ç†å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    urls <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;https://api1.example.com/data&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;https://api2.example.com/data&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;https://api3.example.com/data&#39;</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># è¿è¡Œå¼‚æ­¥ä»£ç </span>
</span></span><span style=display:flex><span>    loop <span style=color:#ff7b72;font-weight:700>=</span> asyncio<span style=color:#ff7b72;font-weight:700>.</span>get_event_loop()
</span></span><span style=display:flex><span>    results <span style=color:#ff7b72;font-weight:700>=</span> loop<span style=color:#ff7b72;font-weight:700>.</span>run_until_complete(process_multiple_apis(urls))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;statusCode&#39;</span>: <span style=color:#a5d6ff>200</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;body&#39;</span>: json<span style=color:#ff7b72;font-weight:700>.</span>dumps(results)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†CPUå¯†é›†å‹ä»»åŠ¡</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>cpu_intensive_task</span>(data):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;CPUå¯†é›†å‹ä»»åŠ¡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    result <span style=color:#ff7b72;font-weight:700>=</span> sum(i <span style=color:#ff7b72;font-weight:700>*</span> i <span style=color:#ff7b72>for</span> i <span style=color:#ff7b72;font-weight:700>in</span> range(data))
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>lambda_handler</span>(event, context):
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>with</span> ThreadPoolExecutor(max_workers<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>4</span>) <span style=color:#ff7b72>as</span> executor:
</span></span><span style=display:flex><span>        futures <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> item <span style=color:#ff7b72;font-weight:700>in</span> event[<span style=color:#a5d6ff>&#39;items&#39;</span>]:
</span></span><span style=display:flex><span>            future <span style=color:#ff7b72;font-weight:700>=</span> executor<span style=color:#ff7b72;font-weight:700>.</span>submit(cpu_intensive_task, item)
</span></span><span style=display:flex><span>            futures<span style=color:#ff7b72;font-weight:700>.</span>append(future)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        results <span style=color:#ff7b72;font-weight:700>=</span> [future<span style=color:#ff7b72;font-weight:700>.</span>result() <span style=color:#ff7b72>for</span> future <span style=color:#ff7b72;font-weight:700>in</span> futures]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;statusCode&#39;</span>: <span style=color:#a5d6ff>200</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;body&#39;</span>: json<span style=color:#ff7b72;font-weight:700>.</span>dumps(results)
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div><h4 id=2-æ•°æ®å¤„ç†ä¼˜åŒ–>2. æ•°æ®å¤„ç†ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#2-æ•°æ®å¤„ç†ä¼˜åŒ–>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># data_optimization.py - æ•°æ®å¤„ç†ä¼˜åŒ–</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>gzip</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>io</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>csv</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å‹ç¼©å“åº”æ•°æ®</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>compress_response</span>(data):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å‹ç¼©å“åº”æ•°æ®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    json_str <span style=color:#ff7b72;font-weight:700>=</span> json<span style=color:#ff7b72;font-weight:700>.</span>dumps(data)
</span></span><span style=display:flex><span>    buffer <span style=color:#ff7b72;font-weight:700>=</span> io<span style=color:#ff7b72;font-weight:700>.</span>BytesIO()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>with</span> gzip<span style=color:#ff7b72;font-weight:700>.</span>GzipFile(fileobj<span style=color:#ff7b72;font-weight:700>=</span>buffer, mode<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;w&#39;</span>) <span style=color:#ff7b72>as</span> gz:
</span></span><span style=display:flex><span>        gz<span style=color:#ff7b72;font-weight:700>.</span>write(json_str<span style=color:#ff7b72;font-weight:700>.</span>encode(<span style=color:#a5d6ff>&#39;utf-8&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> buffer<span style=color:#ff7b72;font-weight:700>.</span>getvalue()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æµå¼å¤„ç†å¤§æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>process_large_csv</span>(event, context):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æµå¼å¤„ç†å¤§CSVæ–‡ä»¶&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    s3 <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;s3&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># è·å–S3äº‹ä»¶</span>
</span></span><span style=display:flex><span>    bucket <span style=color:#ff7b72;font-weight:700>=</span> event[<span style=color:#a5d6ff>&#39;Records&#39;</span>][<span style=color:#a5d6ff>0</span>][<span style=color:#a5d6ff>&#39;s3&#39;</span>][<span style=color:#a5d6ff>&#39;bucket&#39;</span>][<span style=color:#a5d6ff>&#39;name&#39;</span>]
</span></span><span style=display:flex><span>    key <span style=color:#ff7b72;font-weight:700>=</span> event[<span style=color:#a5d6ff>&#39;Records&#39;</span>][<span style=color:#a5d6ff>0</span>][<span style=color:#a5d6ff>&#39;s3&#39;</span>][<span style=color:#a5d6ff>&#39;object&#39;</span>][<span style=color:#a5d6ff>&#39;key&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æµå¼è¯»å–</span>
</span></span><span style=display:flex><span>    response <span style=color:#ff7b72;font-weight:700>=</span> s3<span style=color:#ff7b72;font-weight:700>.</span>get_object(Bucket<span style=color:#ff7b72;font-weight:700>=</span>bucket, Key<span style=color:#ff7b72;font-weight:700>=</span>key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    results <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> line <span style=color:#ff7b72;font-weight:700>in</span> response[<span style=color:#a5d6ff>&#39;Body&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>iter_lines():
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é€è¡Œå¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º</span>
</span></span><span style=display:flex><span>        row <span style=color:#ff7b72;font-weight:700>=</span> json<span style=color:#ff7b72;font-weight:700>.</span>loads(line)
</span></span><span style=display:flex><span>        processed <span style=color:#ff7b72;font-weight:700>=</span> process_row(row)
</span></span><span style=display:flex><span>        results<span style=color:#ff7b72;font-weight:700>.</span>append(processed)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;processed_rows&#39;</span>: len(results)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æ‰¹é‡å¤„ç†ä¼˜åŒ–</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>batch_process_items</span>(items, batch_size<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>100</span>):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰¹é‡å¤„ç†é¡¹ç›®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    batches <span style=color:#ff7b72;font-weight:700>=</span> [items[i:i <span style=color:#ff7b72;font-weight:700>+</span> batch_size] <span style=color:#ff7b72>for</span> i <span style=color:#ff7b72;font-weight:700>in</span> range(<span style=color:#a5d6ff>0</span>, len(items), batch_size)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> batch <span style=color:#ff7b72;font-weight:700>in</span> batches:
</span></span><span style=display:flex><span>        process_batch(batch)
</span></span></code></pre></td></tr></table></div></div><h3 id=ç›‘æ§å’Œè°ƒè¯•>ç›‘æ§å’Œè°ƒè¯•<a hidden class=anchor aria-hidden=true href=#ç›‘æ§å’Œè°ƒè¯•>#</a></h3><h4 id=1-æ€§èƒ½ç›‘æ§>1. æ€§èƒ½ç›‘æ§<a hidden class=anchor aria-hidden=true href=#1-æ€§èƒ½ç›‘æ§>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># monitoring.py - æ€§èƒ½ç›‘æ§è£…é¥°å™¨</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>time</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>functools</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>boto3</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>os</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cloudwatch <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;cloudwatch&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>monitor_performance</span>(metric_name):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ€§èƒ½ç›‘æ§è£…é¥°å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>decorator</span>(func):
</span></span><span style=display:flex><span>        <span style=color:#d2a8ff;font-weight:700>@functools.wraps</span>(func)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>wrapper</span>(<span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs):
</span></span><span style=display:flex><span>            start_time <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                result <span style=color:#ff7b72;font-weight:700>=</span> func(<span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs)
</span></span><span style=display:flex><span>                success <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>                success <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>raise</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>finally</span>:
</span></span><span style=display:flex><span>                duration <span style=color:#ff7b72;font-weight:700>=</span> (time<span style=color:#ff7b72;font-weight:700>.</span>time() <span style=color:#ff7b72;font-weight:700>-</span> start_time) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># å‘é€æŒ‡æ ‡åˆ°CloudWatch</span>
</span></span><span style=display:flex><span>                cloudwatch<span style=color:#ff7b72;font-weight:700>.</span>put_metric_data(
</span></span><span style=display:flex><span>                    Namespace<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Lambda/Performance&#39;</span>,
</span></span><span style=display:flex><span>                    MetricData<span style=color:#ff7b72;font-weight:700>=</span>[
</span></span><span style=display:flex><span>                        {
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;MetricName&#39;</span>: metric_name,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;Value&#39;</span>: duration,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;Unit&#39;</span>: <span style=color:#a5d6ff>&#39;Milliseconds&#39;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;Dimensions&#39;</span>: [
</span></span><span style=display:flex><span>                                {
</span></span><span style=display:flex><span>                                    <span style=color:#a5d6ff>&#39;Name&#39;</span>: <span style=color:#a5d6ff>&#39;FunctionName&#39;</span>,
</span></span><span style=display:flex><span>                                    <span style=color:#a5d6ff>&#39;Value&#39;</span>: os<span style=color:#ff7b72;font-weight:700>.</span>environ<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;AWS_LAMBDA_FUNCTION_NAME&#39;</span>, <span style=color:#a5d6ff>&#39;Unknown&#39;</span>)
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                            ]
</span></span><span style=display:flex><span>                        },
</span></span><span style=display:flex><span>                        {
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;MetricName&#39;</span>: <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#39;</span><span style=color:#a5d6ff>{</span>metric_name<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>_Success&#39;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;Value&#39;</span>: <span style=color:#a5d6ff>1</span> <span style=color:#ff7b72>if</span> success <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;Unit&#39;</span>: <span style=color:#a5d6ff>&#39;Count&#39;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;Dimensions&#39;</span>: [
</span></span><span style=display:flex><span>                                {
</span></span><span style=display:flex><span>                                    <span style=color:#a5d6ff>&#39;Name&#39;</span>: <span style=color:#a5d6ff>&#39;FunctionName&#39;</span>,
</span></span><span style=display:flex><span>                                    <span style=color:#a5d6ff>&#39;Value&#39;</span>: os<span style=color:#ff7b72;font-weight:700>.</span>environ<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;AWS_LAMBDA_FUNCTION_NAME&#39;</span>, <span style=color:#a5d6ff>&#39;Unknown&#39;</span>)
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                            ]
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    ]
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> wrapper
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> decorator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@monitor_performance</span>(<span style=color:#a5d6ff>&#39;api_request&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>lambda_handler</span>(event, context):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;APIè¯·æ±‚å¤„ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ä¸šåŠ¡é€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>pass</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2-é”™è¯¯å¤„ç†å’Œé‡è¯•>2. é”™è¯¯å¤„ç†å’Œé‡è¯•<a hidden class=anchor aria-hidden=true href=#2-é”™è¯¯å¤„ç†å’Œé‡è¯•>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># retry_handler.py - é‡è¯•æœºåˆ¶</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>time</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>random</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>functools</span> <span style=color:#ff7b72>import</span> wraps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>exponential_backoff</span>(max_retries<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>3</span>, base_delay<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.1</span>, max_delay<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>2</span>):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æŒ‡æ•°é€€é¿é‡è¯•è£…é¥°å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>decorator</span>(func):
</span></span><span style=display:flex><span>        <span style=color:#d2a8ff;font-weight:700>@wraps</span>(func)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>wrapper</span>(<span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs):
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> attempt <span style=color:#ff7b72;font-weight:700>in</span> range(max_retries <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>):
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>return</span> func(<span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>if</span> attempt <span style=color:#ff7b72;font-weight:700>==</span> max_retries:
</span></span><span style=display:flex><span>                        <span style=color:#ff7b72>raise</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    delay <span style=color:#ff7b72;font-weight:700>=</span> min(base_delay <span style=color:#ff7b72;font-weight:700>*</span> (<span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>**</span> attempt) <span style=color:#ff7b72;font-weight:700>+</span> random<span style=color:#ff7b72;font-weight:700>.</span>uniform(<span style=color:#a5d6ff>0</span>, <span style=color:#a5d6ff>0.1</span>), max_delay)
</span></span><span style=display:flex><span>                    time<span style=color:#ff7b72;font-weight:700>.</span>sleep(delay)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> wrapper
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> decorator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æ–­è·¯å™¨æ¨¡å¼</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>CircuitBreaker</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, failure_threshold<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>, timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>60</span>):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>failure_threshold <span style=color:#ff7b72;font-weight:700>=</span> failure_threshold
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>timeout <span style=color:#ff7b72;font-weight:700>=</span> timeout
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>failure_count <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>last_failure_time <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>state <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;CLOSED&#39;</span>  <span style=color:#8b949e;font-style:italic># CLOSED, OPEN, HALF_OPEN</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>call</span>(self, func, <span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ–­è·¯å™¨è°ƒç”¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>state <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;OPEN&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> time<span style=color:#ff7b72;font-weight:700>.</span>time() <span style=color:#ff7b72;font-weight:700>-</span> self<span style=color:#ff7b72;font-weight:700>.</span>last_failure_time <span style=color:#ff7b72;font-weight:700>&gt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>timeout:
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>state <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;HALF_OPEN&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>Exception</span>(<span style=color:#a5d6ff>&#39;Circuit breaker is OPEN&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> func(<span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs)
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>reset()
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>record_failure()
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>record_failure</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®°å½•å¤±è´¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>failure_count <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>last_failure_time <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>failure_count <span style=color:#ff7b72;font-weight:700>&gt;=</span> self<span style=color:#ff7b72;font-weight:700>.</span>failure_threshold:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>state <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;OPEN&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>reset</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;é‡ç½®æ–­è·¯å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>failure_count <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>state <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;CLOSED&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æˆæœ¬ä¼˜åŒ–>æˆæœ¬ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#æˆæœ¬ä¼˜åŒ–>#</a></h3><h4 id=1-è®¡ç®—ä¼˜åŒ–>1. è®¡ç®—ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#1-è®¡ç®—ä¼˜åŒ–>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># cost_optimizer.py - æˆæœ¬ä¼˜åŒ–</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>boto3</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>datetime</span> <span style=color:#ff7b72>import</span> datetime, timedelta
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>LambdaCostOptimizer</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>ce_client <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;ce&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>lambda_client <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;lambda&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>analyze_costs</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ†æLambdaæˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        end_date <span style=color:#ff7b72;font-weight:700>=</span> datetime<span style=color:#ff7b72;font-weight:700>.</span>now()<span style=color:#ff7b72;font-weight:700>.</span>date()
</span></span><span style=display:flex><span>        start_date <span style=color:#ff7b72;font-weight:700>=</span> end_date <span style=color:#ff7b72;font-weight:700>-</span> timedelta(days<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>30</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        response <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>ce_client<span style=color:#ff7b72;font-weight:700>.</span>get_cost_and_usage(
</span></span><span style=display:flex><span>            TimePeriod<span style=color:#ff7b72;font-weight:700>=</span>{
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;Start&#39;</span>: start_date<span style=color:#ff7b72;font-weight:700>.</span>isoformat(),
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;End&#39;</span>: end_date<span style=color:#ff7b72;font-weight:700>.</span>isoformat()
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            Granularity<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;DAILY&#39;</span>,
</span></span><span style=display:flex><span>            Metrics<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;BlendedCost&#39;</span>],
</span></span><span style=display:flex><span>            GroupBy<span style=color:#ff7b72;font-weight:700>=</span>[
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;Type&#39;</span>: <span style=color:#a5d6ff>&#39;DIMENSION&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;Key&#39;</span>: <span style=color:#a5d6ff>&#39;SERVICE&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            Filter<span style=color:#ff7b72;font-weight:700>=</span>{
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;Dimensions&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;Key&#39;</span>: <span style=color:#a5d6ff>&#39;SERVICE&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;Values&#39;</span>: [<span style=color:#a5d6ff>&#39;AWS Lambda&#39;</span>]
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> response[<span style=color:#a5d6ff>&#39;ResultsByTime&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>optimize_functions</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä¼˜åŒ–å‡½æ•°é…ç½®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        functions <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>get_all_functions()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> function <span style=color:#ff7b72;font-weight:700>in</span> functions:
</span></span><span style=display:flex><span>            metrics <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>get_function_metrics(function[<span style=color:#a5d6ff>&#39;FunctionName&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> metrics:
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># æ ¹æ®ä½¿ç”¨æ¨¡å¼ä¼˜åŒ–é…ç½®</span>
</span></span><span style=display:flex><span>                optimal_memory <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>calculate_optimal_memory(metrics)
</span></span><span style=display:flex><span>                optimal_timeout <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>calculate_optimal_timeout(metrics)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>update_function_config(
</span></span><span style=display:flex><span>                    function[<span style=color:#a5d6ff>&#39;FunctionName&#39;</span>],
</span></span><span style=display:flex><span>                    optimal_memory,
</span></span><span style=display:flex><span>                    optimal_timeout
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>calculate_optimal_memory</span>(self, metrics):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¡ç®—æœ€ä¼˜å†…å­˜é…ç½®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        avg_duration <span style=color:#ff7b72;font-weight:700>=</span> metrics<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;avg_duration&#39;</span>, <span style=color:#a5d6ff>100</span>)
</span></span><span style=display:flex><span>        max_duration <span style=color:#ff7b72;font-weight:700>=</span> metrics<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;max_duration&#39;</span>, <span style=color:#a5d6ff>500</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åŸºäºæ‰§è¡Œæ—¶é—´è®¡ç®—å†…å­˜éœ€æ±‚</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> avg_duration <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>100</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>128</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> avg_duration <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>500</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>256</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> avg_duration <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>2000</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>512</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>1024</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å®æˆ˜æ¡ˆä¾‹>å®æˆ˜æ¡ˆä¾‹<a hidden class=anchor aria-hidden=true href=#å®æˆ˜æ¡ˆä¾‹>#</a></h3><h4 id=1-å›¾åƒå¤„ç†æœåŠ¡>1. å›¾åƒå¤„ç†æœåŠ¡<a hidden class=anchor aria-hidden=true href=#1-å›¾åƒå¤„ç†æœåŠ¡>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># image_processor.py - å›¾åƒå¤„ç†Lambda</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>boto3</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>io</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>PIL</span> <span style=color:#ff7b72>import</span> Image
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>s3_client <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>client(<span style=color:#a5d6ff>&#39;s3&#39;</span>)
</span></span><span style=display:flex><span>s3_resource <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>resource(<span style=color:#a5d6ff>&#39;s3&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>resize_image_handler</span>(event, context):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å›¾åƒç¼©æ”¾å¤„ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> record <span style=color:#ff7b72;font-weight:700>in</span> event[<span style=color:#a5d6ff>&#39;Records&#39;</span>]:
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è§£æS3äº‹ä»¶</span>
</span></span><span style=display:flex><span>        bucket <span style=color:#ff7b72;font-weight:700>=</span> record[<span style=color:#a5d6ff>&#39;s3&#39;</span>][<span style=color:#a5d6ff>&#39;bucket&#39;</span>][<span style=color:#a5d6ff>&#39;name&#39;</span>]
</span></span><span style=display:flex><span>        key <span style=color:#ff7b72;font-weight:700>=</span> record[<span style=color:#a5d6ff>&#39;s3&#39;</span>][<span style=color:#a5d6ff>&#39;object&#39;</span>][<span style=color:#a5d6ff>&#39;key&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä¸‹è½½å›¾åƒ</span>
</span></span><span style=display:flex><span>        obj <span style=color:#ff7b72;font-weight:700>=</span> s3_resource<span style=color:#ff7b72;font-weight:700>.</span>Object(bucket, key)
</span></span><span style=display:flex><span>        image_data <span style=color:#ff7b72;font-weight:700>=</span> obj<span style=color:#ff7b72;font-weight:700>.</span>get()[<span style=color:#a5d6ff>&#39;Body&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¤„ç†å›¾åƒ</span>
</span></span><span style=display:flex><span>        image <span style=color:#ff7b72;font-weight:700>=</span> Image<span style=color:#ff7b72;font-weight:700>.</span>open(io<span style=color:#ff7b72;font-weight:700>.</span>BytesIO(image_data))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç”Ÿæˆå¤šä¸ªå°ºå¯¸</span>
</span></span><span style=display:flex><span>        sizes <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            (<span style=color:#a5d6ff>&#39;thumbnail&#39;</span>, (<span style=color:#a5d6ff>150</span>, <span style=color:#a5d6ff>150</span>)),
</span></span><span style=display:flex><span>            (<span style=color:#a5d6ff>&#39;medium&#39;</span>, (<span style=color:#a5d6ff>500</span>, <span style=color:#a5d6ff>500</span>)),
</span></span><span style=display:flex><span>            (<span style=color:#a5d6ff>&#39;large&#39;</span>, (<span style=color:#a5d6ff>1000</span>, <span style=color:#a5d6ff>1000</span>))
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> size_name, size <span style=color:#ff7b72;font-weight:700>in</span> sizes:
</span></span><span style=display:flex><span>            resized <span style=color:#ff7b72;font-weight:700>=</span> image<span style=color:#ff7b72;font-weight:700>.</span>copy()
</span></span><span style=display:flex><span>            resized<span style=color:#ff7b72;font-weight:700>.</span>thumbnail(size, Image<span style=color:#ff7b72;font-weight:700>.</span>LANCZOS)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ä¿å­˜åˆ°S3</span>
</span></span><span style=display:flex><span>            output_key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;processed/</span><span style=color:#a5d6ff>{</span>size_name<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/</span><span style=color:#a5d6ff>{</span>key<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>            output_buffer <span style=color:#ff7b72;font-weight:700>=</span> io<span style=color:#ff7b72;font-weight:700>.</span>BytesIO()
</span></span><span style=display:flex><span>            resized<span style=color:#ff7b72;font-weight:700>.</span>save(output_buffer, format<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;JPEG&#39;</span>, quality<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>85</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            s3_client<span style=color:#ff7b72;font-weight:700>.</span>put_object(
</span></span><span style=display:flex><span>                Bucket<span style=color:#ff7b72;font-weight:700>=</span>bucket,
</span></span><span style=display:flex><span>                Key<span style=color:#ff7b72;font-weight:700>=</span>output_key,
</span></span><span style=display:flex><span>                Body<span style=color:#ff7b72;font-weight:700>=</span>output_buffer<span style=color:#ff7b72;font-weight:700>.</span>getvalue(),
</span></span><span style=display:flex><span>                ContentType<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;image/jpeg&#39;</span>
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä¼˜åŒ–ç‰ˆæœ¬ï¼šä½¿ç”¨é¢„åˆ†é…å†…å­˜</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>optimized_resize_handler</span>(event, context):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ä¼˜åŒ–çš„å›¾åƒå¤„ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># é¢„å…ˆåˆ†é…è¶³å¤Ÿçš„å†…å­˜</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>os</span>
</span></span><span style=display:flex><span>    os<span style=color:#ff7b72;font-weight:700>.</span>environ[<span style=color:#a5d6ff>&#39;PYTHONMALLOC&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;malloc&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    resize_image_handler(event, context)
</span></span></code></pre></td></tr></table></div></div><h4 id=2-apiç½‘å…³é›†æˆ>2. APIç½‘å…³é›†æˆ<a hidden class=anchor aria-hidden=true href=#2-apiç½‘å…³é›†æˆ>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># api_gateway.py - APIç½‘å…³é›†æˆä¼˜åŒ–</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>boto3</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>decimal</span> <span style=color:#ff7b72>import</span> Decimal
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dynamodb <span style=color:#ff7b72;font-weight:700>=</span> boto3<span style=color:#ff7b72;font-weight:700>.</span>resource(<span style=color:#a5d6ff>&#39;dynamodb&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>DecimalEncoder</span>(json<span style=color:#ff7b72;font-weight:700>.</span>JSONEncoder):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å¤„ç†Decimalç±»å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>default</span>(self, obj):
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> isinstance(obj, Decimal):
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> float(obj)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> super(DecimalEncoder, self)<span style=color:#ff7b72;font-weight:700>.</span>default(obj)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>api_handler</span>(event, context):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;APIå¤„ç†å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    http_method <span style=color:#ff7b72;font-weight:700>=</span> event[<span style=color:#a5d6ff>&#39;httpMethod&#39;</span>]
</span></span><span style=display:flex><span>    path <span style=color:#ff7b72;font-weight:700>=</span> event[<span style=color:#a5d6ff>&#39;path&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># è·¯ç”±å¤„ç†</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> path <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;/users&#39;</span> <span style=color:#ff7b72;font-weight:700>and</span> http_method <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;GET&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> get_users(event)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>elif</span> path <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;/users&#39;</span> <span style=color:#ff7b72;font-weight:700>and</span> http_method <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;POST&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> create_user(event)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;statusCode&#39;</span>: <span style=color:#a5d6ff>404</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;body&#39;</span>: json<span style=color:#ff7b72;font-weight:700>.</span>dumps({<span style=color:#a5d6ff>&#39;error&#39;</span>: <span style=color:#a5d6ff>&#39;Not found&#39;</span>})
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_users</span>(event):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–ç”¨æˆ·åˆ—è¡¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    table <span style=color:#ff7b72;font-weight:700>=</span> dynamodb<span style=color:#ff7b72;font-weight:700>.</span>Table(<span style=color:#a5d6ff>&#39;users&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># åˆ†é¡µå‚æ•°</span>
</span></span><span style=display:flex><span>    limit <span style=color:#ff7b72;font-weight:700>=</span> int(event<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;queryStringParameters&#39;</span>, {})<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;limit&#39;</span>, <span style=color:#a5d6ff>10</span>))
</span></span><span style=display:flex><span>    last_key <span style=color:#ff7b72;font-weight:700>=</span> event<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;queryStringParameters&#39;</span>, {})<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;last_key&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    scan_kwargs <span style=color:#ff7b72;font-weight:700>=</span> {<span style=color:#a5d6ff>&#39;Limit&#39;</span>: limit}
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> last_key:
</span></span><span style=display:flex><span>        scan_kwargs[<span style=color:#a5d6ff>&#39;ExclusiveStartKey&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> {<span style=color:#a5d6ff>&#39;id&#39;</span>: last_key}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    response <span style=color:#ff7b72;font-weight:700>=</span> table<span style=color:#ff7b72;font-weight:700>.</span>scan(<span style=color:#ff7b72;font-weight:700>**</span>scan_kwargs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;statusCode&#39;</span>: <span style=color:#a5d6ff>200</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;headers&#39;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;Content-Type&#39;</span>: <span style=color:#a5d6ff>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;Access-Control-Allow-Origin&#39;</span>: <span style=color:#a5d6ff>&#39;*&#39;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;body&#39;</span>: json<span style=color:#ff7b72;font-weight:700>.</span>dumps(
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;users&#39;</span>: response[<span style=color:#a5d6ff>&#39;Items&#39;</span>],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;last_key&#39;</span>: response<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;LastEvaluatedKey&#39;</span>, {})<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;id&#39;</span>)
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            cls<span style=color:#ff7b72;font-weight:700>=</span>DecimalEncoder
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div><h3 id=æœ€ä½³å®è·µæ€»ç»“>æœ€ä½³å®è·µæ€»ç»“<a hidden class=anchor aria-hidden=true href=#æœ€ä½³å®è·µæ€»ç»“>#</a></h3><ol><li><strong>å†·å¯åŠ¨ä¼˜åŒ–</strong>ï¼šå…¨å±€åˆå§‹åŒ–ã€é¢„çƒ­ç­–ç•¥ã€è¿è¡Œæ—¶ä¼˜åŒ–</li><li><strong>èµ„æºé…ç½®</strong>ï¼šåŠ¨æ€è°ƒæ•´ã€é¢„ç•™å¹¶å‘ã€æ€§èƒ½ç›‘æ§</li><li><strong>ä»£ç ä¼˜åŒ–</strong>ï¼šå¼‚æ­¥å¤„ç†ã€æ‰¹é‡æ“ä½œã€å†…å­˜ç®¡ç†</li><li><strong>é”™è¯¯å¤„ç†</strong>ï¼šé‡è¯•æœºåˆ¶ã€æ–­è·¯å™¨ã€ä¼˜é›…é™çº§</li><li><strong>æˆæœ¬æ§åˆ¶</strong>ï¼šä½¿ç”¨æ¨¡å¼åˆ†æã€èµ„æºä¼˜åŒ–ã€ç›‘æ§å‘Šè­¦</li></ol><h3 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h3><p>AWS Lambdaä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š</p><ul><li><strong>å‡å°‘å†·å¯åŠ¨</strong>ï¼šé¢„çƒ­å’Œä¼˜åŒ–åˆå§‹åŒ–</li><li><strong>åˆç†é…ç½®</strong>ï¼šæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å†…å­˜å’Œå¹¶å‘</li><li><strong>ä¼˜åŒ–ä»£ç </strong>ï¼šä½¿ç”¨å¼‚æ­¥å’Œæ‰¹å¤„ç†æŠ€æœ¯</li><li><strong>æŒç»­ç›‘æ§</strong>ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»</li><li><strong>æˆæœ¬æ§åˆ¶</strong>ï¼šå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬</li></ul><p>é€šè¿‡è¿™äº›ä¼˜åŒ–ç­–ç•¥ï¼Œå¯ä»¥æ„å»ºé«˜æ€§èƒ½ã€ä½æˆæœ¬çš„æ— æœåŠ¡å™¨åº”ç”¨ã€‚</p><h3 id=ç›¸å…³èµ„æº>ç›¸å…³èµ„æº<a hidden class=anchor aria-hidden=true href=#ç›¸å…³èµ„æº>#</a></h3><ul><li><a href=https://docs.aws.amazon.com/lambda/latest/dg/>AWS Lambdaå¼€å‘è€…æŒ‡å—</a></li><li><a href=https://docs.aws.amazon.com/lambda/latest/dg/best-practices.html>Lambdaæœ€ä½³å®è·µ</a></li><li><a href=https://aws.amazon.com/serverless/>AWSæ— æœåŠ¡å™¨æ¶æ„</a></li></ul></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/aws/ class=tag-pill>AWS
</a><a href=/blog/tags/lambda/ class=tag-pill>Lambda
</a><a href=/blog/tags/%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8/ class=tag-pill>æ— æœåŠ¡å™¨
</a><a href=/blog/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/ class=tag-pill>æ€§èƒ½ä¼˜åŒ–
</a><a href=/blog/tags/serverless/ class=tag-pill>Serverless</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/django-5-new-features/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>Django 5.0æ–°ç‰¹æ€§å…¨é¢è§£æ</div></div></a><a href=/blog/articles/microservices-communication-patterns/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>å¾®æœåŠ¡é€šä¿¡æ¨¡å¼æ·±åº¦è§£æ</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>