<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Web å®‰å…¨æœ€ä½³å®è·µï¼šä¿æŠ¤ä½ çš„åº”ç”¨å…å—æ”»å‡» | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="Webå®‰å…¨,ç½‘ç»œå®‰å…¨,å‰ç«¯å®‰å…¨,åç«¯å®‰å…¨"><meta name=description content="å…¨é¢ä»‹ç» Web åº”ç”¨å®‰å…¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œé˜²èŒƒå¸¸è§çš„å®‰å…¨å¨èƒ"><meta name=author content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/web-security-best-practices/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/web-security-best-practices/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/web-security-best-practices/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/web-security-best-practices/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="Web å®‰å…¨æœ€ä½³å®è·µï¼šä¿æŠ¤ä½ çš„åº”ç”¨å…å—æ”»å‡»"><meta property="og:description" content="å…¨é¢ä»‹ç» Web åº”ç”¨å®‰å…¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œé˜²èŒƒå¸¸è§çš„å®‰å…¨å¨èƒ"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-08T13:30:00+08:00"><meta property="article:modified_time" content="2025-12-08T13:30:00+08:00"><meta property="article:tag" content="Webå®‰å…¨"><meta property="article:tag" content="ç½‘ç»œå®‰å…¨"><meta property="article:tag" content="å‰ç«¯å®‰å…¨"><meta property="article:tag" content="åç«¯å®‰å…¨"><meta name=twitter:card content="summary"><meta name=twitter:title content="Web å®‰å…¨æœ€ä½³å®è·µï¼šä¿æŠ¤ä½ çš„åº”ç”¨å…å—æ”»å‡»"><meta name=twitter:description content="å…¨é¢ä»‹ç» Web åº”ç”¨å®‰å…¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œé˜²èŒƒå¸¸è§çš„å®‰å…¨å¨èƒ"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"Web å®‰å…¨æœ€ä½³å®è·µï¼šä¿æŠ¤ä½ çš„åº”ç”¨å…å—æ”»å‡»","item":"/blog/articles/web-security-best-practices/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Web å®‰å…¨æœ€ä½³å®è·µï¼šä¿æŠ¤ä½ çš„åº”ç”¨å…å—æ”»å‡»","name":"Web å®‰å…¨æœ€ä½³å®è·µï¼šä¿æŠ¤ä½ çš„åº”ç”¨å…å—æ”»å‡»","description":"å…¨é¢ä»‹ç» Web åº”ç”¨å®‰å…¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œé˜²èŒƒå¸¸è§çš„å®‰å…¨å¨èƒ","keywords":["Webå®‰å…¨","ç½‘ç»œå®‰å…¨","å‰ç«¯å®‰å…¨","åç«¯å®‰å…¨"],"articleBody":"å‰è¨€ Web å®‰å…¨æ˜¯æ¯ä¸ªå¼€å‘è€…éƒ½å¿…é¡»é‡è§†çš„é—®é¢˜ã€‚éšç€ç½‘ç»œæ”»å‡»æ‰‹æ®µçš„ä¸æ–­æ¼”è¿›ï¼Œäº†è§£å¹¶å®æ–½å®‰å…¨æœ€ä½³å®è·µå¯¹äºä¿æŠ¤ç”¨æˆ·æ•°æ®å’Œç³»ç»Ÿå®‰å…¨è‡³å…³é‡è¦ã€‚\nOWASP Top 10 é˜²èŒƒ 1. æ³¨å…¥æ”»å‡»é˜²æŠ¤ SQL æ³¨å…¥é˜²æŠ¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // âŒ å±é™©ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ const query = `SELECT * FROM users WHERE id = ${userId}`; // âœ… å®‰å…¨ï¼šå‚æ•°åŒ–æŸ¥è¯¢ const query = 'SELECT * FROM users WHERE id = ?'; const result = db.query(query, [userId]); // ä½¿ç”¨ ORMï¼ˆå¦‚ Sequelizeï¼‰ const user = await User.findOne({ where: { id: userId } }); // æˆ–ä½¿ç”¨æ¨¡æ¿æ ‡ç­¾ï¼ˆå¦‚ pg åº“çš„ tagged template literalsï¼‰ const query = sql`SELECT * FROM users WHERE id = ${userId}`; NoSQL æ³¨å…¥é˜²æŠ¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // âŒ å±é™©ï¼šç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥ const users = db.users.find({ username: req.body.username, password: req.body.password }); // âœ… å®‰å…¨ï¼šä½¿ç”¨ç™½åå•éªŒè¯ const { username, password } = req.body; // éªŒè¯è¾“å…¥æ ¼å¼ if (!/^[a-zA-Z0-9_]{3,20}$/.test(username)) { return res.status(400).json({ error: 'Invalid username' }); } const users = db.users.find({ username: username, password: hashPassword(password) }); 2. èº«ä»½éªŒè¯å’Œæˆæƒ å¯†ç å®‰å…¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 const bcrypt = require('bcryptjs'); const crypto = require('crypto'); // å¯†ç å“ˆå¸Œ const hashPassword = async (password) =\u003e { const saltRounds = 12; return await bcrypt.hash(password, saltRounds); }; // å¯†ç éªŒè¯ const verifyPassword = async (password, hashedPassword) =\u003e { return await bcrypt.compare(password, hashedPassword); }; // ç”Ÿæˆéšæœºå¯†ç  const generateRandomPassword = (length = 12) =\u003e { return crypto.randomBytes(length).toString('hex'); }; // å¯†ç å¼ºåº¦éªŒè¯ const validatePasswordStrength = (password) =\u003e { const minLength = 8; const hasUpperCase = /[A-Z]/.test(password); const hasLowerCase = /[a-z]/.test(password); const hasNumbers = /\\d/.test(password); const hasSpecialChar = /[!@#$%^\u0026*(),.?\":{}|\u003c\u003e]/.test(password); return { isValid: password.length \u003e= minLength \u0026\u0026 hasUpperCase \u0026\u0026 hasLowerCase \u0026\u0026 hasNumbers \u0026\u0026 hasSpecialChar, errors: [ password.length \u003c minLength ? 'Password must be at least 8 characters' : null, !hasUpperCase ? 'Password must contain uppercase letter' : null, !hasLowerCase ? 'Password must contain lowercase letter' : null, !hasNumbers ? 'Password must contain a number' : null, !hasSpecialChar ? 'Password must contain a special character' : null ].filter(Boolean) }; }; JWT å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 const jwt = require('jsonwebtoken'); const tokenService = { // ç”Ÿæˆ token generateToken(payload, expiresIn = '24h') { return jwt.sign(payload, process.env.JWT_SECRET, { expiresIn }); }, // éªŒè¯ token verifyToken(token) { try { return jwt.verify(token, process.env.JWT_SECRET); } catch (error) { throw new Error('Invalid token'); } }, // åˆ·æ–° token refreshToken(oldToken) { try { const decoded = jwt.verify(oldToken, process.env.JWT_SECRET, { ignoreExpiration: true }); // æ£€æŸ¥ token æ˜¯å¦åœ¨åˆ·æ–°æœŸå†… if (Date.now() - decoded.iat * 1000 \u003e 7 * 24 * 60 * 60 * 1000) { throw new Error('Token too old to refresh'); } return this.generateToken({ userId: decoded.userId, role: decoded.role }, '24h'); } catch (error) { throw new Error('Cannot refresh token'); } } }; 3. æ•°æ®éªŒè¯å’Œæ¸…ç† è¾“å…¥éªŒè¯ä¸­é—´ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 const { body, param, query, validationResult } = require('express-validator'); const xss = require('xss'); const validator = require('validator'); // æ¸…ç† HTML è¾“å…¥ const sanitizeHtml = (input) =\u003e { return xss(input, { whiteList: { a: ['href', 'title', 'target'], b: [], i: [], em: [], strong: [] }, stripIgnoreTag: true, stripIgnoreTagBody: ['script'] }); }; // é€šç”¨éªŒè¯ä¸­é—´ä»¶ const validateRequest = (validations) =\u003e { return async (req, res, next) =\u003e { await Promise.all(validations.map(validation =\u003e validation.run(req))); const errors = validationResult(req); if (!errors.isEmpty()) { return res.status(400).json({ success: false, errors: errors.array() }); } // æ¸…ç†è¾“å…¥æ•°æ® const sanitizeObject = (obj) =\u003e { if (typeof obj === 'string') { return sanitizeHtml(validator.escape(obj)); } if (Array.isArray(obj)) { return obj.map(sanitizeObject); } if (obj \u0026\u0026 typeof obj === 'object') { const sanitized = {}; for (const [key, value] of Object.entries(obj)) { sanitized[key] = sanitizeObject(value); } return sanitized; } return obj; }; req.body = sanitizeObject(req.body); req.params = sanitizeObject(req.params); req.query = sanitizeObject(req.query); next(); }; }; // ä½¿ç”¨ç¤ºä¾‹ const userValidation = [ body('email') .isEmail() .normalizeEmail(), body('name') .trim() .isLength({ min: 2, max: 50 }) .escape(), body('age') .optional() .isInt({ min: 0, max: 120 }) ]; app.post('/api/users', validateRequest(userValidation), (req, res) =\u003e { // å¤„ç†é€»è¾‘ }); å‰ç«¯å®‰å…¨ 1. XSS é˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 // Content Security Policy è®¾ç½® const csp = { directives: { defaultSrc: [\"'self'\"], scriptSrc: [ \"'self'\", \"'unsafe-inline'\", // å¼€å‘ç¯å¢ƒä½¿ç”¨ 'https://trusted-cdn.com' ], styleSrc: [ \"'self'\", \"'unsafe-inline'\", 'https://fonts.googleapis.com' ], fontSrc: [ \"'self'\", 'https://fonts.gstatic.com' ], imgSrc: [ \"'self'\", 'data:', 'https:' ], connectSrc: [\"'self'\"], frameSrc: [\"'none'\"], objectSrc: [\"'none'\"] } }; // React ä¸­çš„å®‰å…¨å®è·µ const SafeComponent = ({ content }) =\u003e { // âŒ å±é™©ï¼šç›´æ¥æ¸²æŸ“ HTML // return ; // âœ… å®‰å…¨ï¼šä½¿ç”¨ä¸“é—¨çš„åº“ const DOMPurify = require('dompurify'); const cleanContent = DOMPurify.sanitize(content); return ( \u003cdiv\u003e \u003cspan\u003eSafe content:\u003c/span\u003e \u003cdiv dangerouslySetInnerHTML={{ __html: cleanContent }} /\u003e \u003c/div\u003e ); }; // å®‰å…¨çš„ URL å¤„ç† const SafeLink = ({ url, children }) =\u003e { // éªŒè¯ URL const isValidUrl = (url) =\u003e { try { const parsed = new URL(url); return ['http:', 'https:'].includes(parsed.protocol); } catch { return false; } }; if (!isValidUrl(url)) { console.warn('Invalid URL detected:', url); return \u003cspan\u003e{children}\u003c/span\u003e; } return ( \u003ca href={url} target=\"_blank\" rel=\"noopener noreferrer\"\u003e {children} \u003c/a\u003e ); }; 2. CSRF é˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // CSRF Token ç”Ÿæˆå’ŒéªŒè¯ const csrf = require('csurf'); const cookieParser = require('cookie-parser'); app.use(cookieParser()); const csrfProtection = csrf({ cookie: { httpOnly: true, secure: process.env.NODE_ENV === 'production', sameSite: 'strict' } }); // æä¾› CSRF token app.get('/api/csrf-token', csrfProtection, (req, res) =\u003e { res.json({ csrfToken: req.csrfToken() }); }); // å—ä¿æŠ¤çš„è·¯ç”± app.post('/api/protected', csrfProtection, (req, res) =\u003e { // å¤„ç†è¯·æ±‚ }); // å‰ç«¯ä½¿ç”¨ const postWithCSRF = async (url, data) =\u003e { // è·å– CSRF token const { csrfToken } = await fetch('/api/csrf-token').then(r =\u003e r.json()); return fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRF-Token': csrfToken }, body: JSON.stringify(data) }); }; åç«¯å®‰å…¨ 1. å®‰å…¨å¤´è®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 const helmet = require('helmet'); app.use(helmet({ contentSecurityPolicy: { directives: { defaultSrc: [\"'self'\"], styleSrc: [\"'self'\", \"'unsafe-inline'\"], scriptSrc: [\"'self'\"], imgSrc: [\"'self'\", \"data:\", \"https:\"] } }, hsts: { maxAge: 31536000, includeSubDomains: true, preload: true } })); // è‡ªå®šä¹‰å®‰å…¨å¤´ app.use((req, res, next) =\u003e { // é˜²æ­¢ç‚¹å‡»åŠ«æŒ res.setHeader('X-Frame-Options', 'DENY'); // é˜²æ­¢ MIME ç±»å‹å—…æ¢ res.setHeader('X-Content-Type-Options', 'nosniff'); // XSS ä¿æŠ¤ res.setHeader('X-XSS-Protection', '1; mode=block'); // å¼•ç”¨ç­–ç•¥ res.setHeader('Referrer-Policy', 'strict-origin-when-cross-origin'); // æƒé™ç­–ç•¥ï¼ˆæ›¿ä»£ Feature-Policyï¼‰ res.setHeader('Permissions-Policy', 'geolocation=(), microphone=(), camera=()' ); next(); }); 2. é€Ÿç‡é™åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 const rateLimit = require('express-rate-limit'); const slowDown = require('express-slow-down'); // é€šç”¨é€Ÿç‡é™åˆ¶ const generalLimiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ max: 100, // é™åˆ¶æ¯ä¸ªIP 15åˆ†é’Ÿå†…æœ€å¤š100ä¸ªè¯·æ±‚ message: { error: 'Too many requests, please try again later' }, standardHeaders: true, legacyHeaders: false }); // ç™»å½•é€Ÿç‡é™åˆ¶ const loginLimiter = rateLimit({ windowMs: 15 * 60 * 1000, max: 5, // æœ€å¤š5æ¬¡å°è¯• skipSuccessfulRequests: true }); // API é€Ÿç‡é™åˆ¶ const apiLimiter = rateLimit({ windowMs: 1 * 60 * 1000, // 1åˆ†é’Ÿ max: 60, // æ¯åˆ†é’Ÿ60ä¸ªè¯·æ±‚ keyGenerator: (req) =\u003e { return req.user ? req.user.id : req.ip; } }); // å‡æ…¢å“åº”é€Ÿåº¦ const speedLimiter = slowDown({ windowMs: 15 * 60 * 1000, delayAfter: 50, // 50ä¸ªè¯·æ±‚åå¼€å§‹å»¶è¿Ÿ delayMs: 500, // æ¯ä¸ªè¯·æ±‚å»¶è¿Ÿ500ms maxDelayMs: 20000 // æœ€å¤§å»¶è¿Ÿ20ç§’ }); app.use(generalLimiter); app.use('/api/login', loginLimiter); app.use('/api/', apiLimiter); app.use('/api/', speedLimiter); æ•°æ®å®‰å…¨ 1. åŠ å¯†å­˜å‚¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 const crypto = require('crypto'); const algorithm = 'aes-256-gcm'; const secretKey = crypto.scryptSync(process.env.ENCRYPTION_KEY, 'salt', 32); const encryption = { // åŠ å¯† encrypt(text) { const iv = crypto.randomBytes(16); const cipher = crypto.createCipher(algorithm, secretKey, iv); let encrypted = cipher.update(text, 'utf8', 'hex'); encrypted += cipher.final('hex'); const authTag = cipher.getAuthTag(); return { encrypted, iv: iv.toString('hex'), authTag: authTag.toString('hex') }; }, // è§£å¯† decrypt(encryptedData) { const decipher = crypto.createDecipher( algorithm, secretKey, Buffer.from(encryptedData.iv, 'hex') ); decipher.setAuthTag(Buffer.from(encryptedData.authTag, 'hex')); let decrypted = decipher.update(encryptedData.encrypted, 'hex', 'utf8'); decrypted += decipher.final('utf8'); return decrypted; } }; // ä½¿ç”¨ç¤ºä¾‹ const sensitiveData = \"user's credit card number\"; const encrypted = encryption.encrypt(sensitiveData); const decrypted = encryption.decrypt(encrypted); 2. å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 // ç¯å¢ƒå˜é‡éªŒè¯ const requiredEnvVars = [ 'JWT_SECRET', 'ENCRYPTION_KEY', 'DATABASE_URL' ]; const validateEnv = () =\u003e { const missing = requiredEnvVars.filter(key =\u003e !process.env[key]); if (missing.length \u003e 0) { throw new Error(`Missing required environment variables: ${missing.join(', ')}`); } }; // å®‰å…¨éšæœºæ•°ç”Ÿæˆ const generateSecureToken = (length = 32) =\u003e { return crypto.randomBytes(length).toString('hex'); }; // å¯†é’¥è½®æ¢ const keyRotation = { currentKey: process.env.ENCRYPTION_KEY, previousKeys: [], encryptWithCurrentKey(data) { return this.encrypt(data, this.currentKey); }, decryptWithAnyKey(encryptedData) { // å°è¯•ç”¨å½“å‰å¯†é’¥è§£å¯† try { return this.decrypt(encryptedData, this.currentKey); } catch (e) { // å°è¯•ç”¨ä»¥å‰çš„å¯†é’¥è§£å¯† for (const key of this.previousKeys) { try { return this.decrypt(encryptedData, key); } catch (e) { continue; } } throw new Error('Unable to decrypt data with any available key'); } }, rotateKey(newKey) { this.previousKeys.push(this.currentKey); this.currentKey = newKey; // ä¿ç•™æœ€è¿‘3ä¸ªå¯†é’¥ if (this.previousKeys.length \u003e 3) { this.previousKeys.shift(); } } }; å®‰å…¨æ—¥å¿—å’Œç›‘æ§ 1. å®‰å…¨äº‹ä»¶æ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 const winston = require('winston'); const securityLogger = winston.createLogger({ level: 'info', format: winston.format.combine( winston.format.timestamp(), winston.format.json() ), transports: [ new winston.transports.File({ filename: 'logs/security.log' }) ] }); const securityEvents = { logFailedLogin(ip, email, reason) { securityLogger.warn('Failed login attempt', { event: 'FAILED_LOGIN', ip, email, reason, timestamp: new Date().toISOString() }); }, logSuspiciousActivity(ip, userId, activity) { securityLogger.error('Suspicious activity detected', { event: 'SUSPICIOUS_ACTIVITY', ip, userId, activity, timestamp: new Date().toISOString() }); }, logPrivilegedAction(userId, action, resource) { securityLogger.info('Privileged action performed', { event: 'PRIVILEGED_ACTION', userId, action, resource, timestamp: new Date().toISOString() }); } }; 2. å¼‚å¸¸æ£€æµ‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 class SecurityMonitor { constructor() { this.failedLogins = new Map(); this.suspiciousIPs = new Set(); } recordFailedLogin(ip) { const count = this.failedLogins.get(ip) || 0; this.failedLogins.set(ip, count + 1); // 5æ¬¡å¤±è´¥ç™»å½•åæ ‡è®°ä¸ºå¯ç–‘ if (count \u003e= 5) { this.suspiciousIPs.add(ip); securityEvents.logSuspiciousActivity(ip, null, 'Multiple failed logins'); } // 24å°æ—¶åé‡ç½®è®¡æ•° setTimeout(() =\u003e { this.failedLogins.delete(ip); }, 24 * 60 * 60 * 1000); } isIPSuspicious(ip) { return this.suspiciousIPs.has(ip); } detectAnomalousPattern(userId, action) { // å®ç°å¼‚å¸¸æ¨¡å¼æ£€æµ‹é€»è¾‘ // ä¾‹å¦‚ï¼šçŸ­æ—¶é—´å†…å¤§é‡æ“ä½œã€å¼‚å¸¸æ—¶é—´è®¿é—®ç­‰ } } const securityMonitor = new SecurityMonitor(); å®‰å…¨æµ‹è¯• 1. ä¾èµ–å®‰å…¨æ‰«æ 1 2 3 4 5 6 7 8 9 // package.json scripts { \"scripts\": { \"audit\": \"npm audit --audit-level=moderate\", \"audit:fix\": \"npm audit fix\", \"snyk\": \"snyk test\", \"snyk:monitor\": \"snyk monitor\" } } 2. å®‰å…¨æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // å®‰å…¨æµ‹è¯•ç¤ºä¾‹ const request = require('supertest'); const app = require('../app'); describe('Security Tests', () =\u003e { test('should prevent SQL injection', async () =\u003e { const maliciousInput = \"'; DROP TABLE users; --\"; const response = await request(app) .get(`/api/users/${maliciousInput}`) .expect(400); expect(response.body.error).toContain('Invalid input'); }); test('should prevent XSS in user input', async () =\u003e { const xssPayload = ''; const response = await request(app) .post('/api/users') .send({ name: xssPayload }) .expect(400); expect(response.body.error).toContain('Invalid input'); }); test('should have proper security headers', async () =\u003e { const response = await request(app) .get('/') .expect(200); expect(response.headers['x-frame-options']).toBe('DENY'); expect(response.headers['x-content-type-options']).toBe('nosniff'); expect(response.headers['x-xss-protection']).toBe('1; mode=block'); }); }); æ€»ç»“ Web å®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦å¤šå±‚æ¬¡çš„ä¿æŠ¤ï¼š\nè¾“å…¥éªŒè¯ï¼šä¸¥æ ¼éªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥ èº«ä»½è®¤è¯ï¼šä½¿ç”¨å¼ºå¯†ç ç­–ç•¥å’Œå¤šå› ç´ è®¤è¯ æˆæƒæ§åˆ¶ï¼šå®æ–½æœ€å°æƒé™åŸåˆ™ æ•°æ®ä¿æŠ¤ï¼šåŠ å¯†æ•æ„Ÿæ•°æ® å®‰å…¨å¤´ï¼šè®¾ç½®é€‚å½“çš„å®‰å…¨å“åº”å¤´ ç›‘æ§æ—¥å¿—ï¼šè®°å½•å’Œç›‘æ§å®‰å…¨äº‹ä»¶ å®šæœŸæ›´æ–°ï¼šä¿æŒä¾èµ–å’Œç³»ç»Ÿæ›´æ–° è®°ä½ï¼Œå®‰å…¨ä¸æ˜¯ä¸€æ¬¡æ€§çš„ä»»åŠ¡ï¼Œè€Œæ˜¯éœ€è¦æŒç»­å…³æ³¨å’Œæ”¹è¿›çš„è¿‡ç¨‹ã€‚\nç›¸å…³å·¥å…·ï¼š\nOWASP ZAP - å®‰å…¨æµ‹è¯•å·¥å…· å¯†ç ç”Ÿæˆå™¨ åŠ å¯†å·¥å…· ","wordCount":"2153","inLanguage":"zh-cn","datePublished":"2025-12-08T13:30:00+08:00","dateModified":"2025-12-08T13:30:00+08:00","author":{"@type":"Person","name":"æœ‰æ¡å·¥å…·å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/web-security-best-practices/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">Web å®‰å…¨æœ€ä½³å®è·µï¼šä¿æŠ¤ä½ çš„åº”ç”¨å…å—æ”»å‡»</h1><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/ class=category-link>å®‰å…¨å¼€å‘</a></div><span class=post-date>2025-12-08</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><h2 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><p>Web å®‰å…¨æ˜¯æ¯ä¸ªå¼€å‘è€…éƒ½å¿…é¡»é‡è§†çš„é—®é¢˜ã€‚éšç€ç½‘ç»œæ”»å‡»æ‰‹æ®µçš„ä¸æ–­æ¼”è¿›ï¼Œäº†è§£å¹¶å®æ–½å®‰å…¨æœ€ä½³å®è·µå¯¹äºä¿æŠ¤ç”¨æˆ·æ•°æ®å’Œç³»ç»Ÿå®‰å…¨è‡³å…³é‡è¦ã€‚</p><h2 id=owasp-top-10-é˜²èŒƒ>OWASP Top 10 é˜²èŒƒ<a hidden class=anchor aria-hidden=true href=#owasp-top-10-é˜²èŒƒ>#</a></h2><h3 id=1-æ³¨å…¥æ”»å‡»é˜²æŠ¤>1. æ³¨å…¥æ”»å‡»é˜²æŠ¤<a hidden class=anchor aria-hidden=true href=#1-æ³¨å…¥æ”»å‡»é˜²æŠ¤>#</a></h3><p><strong>SQL æ³¨å…¥é˜²æŠ¤ï¼š</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// âŒ å±é™©ï¼šå­—ç¬¦ä¸²æ‹¼æ¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> query <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`SELECT * FROM users WHERE id = </span><span style=color:#a5d6ff>${</span>userId<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// âœ… å®‰å…¨ï¼šå‚æ•°åŒ–æŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> query <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;SELECT * FROM users WHERE id = ?&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> result <span style=color:#ff7b72;font-weight:700>=</span> db.query(query, [userId]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨ ORMï¼ˆå¦‚ Sequelizeï¼‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> user <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> User.findOne({
</span></span><span style=display:flex><span>  where<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    id<span style=color:#ff7b72;font-weight:700>:</span> userId
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// æˆ–ä½¿ç”¨æ¨¡æ¿æ ‡ç­¾ï¼ˆå¦‚ pg åº“çš„ tagged template literalsï¼‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> query <span style=color:#ff7b72;font-weight:700>=</span> sql<span style=color:#a5d6ff>`SELECT * FROM users WHERE id = </span><span style=color:#a5d6ff>${</span>userId<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>;
</span></span></code></pre></td></tr></table></div></div><p><strong>NoSQL æ³¨å…¥é˜²æŠ¤ï¼š</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// âŒ å±é™©ï¼šç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> users <span style=color:#ff7b72;font-weight:700>=</span> db.users.find({
</span></span><span style=display:flex><span>  username<span style=color:#ff7b72;font-weight:700>:</span> req.body.username,
</span></span><span style=display:flex><span>  password<span style=color:#ff7b72;font-weight:700>:</span> req.body.password
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// âœ… å®‰å…¨ï¼šä½¿ç”¨ç™½åå•éªŒè¯
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> { username, password } <span style=color:#ff7b72;font-weight:700>=</span> req.body;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// éªŒè¯è¾“å…¥æ ¼å¼
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span><span style=color:#79c0ff>/^[a-zA-Z0-9_]{3,20}$/</span>.test(username)) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> res.status(<span style=color:#a5d6ff>400</span>).json({ error<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;Invalid username&#39;</span> });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> users <span style=color:#ff7b72;font-weight:700>=</span> db.users.find({
</span></span><span style=display:flex><span>  username<span style=color:#ff7b72;font-weight:700>:</span> username,
</span></span><span style=display:flex><span>  password<span style=color:#ff7b72;font-weight:700>:</span> hashPassword(password)
</span></span><span style=display:flex><span>});
</span></span></code></pre></td></tr></table></div></div><h3 id=2-èº«ä»½éªŒè¯å’Œæˆæƒ>2. èº«ä»½éªŒè¯å’Œæˆæƒ<a hidden class=anchor aria-hidden=true href=#2-èº«ä»½éªŒè¯å’Œæˆæƒ>#</a></h3><p><strong>å¯†ç å®‰å…¨ï¼š</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>const</span> bcrypt <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;bcryptjs&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> crypto <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;crypto&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å¯†ç å“ˆå¸Œ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> hashPassword <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>async</span> (password) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> saltRounds <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>12</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> bcrypt.hash(password, saltRounds);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å¯†ç éªŒè¯
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> verifyPassword <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>async</span> (password, hashedPassword) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> bcrypt.compare(password, hashedPassword);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ç”Ÿæˆéšæœºå¯†ç 
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> generateRandomPassword <span style=color:#ff7b72;font-weight:700>=</span> (length <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>12</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> crypto.randomBytes(length).toString(<span style=color:#a5d6ff>&#39;hex&#39;</span>);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å¯†ç å¼ºåº¦éªŒè¯
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> validatePasswordStrength <span style=color:#ff7b72;font-weight:700>=</span> (password) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> minLength <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>8</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> hasUpperCase <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>/[A-Z]/</span>.test(password);
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> hasLowerCase <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>/[a-z]/</span>.test(password);
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> hasNumbers <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>/\d/</span>.test(password);
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> hasSpecialChar <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>/[!@#$%^&amp;*(),.?&#34;:{}|&lt;&gt;]/</span>.test(password);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>    isValid<span style=color:#ff7b72;font-weight:700>:</span> password.length <span style=color:#ff7b72;font-weight:700>&gt;=</span> minLength <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span>
</span></span><span style=display:flex><span>             hasUpperCase <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span>
</span></span><span style=display:flex><span>             hasLowerCase <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span>
</span></span><span style=display:flex><span>             hasNumbers <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span>
</span></span><span style=display:flex><span>             hasSpecialChar,
</span></span><span style=display:flex><span>    errors<span style=color:#ff7b72;font-weight:700>:</span> [
</span></span><span style=display:flex><span>      password.length <span style=color:#ff7b72;font-weight:700>&lt;</span> minLength <span style=color:#ff7b72;font-weight:700>?</span> <span style=color:#a5d6ff>&#39;Password must be at least 8 characters&#39;</span> <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>null</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff7b72;font-weight:700>!</span>hasUpperCase <span style=color:#ff7b72;font-weight:700>?</span> <span style=color:#a5d6ff>&#39;Password must contain uppercase letter&#39;</span> <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>null</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff7b72;font-weight:700>!</span>hasLowerCase <span style=color:#ff7b72;font-weight:700>?</span> <span style=color:#a5d6ff>&#39;Password must contain lowercase letter&#39;</span> <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>null</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff7b72;font-weight:700>!</span>hasNumbers <span style=color:#ff7b72;font-weight:700>?</span> <span style=color:#a5d6ff>&#39;Password must contain a number&#39;</span> <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>null</span>,
</span></span><span style=display:flex><span>      <span style=color:#ff7b72;font-weight:700>!</span>hasSpecialChar <span style=color:#ff7b72;font-weight:700>?</span> <span style=color:#a5d6ff>&#39;Password must contain a special character&#39;</span> <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>null</span>
</span></span><span style=display:flex><span>    ].filter(Boolean)
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p><strong>JWT å®ç°ï¼š</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>const</span> jwt <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;jsonwebtoken&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> tokenService <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ç”Ÿæˆ token
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  generateToken(payload, expiresIn <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;24h&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> jwt.sign(payload, process.env.JWT_SECRET, { expiresIn });
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// éªŒè¯ token
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  verifyToken(token) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> jwt.verify(token, process.env.JWT_SECRET);
</span></span><span style=display:flex><span>    } <span style=color:#ff7b72>catch</span> (error) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>throw</span> <span style=color:#ff7b72>new</span> Error(<span style=color:#a5d6ff>&#39;Invalid token&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// åˆ·æ–° token
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  refreshToken(oldToken) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>const</span> decoded <span style=color:#ff7b72;font-weight:700>=</span> jwt.verify(oldToken, process.env.JWT_SECRET, { ignoreExpiration<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥ token æ˜¯å¦åœ¨åˆ·æ–°æœŸå†…
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      <span style=color:#ff7b72>if</span> (Date.now() <span style=color:#ff7b72;font-weight:700>-</span> decoded.iat <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span> <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>7</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>24</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>throw</span> <span style=color:#ff7b72>new</span> Error(<span style=color:#a5d6ff>&#39;Token too old to refresh&#39;</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.generateToken({
</span></span><span style=display:flex><span>        userId<span style=color:#ff7b72;font-weight:700>:</span> decoded.userId,
</span></span><span style=display:flex><span>        role<span style=color:#ff7b72;font-weight:700>:</span> decoded.role
</span></span><span style=display:flex><span>      }, <span style=color:#a5d6ff>&#39;24h&#39;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#ff7b72>catch</span> (error) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>throw</span> <span style=color:#ff7b72>new</span> Error(<span style=color:#a5d6ff>&#39;Cannot refresh token&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><h3 id=3-æ•°æ®éªŒè¯å’Œæ¸…ç†>3. æ•°æ®éªŒè¯å’Œæ¸…ç†<a hidden class=anchor aria-hidden=true href=#3-æ•°æ®éªŒè¯å’Œæ¸…ç†>#</a></h3><p><strong>è¾“å…¥éªŒè¯ä¸­é—´ä»¶ï¼š</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>const</span> { body, param, query, validationResult } <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;express-validator&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> xss <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;xss&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> validator <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;validator&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// æ¸…ç† HTML è¾“å…¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> sanitizeHtml <span style=color:#ff7b72;font-weight:700>=</span> (input) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> xss(input, {
</span></span><span style=display:flex><span>    whiteList<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      a<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;href&#39;</span>, <span style=color:#a5d6ff>&#39;title&#39;</span>, <span style=color:#a5d6ff>&#39;target&#39;</span>],
</span></span><span style=display:flex><span>      b<span style=color:#ff7b72;font-weight:700>:</span> [],
</span></span><span style=display:flex><span>      i<span style=color:#ff7b72;font-weight:700>:</span> [],
</span></span><span style=display:flex><span>      em<span style=color:#ff7b72;font-weight:700>:</span> [],
</span></span><span style=display:flex><span>      strong<span style=color:#ff7b72;font-weight:700>:</span> []
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    stripIgnoreTag<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>    stripIgnoreTagBody<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;script&#39;</span>]
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// é€šç”¨éªŒè¯ä¸­é—´ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> validateRequest <span style=color:#ff7b72;font-weight:700>=</span> (validations) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>async</span> (req, res, next) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>await</span> Promise.all(validations.map(validation =&gt; validation.run(req)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> errors <span style=color:#ff7b72;font-weight:700>=</span> validationResult(req);
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>errors.isEmpty()) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> res.status(<span style=color:#a5d6ff>400</span>).json({
</span></span><span style=display:flex><span>        success<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>,
</span></span><span style=display:flex><span>        errors<span style=color:#ff7b72;font-weight:700>:</span> errors.array()
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ¸…ç†è¾“å…¥æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> sanitizeObject <span style=color:#ff7b72;font-weight:700>=</span> (obj) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>typeof</span> obj <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>&#39;string&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> sanitizeHtml(validator.escape(obj));
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>if</span> (Array.isArray(obj)) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> obj.map(sanitizeObject);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>if</span> (obj <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> <span style=color:#ff7b72>typeof</span> obj <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>&#39;object&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> sanitized <span style=color:#ff7b72;font-weight:700>=</span> {};
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> [key, value] <span style=color:#ff7b72>of</span> Object.entries(obj)) {
</span></span><span style=display:flex><span>          sanitized[key] <span style=color:#ff7b72;font-weight:700>=</span> sanitizeObject(value);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> sanitized;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> obj;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    req.body <span style=color:#ff7b72;font-weight:700>=</span> sanitizeObject(req.body);
</span></span><span style=display:flex><span>    req.params <span style=color:#ff7b72;font-weight:700>=</span> sanitizeObject(req.params);
</span></span><span style=display:flex><span>    req.query <span style=color:#ff7b72;font-weight:700>=</span> sanitizeObject(req.query);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    next();
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> userValidation <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>  body(<span style=color:#a5d6ff>&#39;email&#39;</span>)
</span></span><span style=display:flex><span>    .isEmail()
</span></span><span style=display:flex><span>    .normalizeEmail(),
</span></span><span style=display:flex><span>  body(<span style=color:#a5d6ff>&#39;name&#39;</span>)
</span></span><span style=display:flex><span>    .trim()
</span></span><span style=display:flex><span>    .isLength({ min<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>2</span>, max<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>50</span> })
</span></span><span style=display:flex><span>    .escape(),
</span></span><span style=display:flex><span>  body(<span style=color:#a5d6ff>&#39;age&#39;</span>)
</span></span><span style=display:flex><span>    .optional()
</span></span><span style=display:flex><span>    .isInt({ min<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>0</span>, max<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>120</span> })
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.post(<span style=color:#a5d6ff>&#39;/api/users&#39;</span>, validateRequest(userValidation), (req, res) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// å¤„ç†é€»è¾‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>});
</span></span></code></pre></td></tr></table></div></div><h2 id=å‰ç«¯å®‰å…¨>å‰ç«¯å®‰å…¨<a hidden class=anchor aria-hidden=true href=#å‰ç«¯å®‰å…¨>#</a></h2><h3 id=1-xss-é˜²æŠ¤>1. XSS é˜²æŠ¤<a hidden class=anchor aria-hidden=true href=#1-xss-é˜²æŠ¤>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Content Security Policy è®¾ç½®
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> csp <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  directives<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    defaultSrc<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#34;&#39;self&#39;&#34;</span>],
</span></span><span style=display:flex><span>    scriptSrc<span style=color:#ff7b72;font-weight:700>:</span> [
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#34;&#39;self&#39;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#34;&#39;unsafe-inline&#39;&#34;</span>, <span style=color:#8b949e;font-style:italic>// å¼€å‘ç¯å¢ƒä½¿ç”¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      <span style=color:#a5d6ff>&#39;https://trusted-cdn.com&#39;</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    styleSrc<span style=color:#ff7b72;font-weight:700>:</span> [
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#34;&#39;self&#39;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#34;&#39;unsafe-inline&#39;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;https://fonts.googleapis.com&#39;</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    fontSrc<span style=color:#ff7b72;font-weight:700>:</span> [
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#34;&#39;self&#39;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;https://fonts.gstatic.com&#39;</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    imgSrc<span style=color:#ff7b72;font-weight:700>:</span> [
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#34;&#39;self&#39;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;data:&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;https:&#39;</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    connectSrc<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#34;&#39;self&#39;&#34;</span>],
</span></span><span style=display:flex><span>    frameSrc<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#34;&#39;none&#39;&#34;</span>],
</span></span><span style=display:flex><span>    objectSrc<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#34;&#39;none&#39;&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// React ä¸­çš„å®‰å…¨å®è·µ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> SafeComponent <span style=color:#ff7b72;font-weight:700>=</span> ({ content }) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// âŒ å±é™©ï¼šç›´æ¥æ¸²æŸ“ HTML
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#8b949e;font-style:italic>// return &lt;div dangerouslySetInnerHTML={{ __html: content }} /&gt;;
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// âœ… å®‰å…¨ï¼šä½¿ç”¨ä¸“é—¨çš„åº“
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>const</span> DOMPurify <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;dompurify&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> cleanContent <span style=color:#ff7b72;font-weight:700>=</span> DOMPurify.sanitize(content);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>&lt;</span>div<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72;font-weight:700>&lt;</span>span<span style=color:#ff7b72;font-weight:700>&gt;</span>Safe content<span style=color:#ff7b72;font-weight:700>:&lt;</span><span style=color:#f85149>/span&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72;font-weight:700>&lt;</span>div dangerouslySetInnerHTML<span style=color:#ff7b72;font-weight:700>=</span>{{ __html<span style=color:#ff7b72;font-weight:700>:</span> cleanContent }} <span style=color:#ff7b72;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#f85149>/div&gt;</span>
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å®‰å…¨çš„ URL å¤„ç†
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> SafeLink <span style=color:#ff7b72;font-weight:700>=</span> ({ url, children }) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// éªŒè¯ URL
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>const</span> isValidUrl <span style=color:#ff7b72;font-weight:700>=</span> (url) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>const</span> parsed <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> URL(url);
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> [<span style=color:#a5d6ff>&#39;http:&#39;</span>, <span style=color:#a5d6ff>&#39;https:&#39;</span>].includes(parsed.protocol);
</span></span><span style=display:flex><span>    } <span style=color:#ff7b72>catch</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>isValidUrl(url)) {
</span></span><span style=display:flex><span>    console.warn(<span style=color:#a5d6ff>&#39;Invalid URL detected:&#39;</span>, url);
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72;font-weight:700>&lt;</span>span<span style=color:#ff7b72;font-weight:700>&gt;</span>{children}<span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#f85149>/span&gt;;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>&lt;</span>a href<span style=color:#ff7b72;font-weight:700>=</span>{url} target<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;_blank&#34;</span> rel<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;noopener noreferrer&#34;</span><span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      {children}
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#f85149>/a&gt;</span>
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><h3 id=2-csrf-é˜²æŠ¤>2. CSRF é˜²æŠ¤<a hidden class=anchor aria-hidden=true href=#2-csrf-é˜²æŠ¤>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// CSRF Token ç”Ÿæˆå’ŒéªŒè¯
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> csrf <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;csurf&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> cookieParser <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;cookie-parser&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.use(cookieParser());
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> csrfProtection <span style=color:#ff7b72;font-weight:700>=</span> csrf({
</span></span><span style=display:flex><span>  cookie<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    httpOnly<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>    secure<span style=color:#ff7b72;font-weight:700>:</span> process.env.NODE_ENV <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>&#39;production&#39;</span>,
</span></span><span style=display:flex><span>    sameSite<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;strict&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// æä¾› CSRF token
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>app.get(<span style=color:#a5d6ff>&#39;/api/csrf-token&#39;</span>, csrfProtection, (req, res) =&gt; {
</span></span><span style=display:flex><span>  res.json({ csrfToken<span style=color:#ff7b72;font-weight:700>:</span> req.csrfToken() });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å—ä¿æŠ¤çš„è·¯ç”±
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>app.post(<span style=color:#a5d6ff>&#39;/api/protected&#39;</span>, csrfProtection, (req, res) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// å¤„ç†è¯·æ±‚
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å‰ç«¯ä½¿ç”¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> postWithCSRF <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>async</span> (url, data) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// è·å– CSRF token
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>const</span> { csrfToken } <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> fetch(<span style=color:#a5d6ff>&#39;/api/csrf-token&#39;</span>).then(r =&gt; r.json());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> fetch(url, {
</span></span><span style=display:flex><span>    method<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>    headers<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;Content-Type&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;X-CSRF-Token&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> csrfToken
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    body<span style=color:#ff7b72;font-weight:700>:</span> JSON.stringify(data)
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><h2 id=åç«¯å®‰å…¨>åç«¯å®‰å…¨<a hidden class=anchor aria-hidden=true href=#åç«¯å®‰å…¨>#</a></h2><h3 id=1-å®‰å…¨å¤´è®¾ç½®>1. å®‰å…¨å¤´è®¾ç½®<a hidden class=anchor aria-hidden=true href=#1-å®‰å…¨å¤´è®¾ç½®>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>const</span> helmet <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;helmet&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.use(helmet({
</span></span><span style=display:flex><span>  contentSecurityPolicy<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    directives<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      defaultSrc<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#34;&#39;self&#39;&#34;</span>],
</span></span><span style=display:flex><span>      styleSrc<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#34;&#39;self&#39;&#34;</span>, <span style=color:#a5d6ff>&#34;&#39;unsafe-inline&#39;&#34;</span>],
</span></span><span style=display:flex><span>      scriptSrc<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#34;&#39;self&#39;&#34;</span>],
</span></span><span style=display:flex><span>      imgSrc<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#34;&#39;self&#39;&#34;</span>, <span style=color:#a5d6ff>&#34;data:&#34;</span>, <span style=color:#a5d6ff>&#34;https:&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  hsts<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    maxAge<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>31536000</span>,
</span></span><span style=display:flex><span>    includeSubDomains<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>    preload<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// è‡ªå®šä¹‰å®‰å…¨å¤´
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>app.use((req, res, next) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// é˜²æ­¢ç‚¹å‡»åŠ«æŒ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  res.setHeader(<span style=color:#a5d6ff>&#39;X-Frame-Options&#39;</span>, <span style=color:#a5d6ff>&#39;DENY&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// é˜²æ­¢ MIME ç±»å‹å—…æ¢
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  res.setHeader(<span style=color:#a5d6ff>&#39;X-Content-Type-Options&#39;</span>, <span style=color:#a5d6ff>&#39;nosniff&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// XSS ä¿æŠ¤
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  res.setHeader(<span style=color:#a5d6ff>&#39;X-XSS-Protection&#39;</span>, <span style=color:#a5d6ff>&#39;1; mode=block&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// å¼•ç”¨ç­–ç•¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  res.setHeader(<span style=color:#a5d6ff>&#39;Referrer-Policy&#39;</span>, <span style=color:#a5d6ff>&#39;strict-origin-when-cross-origin&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// æƒé™ç­–ç•¥ï¼ˆæ›¿ä»£ Feature-Policyï¼‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  res.setHeader(<span style=color:#a5d6ff>&#39;Permissions-Policy&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;geolocation=(), microphone=(), camera=()&#39;</span>
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  next();
</span></span><span style=display:flex><span>});
</span></span></code></pre></td></tr></table></div></div><h3 id=2-é€Ÿç‡é™åˆ¶>2. é€Ÿç‡é™åˆ¶<a hidden class=anchor aria-hidden=true href=#2-é€Ÿç‡é™åˆ¶>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>const</span> rateLimit <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;express-rate-limit&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> slowDown <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;express-slow-down&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// é€šç”¨é€Ÿç‡é™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> generalLimiter <span style=color:#ff7b72;font-weight:700>=</span> rateLimit({
</span></span><span style=display:flex><span>  windowMs<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>15</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>, <span style=color:#8b949e;font-style:italic>// 15åˆ†é’Ÿ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  max<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>100</span>, <span style=color:#8b949e;font-style:italic>// é™åˆ¶æ¯ä¸ªIP 15åˆ†é’Ÿå†…æœ€å¤š100ä¸ªè¯·æ±‚
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  message<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    error<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;Too many requests, please try again later&#39;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  standardHeaders<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>  legacyHeaders<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ç™»å½•é€Ÿç‡é™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> loginLimiter <span style=color:#ff7b72;font-weight:700>=</span> rateLimit({
</span></span><span style=display:flex><span>  windowMs<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>15</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>,
</span></span><span style=display:flex><span>  max<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>5</span>, <span style=color:#8b949e;font-style:italic>// æœ€å¤š5æ¬¡å°è¯•
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  skipSuccessfulRequests<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// API é€Ÿç‡é™åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> apiLimiter <span style=color:#ff7b72;font-weight:700>=</span> rateLimit({
</span></span><span style=display:flex><span>  windowMs<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>, <span style=color:#8b949e;font-style:italic>// 1åˆ†é’Ÿ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  max<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>60</span>, <span style=color:#8b949e;font-style:italic>// æ¯åˆ†é’Ÿ60ä¸ªè¯·æ±‚
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  keyGenerator<span style=color:#ff7b72;font-weight:700>:</span> (req) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> req.user <span style=color:#ff7b72;font-weight:700>?</span> req.user.id <span style=color:#ff7b72;font-weight:700>:</span> req.ip;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å‡æ…¢å“åº”é€Ÿåº¦
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> speedLimiter <span style=color:#ff7b72;font-weight:700>=</span> slowDown({
</span></span><span style=display:flex><span>  windowMs<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>15</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>,
</span></span><span style=display:flex><span>  delayAfter<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>50</span>, <span style=color:#8b949e;font-style:italic>// 50ä¸ªè¯·æ±‚åå¼€å§‹å»¶è¿Ÿ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  delayMs<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>500</span>, <span style=color:#8b949e;font-style:italic>// æ¯ä¸ªè¯·æ±‚å»¶è¿Ÿ500ms
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  maxDelayMs<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>20000</span> <span style=color:#8b949e;font-style:italic>// æœ€å¤§å»¶è¿Ÿ20ç§’
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.use(generalLimiter);
</span></span><span style=display:flex><span>app.use(<span style=color:#a5d6ff>&#39;/api/login&#39;</span>, loginLimiter);
</span></span><span style=display:flex><span>app.use(<span style=color:#a5d6ff>&#39;/api/&#39;</span>, apiLimiter);
</span></span><span style=display:flex><span>app.use(<span style=color:#a5d6ff>&#39;/api/&#39;</span>, speedLimiter);
</span></span></code></pre></td></tr></table></div></div><h2 id=æ•°æ®å®‰å…¨>æ•°æ®å®‰å…¨<a hidden class=anchor aria-hidden=true href=#æ•°æ®å®‰å…¨>#</a></h2><h3 id=1-åŠ å¯†å­˜å‚¨>1. åŠ å¯†å­˜å‚¨<a hidden class=anchor aria-hidden=true href=#1-åŠ å¯†å­˜å‚¨>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>const</span> crypto <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;crypto&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> algorithm <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;aes-256-gcm&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> secretKey <span style=color:#ff7b72;font-weight:700>=</span> crypto.scryptSync(process.env.ENCRYPTION_KEY, <span style=color:#a5d6ff>&#39;salt&#39;</span>, <span style=color:#a5d6ff>32</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> encryption <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// åŠ å¯†
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  encrypt(text) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> iv <span style=color:#ff7b72;font-weight:700>=</span> crypto.randomBytes(<span style=color:#a5d6ff>16</span>);
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> cipher <span style=color:#ff7b72;font-weight:700>=</span> crypto.createCipher(algorithm, secretKey, iv);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>let</span> encrypted <span style=color:#ff7b72;font-weight:700>=</span> cipher.update(text, <span style=color:#a5d6ff>&#39;utf8&#39;</span>, <span style=color:#a5d6ff>&#39;hex&#39;</span>);
</span></span><span style=display:flex><span>    encrypted <span style=color:#ff7b72;font-weight:700>+=</span> cipher.<span style=color:#ff7b72>final</span>(<span style=color:#a5d6ff>&#39;hex&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> authTag <span style=color:#ff7b72;font-weight:700>=</span> cipher.getAuthTag();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>      encrypted,
</span></span><span style=display:flex><span>      iv<span style=color:#ff7b72;font-weight:700>:</span> iv.toString(<span style=color:#a5d6ff>&#39;hex&#39;</span>),
</span></span><span style=display:flex><span>      authTag<span style=color:#ff7b72;font-weight:700>:</span> authTag.toString(<span style=color:#a5d6ff>&#39;hex&#39;</span>)
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// è§£å¯†
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  decrypt(encryptedData) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> decipher <span style=color:#ff7b72;font-weight:700>=</span> crypto.createDecipher(
</span></span><span style=display:flex><span>      algorithm,
</span></span><span style=display:flex><span>      secretKey,
</span></span><span style=display:flex><span>      Buffer.from(encryptedData.iv, <span style=color:#a5d6ff>&#39;hex&#39;</span>)
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    decipher.setAuthTag(Buffer.from(encryptedData.authTag, <span style=color:#a5d6ff>&#39;hex&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>let</span> decrypted <span style=color:#ff7b72;font-weight:700>=</span> decipher.update(encryptedData.encrypted, <span style=color:#a5d6ff>&#39;hex&#39;</span>, <span style=color:#a5d6ff>&#39;utf8&#39;</span>);
</span></span><span style=display:flex><span>    decrypted <span style=color:#ff7b72;font-weight:700>+=</span> decipher.<span style=color:#ff7b72>final</span>(<span style=color:#a5d6ff>&#39;utf8&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> decrypted;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> sensitiveData <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;user&#39;s credit card number&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> encrypted <span style=color:#ff7b72;font-weight:700>=</span> encryption.encrypt(sensitiveData);
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> decrypted <span style=color:#ff7b72;font-weight:700>=</span> encryption.decrypt(encrypted);
</span></span></code></pre></td></tr></table></div></div><h3 id=2-å®‰å…¨é…ç½®>2. å®‰å…¨é…ç½®<a hidden class=anchor aria-hidden=true href=#2-å®‰å…¨é…ç½®>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ç¯å¢ƒå˜é‡éªŒè¯
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> requiredEnvVars <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>&#39;JWT_SECRET&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>&#39;ENCRYPTION_KEY&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>&#39;DATABASE_URL&#39;</span>
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> validateEnv <span style=color:#ff7b72;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> missing <span style=color:#ff7b72;font-weight:700>=</span> requiredEnvVars.filter(key =&gt; <span style=color:#ff7b72;font-weight:700>!</span>process.env[key]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>if</span> (missing.length <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>throw</span> <span style=color:#ff7b72>new</span> Error(<span style=color:#a5d6ff>`Missing required environment variables: </span><span style=color:#a5d6ff>${</span>missing.join(<span style=color:#a5d6ff>&#39;, &#39;</span>)<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å®‰å…¨éšæœºæ•°ç”Ÿæˆ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> generateSecureToken <span style=color:#ff7b72;font-weight:700>=</span> (length <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>32</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> crypto.randomBytes(length).toString(<span style=color:#a5d6ff>&#39;hex&#39;</span>);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å¯†é’¥è½®æ¢
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> keyRotation <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  currentKey<span style=color:#ff7b72;font-weight:700>:</span> process.env.ENCRYPTION_KEY,
</span></span><span style=display:flex><span>  previousKeys<span style=color:#ff7b72;font-weight:700>:</span> [],
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  encryptWithCurrentKey(data) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.encrypt(data, <span style=color:#ff7b72>this</span>.currentKey);
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  decryptWithAnyKey(encryptedData) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å°è¯•ç”¨å½“å‰å¯†é’¥è§£å¯†
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.decrypt(encryptedData, <span style=color:#ff7b72>this</span>.currentKey);
</span></span><span style=display:flex><span>    } <span style=color:#ff7b72>catch</span> (e) {
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// å°è¯•ç”¨ä»¥å‰çš„å¯†é’¥è§£å¯†
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> key <span style=color:#ff7b72>of</span> <span style=color:#ff7b72>this</span>.previousKeys) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>          <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.decrypt(encryptedData, key);
</span></span><span style=display:flex><span>        } <span style=color:#ff7b72>catch</span> (e) {
</span></span><span style=display:flex><span>          <span style=color:#ff7b72>continue</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>throw</span> <span style=color:#ff7b72>new</span> Error(<span style=color:#a5d6ff>&#39;Unable to decrypt data with any available key&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  rotateKey(newKey) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.previousKeys.push(<span style=color:#ff7b72>this</span>.currentKey);
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.currentKey <span style=color:#ff7b72;font-weight:700>=</span> newKey;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ä¿ç•™æœ€è¿‘3ä¸ªå¯†é’¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.previousKeys.length <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>3</span>) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.previousKeys.shift();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><h2 id=å®‰å…¨æ—¥å¿—å’Œç›‘æ§>å®‰å…¨æ—¥å¿—å’Œç›‘æ§<a hidden class=anchor aria-hidden=true href=#å®‰å…¨æ—¥å¿—å’Œç›‘æ§>#</a></h2><h3 id=1-å®‰å…¨äº‹ä»¶æ—¥å¿—>1. å®‰å…¨äº‹ä»¶æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#1-å®‰å…¨äº‹ä»¶æ—¥å¿—>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>const</span> winston <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;winston&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> securityLogger <span style=color:#ff7b72;font-weight:700>=</span> winston.createLogger({
</span></span><span style=display:flex><span>  level<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;info&#39;</span>,
</span></span><span style=display:flex><span>  format<span style=color:#ff7b72;font-weight:700>:</span> winston.format.combine(
</span></span><span style=display:flex><span>    winston.format.timestamp(),
</span></span><span style=display:flex><span>    winston.format.json()
</span></span><span style=display:flex><span>  ),
</span></span><span style=display:flex><span>  transports<span style=color:#ff7b72;font-weight:700>:</span> [
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>new</span> winston.transports.File({ filename<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;logs/security.log&#39;</span> })
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> securityEvents <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  logFailedLogin(ip, email, reason) {
</span></span><span style=display:flex><span>    securityLogger.warn(<span style=color:#a5d6ff>&#39;Failed login attempt&#39;</span>, {
</span></span><span style=display:flex><span>      event<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;FAILED_LOGIN&#39;</span>,
</span></span><span style=display:flex><span>      ip,
</span></span><span style=display:flex><span>      email,
</span></span><span style=display:flex><span>      reason,
</span></span><span style=display:flex><span>      timestamp<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>new</span> Date().toISOString()
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  logSuspiciousActivity(ip, userId, activity) {
</span></span><span style=display:flex><span>    securityLogger.error(<span style=color:#a5d6ff>&#39;Suspicious activity detected&#39;</span>, {
</span></span><span style=display:flex><span>      event<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;SUSPICIOUS_ACTIVITY&#39;</span>,
</span></span><span style=display:flex><span>      ip,
</span></span><span style=display:flex><span>      userId,
</span></span><span style=display:flex><span>      activity,
</span></span><span style=display:flex><span>      timestamp<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>new</span> Date().toISOString()
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  logPrivilegedAction(userId, action, resource) {
</span></span><span style=display:flex><span>    securityLogger.info(<span style=color:#a5d6ff>&#39;Privileged action performed&#39;</span>, {
</span></span><span style=display:flex><span>      event<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;PRIVILEGED_ACTION&#39;</span>,
</span></span><span style=display:flex><span>      userId,
</span></span><span style=display:flex><span>      action,
</span></span><span style=display:flex><span>      resource,
</span></span><span style=display:flex><span>      timestamp<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>new</span> Date().toISOString()
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><h3 id=2-å¼‚å¸¸æ£€æµ‹>2. å¼‚å¸¸æ£€æµ‹<a hidden class=anchor aria-hidden=true href=#2-å¼‚å¸¸æ£€æµ‹>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>class</span> SecurityMonitor {
</span></span><span style=display:flex><span>  constructor() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.failedLogins <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map();
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.suspiciousIPs <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Set();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  recordFailedLogin(ip) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> count <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.failedLogins.get(ip) <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.failedLogins.set(ip, count <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 5æ¬¡å¤±è´¥ç™»å½•åæ ‡è®°ä¸ºå¯ç–‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>if</span> (count <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>5</span>) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.suspiciousIPs.add(ip);
</span></span><span style=display:flex><span>      securityEvents.logSuspiciousActivity(ip, <span style=color:#79c0ff>null</span>, <span style=color:#a5d6ff>&#39;Multiple failed logins&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 24å°æ—¶åé‡ç½®è®¡æ•°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    setTimeout(() =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.failedLogins.<span style=color:#ff7b72>delete</span>(ip);
</span></span><span style=display:flex><span>    }, <span style=color:#a5d6ff>24</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  isIPSuspicious(ip) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.suspiciousIPs.has(ip);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  detectAnomalousPattern(userId, action) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å®ç°å¼‚å¸¸æ¨¡å¼æ£€æµ‹é€»è¾‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#8b949e;font-style:italic>// ä¾‹å¦‚ï¼šçŸ­æ—¶é—´å†…å¤§é‡æ“ä½œã€å¼‚å¸¸æ—¶é—´è®¿é—®ç­‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> securityMonitor <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> SecurityMonitor();
</span></span></code></pre></td></tr></table></div></div><h2 id=å®‰å…¨æµ‹è¯•>å®‰å…¨æµ‹è¯•<a hidden class=anchor aria-hidden=true href=#å®‰å…¨æµ‹è¯•>#</a></h2><h3 id=1-ä¾èµ–å®‰å…¨æ‰«æ>1. ä¾èµ–å®‰å…¨æ‰«æ<a hidden class=anchor aria-hidden=true href=#1-ä¾èµ–å®‰å…¨æ‰«æ>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// package.json scripts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>{
</span></span><span style=display:flex><span>  <span style=color:#7ee787>&#34;scripts&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;audit&#34;</span>: <span style=color:#a5d6ff>&#34;npm audit --audit-level=moderate&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;audit:fix&#34;</span>: <span style=color:#a5d6ff>&#34;npm audit fix&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;snyk&#34;</span>: <span style=color:#a5d6ff>&#34;snyk test&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;snyk:monitor&#34;</span>: <span style=color:#a5d6ff>&#34;snyk monitor&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=2-å®‰å…¨æµ‹è¯•>2. å®‰å…¨æµ‹è¯•<a hidden class=anchor aria-hidden=true href=#2-å®‰å…¨æµ‹è¯•>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å®‰å…¨æµ‹è¯•ç¤ºä¾‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> request <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;supertest&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> app <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;../app&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>describe(<span style=color:#a5d6ff>&#39;Security Tests&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>  test(<span style=color:#a5d6ff>&#39;should prevent SQL injection&#39;</span>, <span style=color:#ff7b72>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> maliciousInput <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#39;; DROP TABLE users; --&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> request(app)
</span></span><span style=display:flex><span>      .get(<span style=color:#a5d6ff>`/api/users/</span><span style=color:#a5d6ff>${</span>maliciousInput<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>)
</span></span><span style=display:flex><span>      .expect(<span style=color:#a5d6ff>400</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    expect(response.body.error).toContain(<span style=color:#a5d6ff>&#39;Invalid input&#39;</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  test(<span style=color:#a5d6ff>&#39;should prevent XSS in user input&#39;</span>, <span style=color:#ff7b72>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> xssPayload <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;&lt;script&gt;alert(&#34;xss&#34;)&lt;/script&gt;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> request(app)
</span></span><span style=display:flex><span>      .post(<span style=color:#a5d6ff>&#39;/api/users&#39;</span>)
</span></span><span style=display:flex><span>      .send({ name<span style=color:#ff7b72;font-weight:700>:</span> xssPayload })
</span></span><span style=display:flex><span>      .expect(<span style=color:#a5d6ff>400</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    expect(response.body.error).toContain(<span style=color:#a5d6ff>&#39;Invalid input&#39;</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  test(<span style=color:#a5d6ff>&#39;should have proper security headers&#39;</span>, <span style=color:#ff7b72>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> request(app)
</span></span><span style=display:flex><span>      .get(<span style=color:#a5d6ff>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>      .expect(<span style=color:#a5d6ff>200</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    expect(response.headers[<span style=color:#a5d6ff>&#39;x-frame-options&#39;</span>]).toBe(<span style=color:#a5d6ff>&#39;DENY&#39;</span>);
</span></span><span style=display:flex><span>    expect(response.headers[<span style=color:#a5d6ff>&#39;x-content-type-options&#39;</span>]).toBe(<span style=color:#a5d6ff>&#39;nosniff&#39;</span>);
</span></span><span style=display:flex><span>    expect(response.headers[<span style=color:#a5d6ff>&#39;x-xss-protection&#39;</span>]).toBe(<span style=color:#a5d6ff>&#39;1; mode=block&#39;</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span></code></pre></td></tr></table></div></div><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><p>Web å®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦å¤šå±‚æ¬¡çš„ä¿æŠ¤ï¼š</p><ol><li><strong>è¾“å…¥éªŒè¯</strong>ï¼šä¸¥æ ¼éªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥</li><li><strong>èº«ä»½è®¤è¯</strong>ï¼šä½¿ç”¨å¼ºå¯†ç ç­–ç•¥å’Œå¤šå› ç´ è®¤è¯</li><li><strong>æˆæƒæ§åˆ¶</strong>ï¼šå®æ–½æœ€å°æƒé™åŸåˆ™</li><li><strong>æ•°æ®ä¿æŠ¤</strong>ï¼šåŠ å¯†æ•æ„Ÿæ•°æ®</li><li><strong>å®‰å…¨å¤´</strong>ï¼šè®¾ç½®é€‚å½“çš„å®‰å…¨å“åº”å¤´</li><li><strong>ç›‘æ§æ—¥å¿—</strong>ï¼šè®°å½•å’Œç›‘æ§å®‰å…¨äº‹ä»¶</li><li><strong>å®šæœŸæ›´æ–°</strong>ï¼šä¿æŒä¾èµ–å’Œç³»ç»Ÿæ›´æ–°</li></ol><p>è®°ä½ï¼Œå®‰å…¨ä¸æ˜¯ä¸€æ¬¡æ€§çš„ä»»åŠ¡ï¼Œè€Œæ˜¯éœ€è¦æŒç»­å…³æ³¨å’Œæ”¹è¿›çš„è¿‡ç¨‹ã€‚</p><hr><p><strong>ç›¸å…³å·¥å…·ï¼š</strong></p><ul><li><a href=https://www.zaproxy.org/>OWASP ZAP</a> - å®‰å…¨æµ‹è¯•å·¥å…·</li><li><a href=https://www.util.cn/password-generator/>å¯†ç ç”Ÿæˆå™¨</a></li><li><a href=https://www.util.cn/crypto/>åŠ å¯†å·¥å…·</a></li></ul></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/web%E5%AE%89%E5%85%A8/ class=tag-pill>Webå®‰å…¨
</a><a href=/blog/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/ class=tag-pill>ç½‘ç»œå®‰å…¨
</a><a href=/blog/tags/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/ class=tag-pill>å‰ç«¯å®‰å…¨
</a><a href=/blog/tags/%E5%90%8E%E7%AB%AF%E5%AE%89%E5%85%A8/ class=tag-pill>åç«¯å®‰å…¨</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/docker-containerization-guide/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>Docker å®¹å™¨åŒ–éƒ¨ç½²å®Œå…¨æŒ‡å—</div></div></a><a href=/blog/articles/git-advanced-techniques/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>Git é«˜çº§æŠ€å·§ï¼šæå‡å¼€å‘æ•ˆç‡çš„å®ç”¨æŒ‡å—</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>å‰è¨€</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>OWASP Top 10 é˜²èŒƒ</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>å‰ç«¯å®‰å…¨</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>åç«¯å®‰å…¨</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>æ•°æ®å®‰å…¨</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>å®‰å…¨æ—¥å¿—å’Œç›‘æ§</span></a></li><li class="toc-item toc-h2"><a href=#h2-6 class=toc-item-link><span class=toc-item-text>å®‰å…¨æµ‹è¯•</span></a></li><li class="toc-item toc-h2"><a href=#h2-7 class=toc-item-link><span class=toc-item-text>æ€»ç»“</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>