<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å°æ¸¸æˆå¼€å‘ä¸å˜ç°å®Œå…¨æŒ‡å—ï¼šä»åˆ›æ„åˆ°ç›ˆåˆ©çš„å®æˆ˜æ‰‹å†Œ | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="å°æ¸¸æˆ,æ¸¸æˆå˜ç°,å¹¿å‘Šç³»ç»Ÿ,å†…è´­è®¾è®¡,æ¸¸æˆä¼˜åŒ–,ç”¨æˆ·ç•™å­˜"><meta name=description content="æœ¬æ–‡å…¨é¢ä»‹ç»å°æ¸¸æˆå¼€å‘çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æŠ€æœ¯å®ç°ã€å¹¿å‘Šç³»ç»Ÿé›†æˆã€å†…è´­è®¾è®¡ã€ç”¨æˆ·å¢é•¿ç­‰å…³é”®ç¯èŠ‚ã€‚"><meta name=author content="Util Tech Team"><link rel=canonical href=/blog/articles/mini-game-development-monetization/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/mini-game-development-monetization/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/mini-game-development-monetization/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/mini-game-development-monetization/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="å°æ¸¸æˆå¼€å‘ä¸å˜ç°å®Œå…¨æŒ‡å—ï¼šä»åˆ›æ„åˆ°ç›ˆåˆ©çš„å®æˆ˜æ‰‹å†Œ"><meta property="og:description" content="æœ¬æ–‡å…¨é¢ä»‹ç»å°æ¸¸æˆå¼€å‘çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æŠ€æœ¯å®ç°ã€å¹¿å‘Šç³»ç»Ÿé›†æˆã€å†…è´­è®¾è®¡ã€ç”¨æˆ·å¢é•¿ç­‰å…³é”®ç¯èŠ‚ã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-20T12:00:00+08:00"><meta property="article:modified_time" content="2025-12-20T12:00:00+08:00"><meta property="article:tag" content="å°æ¸¸æˆå¼€å‘"><meta property="article:tag" content="æ¸¸æˆå˜ç°"><meta property="article:tag" content="å¾®ä¿¡å°æ¸¸æˆ"><meta property="article:tag" content="å¹¿å‘Šå˜ç°"><meta property="article:tag" content="å†…è´­è®¾è®¡"><meta name=twitter:card content="summary"><meta name=twitter:title content="å°æ¸¸æˆå¼€å‘ä¸å˜ç°å®Œå…¨æŒ‡å—ï¼šä»åˆ›æ„åˆ°ç›ˆåˆ©çš„å®æˆ˜æ‰‹å†Œ"><meta name=twitter:description content="æœ¬æ–‡å…¨é¢ä»‹ç»å°æ¸¸æˆå¼€å‘çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æŠ€æœ¯å®ç°ã€å¹¿å‘Šç³»ç»Ÿé›†æˆã€å†…è´­è®¾è®¡ã€ç”¨æˆ·å¢é•¿ç­‰å…³é”®ç¯èŠ‚ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"å°æ¸¸æˆå¼€å‘ä¸å˜ç°å®Œå…¨æŒ‡å—ï¼šä»åˆ›æ„åˆ°ç›ˆåˆ©çš„å®æˆ˜æ‰‹å†Œ","item":"/blog/articles/mini-game-development-monetization/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"å°æ¸¸æˆå¼€å‘ä¸å˜ç°å®Œå…¨æŒ‡å—ï¼šä»åˆ›æ„åˆ°ç›ˆåˆ©çš„å®æˆ˜æ‰‹å†Œ","name":"å°æ¸¸æˆå¼€å‘ä¸å˜ç°å®Œå…¨æŒ‡å—ï¼šä»åˆ›æ„åˆ°ç›ˆåˆ©çš„å®æˆ˜æ‰‹å†Œ","description":"æœ¬æ–‡å…¨é¢ä»‹ç»å°æ¸¸æˆå¼€å‘çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æŠ€æœ¯å®ç°ã€å¹¿å‘Šç³»ç»Ÿé›†æˆã€å†…è´­è®¾è®¡ã€ç”¨æˆ·å¢é•¿ç­‰å…³é”®ç¯èŠ‚ã€‚","keywords":["å°æ¸¸æˆ","æ¸¸æˆå˜ç°","å¹¿å‘Šç³»ç»Ÿ","å†…è´­è®¾è®¡","æ¸¸æˆä¼˜åŒ–","ç”¨æˆ·ç•™å­˜"],"articleBody":"å¼•è¨€ å°æ¸¸æˆå¸‚åœºåœ¨2024å¹´ç»§ç»­è“¬å‹ƒå‘å±•ï¼Œå¾®ä¿¡å°æ¸¸æˆæœˆæ´»è·ƒç”¨æˆ·çªç ´4äº¿ï¼Œå°æ¸¸æˆå¸‚åœºè§„æ¨¡è¾¾åˆ°500äº¿å…ƒã€‚éšç€å¼€å‘é—¨æ§›é™ä½å’Œå˜ç°æ¸ é“å¤šæ ·åŒ–ï¼Œè¶Šæ¥è¶Šå¤šå¼€å‘è€…æ¶Œå…¥è¿™ä¸ªé¢†åŸŸã€‚æœ¬æ–‡å°†ä»æŠ€æœ¯å®ç°ã€å•†ä¸šæ¨¡å¼ã€ç”¨æˆ·è¿è¥ç­‰å¤šä¸ªç»´åº¦ï¼Œå…¨é¢è§£æå°æ¸¸æˆå¼€å‘ä¸å˜ç°çš„ç­–ç•¥ã€‚\nå°æ¸¸æˆæŠ€æœ¯æ¶æ„ æŠ€æœ¯æ ˆé€‰æ‹© LayaAirå¼•æ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // LayaAir 2.x æ¸¸æˆåˆå§‹åŒ– class GameMain { constructor() { // åˆå§‹åŒ–å¼•æ“ Laya.init(1136, 640, WebGL).then(() =\u003e { this.init() }) } init() { // è®¾ç½®é€‚é…æ¨¡å¼ Laya.stage.scaleMode = Laya.Stage.SCALE_FIXED_AUTO; Laya.stage.screenMode = Laya.Stage.SCREEN_HORIZONTAL; // åŠ è½½èµ„æº this.loadResources(); } loadResources() { Laya.loader.load([ \"res/atlas/ui.atlas\", \"res/scene/scene.json\", \"res/character/player.json\" ], Laya.Handler.create(this, this.onLoaded)); } onLoaded() { // åˆ›å»ºæ¸¸æˆåœºæ™¯ this.gameScene = new GameScene(); Laya.stage.addChild(this.gameScene); // å¯åŠ¨æ¸¸æˆå¾ªç¯ this.startGameLoop(); } startGameLoop() { Laya.timer.frameLoop(1, this, this.update); } update() { // æ¸¸æˆé€»è¾‘æ›´æ–° this.gameScene.update(); } } // å¯åŠ¨æ¸¸æˆ new GameMain(); Cocos Creator 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 // Cocos Creator æ¸¸æˆè„šæœ¬ import { _decorator, Component, Node, input, Input, EventTouch, Vec3 } from 'cc'; const { ccclass, property } = _decorator; @ccclass('PlayerController') export class PlayerController extends Component { @property(Node) playerNode: Node = null!; @property moveSpeed: number = 300; private _moveDir: Vec3 = new Vec3(); onLoad() { // åˆå§‹åŒ–è¾“å…¥ç³»ç»Ÿ input.on(Input.EventType.TOUCH_START, this.onTouchStart, this); input.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this); input.on(Input.EventType.TOUCH_END, this.onTouchEnd, this); } onTouchStart(event: EventTouch) { // è·å–è§¦æ‘¸ä½ç½® const touchPos = event.getUILocation(); this.updateMoveDirection(touchPos); } onTouchMove(event: EventTouch) { const touchPos = event.getUILocation(); this.updateMoveDirection(touchPos); } onTouchEnd() { this._moveDir.set(0, 0, 0); } private updateMoveDirection(touchPos: Vec3) { const playerPos = this.playerNode.position; const dir = new Vec3( touchPos.x - playerPos.x, touchPos.y - playerPos.y, 0 ); Vec3.normalize(dir, dir); this._moveDir = dir; } update(deltaTime: number) { if (this._moveDir.lengthSquared() \u003e 0) { const movement = new Vec3(); Vec3.multiplyScalar(movement, this._moveDir, this.moveSpeed * deltaTime); const newPos = this.playerNode.position.clone(); Vec3.add(newPos, newPos, movement); this.playerNode.position = newPos; } } onDestroy() { input.off(Input.EventType.TOUCH_START, this.onTouchStart, this); input.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this); input.off(Input.EventType.TOUCH_END, this.onTouchEnd); } } æ¸¸æˆæ€§èƒ½ä¼˜åŒ– å¯¹è±¡æ± ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 // å¯¹è±¡æ± å®ç° class ObjectPool { constructor(createFn, resetFn, maxSize = 50) { this.createFn = createFn; this.resetFn = resetFn; this.maxSize = maxSize; this.pool = []; } get() { if (this.pool.length \u003e 0) { return this.pool.pop(); } else { return this.createFn(); } } put(obj) { if (this.pool.length \u003c this.maxSize) { this.resetFn(obj); this.pool.push(obj); } } clear() { this.pool = []; } } // å­å¼¹å¯¹è±¡æ± ä½¿ç”¨ç¤ºä¾‹ class BulletManager { constructor() { this.bulletPool = new ObjectPool( // åˆ›å»ºå‡½æ•° () =\u003e { const bullet = new Laya.Sprite(); bullet.graphics.drawCircle(0, 0, 5, \"#ff0000\"); return bullet; }, // é‡ç½®å‡½æ•° (bullet) =\u003e { bullet.removeSelf(); bullet.active = false; } ); this.activeBullets = []; } createBullet(x, y, direction, speed) { const bullet = this.bulletPool.get(); bullet.pos(x, y); bullet.active = true; bullet.direction = direction; bullet.speed = speed; this.activeBullets.push(bullet); Laya.stage.addChild(bullet); } update() { for (let i = this.activeBullets.length - 1; i \u003e= 0; i--) { const bullet = this.activeBullets[i]; // æ›´æ–°ä½ç½® bullet.x += bullet.direction.x * bullet.speed; bullet.y += bullet.direction.y * bullet.speed; // æ£€æŸ¥æ˜¯å¦è¶…å‡ºå±å¹• if (bullet.x \u003c -50 || bullet.x \u003e Laya.stage.width + 50 || bullet.y \u003c -50 || bullet.y \u003e Laya.stage.height + 50) { this.removeBullet(bullet); } } } removeBullet(bullet) { const index = this.activeBullets.indexOf(bullet); if (index \u003e -1) { this.activeBullets.splice(index, 1); this.bulletPool.put(bullet); } } } èµ„æºåŠ è½½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 // èµ„æºåŠ è½½ç®¡ç†å™¨ class ResourceManager { constructor() { this.loadedResources = new Map(); this.loadingPromises = new Map(); } // é¢„åŠ è½½èµ„æº async preloadResources(resourceList) { const groups = this.groupResources(resourceList); for (const group of groups) { await this.loadResourceGroup(group); } } // åˆ†ç»„èµ„æºï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ groupResources(resources) { const critical = []; const important = []; const optional = []; resources.forEach(resource =\u003e { switch (resource.priority) { case 'critical': critical.push(resource); break; case 'important': important.push(resource); break; case 'optional': optional.push(resource); break; } }); return [critical, important, optional]; } // åŠ è½½èµ„æºç»„ async loadResourceGroup(group) { const promises = group.map(resource =\u003e this.loadResource(resource)); return Promise.all(promises); } // åŠ è½½å•ä¸ªèµ„æº async loadResource(resource) { if (this.loadedResources.has(resource.url)) { return this.loadedResources.get(resource.url); } if (this.loadingPromises.has(resource.url)) { return this.loadingPromises.get(resource.url); } const promise = this.doLoadResource(resource); this.loadingPromises.set(resource.url, promise); try { const result = await promise; this.loadedResources.set(resource.url, result); return result; } finally { this.loadingPromises.delete(resource.url); } } // å®é™…åŠ è½½é€»è¾‘ async doLoadResource(resource) { return new Promise((resolve, reject) =\u003e { Laya.loader.load(resource.url, Laya.Handler.create(this, resolve), null, resource.type); }); } // é‡Šæ”¾æœªä½¿ç”¨èµ„æº releaseUnusedResources() { // å®ç°èµ„æºé‡Šæ”¾é€»è¾‘ Laya.loader.clearRes(); } } å¹¿å‘Šå˜ç°ç­–ç•¥ å¾®ä¿¡å°æ¸¸æˆå¹¿å‘Šç³»ç»Ÿé›†æˆ Bannerå¹¿å‘Š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 // Bannerå¹¿å‘Šç®¡ç†å™¨ class BannerAdManager { constructor() { this.bannerAd = null; this.bannerAdUnitId = 'adunit-xxxxx'; // æ›¿æ¢ä¸ºå®é™…å¹¿å‘Šä½ID this.isShowing = false; this.retryCount = 0; this.maxRetryCount = 3; } init() { // åˆ›å»ºBannerå¹¿å‘Š this.bannerAd = wx.createBannerAd({ adUnitId: this.bannerAdUnitId, style: { left: 0, top: wx.getSystemInfoSync().windowHeight - 100, width: wx.getSystemInfoSync().windowWidth } }); // ç›‘å¬å¹¿å‘ŠåŠ è½½ this.bannerAd.onLoad(() =\u003e { console.log('Bannerå¹¿å‘ŠåŠ è½½æˆåŠŸ'); this.retryCount = 0; }); // ç›‘å¬å¹¿å‘Šé”™è¯¯ this.bannerAd.onError((err) =\u003e { console.error('Bannerå¹¿å‘ŠåŠ è½½å¤±è´¥:', err); this.retryLoad(); }); // ç›‘å¬å¹¿å‘Šå…³é—­ this.bannerAd.onClose(() =\u003e { console.log('Bannerå¹¿å‘Šå…³é—­'); this.isShowing = false; }); } show() { if (this.bannerAd \u0026\u0026 !this.isShowing) { this.bannerAd.show().then(() =\u003e { this.isShowing = true; }).catch(err =\u003e { console.error('Bannerå¹¿å‘Šæ˜¾ç¤ºå¤±è´¥:', err); }); } } hide() { if (this.bannerAd \u0026\u0026 this.isShowing) { this.bannerAd.hide(); this.isShowing = false; } } destroy() { if (this.bannerAd) { this.bannerAd.destroy(); this.bannerAd = null; } } retryLoad() { if (this.retryCount \u003c this.maxRetryCount) { this.retryCount++; setTimeout(() =\u003e { this.init(); }, 2000 * this.retryCount); } } } æ¿€åŠ±è§†é¢‘å¹¿å‘Š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 // æ¿€åŠ±è§†é¢‘å¹¿å‘Šç®¡ç†å™¨ class RewardedVideoAdManager { constructor() { this.rewardedVideoAd = null; this.adUnitId = 'adunit-yyyyy'; // æ›¿æ¢ä¸ºå®é™…å¹¿å‘Šä½ID this.isLoaded = false; this.loadPromise = null; this.watchCallback = null; } init() { this.rewardedVideoAd = wx.createRewardedVideoAd({ adUnitId: this.adUnitId }); this.setupEventListeners(); this.loadAd(); } setupEventListeners() { // å¹¿å‘ŠåŠ è½½æˆåŠŸ this.rewardedVideoAd.onLoad(() =\u003e { console.log('æ¿€åŠ±è§†é¢‘å¹¿å‘ŠåŠ è½½æˆåŠŸ'); this.isLoaded = true; this.loadPromise = null; }); // å¹¿å‘ŠåŠ è½½å¤±è´¥ this.rewardedVideoAd.onError((err) =\u003e { console.error('æ¿€åŠ±è§†é¢‘å¹¿å‘ŠåŠ è½½å¤±è´¥:', err); this.isLoaded = false; this.loadPromise = null; // é€šçŸ¥å›è°ƒå¤±è´¥ if (this.watchCallback) { this.watchCallback({ success: false, error: err }); this.watchCallback = null; } }); // å¹¿å‘Šå…³é—­ this.rewardedVideoAd.onClose((res) =\u003e { console.log('æ¿€åŠ±è§†é¢‘å¹¿å‘Šå…³é—­', res); // é¢„åŠ è½½ä¸‹ä¸€ä¸ªå¹¿å‘Š this.loadAd(); // é€šçŸ¥å›è°ƒç»“æœ if (this.watchCallback) { this.watchCallback({ success: res.isEnded || res.ended, rewarded: res.isEnded || res.ended }); this.watchCallback = null; } }); } async loadAd() { if (this.loadPromise) { return this.loadPromise; } this.loadPromise = new Promise((resolve) =\u003e { this.rewardedVideoAd.load().then(() =\u003e { resolve(); }).catch(() =\u003e { resolve(); }); }); return this.loadPromise; } // è§‚çœ‹å¹¿å‘Š async watchAd() { return new Promise((resolve) =\u003e { if (this.watchCallback) { resolve({ success: false, error: 'å¹¿å‘Šæ­£åœ¨æ’­æ”¾ä¸­' }); return; } if (!this.isLoaded) { resolve({ success: false, error: 'å¹¿å‘ŠæœªåŠ è½½å®Œæˆ' }); return; } this.watchCallback = resolve; this.rewardedVideoAd.show() .catch(err =\u003e { this.watchCallback = null; resolve({ success: false, error: err }); }); }); } } æ’å±å¹¿å‘Š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 // æ’å±å¹¿å‘Šç®¡ç†å™¨ class InterstitialAdManager { constructor() { this.interstitialAd = null; this.adUnitId = 'adunit-zzzzz'; // æ›¿æ¢ä¸ºå®é™…å¹¿å‘Šä½ID this.isLoaded = false; this.lastShowTime = 0; this.minInterval = 30000; // æœ€å°é—´éš”30ç§’ } init() { this.interstitialAd = wx.createInterstitialAd({ adUnitId: this.adUnitId }); this.interstitialAd.onLoad(() =\u003e { console.log('æ’å±å¹¿å‘ŠåŠ è½½æˆåŠŸ'); this.isLoaded = true; }); this.interstitialAd.onError((err) =\u003e { console.error('æ’å±å¹¿å‘ŠåŠ è½½å¤±è´¥:', err); this.isLoaded = false; }); this.interstitialAd.onClose(() =\u003e { console.log('æ’å±å¹¿å‘Šå…³é—­'); this.isLoaded = false; // å»¶è¿Ÿé‡æ–°åŠ è½½ setTimeout(() =\u003e { this.loadAd(); }, 5000); }); this.loadAd(); } loadAd() { if (!this.isLoaded) { this.interstitialAd.load(); } } // æ˜¾ç¤ºæ’å±å¹¿å‘Š show() { const now = Date.now(); // æ£€æŸ¥æ—¶é—´é—´éš” if (now - this.lastShowTime \u003c this.minInterval) { console.log('æ’å±å¹¿å‘Šé—´éš”æ—¶é—´æœªåˆ°'); return false; } if (this.isLoaded) { this.interstitialAd.show() .then(() =\u003e { this.lastShowTime = now; console.log('æ’å±å¹¿å‘Šæ˜¾ç¤ºæˆåŠŸ'); return true; }) .catch(err =\u003e { console.error('æ’å±å¹¿å‘Šæ˜¾ç¤ºå¤±è´¥:', err); return false; }); } else { console.log('æ’å±å¹¿å‘ŠæœªåŠ è½½å®Œæˆ'); return false; } } } å†…è´­ç³»ç»Ÿè®¾è®¡ è™šæ‹Ÿå•†å“ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 // å•†åº—ç³»ç»Ÿ class GameStore { constructor() { this.products = [ { id: 'coin_100', name: '100é‡‘å¸', price: 6, // 6å…ƒ description: 'è·å¾—100é‡‘å¸ï¼Œå¯ç”¨äºè´­ä¹°é“å…·', icon: 'res/icons/coin_100.png', type: 'consumable' }, { id: 'remove_ads', name: 'å»å¹¿å‘Š', price: 12, description: 'æ°¸ä¹…ç§»é™¤æ‰€æœ‰å¹¿å‘Š', icon: 'res/icons/no_ads.png', type: 'permanent' }, { id: 'vip_month', name: 'æœˆåº¦VIP', price: 18, description: '30å¤©VIPç‰¹æƒï¼Œäº«åŒå€å¥–åŠ±', icon: 'res/icons/vip.png', type: 'subscription', duration: 30 * 24 * 60 * 60 * 1000 // 30å¤© } ]; this.purchasedItems = new Map(); this.initPayment(); } initPayment() { // åˆå§‹åŒ–æ”¯ä»˜ç³»ç»Ÿ if (wx.requestPayment) { this.paymentProvider = 'wechat'; } else { console.error('æ”¯ä»˜ç³»ç»Ÿä¸å¯ç”¨'); } } // è·å–å•†å“åˆ—è¡¨ getProducts() { return this.products; } // è´­ä¹°å•†å“ async purchaseProduct(productId) { const product = this.products.find(p =\u003e p.id === productId); if (!product) { throw new Error('å•†å“ä¸å­˜åœ¨'); } // æ£€æŸ¥æ˜¯å¦å·²è´­ä¹°æ°¸ä¹…å•†å“ if (product.type === 'permanent' \u0026\u0026 this.isProductPurchased(productId)) { throw new Error('è¯¥å•†å“å·²è´­ä¹°'); } try { // å‘èµ·æ”¯ä»˜ await this.requestPayment(product); // æ”¯ä»˜æˆåŠŸï¼Œå¤„ç†è´­ä¹°é€»è¾‘ await this.processPurchase(product); return { success: true, product }; } catch (error) { console.error('è´­ä¹°å¤±è´¥:', error); return { success: false, error: error.message }; } } // å‘èµ·æ”¯ä»˜è¯·æ±‚ async requestPayment(product) { // è·å–æ”¯ä»˜å‚æ•° const paymentParams = await this.getPaymentParams(product); return new Promise((resolve, reject) =\u003e { wx.requestPayment({ ...paymentParams, success: resolve, fail: reject }); }); } // è·å–æ”¯ä»˜å‚æ•° async getPaymentParams(product) { // è°ƒç”¨åç«¯APIè·å–æ”¯ä»˜å‚æ•° const response = await wx.request({ url: 'https://api.example.com/payment/create', method: 'POST', data: { productId: product.id, price: product.price, userId: wx.getStorageSync('userId') } }); return response.data; } // å¤„ç†è´­ä¹°ç»“æœ async processPurchase(product) { const purchaseInfo = { productId: product.id, purchaseTime: Date.now(), type: product.type }; switch (product.type) { case 'consumable': // æ¶ˆè€—å“ï¼Œç«‹å³ç»™äºˆå¥–åŠ± this.grantRewards(product); break; case 'permanent': // æ°¸ä¹…å•†å“ï¼Œè®°å½•è´­ä¹°çŠ¶æ€ this.purchasedItems.set(product.id, purchaseInfo); this.savePurchasedItems(); break; case 'subscription': // è®¢é˜…å•†å“ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ purchaseInfo.expireTime = Date.now() + product.duration; this.purchasedItems.set(product.id, purchaseInfo); this.savePurchasedItems(); break; } // è§¦å‘è´­ä¹°äº‹ä»¶ this.triggerPurchaseEvent(product); } // ç»™äºˆå¥–åŠ± grantRewards(product) { switch (product.id) { case 'coin_100': // å¢åŠ 100é‡‘å¸ gameManager.addCoins(100); break; case 'remove_ads': // ç§»é™¤å¹¿å‘Š adManager.removeAllAds(); break; } } // æ£€æŸ¥å•†å“æ˜¯å¦å·²è´­ä¹° isProductPurchased(productId) { const purchase = this.purchasedItems.get(productId); if (!purchase) return false; if (purchase.type === 'subscription') { // æ£€æŸ¥è®¢é˜…æ˜¯å¦è¿‡æœŸ return Date.now() \u003c purchase.expireTime; } return true; } // è·å–è´­ä¹°çŠ¶æ€ getPurchaseStatus() { const status = {}; this.purchasedItems.forEach((purchase, productId) =\u003e { status[productId] = { purchased: this.isProductPurchased(productId), purchaseTime: purchase.purchaseTime, expireTime: purchase.expireTime }; }); return status; } // ä¿å­˜è´­ä¹°è®°å½• savePurchasedItems() { const data = Array.from(this.purchasedItems.entries()); wx.setStorageSync('purchasedItems', data); } // åŠ è½½è´­ä¹°è®°å½• loadPurchasedItems() { const data = wx.getStorageSync('purchasedItems') || []; this.purchasedItems = new Map(data); } // è§¦å‘è´­ä¹°äº‹ä»¶ triggerPurchaseEvent(product) { // æ•°æ®ç»Ÿè®¡ wx.reportAnalytics('purchase', { product_id: product.id, price: product.price, timestamp: Date.now() }); // æ¸¸æˆå†…äº‹ä»¶ gameManager.eventSystem.emit('product_purchased', product); } } ç”¨æˆ·ç•™å­˜ä¸å¢é•¿ æ¸¸æˆæ•°æ®åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 // æ¸¸æˆæ•°æ®åˆ†æç³»ç»Ÿ class GameAnalytics { constructor() { this.sessionStartTime = Date.now(); this.sessionId = this.generateSessionId(); this.customEvents = []; this.levelProgress = new Map(); } // ç”Ÿæˆä¼šè¯ID generateSessionId() { return Date.now().toString(36) + Math.random().toString(36).substr(2); } // è®°å½•æ¸¸æˆå¼€å§‹ trackGameStart() { const event = { eventName: 'game_start', timestamp: Date.now(), sessionId: this.sessionId, properties: { deviceInfo: wx.getSystemInfoSync(), isNewPlayer: this.isNewPlayer(), lastPlayTime: wx.getStorageSync('lastPlayTime') || null } }; this.reportEvent(event); } // è®°å½•æ¸¸æˆç»“æŸ trackGameEnd(properties = {}) { const sessionDuration = Date.now() - this.sessionStartTime; const event = { eventName: 'game_end', timestamp: Date.now(), sessionId: this.sessionId, properties: { sessionDuration, level: properties.level || 1, score: properties.score || 0, reason: properties.reason || 'normal' } }; this.reportEvent(event); // ä¿å­˜æ¸¸æˆæ—¶é•¿ this.savePlaytime(sessionDuration); } // è®°å½•å…³å¡è¿›åº¦ trackLevelStart(levelId) { const event = { eventName: 'level_start', timestamp: Date.now(), sessionId: this.sessionId, properties: { levelId, attempts: this.getLevelAttempts(levelId) } }; this.reportEvent(event); } trackLevelComplete(levelId, properties = {}) { const attempts = this.getLevelAttempts(levelId); const event = { eventName: 'level_complete', timestamp: Date.now(), sessionId: this.sessionId, properties: { levelId, attempts, duration: properties.duration, stars: properties.stars || 0, score: properties.score || 0 } }; this.reportEvent(event); // æ›´æ–°å…³å¡è¿›åº¦ this.updateLevelProgress(levelId, 'complete'); } trackLevelFail(levelId, properties = {}) { const attempts = this.getLevelAttempts(levelId); const event = { eventName: 'level_fail', timestamp: Date.now(), sessionId: this.sessionId, properties: { levelId, attempts, reason: properties.reason || 'timeout', progress: properties.progress || 0 } }; this.reportEvent(event); // æ›´æ–°å…³å¡è¿›åº¦ this.updateLevelProgress(levelId, 'fail'); } // è®°å½•å¹¿å‘Šè§‚çœ‹ trackAdWatch(adType, result) { const event = { eventName: 'ad_watch', timestamp: Date.now(), sessionId: this.sessionId, properties: { adType, // 'banner', 'interstitial', 'rewarded' result, // 'completed', 'skipped', 'failed' placement: this.getCurrentPlacement() } }; this.reportEvent(event); } // è®°å½•å†…è´­è¡Œä¸º trackPurchase(productId, price, result) { const event = { eventName: 'purchase', timestamp: Date.now(), sessionId: this.sessionId, properties: { productId, price, result, // 'success', 'failed', 'cancelled' level: this.getCurrentLevel() } }; this.reportEvent(event); } // è®°å½•è‡ªå®šä¹‰äº‹ä»¶ trackCustomEvent(eventName, properties = {}) { const event = { eventName, timestamp: Date.now(), sessionId: this.sessionId, properties }; this.customEvents.push(event); this.reportEvent(event); } // ä¸ŠæŠ¥äº‹ä»¶åˆ°æœåŠ¡å™¨ async reportEvent(event) { try { await wx.request({ url: 'https://api.example.com/analytics/events', method: 'POST', data: { events: [event], userId: wx.getStorageSync('userId'), appId: wx.getAccountInfoSync().miniProgram.appId } }); } catch (error) { console.error('äº‹ä»¶ä¸ŠæŠ¥å¤±è´¥:', error); // æœ¬åœ°ç¼“å­˜ï¼Œç¨åé‡è¯• this.cacheEvent(event); } } // ç¼“å­˜äº‹ä»¶ cacheEvent(event) { const cachedEvents = wx.getStorageSync('cachedEvents') || []; cachedEvents.push(event); // é™åˆ¶ç¼“å­˜å¤§å° if (cachedEvents.length \u003e 100) { cachedEvents.shift(); } wx.setStorageSync('cachedEvents', cachedEvents); } // é‡è¯•ä¸ŠæŠ¥ç¼“å­˜çš„äº‹ä»¶ async retryCachedEvents() { const cachedEvents = wx.getStorageSync('cachedEvents') || []; if (cachedEvents.length === 0) return; try { await wx.request({ url: 'https://api.example.com/analytics/events', method: 'POST', data: { events: cachedEvents, userId: wx.getStorageSync('userId'), appId: wx.getAccountInfoSync().miniProgram.appId } }); // æ¸…ç©ºç¼“å­˜ wx.removeStorageSync('cachedEvents'); } catch (error) { console.error('ç¼“å­˜äº‹ä»¶ä¸ŠæŠ¥å¤±è´¥:', error); } } // è·å–å…³å¡å°è¯•æ¬¡æ•° getLevelAttempts(levelId) { const key = `level_attempts_${levelId}`; return wx.getStorageSync(key) || 0; } // å¢åŠ å…³å¡å°è¯•æ¬¡æ•° incrementLevelAttempts(levelId) { const key = `level_attempts_${levelId}`; const attempts = this.getLevelAttempts(levelId); wx.setStorageSync(key, attempts + 1); } // æ›´æ–°å…³å¡è¿›åº¦ updateLevelProgress(levelId, status) { if (!this.levelProgress.has(levelId)) { this.levelProgress.set(levelId, { attempts: 0, bestScore: 0, completed: false, completedAt: null }); } const progress = this.levelProgress.get(levelId); progress.attempts++; if (status === 'complete' \u0026\u0026 !progress.completed) { progress.completed = true; progress.completedAt = Date.now(); } wx.setStorageSync('levelProgress', Array.from(this.levelProgress.entries())); } // æ£€æŸ¥æ˜¯å¦ä¸ºæ–°ç©å®¶ isNewPlayer() { return !wx.getStorageSync('hasPlayedBefore'); } // ä¿å­˜æ¸¸æˆæ—¶é•¿ savePlaytime(duration) { const today = new Date().toDateString(); const playtimeData = wx.getStorageSync('playtimeData') || {}; if (!playtimeData[today]) { playtimeData[today] = 0; } playtimeData[today] += duration; wx.setStorageSync('playtimeData', playtimeData); wx.setStorageSync('lastPlayTime', Date.now()); wx.setStorageSync('hasPlayedBefore', true); } // è·å–å½“å‰å…³å¡ getCurrentLevel() { return wx.getStorageSync('currentLevel') || 1; } // è·å–å½“å‰å¹¿å‘Šä½ getCurrentPlacement() { return wx.getStorageSync('currentPlacement') || 'unknown'; } } A/Bæµ‹è¯•ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 // A/Bæµ‹è¯•ç®¡ç†å™¨ class ABTestManager { constructor() { this.experiments = new Map(); this.userVariant = new Map(); this.loadExperiments(); } // åŠ è½½å®éªŒé…ç½® async loadExperiments() { try { const response = await wx.request({ url: 'https://api.example.com/abtest/experiments', method: 'GET' }); response.data.forEach(experiment =\u003e { this.experiments.set(experiment.id, experiment); }); // ä¸ºç”¨æˆ·åˆ†é…å®éªŒç»„ this.assignUserToExperiments(); } catch (error) { console.error('åŠ è½½A/Bæµ‹è¯•é…ç½®å¤±è´¥:', error); } } // ä¸ºç”¨æˆ·åˆ†é…å®éªŒç»„ assignUserToExperiments() { const userId = wx.getStorageSync('userId') || this.generateUserId(); wx.setStorageSync('userId', userId); this.experiments.forEach((experiment, expId) =\u003e { if (!this.userVariant.has(expId)) { const variant = this.assignVariant(experiment, userId); this.userVariant.set(expId, variant); // è®°å½•åˆ†ç»„äº‹ä»¶ this.trackExperimentAssignment(expId, variant); } }); // ä¿å­˜åˆ†ç»„ç»“æœ this.saveUserVariants(); } // åˆ†é…å˜ä½“ assignVariant(experiment, userId) { const hash = this.hashString(userId + experiment.id); const ratio = hash / 0xFFFFFFFF; let cumulativeRatio = 0; for (const variant of experiment.variants) { cumulativeRatio += variant.ratio; if (ratio \u003c= cumulativeRatio) { return variant.id; } } // é»˜è®¤è¿”å›ç¬¬ä¸€ä¸ªå˜ä½“ return experiment.variants[0].id; } // å­—ç¬¦ä¸²å“ˆå¸Œ hashString(str) { let hash = 0; for (let i = 0; i \u003c str.length; i++) { const char = str.charCodeAt(i); hash = ((hash \u003c\u003c 5) - hash) + char; hash = hash \u0026 hash; } return Math.abs(hash); } // ç”Ÿæˆç”¨æˆ·ID generateUserId() { return Date.now().toString(36) + Math.random().toString(36).substr(2); } // è·å–å®éªŒå˜ä½“ getVariant(experimentId) { return this.userVariant.get(experimentId); } // æ£€æŸ¥æ˜¯å¦åœ¨å®éªŒä¸­ isInExperiment(experimentId, variantId) { const userVariant = this.getVariant(experimentId); return userVariant === variantId; } // åº”ç”¨å®éªŒé…ç½® applyExperimentConfig(experimentId, defaultValue) { const variant = this.getVariant(experimentId); const experiment = this.experiments.get(experimentId); if (!experiment || !variant) { return defaultValue; } const variantConfig = experiment.variants.find(v =\u003e v.id === variant); return variantConfig ? variantConfig.config : defaultValue; } // è®°å½•å®éªŒåˆ†ç»„ trackExperimentAssignment(experimentId, variant) { wx.reportAnalytics('experiment_assignment', { experiment_id: experimentId, variant: variant, timestamp: Date.now() }); } // è®°å½•å®éªŒç»“æœ trackExperimentResult(experimentId, metric, value) { const variant = this.getVariant(experimentId); wx.reportAnalytics('experiment_result', { experiment_id: experimentId, variant: variant, metric: metric, value: value, timestamp: Date.now() }); } // ä¿å­˜ç”¨æˆ·åˆ†ç»„ saveUserVariants() { const data = Array.from(this.userVariant.entries()); wx.setStorageSync('abtest_variants', data); } // åŠ è½½ç”¨æˆ·åˆ†ç»„ loadUserVariants() { const data = wx.getStorageSync('abtest_variants') || []; this.userVariant = new Map(data); } } æ€»ç»“ å°æ¸¸æˆå¼€å‘ä¸å˜ç°éœ€è¦ç»¼åˆè€ƒé‡å¤šä¸ªæ–¹é¢ï¼š\næŠ€æœ¯å®ç°ï¼š\né€‰æ‹©åˆé€‚çš„æ¸¸æˆå¼•æ“å’Œå¼€å‘æ¡†æ¶ å®ç°é«˜æ•ˆçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ å»ºç«‹å®Œå–„çš„èµ„æºç®¡ç†ç³»ç»Ÿ å˜ç°æ¨¡å¼ï¼š\nå¤šå…ƒåŒ–å¹¿å‘Šç³»ç»Ÿé›†æˆ åˆç†çš„å†…è´­æœºåˆ¶è®¾è®¡ æŒç»­çš„ç”¨æˆ·ä»·å€¼æŒ–æ˜ ç”¨æˆ·è¿è¥ï¼š\næ·±åº¦çš„æ•°æ®åˆ†æå’Œç›‘æ§ A/Bæµ‹è¯•é©±åŠ¨çš„äº§å“ä¼˜åŒ– ç”¨æˆ·ç•™å­˜å’Œå¢é•¿ç­–ç•¥ å•†ä¸šåŒ–æˆåŠŸè¦ç´ ï¼š\nä¼˜è´¨çš„æ¸¸æˆå†…å®¹å’Œä½“éªŒ åˆç†çš„å˜ç°èŠ‚å¥å’Œç­–ç•¥ ç²¾ç»†åŒ–çš„è¿è¥å’Œä¼˜åŒ– é€šè¿‡ç³»ç»ŸåŒ–çš„å¼€å‘å’Œè¿è¥ç­–ç•¥ï¼Œå°æ¸¸æˆå¯ä»¥å®ç°å•†ä¸šæˆåŠŸï¼Œä¸ºç”¨æˆ·åˆ›é€ ä»·å€¼çš„åŒæ—¶è·å¾—æŒç»­æ”¶ç›Šã€‚\nç›¸å…³èµ„æºï¼š\nå¾®ä¿¡å°æ¸¸æˆå®˜æ–¹æ–‡æ¡£ LayaAirå®˜æ–¹æ–‡æ¡£ Cocos Creatorå®˜æ–¹æ–‡æ¡£ å°æ¸¸æˆæ•°æ®åˆ†ææŒ‡å— ","wordCount":"3431","inLanguage":"zh-cn","datePublished":"2025-12-20T12:00:00+08:00","dateModified":"2025-12-20T12:00:00+08:00","author":{"@type":"Person","name":"Util Tech Team"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/mini-game-development-monetization/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">å°æ¸¸æˆå¼€å‘ä¸å˜ç°å®Œå…¨æŒ‡å—ï¼šä»åˆ›æ„åˆ°ç›ˆåˆ©çš„å®æˆ˜æ‰‹å†Œ</h1><div class=post-description>æœ¬æ–‡å…¨é¢ä»‹ç»å°æ¸¸æˆå¼€å‘çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æŠ€æœ¯å®ç°ã€å¹¿å‘Šç³»ç»Ÿé›†æˆã€å†…è´­è®¾è®¡ã€ç”¨æˆ·å¢é•¿ç­‰å…³é”®ç¯èŠ‚ã€‚</div><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/ class=category-link>æ¸¸æˆå¼€å‘</a><a href=/blog/categories/%E5%95%86%E4%B8%9A%E5%8C%96/ class=category-link>å•†ä¸šåŒ–</a></div><span class=post-date>2025-12-20</span><span class=post-author>Util Tech Team</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><h2 id=å¼•è¨€>å¼•è¨€<a hidden class=anchor aria-hidden=true href=#å¼•è¨€>#</a></h2><p>å°æ¸¸æˆå¸‚åœºåœ¨2024å¹´ç»§ç»­è“¬å‹ƒå‘å±•ï¼Œå¾®ä¿¡å°æ¸¸æˆæœˆæ´»è·ƒç”¨æˆ·çªç ´4äº¿ï¼Œå°æ¸¸æˆå¸‚åœºè§„æ¨¡è¾¾åˆ°500äº¿å…ƒã€‚éšç€å¼€å‘é—¨æ§›é™ä½å’Œå˜ç°æ¸ é“å¤šæ ·åŒ–ï¼Œè¶Šæ¥è¶Šå¤šå¼€å‘è€…æ¶Œå…¥è¿™ä¸ªé¢†åŸŸã€‚æœ¬æ–‡å°†ä»æŠ€æœ¯å®ç°ã€å•†ä¸šæ¨¡å¼ã€ç”¨æˆ·è¿è¥ç­‰å¤šä¸ªç»´åº¦ï¼Œå…¨é¢è§£æå°æ¸¸æˆå¼€å‘ä¸å˜ç°çš„ç­–ç•¥ã€‚</p><h2 id=å°æ¸¸æˆæŠ€æœ¯æ¶æ„>å°æ¸¸æˆæŠ€æœ¯æ¶æ„<a hidden class=anchor aria-hidden=true href=#å°æ¸¸æˆæŠ€æœ¯æ¶æ„>#</a></h2><h3 id=æŠ€æœ¯æ ˆé€‰æ‹©>æŠ€æœ¯æ ˆé€‰æ‹©<a hidden class=anchor aria-hidden=true href=#æŠ€æœ¯æ ˆé€‰æ‹©>#</a></h3><h4 id=layaairå¼•æ“>LayaAirå¼•æ“<a hidden class=anchor aria-hidden=true href=#layaairå¼•æ“>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// LayaAir 2.x æ¸¸æˆåˆå§‹åŒ–
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> GameMain {
</span></span><span style=display:flex><span>    constructor() {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// åˆå§‹åŒ–å¼•æ“
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        Laya.init(<span style=color:#a5d6ff>1136</span>, <span style=color:#a5d6ff>640</span>, WebGL).then(() =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.init()
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    init() {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// è®¾ç½®é€‚é…æ¨¡å¼
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        Laya.stage.scaleMode <span style=color:#ff7b72;font-weight:700>=</span> Laya.Stage.SCALE_FIXED_AUTO;
</span></span><span style=display:flex><span>        Laya.stage.screenMode <span style=color:#ff7b72;font-weight:700>=</span> Laya.Stage.SCREEN_HORIZONTAL;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// åŠ è½½èµ„æº
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.loadResources();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    loadResources() {
</span></span><span style=display:flex><span>        Laya.loader.load([
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;res/atlas/ui.atlas&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;res/scene/scene.json&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;res/character/player.json&#34;</span>
</span></span><span style=display:flex><span>        ], Laya.Handler.create(<span style=color:#ff7b72>this</span>, <span style=color:#ff7b72>this</span>.onLoaded));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    onLoaded() {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// åˆ›å»ºæ¸¸æˆåœºæ™¯
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.gameScene <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> GameScene();
</span></span><span style=display:flex><span>        Laya.stage.addChild(<span style=color:#ff7b72>this</span>.gameScene);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// å¯åŠ¨æ¸¸æˆå¾ªç¯
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.startGameLoop();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    startGameLoop() {
</span></span><span style=display:flex><span>        Laya.timer.frameLoop(<span style=color:#a5d6ff>1</span>, <span style=color:#ff7b72>this</span>, <span style=color:#ff7b72>this</span>.update);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    update() {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// æ¸¸æˆé€»è¾‘æ›´æ–°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.gameScene.update();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å¯åŠ¨æ¸¸æˆ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>new</span> GameMain();
</span></span></code></pre></td></tr></table></div></div><h4 id=cocos-creator>Cocos Creator<a hidden class=anchor aria-hidden=true href=#cocos-creator>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Cocos Creator æ¸¸æˆè„šæœ¬
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { _decorator, Component, Node, input, Input, EventTouch, Vec3 } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;cc&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> { ccclass, property } <span style=color:#ff7b72;font-weight:700>=</span> _decorator;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>@ccclass</span>(<span style=color:#a5d6ff>&#39;PlayerController&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>class</span> PlayerController <span style=color:#ff7b72>extends</span> Component {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>@property</span>(Node)
</span></span><span style=display:flex><span>    playerNode: <span style=color:#ff7b72>Node</span> <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span><span style=color:#ff7b72;font-weight:700>!</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>@property</span>
</span></span><span style=display:flex><span>    moveSpeed: <span style=color:#ff7b72>number</span> <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>300</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> _moveDir: <span style=color:#ff7b72>Vec3</span> <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Vec3();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    onLoad() {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// åˆå§‹åŒ–è¾“å…¥ç³»ç»Ÿ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        input.on(Input.EventType.TOUCH_START, <span style=color:#ff7b72>this</span>.onTouchStart, <span style=color:#ff7b72>this</span>);
</span></span><span style=display:flex><span>        input.on(Input.EventType.TOUCH_MOVE, <span style=color:#ff7b72>this</span>.onTouchMove, <span style=color:#ff7b72>this</span>);
</span></span><span style=display:flex><span>        input.on(Input.EventType.TOUCH_END, <span style=color:#ff7b72>this</span>.onTouchEnd, <span style=color:#ff7b72>this</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    onTouchStart(event: <span style=color:#ff7b72>EventTouch</span>) {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// è·å–è§¦æ‘¸ä½ç½®
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>const</span> touchPos <span style=color:#ff7b72;font-weight:700>=</span> event.getUILocation();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.updateMoveDirection(touchPos);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    onTouchMove(event: <span style=color:#ff7b72>EventTouch</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> touchPos <span style=color:#ff7b72;font-weight:700>=</span> event.getUILocation();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.updateMoveDirection(touchPos);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    onTouchEnd() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>._moveDir.<span style=color:#ff7b72>set</span>(<span style=color:#a5d6ff>0</span>, <span style=color:#a5d6ff>0</span>, <span style=color:#a5d6ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> updateMoveDirection(touchPos: <span style=color:#ff7b72>Vec3</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> playerPos <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.playerNode.position;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> dir <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Vec3(
</span></span><span style=display:flex><span>            touchPos.x <span style=color:#ff7b72;font-weight:700>-</span> playerPos.x,
</span></span><span style=display:flex><span>            touchPos.y <span style=color:#ff7b72;font-weight:700>-</span> playerPos.y,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        Vec3.normalize(dir, dir);
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>._moveDir <span style=color:#ff7b72;font-weight:700>=</span> dir;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    update(deltaTime: <span style=color:#ff7b72>number</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>._moveDir.lengthSquared() <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>const</span> movement <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Vec3();
</span></span><span style=display:flex><span>            Vec3.multiplyScalar(movement, <span style=color:#ff7b72>this</span>._moveDir, <span style=color:#ff7b72>this</span>.moveSpeed <span style=color:#ff7b72;font-weight:700>*</span> deltaTime);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>const</span> newPos <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.playerNode.position.clone();
</span></span><span style=display:flex><span>            Vec3.add(newPos, newPos, movement);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.playerNode.position <span style=color:#ff7b72;font-weight:700>=</span> newPos;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    onDestroy() {
</span></span><span style=display:flex><span>        input.off(Input.EventType.TOUCH_START, <span style=color:#ff7b72>this</span>.onTouchStart, <span style=color:#ff7b72>this</span>);
</span></span><span style=display:flex><span>        input.off(Input.EventType.TOUCH_MOVE, <span style=color:#ff7b72>this</span>.onTouchMove, <span style=color:#ff7b72>this</span>);
</span></span><span style=display:flex><span>        input.off(Input.EventType.TOUCH_END, <span style=color:#ff7b72>this</span>.onTouchEnd);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=æ¸¸æˆæ€§èƒ½ä¼˜åŒ–>æ¸¸æˆæ€§èƒ½ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#æ¸¸æˆæ€§èƒ½ä¼˜åŒ–>#</a></h3><h4 id=å¯¹è±¡æ± ç®¡ç†>å¯¹è±¡æ± ç®¡ç†<a hidden class=anchor aria-hidden=true href=#å¯¹è±¡æ± ç®¡ç†>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">84
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å¯¹è±¡æ± å®ç°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> ObjectPool {
</span></span><span style=display:flex><span>    constructor(createFn, resetFn, maxSize <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>50</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.createFn <span style=color:#ff7b72;font-weight:700>=</span> createFn;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.resetFn <span style=color:#ff7b72;font-weight:700>=</span> resetFn;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.maxSize <span style=color:#ff7b72;font-weight:700>=</span> maxSize;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.pool <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    get() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.pool.length <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.pool.pop();
</span></span><span style=display:flex><span>        } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.createFn();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    put(obj) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.pool.length <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#ff7b72>this</span>.maxSize) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.resetFn(obj);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.pool.push(obj);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    clear() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.pool <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å­å¼¹å¯¹è±¡æ± ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> BulletManager {
</span></span><span style=display:flex><span>    constructor() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.bulletPool <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> ObjectPool(
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// åˆ›å»ºå‡½æ•°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            () =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>const</span> bullet <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Laya.Sprite();
</span></span><span style=display:flex><span>                bullet.graphics.drawCircle(<span style=color:#a5d6ff>0</span>, <span style=color:#a5d6ff>0</span>, <span style=color:#a5d6ff>5</span>, <span style=color:#a5d6ff>&#34;#ff0000&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> bullet;
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// é‡ç½®å‡½æ•°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            (bullet) =&gt; {
</span></span><span style=display:flex><span>                bullet.removeSelf();
</span></span><span style=display:flex><span>                bullet.active <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.activeBullets <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    createBullet(x, y, direction, speed) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> bullet <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.bulletPool.get();
</span></span><span style=display:flex><span>        bullet.pos(x, y);
</span></span><span style=display:flex><span>        bullet.active <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>true</span>;
</span></span><span style=display:flex><span>        bullet.direction <span style=color:#ff7b72;font-weight:700>=</span> direction;
</span></span><span style=display:flex><span>        bullet.speed <span style=color:#ff7b72;font-weight:700>=</span> speed;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.activeBullets.push(bullet);
</span></span><span style=display:flex><span>        Laya.stage.addChild(bullet);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    update() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>let</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.activeBullets.length <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#a5d6ff>1</span>; i <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>0</span>; i<span style=color:#ff7b72;font-weight:700>--</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>const</span> bullet <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.activeBullets[i];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// æ›´æ–°ä½ç½®
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            bullet.x <span style=color:#ff7b72;font-weight:700>+=</span> bullet.direction.x <span style=color:#ff7b72;font-weight:700>*</span> bullet.speed;
</span></span><span style=display:flex><span>            bullet.y <span style=color:#ff7b72;font-weight:700>+=</span> bullet.direction.y <span style=color:#ff7b72;font-weight:700>*</span> bullet.speed;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥æ˜¯å¦è¶…å‡ºå±å¹•
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            <span style=color:#ff7b72>if</span> (bullet.x <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>50</span> <span style=color:#ff7b72;font-weight:700>||</span> bullet.x <span style=color:#ff7b72;font-weight:700>&gt;</span> Laya.stage.width <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>50</span> <span style=color:#ff7b72;font-weight:700>||</span>
</span></span><span style=display:flex><span>                bullet.y <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>50</span> <span style=color:#ff7b72;font-weight:700>||</span> bullet.y <span style=color:#ff7b72;font-weight:700>&gt;</span> Laya.stage.height <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>50</span>) {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.removeBullet(bullet);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    removeBullet(bullet) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> index <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.activeBullets.indexOf(bullet);
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (index <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.activeBullets.splice(index, <span style=color:#a5d6ff>1</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.bulletPool.put(bullet);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=èµ„æºåŠ è½½ä¼˜åŒ–>èµ„æºåŠ è½½ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#èµ„æºåŠ è½½ä¼˜åŒ–>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// èµ„æºåŠ è½½ç®¡ç†å™¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> ResourceManager {
</span></span><span style=display:flex><span>    constructor() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.loadedResources <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.loadingPromises <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// é¢„åŠ è½½èµ„æº
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> preloadResources(resourceList) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> groups <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.groupResources(resourceList);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> group <span style=color:#ff7b72>of</span> groups) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.loadResourceGroup(group);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// åˆ†ç»„èµ„æºï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    groupResources(resources) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> critical <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> important <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> optional <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        resources.forEach(resource =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>switch</span> (resource.priority) {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#39;critical&#39;</span><span style=color:#ff7b72;font-weight:700>:</span>
</span></span><span style=display:flex><span>                    critical.push(resource);
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#39;important&#39;</span><span style=color:#ff7b72;font-weight:700>:</span>
</span></span><span style=display:flex><span>                    important.push(resource);
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#39;optional&#39;</span><span style=color:#ff7b72;font-weight:700>:</span>
</span></span><span style=display:flex><span>                    optional.push(resource);
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> [critical, important, optional];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// åŠ è½½èµ„æºç»„
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> loadResourceGroup(group) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> promises <span style=color:#ff7b72;font-weight:700>=</span> group.map(resource =&gt; <span style=color:#ff7b72>this</span>.loadResource(resource));
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> Promise.all(promises);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// åŠ è½½å•ä¸ªèµ„æº
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> loadResource(resource) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.loadedResources.has(resource.url)) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.loadedResources.get(resource.url);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.loadingPromises.has(resource.url)) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.loadingPromises.get(resource.url);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> promise <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.doLoadResource(resource);
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.loadingPromises.set(resource.url, promise);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>const</span> result <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> promise;
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.loadedResources.set(resource.url, result);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> result;
</span></span><span style=display:flex><span>        } <span style=color:#ff7b72>finally</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.loadingPromises.<span style=color:#ff7b72>delete</span>(resource.url);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å®é™…åŠ è½½é€»è¾‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> doLoadResource(resource) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> Promise((resolve, reject) =&gt; {
</span></span><span style=display:flex><span>            Laya.loader.load(resource.url, Laya.Handler.create(<span style=color:#ff7b72>this</span>, resolve), <span style=color:#79c0ff>null</span>, resource.type);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// é‡Šæ”¾æœªä½¿ç”¨èµ„æº
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    releaseUnusedResources() {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// å®ç°èµ„æºé‡Šæ”¾é€»è¾‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        Laya.loader.clearRes();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=å¹¿å‘Šå˜ç°ç­–ç•¥>å¹¿å‘Šå˜ç°ç­–ç•¥<a hidden class=anchor aria-hidden=true href=#å¹¿å‘Šå˜ç°ç­–ç•¥>#</a></h2><h3 id=å¾®ä¿¡å°æ¸¸æˆå¹¿å‘Šç³»ç»Ÿé›†æˆ>å¾®ä¿¡å°æ¸¸æˆå¹¿å‘Šç³»ç»Ÿé›†æˆ<a hidden class=anchor aria-hidden=true href=#å¾®ä¿¡å°æ¸¸æˆå¹¿å‘Šç³»ç»Ÿé›†æˆ>#</a></h3><h4 id=bannerå¹¿å‘Š>Bannerå¹¿å‘Š<a hidden class=anchor aria-hidden=true href=#bannerå¹¿å‘Š>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bannerå¹¿å‘Šç®¡ç†å™¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> BannerAdManager {
</span></span><span style=display:flex><span>    constructor() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.bannerAd <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.bannerAdUnitId <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;adunit-xxxxx&#39;</span>; <span style=color:#8b949e;font-style:italic>// æ›¿æ¢ä¸ºå®é™…å¹¿å‘Šä½ID
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.isShowing <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.retryCount <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.maxRetryCount <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>3</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    init() {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// åˆ›å»ºBannerå¹¿å‘Š
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.bannerAd <span style=color:#ff7b72;font-weight:700>=</span> wx.createBannerAd({
</span></span><span style=display:flex><span>            adUnitId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.bannerAdUnitId,
</span></span><span style=display:flex><span>            style<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                left<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>                top<span style=color:#ff7b72;font-weight:700>:</span> wx.getSystemInfoSync().windowHeight <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#a5d6ff>100</span>,
</span></span><span style=display:flex><span>                width<span style=color:#ff7b72;font-weight:700>:</span> wx.getSystemInfoSync().windowWidth
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// ç›‘å¬å¹¿å‘ŠåŠ è½½
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.bannerAd.onLoad(() =&gt; {
</span></span><span style=display:flex><span>            console.log(<span style=color:#a5d6ff>&#39;Bannerå¹¿å‘ŠåŠ è½½æˆåŠŸ&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.retryCount <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// ç›‘å¬å¹¿å‘Šé”™è¯¯
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.bannerAd.onError((err) =&gt; {
</span></span><span style=display:flex><span>            console.error(<span style=color:#a5d6ff>&#39;Bannerå¹¿å‘ŠåŠ è½½å¤±è´¥:&#39;</span>, err);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.retryLoad();
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// ç›‘å¬å¹¿å‘Šå…³é—­
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.bannerAd.onClose(() =&gt; {
</span></span><span style=display:flex><span>            console.log(<span style=color:#a5d6ff>&#39;Bannerå¹¿å‘Šå…³é—­&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.isShowing <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    show() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.bannerAd <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> <span style=color:#ff7b72;font-weight:700>!</span><span style=color:#ff7b72>this</span>.isShowing) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.bannerAd.show().then(() =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.isShowing <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>true</span>;
</span></span><span style=display:flex><span>            }).<span style=color:#ff7b72>catch</span>(err =&gt; {
</span></span><span style=display:flex><span>                console.error(<span style=color:#a5d6ff>&#39;Bannerå¹¿å‘Šæ˜¾ç¤ºå¤±è´¥:&#39;</span>, err);
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    hide() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.bannerAd <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> <span style=color:#ff7b72>this</span>.isShowing) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.bannerAd.hide();
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.isShowing <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    destroy() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.bannerAd) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.bannerAd.destroy();
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.bannerAd <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    retryLoad() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.retryCount <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#ff7b72>this</span>.maxRetryCount) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.retryCount<span style=color:#ff7b72;font-weight:700>++</span>;
</span></span><span style=display:flex><span>            setTimeout(() =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.init();
</span></span><span style=display:flex><span>            }, <span style=color:#a5d6ff>2000</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.retryCount);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=æ¿€åŠ±è§†é¢‘å¹¿å‘Š>æ¿€åŠ±è§†é¢‘å¹¿å‘Š<a hidden class=anchor aria-hidden=true href=#æ¿€åŠ±è§†é¢‘å¹¿å‘Š>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">96
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// æ¿€åŠ±è§†é¢‘å¹¿å‘Šç®¡ç†å™¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> RewardedVideoAdManager {
</span></span><span style=display:flex><span>    constructor() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.rewardedVideoAd <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.adUnitId <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;adunit-yyyyy&#39;</span>; <span style=color:#8b949e;font-style:italic>// æ›¿æ¢ä¸ºå®é™…å¹¿å‘Šä½ID
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.isLoaded <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.loadPromise <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.watchCallback <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    init() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.rewardedVideoAd <span style=color:#ff7b72;font-weight:700>=</span> wx.createRewardedVideoAd({
</span></span><span style=display:flex><span>            adUnitId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.adUnitId
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.setupEventListeners();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.loadAd();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    setupEventListeners() {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// å¹¿å‘ŠåŠ è½½æˆåŠŸ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.rewardedVideoAd.onLoad(() =&gt; {
</span></span><span style=display:flex><span>            console.log(<span style=color:#a5d6ff>&#39;æ¿€åŠ±è§†é¢‘å¹¿å‘ŠåŠ è½½æˆåŠŸ&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.isLoaded <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>true</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.loadPromise <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// å¹¿å‘ŠåŠ è½½å¤±è´¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.rewardedVideoAd.onError((err) =&gt; {
</span></span><span style=display:flex><span>            console.error(<span style=color:#a5d6ff>&#39;æ¿€åŠ±è§†é¢‘å¹¿å‘ŠåŠ è½½å¤±è´¥:&#39;</span>, err);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.isLoaded <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.loadPromise <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// é€šçŸ¥å›è°ƒå¤±è´¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.watchCallback) {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.watchCallback({ success<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>, error<span style=color:#ff7b72;font-weight:700>:</span> err });
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.watchCallback <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// å¹¿å‘Šå…³é—­
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.rewardedVideoAd.onClose((res) =&gt; {
</span></span><span style=display:flex><span>            console.log(<span style=color:#a5d6ff>&#39;æ¿€åŠ±è§†é¢‘å¹¿å‘Šå…³é—­&#39;</span>, res);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// é¢„åŠ è½½ä¸‹ä¸€ä¸ªå¹¿å‘Š
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            <span style=color:#ff7b72>this</span>.loadAd();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// é€šçŸ¥å›è°ƒç»“æœ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.watchCallback) {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.watchCallback({
</span></span><span style=display:flex><span>                    success<span style=color:#ff7b72;font-weight:700>:</span> res.isEnded <span style=color:#ff7b72;font-weight:700>||</span> res.ended,
</span></span><span style=display:flex><span>                    rewarded<span style=color:#ff7b72;font-weight:700>:</span> res.isEnded <span style=color:#ff7b72;font-weight:700>||</span> res.ended
</span></span><span style=display:flex><span>                });
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.watchCallback <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> loadAd() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.loadPromise) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.loadPromise;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.loadPromise <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Promise((resolve) =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.rewardedVideoAd.load().then(() =&gt; {
</span></span><span style=display:flex><span>                resolve();
</span></span><span style=display:flex><span>            }).<span style=color:#ff7b72>catch</span>(() =&gt; {
</span></span><span style=display:flex><span>                resolve();
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.loadPromise;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è§‚çœ‹å¹¿å‘Š
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> watchAd() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> Promise((resolve) =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.watchCallback) {
</span></span><span style=display:flex><span>                resolve({ success<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>, error<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;å¹¿å‘Šæ­£åœ¨æ’­æ”¾ä¸­&#39;</span> });
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span><span style=color:#ff7b72>this</span>.isLoaded) {
</span></span><span style=display:flex><span>                resolve({ success<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>, error<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;å¹¿å‘ŠæœªåŠ è½½å®Œæˆ&#39;</span> });
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.watchCallback <span style=color:#ff7b72;font-weight:700>=</span> resolve;
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.rewardedVideoAd.show()
</span></span><span style=display:flex><span>                .<span style=color:#ff7b72>catch</span>(err =&gt; {
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>this</span>.watchCallback <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>                    resolve({ success<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>, error<span style=color:#ff7b72;font-weight:700>:</span> err });
</span></span><span style=display:flex><span>                });
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=æ’å±å¹¿å‘Š>æ’å±å¹¿å‘Š<a hidden class=anchor aria-hidden=true href=#æ’å±å¹¿å‘Š>#</a></h4><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// æ’å±å¹¿å‘Šç®¡ç†å™¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> InterstitialAdManager {
</span></span><span style=display:flex><span>    constructor() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.interstitialAd <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.adUnitId <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;adunit-zzzzz&#39;</span>; <span style=color:#8b949e;font-style:italic>// æ›¿æ¢ä¸ºå®é™…å¹¿å‘Šä½ID
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.isLoaded <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.lastShowTime <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.minInterval <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>30000</span>; <span style=color:#8b949e;font-style:italic>// æœ€å°é—´éš”30ç§’
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    init() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.interstitialAd <span style=color:#ff7b72;font-weight:700>=</span> wx.createInterstitialAd({
</span></span><span style=display:flex><span>            adUnitId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.adUnitId
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.interstitialAd.onLoad(() =&gt; {
</span></span><span style=display:flex><span>            console.log(<span style=color:#a5d6ff>&#39;æ’å±å¹¿å‘ŠåŠ è½½æˆåŠŸ&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.isLoaded <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>true</span>;
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.interstitialAd.onError((err) =&gt; {
</span></span><span style=display:flex><span>            console.error(<span style=color:#a5d6ff>&#39;æ’å±å¹¿å‘ŠåŠ è½½å¤±è´¥:&#39;</span>, err);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.isLoaded <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.interstitialAd.onClose(() =&gt; {
</span></span><span style=display:flex><span>            console.log(<span style=color:#a5d6ff>&#39;æ’å±å¹¿å‘Šå…³é—­&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.isLoaded <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// å»¶è¿Ÿé‡æ–°åŠ è½½
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            setTimeout(() =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.loadAd();
</span></span><span style=display:flex><span>            }, <span style=color:#a5d6ff>5000</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.loadAd();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    loadAd() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span><span style=color:#ff7b72>this</span>.isLoaded) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.interstitialAd.load();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ˜¾ç¤ºæ’å±å¹¿å‘Š
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    show() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> now <span style=color:#ff7b72;font-weight:700>=</span> Date.now();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥æ—¶é—´é—´éš”
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>if</span> (now <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#ff7b72>this</span>.lastShowTime <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#ff7b72>this</span>.minInterval) {
</span></span><span style=display:flex><span>            console.log(<span style=color:#a5d6ff>&#39;æ’å±å¹¿å‘Šé—´éš”æ—¶é—´æœªåˆ°&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.isLoaded) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.interstitialAd.show()
</span></span><span style=display:flex><span>                .then(() =&gt; {
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>this</span>.lastShowTime <span style=color:#ff7b72;font-weight:700>=</span> now;
</span></span><span style=display:flex><span>                    console.log(<span style=color:#a5d6ff>&#39;æ’å±å¹¿å‘Šæ˜¾ç¤ºæˆåŠŸ&#39;</span>);
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>true</span>;
</span></span><span style=display:flex><span>                })
</span></span><span style=display:flex><span>                .<span style=color:#ff7b72>catch</span>(err =&gt; {
</span></span><span style=display:flex><span>                    console.error(<span style=color:#a5d6ff>&#39;æ’å±å¹¿å‘Šæ˜¾ç¤ºå¤±è´¥:&#39;</span>, err);
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>                });
</span></span><span style=display:flex><span>        } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>            console.log(<span style=color:#a5d6ff>&#39;æ’å±å¹¿å‘ŠæœªåŠ è½½å®Œæˆ&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=å†…è´­ç³»ç»Ÿè®¾è®¡>å†…è´­ç³»ç»Ÿè®¾è®¡<a hidden class=anchor aria-hidden=true href=#å†…è´­ç³»ç»Ÿè®¾è®¡>#</a></h2><h3 id=è™šæ‹Ÿå•†å“ç®¡ç†>è™šæ‹Ÿå•†å“ç®¡ç†<a hidden class=anchor aria-hidden=true href=#è™šæ‹Ÿå•†å“ç®¡ç†>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">202
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å•†åº—ç³»ç»Ÿ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> GameStore {
</span></span><span style=display:flex><span>    constructor() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.products <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                id<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;coin_100&#39;</span>,
</span></span><span style=display:flex><span>                name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;100é‡‘å¸&#39;</span>,
</span></span><span style=display:flex><span>                price<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>6</span>, <span style=color:#8b949e;font-style:italic>// 6å…ƒ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                description<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;è·å¾—100é‡‘å¸ï¼Œå¯ç”¨äºè´­ä¹°é“å…·&#39;</span>,
</span></span><span style=display:flex><span>                icon<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;res/icons/coin_100.png&#39;</span>,
</span></span><span style=display:flex><span>                type<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;consumable&#39;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                id<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;remove_ads&#39;</span>,
</span></span><span style=display:flex><span>                name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;å»å¹¿å‘Š&#39;</span>,
</span></span><span style=display:flex><span>                price<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>12</span>,
</span></span><span style=display:flex><span>                description<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;æ°¸ä¹…ç§»é™¤æ‰€æœ‰å¹¿å‘Š&#39;</span>,
</span></span><span style=display:flex><span>                icon<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;res/icons/no_ads.png&#39;</span>,
</span></span><span style=display:flex><span>                type<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;permanent&#39;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                id<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;vip_month&#39;</span>,
</span></span><span style=display:flex><span>                name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;æœˆåº¦VIP&#39;</span>,
</span></span><span style=display:flex><span>                price<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>18</span>,
</span></span><span style=display:flex><span>                description<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;30å¤©VIPç‰¹æƒï¼Œäº«åŒå€å¥–åŠ±&#39;</span>,
</span></span><span style=display:flex><span>                icon<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;res/icons/vip.png&#39;</span>,
</span></span><span style=display:flex><span>                type<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;subscription&#39;</span>,
</span></span><span style=display:flex><span>                duration<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>30</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>24</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span> <span style=color:#8b949e;font-style:italic>// 30å¤©
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            }
</span></span><span style=display:flex><span>        ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.purchasedItems <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.initPayment();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    initPayment() {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// åˆå§‹åŒ–æ”¯ä»˜ç³»ç»Ÿ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>if</span> (wx.requestPayment) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.paymentProvider <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;wechat&#39;</span>;
</span></span><span style=display:flex><span>        } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>            console.error(<span style=color:#a5d6ff>&#39;æ”¯ä»˜ç³»ç»Ÿä¸å¯ç”¨&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è·å–å•†å“åˆ—è¡¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    getProducts() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.products;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è´­ä¹°å•†å“
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> purchaseProduct(productId) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> product <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.products.find(p =&gt; p.id <span style=color:#ff7b72;font-weight:700>===</span> productId);
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>product) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>throw</span> <span style=color:#ff7b72>new</span> Error(<span style=color:#a5d6ff>&#39;å•†å“ä¸å­˜åœ¨&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥æ˜¯å¦å·²è´­ä¹°æ°¸ä¹…å•†å“
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>if</span> (product.type <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>&#39;permanent&#39;</span> <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> <span style=color:#ff7b72>this</span>.isProductPurchased(productId)) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>throw</span> <span style=color:#ff7b72>new</span> Error(<span style=color:#a5d6ff>&#39;è¯¥å•†å“å·²è´­ä¹°&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// å‘èµ·æ”¯ä»˜
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.requestPayment(product);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// æ”¯ä»˜æˆåŠŸï¼Œå¤„ç†è´­ä¹°é€»è¾‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.processPurchase(product);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> { success<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>, product };
</span></span><span style=display:flex><span>        } <span style=color:#ff7b72>catch</span> (error) {
</span></span><span style=display:flex><span>            console.error(<span style=color:#a5d6ff>&#39;è´­ä¹°å¤±è´¥:&#39;</span>, error);
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> { success<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>, error<span style=color:#ff7b72;font-weight:700>:</span> error.message };
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å‘èµ·æ”¯ä»˜è¯·æ±‚
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> requestPayment(product) {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// è·å–æ”¯ä»˜å‚æ•°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>const</span> paymentParams <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.getPaymentParams(product);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> Promise((resolve, reject) =&gt; {
</span></span><span style=display:flex><span>            wx.requestPayment({
</span></span><span style=display:flex><span>                ...paymentParams,
</span></span><span style=display:flex><span>                success<span style=color:#ff7b72;font-weight:700>:</span> resolve,
</span></span><span style=display:flex><span>                fail<span style=color:#ff7b72;font-weight:700>:</span> reject
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è·å–æ”¯ä»˜å‚æ•°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> getPaymentParams(product) {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// è°ƒç”¨åç«¯APIè·å–æ”¯ä»˜å‚æ•°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>const</span> response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> wx.request({
</span></span><span style=display:flex><span>            url<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;https://api.example.com/payment/create&#39;</span>,
</span></span><span style=display:flex><span>            method<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>            data<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                productId<span style=color:#ff7b72;font-weight:700>:</span> product.id,
</span></span><span style=display:flex><span>                price<span style=color:#ff7b72;font-weight:700>:</span> product.price,
</span></span><span style=display:flex><span>                userId<span style=color:#ff7b72;font-weight:700>:</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;userId&#39;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> response.data;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å¤„ç†è´­ä¹°ç»“æœ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> processPurchase(product) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> purchaseInfo <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            productId<span style=color:#ff7b72;font-weight:700>:</span> product.id,
</span></span><span style=display:flex><span>            purchaseTime<span style=color:#ff7b72;font-weight:700>:</span> Date.now(),
</span></span><span style=display:flex><span>            type<span style=color:#ff7b72;font-weight:700>:</span> product.type
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>switch</span> (product.type) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#39;consumable&#39;</span><span style=color:#ff7b72;font-weight:700>:</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>// æ¶ˆè€—å“ï¼Œç«‹å³ç»™äºˆå¥–åŠ±
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72>this</span>.grantRewards(product);
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#39;permanent&#39;</span><span style=color:#ff7b72;font-weight:700>:</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>// æ°¸ä¹…å•†å“ï¼Œè®°å½•è´­ä¹°çŠ¶æ€
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72>this</span>.purchasedItems.set(product.id, purchaseInfo);
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.savePurchasedItems();
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#39;subscription&#39;</span><span style=color:#ff7b72;font-weight:700>:</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>// è®¢é˜…å•†å“ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                purchaseInfo.expireTime <span style=color:#ff7b72;font-weight:700>=</span> Date.now() <span style=color:#ff7b72;font-weight:700>+</span> product.duration;
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.purchasedItems.set(product.id, purchaseInfo);
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.savePurchasedItems();
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// è§¦å‘è´­ä¹°äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.triggerPurchaseEvent(product);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ç»™äºˆå¥–åŠ±
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    grantRewards(product) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>switch</span> (product.id) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#39;coin_100&#39;</span><span style=color:#ff7b72;font-weight:700>:</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>// å¢åŠ 100é‡‘å¸
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                gameManager.addCoins(<span style=color:#a5d6ff>100</span>);
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#39;remove_ads&#39;</span><span style=color:#ff7b72;font-weight:700>:</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>// ç§»é™¤å¹¿å‘Š
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                adManager.removeAllAds();
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥å•†å“æ˜¯å¦å·²è´­ä¹°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    isProductPurchased(productId) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> purchase <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.purchasedItems.get(productId);
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>purchase) <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (purchase.type <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>&#39;subscription&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥è®¢é˜…æ˜¯å¦è¿‡æœŸ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            <span style=color:#ff7b72>return</span> Date.now() <span style=color:#ff7b72;font-weight:700>&lt;</span> purchase.expireTime;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è·å–è´­ä¹°çŠ¶æ€
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    getPurchaseStatus() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> status <span style=color:#ff7b72;font-weight:700>=</span> {};
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.purchasedItems.forEach((purchase, productId) =&gt; {
</span></span><span style=display:flex><span>            status[productId] <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                purchased<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.isProductPurchased(productId),
</span></span><span style=display:flex><span>                purchaseTime<span style=color:#ff7b72;font-weight:700>:</span> purchase.purchaseTime,
</span></span><span style=display:flex><span>                expireTime<span style=color:#ff7b72;font-weight:700>:</span> purchase.expireTime
</span></span><span style=display:flex><span>            };
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> status;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ä¿å­˜è´­ä¹°è®°å½•
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    savePurchasedItems() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> data <span style=color:#ff7b72;font-weight:700>=</span> Array.from(<span style=color:#ff7b72>this</span>.purchasedItems.entries());
</span></span><span style=display:flex><span>        wx.setStorageSync(<span style=color:#a5d6ff>&#39;purchasedItems&#39;</span>, data);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// åŠ è½½è´­ä¹°è®°å½•
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    loadPurchasedItems() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> data <span style=color:#ff7b72;font-weight:700>=</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;purchasedItems&#39;</span>) <span style=color:#ff7b72;font-weight:700>||</span> [];
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.purchasedItems <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map(data);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è§¦å‘è´­ä¹°äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    triggerPurchaseEvent(product) {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// æ•°æ®ç»Ÿè®¡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        wx.reportAnalytics(<span style=color:#a5d6ff>&#39;purchase&#39;</span>, {
</span></span><span style=display:flex><span>            product_id<span style=color:#ff7b72;font-weight:700>:</span> product.id,
</span></span><span style=display:flex><span>            price<span style=color:#ff7b72;font-weight:700>:</span> product.price,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now()
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// æ¸¸æˆå†…äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        gameManager.eventSystem.emit(<span style=color:#a5d6ff>&#39;product_purchased&#39;</span>, product);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=ç”¨æˆ·ç•™å­˜ä¸å¢é•¿>ç”¨æˆ·ç•™å­˜ä¸å¢é•¿<a hidden class=anchor aria-hidden=true href=#ç”¨æˆ·ç•™å­˜ä¸å¢é•¿>#</a></h2><h3 id=æ¸¸æˆæ•°æ®åˆ†æ>æ¸¸æˆæ•°æ®åˆ†æ<a hidden class=anchor aria-hidden=true href=#æ¸¸æˆæ•°æ®åˆ†æ>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">255
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">256
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">257
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">258
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">259
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">260
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">261
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">262
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">263
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">264
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">265
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">266
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">267
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">268
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">269
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">270
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">271
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">272
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">273
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">274
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">275
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">276
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// æ¸¸æˆæ•°æ®åˆ†æç³»ç»Ÿ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> GameAnalytics {
</span></span><span style=display:flex><span>    constructor() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.sessionStartTime <span style=color:#ff7b72;font-weight:700>=</span> Date.now();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.sessionId <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.generateSessionId();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.customEvents <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.levelProgress <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ç”Ÿæˆä¼šè¯ID
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    generateSessionId() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> Date.now().toString(<span style=color:#a5d6ff>36</span>) <span style=color:#ff7b72;font-weight:700>+</span> Math.random().toString(<span style=color:#a5d6ff>36</span>).substr(<span style=color:#a5d6ff>2</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è®°å½•æ¸¸æˆå¼€å§‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    trackGameStart() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> event <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            eventName<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;game_start&#39;</span>,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now(),
</span></span><span style=display:flex><span>            sessionId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.sessionId,
</span></span><span style=display:flex><span>            properties<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                deviceInfo<span style=color:#ff7b72;font-weight:700>:</span> wx.getSystemInfoSync(),
</span></span><span style=display:flex><span>                isNewPlayer<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.isNewPlayer(),
</span></span><span style=display:flex><span>                lastPlayTime<span style=color:#ff7b72;font-weight:700>:</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;lastPlayTime&#39;</span>) <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#79c0ff>null</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.reportEvent(event);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è®°å½•æ¸¸æˆç»“æŸ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    trackGameEnd(properties <span style=color:#ff7b72;font-weight:700>=</span> {}) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> sessionDuration <span style=color:#ff7b72;font-weight:700>=</span> Date.now() <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#ff7b72>this</span>.sessionStartTime;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> event <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            eventName<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;game_end&#39;</span>,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now(),
</span></span><span style=display:flex><span>            sessionId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.sessionId,
</span></span><span style=display:flex><span>            properties<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                sessionDuration,
</span></span><span style=display:flex><span>                level<span style=color:#ff7b72;font-weight:700>:</span> properties.level <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>1</span>,
</span></span><span style=display:flex><span>                score<span style=color:#ff7b72;font-weight:700>:</span> properties.score <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>                reason<span style=color:#ff7b72;font-weight:700>:</span> properties.reason <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>&#39;normal&#39;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.reportEvent(event);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// ä¿å­˜æ¸¸æˆæ—¶é•¿
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.savePlaytime(sessionDuration);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è®°å½•å…³å¡è¿›åº¦
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    trackLevelStart(levelId) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> event <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            eventName<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;level_start&#39;</span>,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now(),
</span></span><span style=display:flex><span>            sessionId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.sessionId,
</span></span><span style=display:flex><span>            properties<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                levelId,
</span></span><span style=display:flex><span>                attempts<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.getLevelAttempts(levelId)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.reportEvent(event);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    trackLevelComplete(levelId, properties <span style=color:#ff7b72;font-weight:700>=</span> {}) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> attempts <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.getLevelAttempts(levelId);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> event <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            eventName<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;level_complete&#39;</span>,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now(),
</span></span><span style=display:flex><span>            sessionId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.sessionId,
</span></span><span style=display:flex><span>            properties<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                levelId,
</span></span><span style=display:flex><span>                attempts,
</span></span><span style=display:flex><span>                duration<span style=color:#ff7b72;font-weight:700>:</span> properties.duration,
</span></span><span style=display:flex><span>                stars<span style=color:#ff7b72;font-weight:700>:</span> properties.stars <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>                score<span style=color:#ff7b72;font-weight:700>:</span> properties.score <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.reportEvent(event);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// æ›´æ–°å…³å¡è¿›åº¦
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.updateLevelProgress(levelId, <span style=color:#a5d6ff>&#39;complete&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    trackLevelFail(levelId, properties <span style=color:#ff7b72;font-weight:700>=</span> {}) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> attempts <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.getLevelAttempts(levelId);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> event <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            eventName<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;level_fail&#39;</span>,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now(),
</span></span><span style=display:flex><span>            sessionId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.sessionId,
</span></span><span style=display:flex><span>            properties<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                levelId,
</span></span><span style=display:flex><span>                attempts,
</span></span><span style=display:flex><span>                reason<span style=color:#ff7b72;font-weight:700>:</span> properties.reason <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>&#39;timeout&#39;</span>,
</span></span><span style=display:flex><span>                progress<span style=color:#ff7b72;font-weight:700>:</span> properties.progress <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.reportEvent(event);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// æ›´æ–°å…³å¡è¿›åº¦
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.updateLevelProgress(levelId, <span style=color:#a5d6ff>&#39;fail&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è®°å½•å¹¿å‘Šè§‚çœ‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    trackAdWatch(adType, result) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> event <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            eventName<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;ad_watch&#39;</span>,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now(),
</span></span><span style=display:flex><span>            sessionId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.sessionId,
</span></span><span style=display:flex><span>            properties<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                adType, <span style=color:#8b949e;font-style:italic>// &#39;banner&#39;, &#39;interstitial&#39;, &#39;rewarded&#39;
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                result, <span style=color:#8b949e;font-style:italic>// &#39;completed&#39;, &#39;skipped&#39;, &#39;failed&#39;
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                placement<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.getCurrentPlacement()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.reportEvent(event);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è®°å½•å†…è´­è¡Œä¸º
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    trackPurchase(productId, price, result) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> event <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            eventName<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;purchase&#39;</span>,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now(),
</span></span><span style=display:flex><span>            sessionId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.sessionId,
</span></span><span style=display:flex><span>            properties<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                productId,
</span></span><span style=display:flex><span>                price,
</span></span><span style=display:flex><span>                result, <span style=color:#8b949e;font-style:italic>// &#39;success&#39;, &#39;failed&#39;, &#39;cancelled&#39;
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                level<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.getCurrentLevel()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.reportEvent(event);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è®°å½•è‡ªå®šä¹‰äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    trackCustomEvent(eventName, properties <span style=color:#ff7b72;font-weight:700>=</span> {}) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> event <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            eventName,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now(),
</span></span><span style=display:flex><span>            sessionId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.sessionId,
</span></span><span style=display:flex><span>            properties
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.customEvents.push(event);
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.reportEvent(event);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ä¸ŠæŠ¥äº‹ä»¶åˆ°æœåŠ¡å™¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> reportEvent(event) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>await</span> wx.request({
</span></span><span style=display:flex><span>                url<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;https://api.example.com/analytics/events&#39;</span>,
</span></span><span style=display:flex><span>                method<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>                data<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                    events<span style=color:#ff7b72;font-weight:700>:</span> [event],
</span></span><span style=display:flex><span>                    userId<span style=color:#ff7b72;font-weight:700>:</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;userId&#39;</span>),
</span></span><span style=display:flex><span>                    appId<span style=color:#ff7b72;font-weight:700>:</span> wx.getAccountInfoSync().miniProgram.appId
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        } <span style=color:#ff7b72>catch</span> (error) {
</span></span><span style=display:flex><span>            console.error(<span style=color:#a5d6ff>&#39;äº‹ä»¶ä¸ŠæŠ¥å¤±è´¥:&#39;</span>, error);
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// æœ¬åœ°ç¼“å­˜ï¼Œç¨åé‡è¯•
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            <span style=color:#ff7b72>this</span>.cacheEvent(event);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ç¼“å­˜äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    cacheEvent(event) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> cachedEvents <span style=color:#ff7b72;font-weight:700>=</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;cachedEvents&#39;</span>) <span style=color:#ff7b72;font-weight:700>||</span> [];
</span></span><span style=display:flex><span>        cachedEvents.push(event);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// é™åˆ¶ç¼“å­˜å¤§å°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>if</span> (cachedEvents.length <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>100</span>) {
</span></span><span style=display:flex><span>            cachedEvents.shift();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        wx.setStorageSync(<span style=color:#a5d6ff>&#39;cachedEvents&#39;</span>, cachedEvents);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// é‡è¯•ä¸ŠæŠ¥ç¼“å­˜çš„äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> retryCachedEvents() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> cachedEvents <span style=color:#ff7b72;font-weight:700>=</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;cachedEvents&#39;</span>) <span style=color:#ff7b72;font-weight:700>||</span> [];
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (cachedEvents.length <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>await</span> wx.request({
</span></span><span style=display:flex><span>                url<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;https://api.example.com/analytics/events&#39;</span>,
</span></span><span style=display:flex><span>                method<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>                data<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>                    events<span style=color:#ff7b72;font-weight:700>:</span> cachedEvents,
</span></span><span style=display:flex><span>                    userId<span style=color:#ff7b72;font-weight:700>:</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;userId&#39;</span>),
</span></span><span style=display:flex><span>                    appId<span style=color:#ff7b72;font-weight:700>:</span> wx.getAccountInfoSync().miniProgram.appId
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// æ¸…ç©ºç¼“å­˜
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            wx.removeStorageSync(<span style=color:#a5d6ff>&#39;cachedEvents&#39;</span>);
</span></span><span style=display:flex><span>        } <span style=color:#ff7b72>catch</span> (error) {
</span></span><span style=display:flex><span>            console.error(<span style=color:#a5d6ff>&#39;ç¼“å­˜äº‹ä»¶ä¸ŠæŠ¥å¤±è´¥:&#39;</span>, error);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è·å–å…³å¡å°è¯•æ¬¡æ•°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    getLevelAttempts(levelId) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`level_attempts_</span><span style=color:#a5d6ff>${</span>levelId<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> wx.getStorageSync(key) <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å¢åŠ å…³å¡å°è¯•æ¬¡æ•°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    incrementLevelAttempts(levelId) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`level_attempts_</span><span style=color:#a5d6ff>${</span>levelId<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> attempts <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.getLevelAttempts(levelId);
</span></span><span style=display:flex><span>        wx.setStorageSync(key, attempts <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ›´æ–°å…³å¡è¿›åº¦
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    updateLevelProgress(levelId, status) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span><span style=color:#ff7b72>this</span>.levelProgress.has(levelId)) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>this</span>.levelProgress.set(levelId, {
</span></span><span style=display:flex><span>                attempts<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>                bestScore<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>                completed<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>,
</span></span><span style=display:flex><span>                completedAt<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>null</span>
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> progress <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.levelProgress.get(levelId);
</span></span><span style=display:flex><span>        progress.attempts<span style=color:#ff7b72;font-weight:700>++</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (status <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>&#39;complete&#39;</span> <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> <span style=color:#ff7b72;font-weight:700>!</span>progress.completed) {
</span></span><span style=display:flex><span>            progress.completed <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>true</span>;
</span></span><span style=display:flex><span>            progress.completedAt <span style=color:#ff7b72;font-weight:700>=</span> Date.now();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        wx.setStorageSync(<span style=color:#a5d6ff>&#39;levelProgress&#39;</span>, Array.from(<span style=color:#ff7b72>this</span>.levelProgress.entries()));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥æ˜¯å¦ä¸ºæ–°ç©å®¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    isNewPlayer() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72;font-weight:700>!</span>wx.getStorageSync(<span style=color:#a5d6ff>&#39;hasPlayedBefore&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ä¿å­˜æ¸¸æˆæ—¶é•¿
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    savePlaytime(duration) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> today <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Date().toDateString();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> playtimeData <span style=color:#ff7b72;font-weight:700>=</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;playtimeData&#39;</span>) <span style=color:#ff7b72;font-weight:700>||</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>playtimeData[today]) {
</span></span><span style=display:flex><span>            playtimeData[today] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        playtimeData[today] <span style=color:#ff7b72;font-weight:700>+=</span> duration;
</span></span><span style=display:flex><span>        wx.setStorageSync(<span style=color:#a5d6ff>&#39;playtimeData&#39;</span>, playtimeData);
</span></span><span style=display:flex><span>        wx.setStorageSync(<span style=color:#a5d6ff>&#39;lastPlayTime&#39;</span>, Date.now());
</span></span><span style=display:flex><span>        wx.setStorageSync(<span style=color:#a5d6ff>&#39;hasPlayedBefore&#39;</span>, <span style=color:#79c0ff>true</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è·å–å½“å‰å…³å¡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    getCurrentLevel() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;currentLevel&#39;</span>) <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è·å–å½“å‰å¹¿å‘Šä½
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    getCurrentPlacement() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;currentPlacement&#39;</span>) <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>&#39;unknown&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=abæµ‹è¯•ç³»ç»Ÿ>A/Bæµ‹è¯•ç³»ç»Ÿ<a hidden class=anchor aria-hidden=true href=#abæµ‹è¯•ç³»ç»Ÿ>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// A/Bæµ‹è¯•ç®¡ç†å™¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> ABTestManager {
</span></span><span style=display:flex><span>    constructor() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.experiments <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.userVariant <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map();
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.loadExperiments();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// åŠ è½½å®éªŒé…ç½®
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>async</span> loadExperiments() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>const</span> response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> wx.request({
</span></span><span style=display:flex><span>                url<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;https://api.example.com/abtest/experiments&#39;</span>,
</span></span><span style=display:flex><span>                method<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;GET&#39;</span>
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            response.data.forEach(experiment =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.experiments.set(experiment.id, experiment);
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>// ä¸ºç”¨æˆ·åˆ†é…å®éªŒç»„
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            <span style=color:#ff7b72>this</span>.assignUserToExperiments();
</span></span><span style=display:flex><span>        } <span style=color:#ff7b72>catch</span> (error) {
</span></span><span style=display:flex><span>            console.error(<span style=color:#a5d6ff>&#39;åŠ è½½A/Bæµ‹è¯•é…ç½®å¤±è´¥:&#39;</span>, error);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ä¸ºç”¨æˆ·åˆ†é…å®éªŒç»„
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    assignUserToExperiments() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> userId <span style=color:#ff7b72;font-weight:700>=</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;userId&#39;</span>) <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#ff7b72>this</span>.generateUserId();
</span></span><span style=display:flex><span>        wx.setStorageSync(<span style=color:#a5d6ff>&#39;userId&#39;</span>, userId);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.experiments.forEach((experiment, expId) =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span><span style=color:#ff7b72>this</span>.userVariant.has(expId)) {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>const</span> variant <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.assignVariant(experiment, userId);
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>this</span>.userVariant.set(expId, variant);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>// è®°å½•åˆ†ç»„äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72>this</span>.trackExperimentAssignment(expId, variant);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// ä¿å­˜åˆ†ç»„ç»“æœ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>this</span>.saveUserVariants();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// åˆ†é…å˜ä½“
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    assignVariant(experiment, userId) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> hash <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.hashString(userId <span style=color:#ff7b72;font-weight:700>+</span> experiment.id);
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> ratio <span style=color:#ff7b72;font-weight:700>=</span> hash <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#a5d6ff>0xFFFFFFFF</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>let</span> cumulativeRatio <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> variant <span style=color:#ff7b72>of</span> experiment.variants) {
</span></span><span style=display:flex><span>            cumulativeRatio <span style=color:#ff7b72;font-weight:700>+=</span> variant.ratio;
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> (ratio <span style=color:#ff7b72;font-weight:700>&lt;=</span> cumulativeRatio) {
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> variant.id;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// é»˜è®¤è¿”å›ç¬¬ä¸€ä¸ªå˜ä½“
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>return</span> experiment.variants[<span style=color:#a5d6ff>0</span>].id;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å­—ç¬¦ä¸²å“ˆå¸Œ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    hashString(str) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>let</span> hash <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>let</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> str.length; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>const</span> <span style=color:#ff7b72>char</span> <span style=color:#ff7b72;font-weight:700>=</span> str.charCodeAt(i);
</span></span><span style=display:flex><span>            hash <span style=color:#ff7b72;font-weight:700>=</span> ((hash <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#a5d6ff>5</span>) <span style=color:#ff7b72;font-weight:700>-</span> hash) <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#ff7b72>char</span>;
</span></span><span style=display:flex><span>            hash <span style=color:#ff7b72;font-weight:700>=</span> hash <span style=color:#ff7b72;font-weight:700>&amp;</span> hash;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> Math.abs(hash);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ç”Ÿæˆç”¨æˆ·ID
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    generateUserId() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> Date.now().toString(<span style=color:#a5d6ff>36</span>) <span style=color:#ff7b72;font-weight:700>+</span> Math.random().toString(<span style=color:#a5d6ff>36</span>).substr(<span style=color:#a5d6ff>2</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è·å–å®éªŒå˜ä½“
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    getVariant(experimentId) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.userVariant.get(experimentId);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥æ˜¯å¦åœ¨å®éªŒä¸­
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    isInExperiment(experimentId, variantId) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> userVariant <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.getVariant(experimentId);
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> userVariant <span style=color:#ff7b72;font-weight:700>===</span> variantId;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// åº”ç”¨å®éªŒé…ç½®
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    applyExperimentConfig(experimentId, defaultValue) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> variant <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.getVariant(experimentId);
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> experiment <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.experiments.get(experimentId);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>experiment <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#ff7b72;font-weight:700>!</span>variant) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> defaultValue;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> variantConfig <span style=color:#ff7b72;font-weight:700>=</span> experiment.variants.find(v =&gt; v.id <span style=color:#ff7b72;font-weight:700>===</span> variant);
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> variantConfig <span style=color:#ff7b72;font-weight:700>?</span> variantConfig.config <span style=color:#ff7b72;font-weight:700>:</span> defaultValue;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è®°å½•å®éªŒåˆ†ç»„
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    trackExperimentAssignment(experimentId, variant) {
</span></span><span style=display:flex><span>        wx.reportAnalytics(<span style=color:#a5d6ff>&#39;experiment_assignment&#39;</span>, {
</span></span><span style=display:flex><span>            experiment_id<span style=color:#ff7b72;font-weight:700>:</span> experimentId,
</span></span><span style=display:flex><span>            variant<span style=color:#ff7b72;font-weight:700>:</span> variant,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now()
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è®°å½•å®éªŒç»“æœ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    trackExperimentResult(experimentId, metric, value) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> variant <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.getVariant(experimentId);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        wx.reportAnalytics(<span style=color:#a5d6ff>&#39;experiment_result&#39;</span>, {
</span></span><span style=display:flex><span>            experiment_id<span style=color:#ff7b72;font-weight:700>:</span> experimentId,
</span></span><span style=display:flex><span>            variant<span style=color:#ff7b72;font-weight:700>:</span> variant,
</span></span><span style=display:flex><span>            metric<span style=color:#ff7b72;font-weight:700>:</span> metric,
</span></span><span style=display:flex><span>            value<span style=color:#ff7b72;font-weight:700>:</span> value,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now()
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ä¿å­˜ç”¨æˆ·åˆ†ç»„
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    saveUserVariants() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> data <span style=color:#ff7b72;font-weight:700>=</span> Array.from(<span style=color:#ff7b72>this</span>.userVariant.entries());
</span></span><span style=display:flex><span>        wx.setStorageSync(<span style=color:#a5d6ff>&#39;abtest_variants&#39;</span>, data);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// åŠ è½½ç”¨æˆ·åˆ†ç»„
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    loadUserVariants() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> data <span style=color:#ff7b72;font-weight:700>=</span> wx.getStorageSync(<span style=color:#a5d6ff>&#39;abtest_variants&#39;</span>) <span style=color:#ff7b72;font-weight:700>||</span> [];
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.userVariant <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map(data);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><p>å°æ¸¸æˆå¼€å‘ä¸å˜ç°éœ€è¦ç»¼åˆè€ƒé‡å¤šä¸ªæ–¹é¢ï¼š</p><p><strong>æŠ€æœ¯å®ç°ï¼š</strong></p><ol><li>é€‰æ‹©åˆé€‚çš„æ¸¸æˆå¼•æ“å’Œå¼€å‘æ¡†æ¶</li><li>å®ç°é«˜æ•ˆçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</li><li>å»ºç«‹å®Œå–„çš„èµ„æºç®¡ç†ç³»ç»Ÿ</li></ol><p><strong>å˜ç°æ¨¡å¼ï¼š</strong></p><ol><li>å¤šå…ƒåŒ–å¹¿å‘Šç³»ç»Ÿé›†æˆ</li><li>åˆç†çš„å†…è´­æœºåˆ¶è®¾è®¡</li><li>æŒç»­çš„ç”¨æˆ·ä»·å€¼æŒ–æ˜</li></ol><p><strong>ç”¨æˆ·è¿è¥ï¼š</strong></p><ol><li>æ·±åº¦çš„æ•°æ®åˆ†æå’Œç›‘æ§</li><li>A/Bæµ‹è¯•é©±åŠ¨çš„äº§å“ä¼˜åŒ–</li><li>ç”¨æˆ·ç•™å­˜å’Œå¢é•¿ç­–ç•¥</li></ol><p><strong>å•†ä¸šåŒ–æˆåŠŸè¦ç´ ï¼š</strong></p><ol><li>ä¼˜è´¨çš„æ¸¸æˆå†…å®¹å’Œä½“éªŒ</li><li>åˆç†çš„å˜ç°èŠ‚å¥å’Œç­–ç•¥</li><li>ç²¾ç»†åŒ–çš„è¿è¥å’Œä¼˜åŒ–</li></ol><p>é€šè¿‡ç³»ç»ŸåŒ–çš„å¼€å‘å’Œè¿è¥ç­–ç•¥ï¼Œå°æ¸¸æˆå¯ä»¥å®ç°å•†ä¸šæˆåŠŸï¼Œä¸ºç”¨æˆ·åˆ›é€ ä»·å€¼çš„åŒæ—¶è·å¾—æŒç»­æ”¶ç›Šã€‚</p><hr><p><strong>ç›¸å…³èµ„æºï¼š</strong></p><ul><li><a href=https://developers.weixin.qq.com/minigame/dev/>å¾®ä¿¡å°æ¸¸æˆå®˜æ–¹æ–‡æ¡£</a></li><li><a href=https://layaair2.ldc2.layabox.com/>LayaAirå®˜æ–¹æ–‡æ¡£</a></li><li><a href=https://docs.cocos.com/creator/>Cocos Creatorå®˜æ–¹æ–‡æ¡£</a></li><li><a href=https://developers.weixin.qq.com/miniprogram/dev/framework/data-analysis/>å°æ¸¸æˆæ•°æ®åˆ†ææŒ‡å—</a></li></ul></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/ class=tag-pill>å°æ¸¸æˆå¼€å‘
</a><a href=/blog/tags/%E6%B8%B8%E6%88%8F%E5%8F%98%E7%8E%B0/ class=tag-pill>æ¸¸æˆå˜ç°
</a><a href=/blog/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E6%B8%B8%E6%88%8F/ class=tag-pill>å¾®ä¿¡å°æ¸¸æˆ
</a><a href=/blog/tags/%E5%B9%BF%E5%91%8A%E5%8F%98%E7%8E%B0/ class=tag-pill>å¹¿å‘Šå˜ç°
</a><a href=/blog/tags/%E5%86%85%E8%B4%AD%E8%AE%BE%E8%AE%A1/ class=tag-pill>å†…è´­è®¾è®¡</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/mini-program-development-best-practices/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>å°ç¨‹åºå¼€å‘å®Œå…¨æŒ‡å—ï¼šä»é›¶åˆ°ä¸Šçº¿çš„é«˜çº§æŠ€å·§</div></div></a><a href=/blog/articles/game-localization-overseas-strategy/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>æ¸¸æˆå‡ºæµ·å…¨æ”»ç•¥ï¼šä»æœ¬åœŸåŒ–åˆ°å…¨çƒå‘è¡Œçš„åˆ¶èƒœä¹‹é“</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>å¼•è¨€</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>å°æ¸¸æˆæŠ€æœ¯æ¶æ„</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>å¹¿å‘Šå˜ç°ç­–ç•¥</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>å†…è´­ç³»ç»Ÿè®¾è®¡</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>ç”¨æˆ·ç•™å­˜ä¸å¢é•¿</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>æ€»ç»“</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>