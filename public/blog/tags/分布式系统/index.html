<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>åˆ†å¸ƒå¼ç³»ç»Ÿ | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content><meta name=description content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·ï¼šåˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒ"><meta name=author content="util.cn Team"><link rel=canonical href=/blog/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="åˆ†å¸ƒå¼ç³»ç»Ÿ"><meta property="og:description" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·ï¼šåˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒ"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="åˆ†å¸ƒå¼ç³»ç»Ÿ"><meta name=twitter:description content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·ï¼šåˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒ"></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>åˆ†å¸ƒå¼ç³»ç»Ÿ</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§ä¿éšœæ–¹æ¡ˆè®¾è®¡ï¼šä»ç†è®ºåˆ°è½åœ°çš„å®Œæ•´æŒ‡å—</h2></header><div class=entry-content><p>å¼•è¨€ï¼šä¸€è‡´æ€§éš¾é¢˜çš„æœ¬è´¨ åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæ•°æ®åº“äº‹åŠ¡ï¼ˆACIDï¼‰ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„ä¸€è‡´æ€§ä¿è¯ã€‚ä½†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œåˆ†åŒºã€èŠ‚ç‚¹æ•…éšœã€æ—¶é’Ÿæ¼‚ç§»ç­‰ä¸ç¡®å®šæ€§å› ç´ ï¼Œä½¿å¾—å¼ºä¸€è‡´æ€§æˆä¸ºå¥¢ä¾ˆçš„é€‰æ‹©ã€‚
å¦‚ä½•åœ¨ä¸åŒä¸šåŠ¡åœºæ™¯ä¸‹é€‰æ‹©åˆé€‚çš„ä¸€è‡´æ€§æ–¹æ¡ˆï¼Ÿæœ¬æ–‡å°†ä»ç†è®ºå‡ºå‘ï¼Œç»“åˆå®é™…ä»£ç ï¼Œç³»ç»Ÿåœ°ä»‹ç»åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„å·¥ç¨‹å®è·µã€‚
ä¸€ã€ç†è®ºåŸºçŸ³ï¼šç†è§£ CAP ä¸ BASE 1.1 CAP å®šç†çš„å®è·µè§£è¯» ä¸€è‡´æ€§ (Consistency) â†— â†– / \ / \ å¯ç”¨æ€§ åˆ†åŒºå®¹é”™æ€§ (Availability) (Partition Tolerance) æ ¸å¿ƒè®¤çŸ¥ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒPï¼ˆåˆ†åŒºå®¹é”™ï¼‰æ˜¯å®¢è§‚å­˜åœ¨çš„ã€‚æˆ‘ä»¬çœŸæ­£é€‰æ‹©çš„æ˜¯åœ¨å‘ç”Ÿåˆ†åŒºæ—¶ï¼Œæ˜¯é€‰æ‹© Cï¼ˆä¸€è‡´æ€§ï¼‰è¿˜æ˜¯ Aï¼ˆå¯ç”¨æ€§ï¼‰ã€‚
åœºæ™¯åˆ†ç±»ï¼š
ä¸šåŠ¡åœºæ™¯ ä¸€æ€§æ€§è¦æ±‚ å¯ç”¨æ€§è¦æ±‚ å…¸å‹æ–¹æ¡ˆ é‡‘èè½¬è´¦ å¼ºä¸€è‡´æ€§ å¯é™çº§ 2PC/TCC + å†²çªç­‰å¾… è®¢å•æ”¯ä»˜ æœ€ç»ˆä¸€è‡´æ€§ é«˜å¯ç”¨ Saga + æœ¬åœ°æ¶ˆæ¯è¡¨ ç¤¾äº¤ç‚¹èµ æœ€ç»ˆä¸€è‡´æ€§ é«˜å¯ç”¨ å¼‚æ­¥å¤åˆ¶ + å†²çªå¤„ç† åº“å­˜æ‰£å‡ å¼ºä¸€è‡´æ€§ å¯é™çº§ åˆ†å¸ƒå¼é” + Redis 1.2 BASE ç†è®ºçš„å·¥ç¨‹å®è·µ BASEï¼ˆBasically Available, Soft state, Eventually consistentï¼‰æ˜¯å¯¹ CAP ä¸­ AP åœºæ™¯çš„è¡¥å……ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // è½¯çŠ¶æ€ç¤ºä¾‹ï¼šè®¢å•åˆ›å»ºåï¼Œè¿›å…¥"å¤„ç†ä¸­"çŠ¶æ€ type Order struct { ID string Status OrderStatus // è½¯çŠ¶æ€ï¼špending -> confirmed -> shipped CreatedAt time.Time UpdatedAt time.Time // çŠ¶æ€ä¼šæŒç»­å˜åŒ– } type OrderStatus int const ( StatusPending OrderStatus = iota // åˆå§‹çŠ¶æ€ StatusConfirmed // ä¸­é—´çŠ¶æ€ï¼ˆè½¯çŠ¶æ€ï¼‰ StatusShipped // æœ€ç»ˆçŠ¶æ€ ) // æœ€ç»ˆä¸€è‡´æ€§ï¼šç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œæ‰€æœ‰å‰¯æœ¬çš„çŠ¶æ€ä¼šæ”¶æ•› func (s *OrderService) ConfirmOrder(id string) error { // 1. æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆç«‹å³è¿”å›ï¼‰ if err := s.repo.UpdateStatus(id, StatusConfirmed); err != nil { return err } // 2. å¼‚æ­¥è§¦å‘åç»­æµç¨‹ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ go func() { s.inventoryClient.Deduct(id) // å¯èƒ½å¤±è´¥ï¼Œé‡è¯• s.shippingClient Arrange(id) // å¯èƒ½å¤±è´¥ï¼Œé‡è¯• s.notificationClient.Notify(id) // å¯èƒ½å¤±è´¥ï¼Œé‡è¯• }() return nil } äºŒã€å¼ºä¸€è‡´æ€§æ–¹æ¡ˆï¼š2PC ä¸ 3PC 2.1 ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰è¯¦è§£ æ¶æ„ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2026-01-05</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§ä¿éšœæ–¹æ¡ˆè®¾è®¡ï¼šä»ç†è®ºåˆ°è½åœ°çš„å®Œæ•´æŒ‡å—" href=/blog/articles/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%80%E8%87%B4%E6%80%A7%E4%BF%9D%E9%9A%9C%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E8%90%BD%E5%9C%B0%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®è·µä¸åæ€ï¼šä»å•ä½“åˆ°åˆ†å¸ƒå¼çš„æ¼”è¿›ä¹‹è·¯</h2></header><div class=entry-content><p>å‰è¨€ å¾®æœåŠ¡æ¶æ„å·²æˆä¸ºç°ä»£åç«¯ç³»ç»Ÿçš„ä¸»æµé€‰æ‹©ï¼Œä½†åœ¨å®é™…è½åœ°è¿‡ç¨‹ä¸­ï¼Œè®¸å¤šå›¢é˜Ÿé¢ä¸´ç€"ä½•æ—¶æ‹†"ã€â€œå¦‚ä½•æ‹†â€ã€â€œæ‹†åˆ°ä»€ä¹ˆç¨‹åº¦"çš„å›°æƒ‘ã€‚æœ¬æ–‡åŸºäºæˆ‘ä»¬å›¢é˜Ÿä»å•ä½“æ¶æ„è¿ç§»åˆ°å¾®æœåŠ¡æ¶æ„çš„ä¸¤å¹´å®è·µï¼Œæ€»ç»“äº†ä¸€å¥—å¯å¤åˆ¶çš„æ‹†åˆ†æ–¹æ³•è®ºï¼Œä»¥åŠåœ¨æ‹†åˆ†è¿‡ç¨‹ä¸­è¸©è¿‡çš„å‘ã€‚
ä¸€ã€å¾®æœåŠ¡æ‹†åˆ†çš„æ—¶æœºåˆ¤æ–­ 1.1 æ˜ç¡®çš„æ‹†åˆ†ä¿¡å· å›¢é˜Ÿè§„æ¨¡ä¿¡å·
å¼€å‘å›¢é˜Ÿè¶…è¿‡10-15äººï¼Œå•ä½“åº”ç”¨éƒ¨ç½²åè°ƒæˆæœ¬æ˜¾è‘—ä¸Šå‡ ä¸åŒåŠŸèƒ½æ¨¡å—çš„ä»£ç å†²çªé¢‘ç¹ï¼Œåˆå¹¶ä»£ç æˆä¸ºè´Ÿæ‹… ä¸šåŠ¡å¤æ‚åº¦ä¿¡å·
ä¸šåŠ¡åŸŸè¾¹ç•Œæ¸…æ™°ï¼Œå¯ä»¥è¯†åˆ«å‡ºç›¸å¯¹ç‹¬ç«‹çš„ä¸šåŠ¡èƒ½åŠ› ä¸åŒæ¨¡å—çš„å‘å¸ƒèŠ‚å¥å·®å¼‚æ˜æ˜¾ï¼ˆæœ‰çš„æ¨¡å—éœ€è¦é¢‘ç¹å‘å¸ƒï¼Œæœ‰çš„åˆ™ç›¸å¯¹ç¨³å®šï¼‰ æŠ€æœ¯å€ºåŠ¡ä¿¡å·
å•ä½“åº”ç”¨å¯åŠ¨æ—¶é—´è¶…è¿‡5åˆ†é’Ÿï¼Œä¸¥é‡å½±å“å¼€å‘æ•ˆç‡ å†…å­˜å ç”¨æŒç»­å¢é•¿ï¼Œå‚ç›´æ‰©å±•æˆæœ¬è¿‡é«˜ å•ç‚¹æ•…éšœé£é™©æ— æ³•æ¥å—ï¼Œéœ€è¦å¯¹æ ¸å¿ƒæ¨¡å—è¿›è¡Œéš”ç¦» 1.2 å¸¸è§çš„ä¼ªä¿¡å·ï¼ˆå€¼å¾—è­¦æƒ•ï¼‰ â€œå¤§å®¶éƒ½ç”¨å¾®æœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦ç”¨â€ â€”â€” ç›²ç›®è·Ÿé£ â€œå¾®æœåŠ¡çœ‹èµ·æ¥æ›´å…ˆè¿›â€ â€”â€” æŠ€æœ¯ç‚«æŠ€ â€œä¸ºäº†å­¦ä¹ å¾®æœåŠ¡è€Œæ‹†åˆ†â€ â€”â€” å­¦ä¹ æˆæœ¬è½¬å«ç»™é¡¹ç›® äºŒã€é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰æŒ‡å¯¼ä¸‹çš„æœåŠ¡æ‹†åˆ† 2.1 è¯†åˆ«é™ç•Œä¸Šä¸‹æ–‡ é™ç•Œä¸Šä¸‹æ–‡æ˜¯é¢†åŸŸæ¨¡å‹çš„è¾¹ç•Œï¼Œä¹Ÿæ˜¯å¾®æœåŠ¡æ‹†åˆ†çš„å¤©ç„¶è¾¹ç•Œã€‚æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¯†åˆ«ï¼š
graph TD A[æ”¶é›†é¢†åŸŸæœ¯è¯­] --> B[è¯†åˆ«èšåˆæ ¹] B --> C[åˆ’åˆ†é™ç•Œä¸Šä¸‹æ–‡] C --> D[éªŒè¯ä¸Šä¸‹æ–‡è¾¹ç•Œ] D --> E[ç¡®å®šæœåŠ¡æ‹†åˆ†æ–¹æ¡ˆ] å®è·µæ¡ˆä¾‹ï¼šç”µå•†è®¢å•ç³»ç»Ÿ
é”™è¯¯æ‹†åˆ†ï¼ˆæŒ‰æŠ€æœ¯å±‚æ¬¡ï¼‰ï¼š
- ç”¨æˆ·æœåŠ¡ï¼ˆUser Serviceï¼‰ - è®¢å•æœåŠ¡ï¼ˆOrder Serviceï¼‰ - æ”¯ä»˜æœåŠ¡ï¼ˆPayment Serviceï¼‰ - åº“å­˜æœåŠ¡ï¼ˆInventory Serviceï¼‰ è¿™ç§æ‹†åˆ†çœ‹ä¼¼åˆç†ï¼Œä½†å®é™…ä¸Šè®¢å•æœåŠ¡å’Œæ”¯ä»˜æœåŠ¡ä¹‹é—´è€¦åˆä¸¥é‡ï¼Œè®¢å•çŠ¶æ€å˜æ›´éœ€è¦åŒæ­¥æ›´æ–°æ”¯ä»˜çŠ¶æ€ï¼Œå¯¼è‡´åˆ†å¸ƒå¼äº‹åŠ¡å¤æ‚åº¦å‘ˆæŒ‡æ•°çº§ä¸Šå‡ã€‚
æ­£ç¡®æ‹†åˆ†ï¼ˆæŒ‰ä¸šåŠ¡èƒ½åŠ›ï¼‰ï¼š
- äº¤æ˜“ä¸Šä¸‹æ–‡ï¼ˆTrading Contextï¼‰ï¼šå¤„ç†ä¸‹å•ã€æ”¯ä»˜ã€é€€æ¬¾ - å±¥çº¦ä¸Šä¸‹æ–‡ï¼ˆFulfillment Contextï¼‰ï¼šå¤„ç†åº“å­˜ã€å‘è´§ã€é€€è´§ - ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼ˆUser Contextï¼‰ï¼šç”¨æˆ·ä¿¡æ¯ã€è´¦æˆ·ç®¡ç† - å•†å“ä¸Šä¸‹æ–‡ï¼ˆProduct Contextï¼‰ï¼šå•†å“ä¿¡æ¯ã€ä»·æ ¼ç®¡ç† 2.2 é¿å…åˆ†å¸ƒå¼å•ä½“é™·é˜± åæ¨¡å¼ç¤ºä¾‹ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/ class=category-link>æŠ€æœ¯æ ˆ</a></div><span class=post-date>2026-01-05</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®è·µä¸åæ€ï¼šä»å•ä½“åˆ°åˆ†å¸ƒå¼çš„æ¼”è¿›ä¹‹è·¯" href=/blog/articles/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%8B%86%E5%88%86%E5%AE%9E%E8%B7%B5%E4%B8%8E%E5%8F%8D%E6%80%9D%E4%BB%8E%E5%8D%95%E4%BD%93%E5%88%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%9A%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>åç«¯ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼šä»å•ä½“åˆ°å¾®æœåŠ¡çš„æ¼”è¿›ä¹‹è·¯</h2></header><div class=entry-content><p>å¼•è¨€ éšç€ä¸šåŠ¡è§„æ¨¡çš„ä¸æ–­æ‰©å¤§ï¼Œåç«¯ç³»ç»Ÿæ¶æ„éœ€è¦ä¸æ–­æ¼”è¿›ä»¥åº”å¯¹æ—¥ç›Šå¢é•¿çš„æŒ‘æˆ˜ã€‚ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡æ¶æ„ï¼Œä»å•æœºéƒ¨ç½²åˆ°åˆ†å¸ƒå¼é›†ç¾¤ï¼Œæ¯ä¸€æ¬¡æ¶æ„æ¼”è¿›éƒ½æ˜¯ä¸ºäº†è§£å†³ç‰¹å®šçš„ç—›ç‚¹ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨åç«¯ç³»ç»Ÿæ¶æ„è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™ã€æ¨¡å¼ä¸å®è·µã€‚
ä¸€ã€æ¶æ„æ¼”è¿›å†ç¨‹ 1.1 æ¶æ„æ¼”è¿›è·¯å¾„ å•ä½“åº”ç”¨ â†’ åˆ†å±‚æ¶æ„ â†’ SOA â†’ å¾®æœåŠ¡ â†’ Serverless æ¼”è¿›é˜¶æ®µå¯¹æ¯”
æ¶æ„ç±»å‹ ç‰¹ç‚¹ ä¼˜åŠ¿ æŒ‘æˆ˜ é€‚ç”¨åœºæ™¯ å•ä½“åº”ç”¨ å•ä¸€ä»£ç åº“ã€å•ä¸€éƒ¨ç½² å¼€å‘ç®€å•ã€éƒ¨ç½²å®¹æ˜“ æ‰©å±•æ€§å·®ã€æŠ€æœ¯æ ˆå›ºå®š å°å‹é¡¹ç›®ã€åˆåˆ›æœŸ åˆ†å±‚æ¶æ„ MVC/MVPåˆ†å±‚ èŒè´£æ¸…æ™°ã€æ˜“äºç»´æŠ¤ å±‚é—´è€¦åˆå¼º ä¸­å°å‹é¡¹ç›® SOA æœåŠ¡åŒ–ã€ESBæ€»çº¿ æœåŠ¡å¤ç”¨ã€æ¾è€¦åˆ ESBå•ç‚¹ã€å¤æ‚åº¦é«˜ ä¼ä¸šçº§åº”ç”¨ å¾®æœåŠ¡ ç‹¬ç«‹æœåŠ¡ã€è‡ªæ²»éƒ¨ç½² ç‹¬ç«‹æ‰©å±•ã€æŠ€æœ¯è‡ªç”± è¿ç»´å¤æ‚ã€åˆ†å¸ƒå¼äº‹åŠ¡ å¤§å‹å¤æ‚ç³»ç»Ÿ Serverless å‡½æ•°çº§ã€æŒ‰éœ€ä»˜è´¹ æè‡´å¼¹æ€§ã€æˆæœ¬ä¼˜åŒ– å‚å•†é”å®šã€å†·å¯åŠ¨ äº‹ä»¶é©±åŠ¨ã€æ³¢å³°æ˜æ˜¾ 1.2 å•ä½“æ¶æ„çš„å±€é™æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # å•ä½“åº”ç”¨çš„å…¸å‹é—®é¢˜ # é—®é¢˜1: ä»£ç è€¦åˆä¸¥é‡ # ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†æµç¨‹æ¶‰åŠå¤šä¸ªæ¨¡å— class OrderService: def create_order(self, user_id, items): # ç›´æ¥ä¾èµ–å¤šä¸ªæ¨¡å— user = UserService().get_user(user_id) inventory = InventoryService().check_stock(items) payment = PaymentService().process_payment(items) shipping = ShippingService().calculate_shipping(user.address) notification = NotificationService().send_confirmation(user.email) # å¦‚æœä»»ä½•ä¸€ä¸ªæ¨¡å—å‡ºé”™ï¼Œæ•´ä¸ªè®¢å•åˆ›å»ºå¤±è´¥ return Order(user=user, items=items, payment=payment) # é—®é¢˜2: éš¾ä»¥ç‹¬ç«‹æ‰©å±• # å½“è®¢å•æœåŠ¡å‹åŠ›å¤§æ—¶ï¼Œå¿…é¡»æ•´ä½“æ‰©å±• # æ— æ³•é’ˆå¯¹ç‰¹å®šç“¶é¢ˆæœåŠ¡å•ç‹¬æ‰©å®¹ # é—®é¢˜3: æŠ€æœ¯æ ˆé”å®š # æ•´ä¸ªåº”ç”¨å¿…é¡»ä½¿ç”¨ç›¸åŒçš„è¯­è¨€å’Œæ¡†æ¶ # æ— æ³•ä¸ºæ–°æœåŠ¡é€‰æ‹©æ›´é€‚åˆçš„æŠ€æœ¯ # é—®é¢˜4: éƒ¨ç½²é£é™©é«˜ # ä»»ä½•å°çš„ä¿®æ”¹éƒ½éœ€è¦é‡æ–°éƒ¨ç½²æ•´ä¸ªåº”ç”¨ # ä¸€å¤„bugå¯èƒ½å½±å“æ•´ä¸ªç³»ç»Ÿ äºŒã€å¾®æœåŠ¡æ¶æ„è®¾è®¡ 2.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 # ========== æœåŠ¡æ‹†åˆ†åŸåˆ™ ========== # 1. å•ä¸€èŒè´£åŸåˆ™ # æ¯ä¸ªæœåŠ¡ä¸“æ³¨äºä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ class UserService: """ç”¨æˆ·æœåŠ¡ - åªè´Ÿè´£ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡""" def create_user(self, data): pass def get_user(self, user_id): pass def update_user(self, user_id, data): pass class OrderService: """è®¢å•æœåŠ¡ - åªè´Ÿè´£è®¢å•ç›¸å…³çš„ä¸šåŠ¡""" def create_order(self, data): pass def get_order(self, order_id): pass def cancel_order(self, order_id): pass # 2. é™ç•Œä¸Šä¸‹æ–‡åŸåˆ™ # æŒ‰ç…§ä¸šåŠ¡é¢†åŸŸè¾¹ç•Œæ‹†åˆ†æœåŠ¡ # DDD (Domain-Driven Design) æˆ˜æœ¯æ¨¡å¼ # 3. æ•°æ®ç‹¬ç«‹æ€§åŸåˆ™ # æ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ class UserDatabase: """ç”¨æˆ·æœåŠ¡çš„æ•°æ®åº“""" def __init__(self): self.db = PostgreSQL('users_db') class OrderDatabase: """è®¢å•æœåŠ¡çš„æ•°æ®åº“""" def __init__(self): self.db = MongoDB('orders_db') # 4. APIç½‘å…³åŸåˆ™ # ç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±è½¬å‘ class APIGateway: """APIç½‘å…³ - æœåŠ¡ç»Ÿä¸€å…¥å£""" def __init__(self): self.routes = { '/api/users/*': UserService(), '/api/orders/*': OrderService(), '/api/products/*': ProductService(), '/api/payments/*': PaymentService() } def route(self, request): # è·¯ç”±åŒ¹é… for pattern, service in self.routes.items(): if request.path.match(pattern): return service.handle(request) # èšåˆå¤šä¸ªæœåŠ¡çš„å“åº” if request.path == '/api/dashboard': return self.aggregate_dashboard(request) def aggregate_dashboard(self, request): """èšåˆå¤šä¸ªæœåŠ¡çš„æ•°æ®""" user_data = self.call_service('/api/users/me', request) order_data = self.call_service('/api/orders/recent', request) notification_data = self.call_service('/api/notifications', request) return { 'user': user_data, 'orders': order_data, 'notifications': notification_data } 2.2 æœåŠ¡é€šä¿¡æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 # ========== åŒæ­¥é€šä¿¡: REST/gRPC ========== import requests from typing import Protocol # REST APIè°ƒç”¨ class OrderClient: """è®¢å•æœåŠ¡å®¢æˆ·ç«¯""" BASE_URL = "http://order-service:8080" def create_order(self, order_data: dict) -> dict: response = requests.post( f"{self.BASE_URL}/api/orders", json=order_data, timeout=5 # è¶…æ—¶æ§åˆ¶ ) response.raise_for_status() return response.json() def get_order(self, order_id: str) -> dict: response = requests.get( f"{self.BASE_URL}/api/orders/{order_id}", timeout=3 ) response.raise_for_status() return response.json() # gRPCè°ƒç”¨ (æ€§èƒ½æ›´é«˜) import grpc from generated import order_pb2, order_pb2_grpc class OrderGRPCClient: """è®¢å•æœåŠ¡gRPCå®¢æˆ·ç«¯""" def __init__(self): self.channel = grpc.insecure_channel('order-service:9090') self.stub = order_pb2_grpc.OrderServiceStub(self.channel) def create_order(self, order_data: dict) -> order_pb2.OrderResponse: request = order_pb2.CreateOrderRequest( user_id=order_data['user_id'], items=[ order_pb2.OrderItem( product_id=item['product_id'], quantity=item['quantity'] ) for item in order_data['items'] ] ) return self.stub.CreateOrder(request, timeout=5) # ========== å¼‚æ­¥é€šä¿¡: æ¶ˆæ¯é˜Ÿåˆ— ========== import asyncio from aio_pika import connect, Message class EventBus: """äº‹ä»¶æ€»çº¿ - å¼‚æ­¥æ¶ˆæ¯ä¼ é€’""" def __init__(self, amqp_url: str): self.connection = None self.channel = None self.amqp_url = amqp_url async def connect(self): """å»ºç«‹è¿æ¥""" self.connection = await connect(self.amqp_url) self.channel = await self.connection.channel() # å£°æ˜äº¤æ¢æœº await self.channel.declare_exchange( 'domain-events', 'topic', durable=True ) async def publish(self, event_type: str, event_data: dict): """å‘å¸ƒäº‹ä»¶""" exchange = await self.get_exchange() message = Message( json.dumps(event_data).encode(), content_type='application/json', delivery_mode=2 # æŒä¹…åŒ– ) await exchange.publish( message, routing_key=event_type ) async def subscribe(self, event_pattern: str, handler): """è®¢é˜…äº‹ä»¶""" exchange = await self.get_exchange() # å£°æ˜é˜Ÿåˆ— queue = await self.channel.declare_queue( f'{event_pattern}-queue', durable=True ) # ç»‘å®šäº¤æ¢æœº await queue.bind(exchange, routing_key=event_pattern) async with queue.iterator() as queue_iter: async for message in queue_iter: try: event_data = json.loads(message.body.decode()) await handler(event_data) await message.ack() except Exception as e: await message.nack() # äº‹ä»¶é©±åŠ¨æ¶æ„ç¤ºä¾‹ class OrderCreatedEvent: """è®¢å•åˆ›å»ºäº‹ä»¶""" def __init__(self, order_id, user_id, items): self.event_type = 'order.created' self.data = { 'order_id': order_id, 'user_id': user_id, 'items': items, 'timestamp': datetime.now().isoformat() } # è®¢å•æœåŠ¡å‘å¸ƒäº‹ä»¶ async def create_order_with_event(order_data): # åˆ›å»ºè®¢å• order = await order_repository.create(order_data) # å‘å¸ƒäº‹ä»¶ event_bus = EventBus() await event_bus.publish( 'order.created', OrderCreatedEvent( order.id, order.user_id, order.items ).data ) return order # åº“å­˜æœåŠ¡ç›‘å¬äº‹ä»¶ async def handle_order_created(event_data): """å¤„ç†è®¢å•åˆ›å»ºäº‹ä»¶ - æ‰£å‡åº“å­˜""" order_id = event_data['order_id'] items = event_data['items'] for item in items: await inventory_service.deduct_stock( item['product_id'], item['quantity'] ) await event_bus.publish( 'inventory.deducted', {'order_id': order_id, 'status': 'completed'} ) # é€šçŸ¥æœåŠ¡ç›‘å¬äº‹ä»¶ async def handle_inventory_deducted(event_data): """å¤„ç†åº“å­˜æ‰£å‡å®Œæˆäº‹ä»¶ - å‘é€é€šçŸ¥""" order_id = event_data['order_id'] order = await order_repository.get(order_id) await notification_service.send_order_confirmation( order.user_email, order_id ) 2.3 æœåŠ¡å‘ç°ä¸æ³¨å†Œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 # ========== æœåŠ¡æ³¨å†Œä¸­å¿ƒ ========== import asyncio from typing import Dict, List, Optional from datetime import datetime, timedelta class ServiceInstance: """æœåŠ¡å®ä¾‹""" def __init__(self, service_id: str, address: str, port: int): self.service_id = service_id self.address = address self.port = port self.last_heartbeat = datetime.now() @property def url(self) -> str: return f"http://{self.address}:{self.port}" def is_alive(self, timeout: int = 10) -> bool: """æ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜æ´»""" return (datetime.now() - self.last_heartbeat).seconds &lt; timeout class ServiceRegistry: """æœåŠ¡æ³¨å†Œä¸­å¿ƒ""" def __init__(self): self.services: Dict[str, List[ServiceInstance]] = {} def register(self, service_name: str, instance: ServiceInstance): """æ³¨å†ŒæœåŠ¡å®ä¾‹""" if service_name not in self.services: self.services[service_name] = [] # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ existing = next( (i for i in self.services[service_name] if i.service_id == instance.service_id), None ) if existing: # æ›´æ–°å¿ƒè·³æ—¶é—´ existing.last_heartbeat = datetime.now() else: # æ–°æ³¨å†Œ self.services[service_name].append(instance) print(f"Registered: {service_name} - {instance.url}") def deregister(self, service_name: str, service_id: str): """æ³¨é”€æœåŠ¡å®ä¾‹""" if service_name in self.services: self.services[service_name] = [ i for i in self.services[service_name] if i.service_id != service_id ] def discover(self, service_name: str) -> Optional[ServiceInstance]: """æœåŠ¡å‘ç° - è´Ÿè½½å‡è¡¡""" if service_name not in self.services: return None # è¿‡æ»¤æ‰å¤±æ•ˆçš„å®ä¾‹ alive_instances = [ i for i in self.services[service_name] if i.is_alive() ] if not alive_instances: return None # è½®è¯¢è´Ÿè½½å‡è¡¡ return alive_instances[hash(service_name) % len(alive_instances)] # æˆ–è€…ä½¿ç”¨éšæœºé€‰æ‹© # return random.choice(alive_instances) def heartbeat(self, service_name: str, service_id: str): """æ¥æ”¶å¿ƒè·³""" if service_name in self.services: for instance in self.services[service_name]: if instance.service_id == service_id: instance.last_heartbeat = datetime.now() # ========== æœåŠ¡å®¢æˆ·ç«¯ ========== class ServiceClient: """æœåŠ¡å®¢æˆ·ç«¯ - å¸¦æœåŠ¡å‘ç°""" def __init__(self, registry: ServiceRegistry): self.registry = registry self.cache = {} # ç¼“å­˜æœåŠ¡åœ°å€ async def call(self, service_name: str, endpoint: str, **kwargs): """è°ƒç”¨æœåŠ¡""" # ä»ç¼“å­˜æˆ–æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åœ°å€ instance = self.cache.get(service_name) if not instance or not instance.is_alive(): instance = self.registry.discover(service_name) if not instance: raise ServiceUnavailableException(f"Service {service_name} not found") self.cache[service_name] = instance # æ„å»ºè¯·æ±‚URL url = f"{instance.url}{endpoint}" try: response = requests.post(url, json=kwargs, timeout=5) response.raise_for_status() return response.json() except requests.RequestException as e: # è°ƒç”¨å¤±è´¥ï¼Œæ¸…é™¤ç¼“å­˜ self.cache.pop(service_name, None) raise e # ========== ä½¿ç”¨ç¤ºä¾‹ ========== # æœåŠ¡å¯åŠ¨æ—¶æ³¨å†Œ registry = ServiceRegistry() async def start_service(): service_instance = ServiceInstance( service_id=f"order-service-{os.getenv('INSTANCE_ID')}", address=os.getenv('SERVICE_ADDRESS'), port=int(os.getenv('SERVICE_PORT')) ) registry.register('order-service', service_instance) # å®šæœŸå‘é€å¿ƒè·³ while True: await asyncio.sleep(5) registry.heartbeat('order-service', service_instance.service_id) 2.4 åˆ†å¸ƒå¼é…ç½®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 # ========== é…ç½®ä¸­å¿ƒ ========== import asyncio import json from typing import Any, Callable from watchfiles import awatch class ConfigCenter: """åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ""" def __init__(self, config_dir: str = './config'): self.config_dir = config_dir self.configs = {} self.watchers = {} # config_key -> [callbacks] def load_config(self, service_name: str) -> dict: """åŠ è½½æœåŠ¡é…ç½®""" config_file = f"{self.config_dir}/{service_name}.json" try: with open(config_file) as f: config = json.load(f) self.configs[service_name] = config return config except FileNotFoundError: return {} def get_config(self, service_name: str, key: str = None) -> Any: """è·å–é…ç½®""" config = self.configs.get(service_name, {}) if key: return config.get(key) return config def watch_config(self, service_name: str, callback: Callable): """ç›‘å¬é…ç½®å˜åŒ–""" if service_name not in self.watchers: self.watchers[service_name] = [] self.watchers[service_name].append(callback) async def watch_changes(self): """ç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ–""" async for changes in awatch(self.config_dir): for change_type, config_path in changes: service_name = config_path.stem if change_type == Change.modified: # é‡æ–°åŠ è½½é…ç½® old_config = self.configs.get(service_name, {}) new_config = self.load_config(service_name) # è§¦å‘å›è°ƒ if service_name in self.watchers: for callback in self.watchers[service_name]: await callback(old_config, new_config) # ========== ä½¿ç”¨ç¤ºä¾‹ ========== config_center = ConfigCenter() # åŠ è½½é…ç½® app_config = config_center.load_config('order-service') # ç›‘å¬é…ç½®å˜åŒ– async def on_config_changed(old_config, new_config): """é…ç½®å˜åŒ–å¤„ç†""" if old_config.get('log_level') != new_config.get('log_level'): # é‡æ–°é…ç½®æ—¥å¿—çº§åˆ« logging.getLogger().setLevel(new_config['log_level']) if old_config.get('database') != new_config.get('database'): # é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥ await reconnect_database(new_config['database']) config_center.watch_config('order-service', on_config_changed) ä¸‰ã€æ•°æ®ä¸€è‡´æ€§è®¾è®¡ 3.1 åˆ†å¸ƒå¼äº‹åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 # ========== ä¸¤é˜¶æ®µæäº¤ (2PC) ========== class TwoPhaseCommit: """ä¸¤é˜¶æ®µæäº¤åè°ƒè€…""" def __init__(self): self.participants = [] def register_participant(self, participant): """æ³¨å†Œå‚ä¸è€…""" self.participants.append(participant) async def execute(self, transaction_data): """æ‰§è¡Œåˆ†å¸ƒå¼äº‹åŠ¡""" transaction_id = generate_transaction_id() # é˜¶æ®µ1: å‡†å¤‡é˜¶æ®µ prepared = [] for participant in self.participants: try: result = await participant.prepare(transaction_id, transaction_data) if result == 'PREPARED': prepared.append(participant) else: # ä»»ä½•å‚ä¸è€…æ‹’ç»ï¼Œå›æ»šæ‰€æœ‰ await self._rollback_all(transaction_id, prepared) return False except Exception as e: await self._rollback_all(transaction_id, prepared) raise e # é˜¶æ®µ2: æäº¤é˜¶æ®µ committed = [] for participant in prepared: try: await participant.commit(transaction_id) committed.append(participant) except Exception as e: # æäº¤å¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥ await self._rollback_all(transaction_id, committed) raise Exception(f"Commit failed: {e}") return True async def _rollback_all(self, transaction_id, participants): """å›æ»šæ‰€æœ‰å‚ä¸è€…""" for participant in participants: try: await participant.rollback(transaction_id) except Exception as e: logging.error(f"Rollback failed: {e}") # ========== Sagaæ¨¡å¼ ========== # é•¿äº‹åŠ¡çš„æ›¿ä»£æ–¹æ¡ˆ class SagaOrchestrator: """Sagaç¼–æ’å™¨""" def __init__(self): self.steps = [] self.compensations = [] def add_step(self, action, compensation): """æ·»åŠ æ­¥éª¤""" self.steps.append(action) self.compensations.append(compensation) async def execute(self, initial_data): """æ‰§è¡ŒSaga""" context = initial_data executed_steps = [] # æ‰§è¡Œæ¯ä¸ªæ­¥éª¤ for i, step in enumerate(self.steps): try: context = await step(context) executed_steps.append(i) except Exception as e: # å¤±è´¥ï¼Œæ‰§è¡Œè¡¥å¿ await self._compensate(executed_steps, context) raise e return context async def _compensate(self, executed_steps, context): """æ‰§è¡Œè¡¥å¿äº‹åŠ¡""" # é€†åºæ‰§è¡Œè¡¥å¿ for i in reversed(executed_steps): try: await self.compensations[i](context) except Exception as e: logging.error(f"Compensation failed: {e}") # è®¢å•Sagaç¤ºä¾‹ class OrderSaga: """è®¢å•å¤„ç†Saga""" def __init__(self): self.saga = SagaOrchestrator() self._setup_steps() def _setup_steps(self): """è®¾ç½®Sagaæ­¥éª¤""" # æ­¥éª¤1: åˆ›å»ºè®¢å• async def create_order(context): order = await order_repository.create(context['order_data']) context['order'] = order return context async def cancel_order(context): await order_repository.update_status( context['order'].id, 'CANCELLED' ) # æ­¥éª¤2: æ‰£å‡åº“å­˜ async def deduct_inventory(context): for item in context['order'].items: await inventory_service.deduct_stock( item.product_id, item.quantity ) return context async def restore_inventory(context): for item in context['order'].items: await inventory_service.restore_stock( item.product_id, item.quantity ) # æ­¥éª¤3: å¤„ç†æ”¯ä»˜ async def process_payment(context): payment = await payment_service.charge( context['order'].user_id, context['order'].total_amount ) context['payment'] = payment return context async def refund_payment(context): await payment_service.refund( context['payment'].transaction_id ) # æ­¥éª¤4: å‘é€é€šçŸ¥ async def send_notification(context): await notification_service.send( context['order'].user_email, 'Order Created', f'Your order {context["order"].id} has been created' ) return context async def cancel_notification(context): # é€šçŸ¥å¯èƒ½ä¸éœ€è¦è¡¥å¿ pass # æ·»åŠ æ­¥éª¤å’Œè¡¥å¿ self.saga.add_step(create_order, cancel_order) self.saga.add_step(deduct_inventory, restore_inventory) self.saga.add_step(process_payment, refund_payment) self.saga.add_step(send_notification, cancel_notification) async def execute(self, order_data): """æ‰§è¡Œè®¢å•Saga""" return await self.saga.execute({'order_data': order_data}) 3.2 æœ€ç»ˆä¸€è‡´æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 # ========== äº‹ä»¶æº¯æº ========== # é€šè¿‡äº‹ä»¶æµé‡å»ºçŠ¶æ€ class EventStore: """äº‹ä»¶å­˜å‚¨""" def __init__(self): self.events = [] async def append_event(self, aggregate_id: str, event: dict): """è¿½åŠ äº‹ä»¶""" event['aggregate_id'] = aggregate_id event['timestamp'] = datetime.now().isoformat() event['version'] = len(self.events) + 1 self.events.append(event) async def get_events(self, aggregate_id: str) -> List[dict]: """è·å–èšåˆçš„æ‰€æœ‰äº‹ä»¶""" return [ e for e in self.events if e['aggregate_id'] == aggregate_id ] class OrderAggregate: """è®¢å•èšåˆ - é€šè¿‡äº‹ä»¶é‡å»ºçŠ¶æ€""" def __init__(self, event_store: EventStore): self.event_store = event_store self.state = None async def rebuild(self, order_id: str): """ä»äº‹ä»¶æµé‡å»ºçŠ¶æ€""" events = await self.event_store.get_events(order_id) state = None for event in events: state = self._apply_event(state, event) self.state = state return state def _apply_event(self, state, event): """åº”ç”¨äº‹ä»¶åˆ°çŠ¶æ€""" event_type = event['type'] if event_type == 'OrderCreated': return { 'id': event['order_id'], 'user_id': event['user_id'], 'items': event['items'], 'status': 'CREATED' } elif event_type == 'PaymentCompleted': state['status'] = 'PAID' state['payment_id'] = event['payment_id'] return state elif event_type == 'OrderShipped': state['status'] = 'SHIPPED' state['shipping_id'] = event['shipping_id'] return state elif event_type == 'OrderCancelled': state['status'] = 'CANCELLED' return state return state async def create_order(self, user_id, items): """åˆ›å»ºè®¢å•""" event = { 'type': 'OrderCreated', 'order_id': generate_id(), 'user_id': user_id, 'items': items } await self.event_store.append_event(event['order_id'], event) return await self.rebuild(event['order_id']) # ========== CQRS ========== # å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦» class CommandBus: """å‘½ä»¤æ€»çº¿""" def __init__(self): self.handlers = {} def register(self, command_type: str, handler): """æ³¨å†Œå‘½ä»¤å¤„ç†å™¨""" self.handlers[command_type] = handler async def execute(self, command: dict): """æ‰§è¡Œå‘½ä»¤""" command_type = command['type'] if command_type not in self.handlers: raise ValueError(f"Unknown command: {command_type}") return await self.handlers[command_type](command) class QueryBus: """æŸ¥è¯¢æ€»çº¿""" def __init__(self): self.handlers = {} def register(self, query_type: str, handler): """æ³¨å†ŒæŸ¥è¯¢å¤„ç†å™¨""" self.handlers[query_type] = handler async def execute(self, query: dict): """æ‰§è¡ŒæŸ¥è¯¢""" query_type = query['type'] if query_type not in self.handlers: raise ValueError(f"Unknown query: {query_type}") return await self.handlers[query_type](query) # CQRSç¤ºä¾‹ class OrderService: """è®¢å•æœåŠ¡ - CQRS""" def __init__(self): self.command_bus = CommandBus() self.query_bus = QueryBus() self.event_store = EventStore() self.read_db = {} # è¯»æ¨¡å‹ self._register_handlers() def _register_handlers(self): """æ³¨å†Œå¤„ç†å™¨""" # å‘½ä»¤å¤„ç†å™¨ self.command_bus.register('CreateOrder', self._handle_create_order) self.command_bus.register('CancelOrder', self._handle_cancel_order) # æŸ¥è¯¢å¤„ç†å™¨ self.query_bus.register('GetOrder', self._handle_get_order) self.query_bus.register('ListOrders', self._handle_list_orders) async def _handle_create_order(self, command): """å¤„ç†åˆ›å»ºè®¢å•å‘½ä»¤""" event = { 'type': 'OrderCreated', 'order_id': command['order_id'], 'user_id': command['user_id'], 'items': command['items'] } await self.event_store.append_event(command['order_id'], event) # æ›´æ–°è¯»æ¨¡å‹ self._update_read_model(event) return event['order_id'] async def _handle_cancel_order(self, command): """å¤„ç†å–æ¶ˆè®¢å•å‘½ä»¤""" event = { 'type': 'OrderCancelled', 'order_id': command['order_id'] } await self.event_store.append_event(command['order_id'], event) # æ›´æ–°è¯»æ¨¡å‹ self._update_read_model(event) async def _handle_get_order(self, query): """å¤„ç†è·å–è®¢å•æŸ¥è¯¢""" return self.read_db.get(query['order_id']) async def _handle_list_orders(self, query): """å¤„ç†è®¢å•åˆ—è¡¨æŸ¥è¯¢""" user_id = query.get('user_id') orders = [ order for order in self.read_db.values() if not user_id or order['user_id'] == user_id ] return orders def _update_read_model(self, event): """æ›´æ–°è¯»æ¨¡å‹""" order_id = event['order_id'] if event['type'] == 'OrderCreated': self.read_db[order_id] = { 'id': order_id, 'user_id': event['user_id'], 'items': event['items'], 'status': 'CREATED' } elif event['type'] == 'OrderCancelled': if order_id in self.read_db: self.read_db[order_id]['status'] = 'CANCELLED' å››ã€å®¹é”™ä¸é«˜å¯ç”¨è®¾è®¡ 4.1 ç†”æ–­å™¨æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 import asyncio from enum import Enum from datetime import datetime, timedelta class CircuitState(Enum): CLOSED = 'CLOSED' # æ­£å¸¸çŠ¶æ€ OPEN = 'OPEN' # ç†”æ–­çŠ¶æ€ HALF_OPEN = 'HALF_OPEN' # åŠå¼€çŠ¶æ€ class CircuitBreaker: """ç†”æ–­å™¨""" def __init__( self, failure_threshold: int = 5, timeout: int = 60, half_open_attempts: int = 3 ): self.failure_threshold = failure_threshold self.timeout = timeout self.half_open_attempts = half_open_attempts self.state = CircuitState.CLOSED self.failure_count = 0 self.success_count = 0 self.last_failure_time = None async def call(self, func, *args, **kwargs): """é€šè¿‡ç†”æ–­å™¨è°ƒç”¨å‡½æ•°""" if self.state == CircuitState.OPEN: # ç†”æ–­çŠ¶æ€ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥è¿›å…¥åŠå¼€ if self._should_attempt_reset(): self.state = CircuitState.HALF_OPEN self.success_count = 0 else: raise CircuitBreakerOpenException( f"Circuit breaker is OPEN. Try again later." ) try: result = await func(*args, **kwargs) # æˆåŠŸï¼Œé‡ç½®è®¡æ•° self._on_success() return result except Exception as e: # å¤±è´¥ï¼Œå¢åŠ è®¡æ•° self._on_failure() raise e def _should_attempt_reset(self) -> bool: """æ£€æŸ¥æ˜¯å¦åº”è¯¥å°è¯•é‡ç½®""" if self.last_failure_time is None: return False elapsed = (datetime.now() - self.last_failure_time).seconds return elapsed >= self.timeout def _on_success(self): """å¤„ç†æˆåŠŸ""" if self.state == CircuitState.HALF_OPEN: self.success_count += 1 # åŠå¼€çŠ¶æ€ä¸‹è¿ç»­æˆåŠŸï¼Œæ¢å¤å…³é—­çŠ¶æ€ if self.success_count >= self.half_open_attempts: self.state = CircuitState.CLOSED self.failure_count = 0 elif self.state == CircuitState.CLOSED: self.failure_count = 0 def _on_failure(self): """å¤„ç†å¤±è´¥""" self.failure_count += 1 self.last_failure_time = datetime.now() # è¾¾åˆ°é˜ˆå€¼ï¼Œæ‰“å¼€ç†”æ–­å™¨ if self.failure_count >= self.failure_threshold: self.state = CircuitState.OPEN # ä½¿ç”¨ç¤ºä¾‹ async def call_external_service(url): """è°ƒç”¨å¤–éƒ¨æœåŠ¡""" response = await aiohttp.get(url) return await response.json() # åˆ›å»ºç†”æ–­å™¨ circuit_breaker = CircuitBreaker( failure_threshold=5, timeout=60, half_open_attempts=3 ) # é€šè¿‡ç†”æ–­å™¨è°ƒç”¨ try: result = await circuit_breaker.call( call_external_service, 'http://external-service/api/data' ) except CircuitBreakerOpenException: # ç†”æ–­å™¨æ‰“å¼€ï¼Œä½¿ç”¨é™çº§é€»è¾‘ result = get_cached_data() except Exception as e: # å…¶ä»–é”™è¯¯å¤„ç† logger.error(f"Service call failed: {e}") 4.2 é‡è¯•ä¸è¶…æ—¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 import asyncio from functools import wraps from typing import Callable, Type class RetryConfig: """é‡è¯•é…ç½®""" def __init__( self, max_attempts: int = 3, base_delay: float = 1.0, max_delay: float = 10.0, exponential_base: float = 2, jitter: bool = True, retry_exceptions: list = None ): self.max_attempts = max_attempts self.base_delay = base_delay self.max_delay = max_delay self.exponential_base = exponential_base self.jitter = jitter self.retry_exceptions = retry_exceptions or [Exception] def retry(config: RetryConfig = None): """é‡è¯•è£…é¥°å™¨""" if config is None: config = RetryConfig() def decorator(func: Callable): @wraps(func) async def wrapper(*args, **kwargs): last_exception = None for attempt in range(1, config.max_attempts + 1): try: return await func(*args, **kwargs) except tuple(config.retry_exceptions) as e: last_exception = e if attempt &lt; config.max_attempts: # è®¡ç®—å»¶è¿Ÿæ—¶é—´ delay = min( config.base_delay * (config.exponential_base ** (attempt - 1)), config.max_delay ) # æ·»åŠ æŠ–åŠ¨ if config.jitter: delay = delay * (0.5 + random.random() * 0.5) logger.warning( f"Attempt {attempt} failed: {e}. " f"Retrying in {delay:.2f}s..." ) await asyncio.sleep(delay) # æ‰€æœ‰å°è¯•éƒ½å¤±è´¥ raise last_exception return wrapper return decorator # è¶…æ—¶è£…é¥°å™¨ def timeout(seconds: float): """è¶…æ—¶è£…é¥°å™¨""" def decorator(func: Callable): @wraps(func) async def wrapper(*args, **kwargs): try: return await asyncio.wait_for( func(*args, **kwargs), timeout=seconds ) except asyncio.TimeoutError: raise TimeoutException( f"Function {func.__name__} timed out after {seconds}s" ) return wrapper return decorator # ä½¿ç”¨ç¤ºä¾‹ @retry(RetryConfig( max_attempts=3, base_delay=1.0, exponential_base=2, retry_exceptions=[ConnectionError, TimeoutError] )) @timeout(seconds=5) async def call_external_api(url): """è°ƒç”¨å¤–éƒ¨APIï¼Œå¸¦é‡è¯•å’Œè¶…æ—¶""" async with aiohttp.ClientSession() as session: async with session.get(url) as response: response.raise_for_status() return await response.json() 4.3 é™æµä¸é™çº§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 import time from collections import deque from typing import Callable, Any class RateLimiter: """é€Ÿç‡é™åˆ¶å™¨""" def __init__(self, rate: int, per: float): """ rate: å…è®¸çš„è¯·æ±‚æ•° per: æ—¶é—´çª—å£ï¼ˆç§’ï¼‰ """ self.rate = rate self.per = per self.allowance = rate self.last_check = time.time() def acquire(self, tokens: int = 1) -> bool: """è·å–ä»¤ç‰Œ""" current = time.time() elapsed = current - self.last_check # è¡¥å……ä»¤ç‰Œ self.allowance += elapsed * (self.rate / self.per) if self.allowance > self.rate: self.allowance = self.rate self.last_check = current # æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œ if self.allowance &lt; tokens: return False self.allowance -= tokens return True class TokenBucket: """ä»¤ç‰Œæ¡¶ç®—æ³•""" def __init__(self, capacity: int, refill_rate: float): """ capacity: æ¡¶å®¹é‡ refill_rate: å¡«å……é€Ÿç‡ï¼ˆæ¯ç§’ï¼‰ """ self.capacity = capacity self.refill_rate = refill_rate self.tokens = capacity self.last_refill = time.time() def consume(self, tokens: int = 1) -> bool: """æ¶ˆè´¹ä»¤ç‰Œ""" self._refill() if self.tokens >= tokens: self.tokens -= tokens return True return False def _refill(self): """è¡¥å……ä»¤ç‰Œ""" now = time.time() elapsed = now - self.last_refill refill_amount = elapsed * self.refill_rate self.tokens = min(self.capacity, self.tokens + refill_amount) self.last_refill = now class SlidingWindow: """æ»‘åŠ¨çª—å£é™æµ""" def __init__(self, limit: int, window: float): """ limit: çª—å£å†…æœ€å¤§è¯·æ±‚æ•° window: æ—¶é—´çª—å£ï¼ˆç§’ï¼‰ """ self.limit = limit self.window = window self.requests = deque() def is_allowed(self) -> bool: """æ£€æŸ¥æ˜¯å¦å…è®¸è¯·æ±‚""" now = time.time() # ç§»é™¤çª—å£å¤–çš„è¯·æ±‚ while self.requests and self.requests[0] &lt; now - self.window: self.requests.popleft() # æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶ if len(self.requests) >= self.limit: return False self.requests.append(now) return True # é™çº§è£…é¥°å™¨ class FallbackExecutor: """é™çº§æ‰§è¡Œå™¨""" def __init__(self): self.fallbacks = {} def register_fallback(self, func_name: str, fallback: Callable): """æ³¨å†Œé™çº§å‡½æ•°""" self.fallbacks[func_name] = fallback async def execute_with_fallback( self, func: Callable, *args, fallback_result: Any = None, **kwargs ): """æ‰§è¡Œå‡½æ•°ï¼Œå¤±è´¥æ—¶é™çº§""" try: return await func(*args, **kwargs) except Exception as e: func_name = func.__name__ # æŸ¥æ‰¾æ³¨å†Œçš„é™çº§å‡½æ•° if func_name in self.fallbacks: logger.warning(f"Function {func_name} failed, using fallback") return await self.fallbacks[func_name](*args, **kwargs) # ä½¿ç”¨é»˜è®¤é™çº§ç»“æœ if fallback_result is not None: logger.warning(f"Function {func_name} failed, using fallback result") return fallback_result # æ²¡æœ‰é™çº§æ–¹æ¡ˆï¼ŒæŠ›å‡ºå¼‚å¸¸ raise e # ä½¿ç”¨ç¤ºä¾‹ # åˆ›å»ºé™æµå™¨ rate_limiter = RateLimiter(rate=100, per=1) # 100è¯·æ±‚/ç§’ token_bucket = TokenBucket(capacity=10, refill_rate=1) # 10ä»¤ç‰Œå®¹é‡ï¼Œæ¯ç§’è¡¥å……1ä¸ª sliding_window = SlidingWindow(limit=100, window=60) # 60ç§’å†…æœ€å¤š100è¯·æ±‚ # åˆ›å»ºé™çº§æ‰§è¡Œå™¨ fallback_executor = FallbackExecutor() async def get_user_data(user_id): """è·å–ç”¨æˆ·æ•°æ®""" # æ£€æŸ¥é™æµ if not rate_limiter.acquire(): raise RateLimitException("Too many requests") # è°ƒç”¨æœåŠ¡ return await user_service.get_user(user_id) # æ³¨å†Œé™çº§å‡½æ•° async def get_user_data_fallback(user_id): """é™çº§ï¼šè¿”å›ç¼“å­˜çš„ç”¨æˆ·æ•°æ®""" return await cache.get(f"user:{user_id}") fallback_executor.register_fallback('get_user_data', get_user_data_fallback) # ä½¿ç”¨ try: result = await fallback_executor.execute_with_fallback( get_user_data, user_id='123' ) except Exception as e: logger.error(f"All attempts failed: {e}") äº”ã€å¯è§‚æµ‹æ€§è®¾è®¡ 5.1 æ—¥å¿—ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 import structlog from typing import Any class LogContext: """æ—¥å¿—ä¸Šä¸‹æ–‡""" def __init__(self): self.context = {} def set(self, key: str, value: Any): """è®¾ç½®ä¸Šä¸‹æ–‡""" self.context[key] = value def get(self, key: str, default=None): """è·å–ä¸Šä¸‹æ–‡""" return self.context.get(key, default) def clear(self): """æ¸…ç©ºä¸Šä¸‹æ–‡""" self.context.clear() # å…¨å±€æ—¥å¿—ä¸Šä¸‹æ–‡ log_context = LogContext() # é…ç½®structlog structlog.configure( processors=[ structlog.stdlib.filter_by_level, structlog.stdlib.add_logger_name, structlog.stdlib.add_log_level, structlog.stdlib.PositionalArgumentsFormatter(), structlog.processors.TimeStamper(fmt="iso"), structlog.processors.StackInfoRenderer(), structlog.processors.format_exc_info, structlog.processors.UnicodeDecoder(), # æ·»åŠ ä¸Šä¸‹æ–‡ lambda logger, method_name, event_dict: { **event_dict, **log_context.context }, # æ ¼å¼åŒ–è¾“å‡º structlog.processors.JSONRenderer() ], context_class=dict, logger_factory=structlog.stdlib.LoggerFactory(), cache_logger_on_first_use=True, ) class ServiceLogger: """æœåŠ¡æ—¥å¿—è®°å½•å™¨""" def __init__(self, service_name: str): self.service_name = service_name self.logger = structlog.get_logger() def log_request(self, request_id: str, method: str, path: str, **kwargs): """è®°å½•è¯·æ±‚""" self.logger.info( "incoming_request", request_id=request_id, service=self.service_name, method=method, path=path, **kwargs ) def log_response( self, request_id: str, status_code: int, duration_ms: float, **kwargs ): """è®°å½•å“åº”""" self.logger.info( "outgoing_response", request_id=request_id, service=self.service_name, status_code=status_code, duration_ms=duration_ms, **kwargs ) def log_error(self, error: Exception, **kwargs): """è®°å½•é”™è¯¯""" self.logger.error( "error_occurred", service=self.service_name, error_type=type(error).__name__, error_message=str(error), **kwargs ) def log_service_call( self, service_name: str, method: str, duration_ms: float, success: bool, **kwargs ): """è®°å½•æœåŠ¡è°ƒç”¨""" self.logger.info( "service_call", caller=self.service_name, service=service_name, method=method, duration_ms=duration_ms, success=success, **kwargs ) # ä¸­é—´ä»¶ç¤ºä¾‹ class LoggingMiddleware: """æ—¥å¿—ä¸­é—´ä»¶""" def __init__(self, logger: ServiceLogger): self.logger = logger async def process_request(self, request, call_next): """å¤„ç†è¯·æ±‚""" request_id = generate_request_id() start_time = time.time() # è®¾ç½®æ—¥å¿—ä¸Šä¸‹æ–‡ log_context.set('request_id', request_id) log_context.set('user_id', request.user_id) # è®°å½•è¯·æ±‚ self.logger.log_request( request_id=request_id, method=request.method, path=request.path ) try: # å¤„ç†è¯·æ±‚ response = await call_next(request) # è®°å½•å“åº” duration_ms = (time.time() - start_time) * 1000 self.logger.log_response( request_id=request_id, status_code=response.status_code, duration_ms=duration_ms ) return response except Exception as e: duration_ms = (time.time() - start_time) * 1000 self.logger.log_error( error=e, request_id=request_id, duration_ms=duration_ms ) raise finally: log_context.clear() 5.2 é“¾è·¯è¿½è¸ª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 from opentelemetry import trace from opentelemetry.sdk.trace import TracerProvider from opentelemetry.sdk.trace.export import BatchSpanProcessor from opentelemetry.exporter.jaeger.thrift import JaegerExporter # é…ç½®Tracer trace.set_tracer_provider(TracerProvider()) tracer_provider = trace.get_tracer_provider() # é…ç½®Jaegerå¯¼å‡ºå™¨ jaeger_exporter = JaegerExporter( agent_host_name="localhost", agent_port=6831, ) tracer_provider.add_span_processor( BatchSpanProcessor(jaeger_exporter) ) class TracingClient: """å¸¦è¿½è¸ªçš„å®¢æˆ·ç«¯""" def __init__(self, service_name: str): self.service_name = service_name self.tracer = trace.get_tracer(__name__) async def call_service( self, service_name: str, method: str, **kwargs ): """è°ƒç”¨æœåŠ¡å¹¶è¿½è¸ª""" with self.tracer.start_as_current_span( f"{service_name}.{method}", kind=trace.SpanKind.CLIENT ) as span: # æ·»åŠ å±æ€§ span.set_attribute("service", self.service_name) span.set_attribute("target_service", service_name) span.set_attribute("method", method) try: # æ³¨å…¥è¿½è¸ªä¸Šä¸‹æ–‡ headers = {} trace.inject(headers) # è°ƒç”¨æœåŠ¡ result = await self._make_request( service_name, method, headers=headers, **kwargs ) span.set_attribute("success", True) return result except Exception as e: span.record_exception(e) span.set_attribute("success", False) raise async def _make_request(self, service_name, method, headers, **kwargs): """å®é™…è¯·æ±‚é€»è¾‘""" # å®ç°æœåŠ¡è°ƒç”¨ pass # ä½¿ç”¨ç¤ºä¾‹ client = TracingClient("order-service") async def create_order(user_id, items): """åˆ›å»ºè®¢å• - å¸¦è¿½è¸ª""" with client.tracer.start_as_current_span("create_order") as span: span.set_attribute("user_id", user_id) span.set_attribute("item_count", len(items)) # è°ƒç”¨åº“å­˜æœåŠ¡ inventory_result = await client.call_service( "inventory-service", "check_stock", items=items ) # è°ƒç”¨æ”¯ä»˜æœåŠ¡ payment_result = await client.call_service( "payment-service", "process_payment", user_id=user_id, amount=calculate_amount(items) ) return { "inventory": inventory_result, "payment": payment_result } 5.3 æŒ‡æ ‡ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 from prometheus_client import Counter, Histogram, Gauge, start_http_server # å®šä¹‰æŒ‡æ ‡ request_count = Counter( 'http_requests_total', 'Total HTTP requests', ['method', 'endpoint', 'status'] ) request_duration = Histogram( 'http_request_duration_seconds', 'HTTP request duration', ['method', 'endpoint'] ) active_connections = Gauge( 'active_connections', 'Number of active connections' ) business_metric = Counter( 'business_operations_total', 'Total business operations', ['operation', 'status'] ) class MetricsMiddleware: """æŒ‡æ ‡æ”¶é›†ä¸­é—´ä»¶""" def __init__(self): self.active_connections = active_connections async def process_request(self, request, call_next): """å¤„ç†è¯·æ±‚å¹¶æ”¶é›†æŒ‡æ ‡""" # å¢åŠ æ´»è·ƒè¿æ¥æ•° self.active_connections.inc() start_time = time.time() try: response = await call_next(request) # è®°å½•è¯·æ±‚è®¡æ•° request_count.labels( method=request.method, endpoint=request.path, status=response.status_code ).inc() # è®°å½•è¯·æ±‚è€—æ—¶ duration = time.time() - start_time request_duration.labels( method=request.method, endpoint=request.path ).observe(duration) return response finally: # å‡å°‘æ´»è·ƒè¿æ¥æ•° self.active_connections.dec() class BusinessMetrics: """ä¸šåŠ¡æŒ‡æ ‡æ”¶é›†""" @staticmethod def record_operation(operation: str, success: bool): """è®°å½•ä¸šåŠ¡æ“ä½œ""" status = "success" if success else "failure" business_metric.labels( operation=operation, status=status ).inc() @staticmethod def record_order_created(order_value: float): """è®°å½•è®¢å•åˆ›å»º""" business_metric.labels( operation="order_created", status="success" ).inc() @staticmethod def record_payment_failed(amount: float, reason: str): """è®°å½•æ”¯ä»˜å¤±è´¥""" business_metric.labels( operation=f"payment_failed_{reason}", status="failure" ).inc() # ä½¿ç”¨ç¤ºä¾‹ async def create_order_logic(user_id, items): """åˆ›å»ºè®¢å•é€»è¾‘""" try: order = await order_service.create(user_id, items) BusinessMetrics.record_operation("order_created", True) return order except InventoryError as e: BusinessMetrics.record_operation("order_created", False) BusinessMetrics.record_operation("inventory_check_failed", False) raise except PaymentError as e: BusinessMetrics.record_operation("order_created", False) BusinessMetrics.record_payment_failed( order.total, e.reason ) raise # å¯åŠ¨æŒ‡æ ‡æœåŠ¡å™¨ start_http_server(8000) æ€»ç»“ åç«¯ç³»ç»Ÿæ¶æ„è®¾è®¡æ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘å¤šä¸ªç»´åº¦ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=category-link>åç«¯å¼€å‘</a><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2025-12-30</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to åç«¯ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼šä»å•ä½“åˆ°å¾®æœåŠ¡çš„æ¼”è¿›ä¹‹è·¯" href=/blog/articles/%E5%90%8E%E7%AB%AF%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BB%8E%E5%8D%95%E4%BD%93%E5%88%B0%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§ç®—æ³•æ·±åº¦è§£æï¼šä»Paxosåˆ°Raft</h2></header><div class=entry-content><p>æ·±å…¥æ¢è®¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ ¸å¿ƒä¸€è‡´æ€§ç®—æ³•ï¼ŒåŒ…æ‹¬Paxosã€Raftã€EPaxOSç­‰ï¼Œç†è§£å…¶å·¥ä½œåŸç†ã€åº”ç”¨åœºæ™¯å’Œå®ç°ç»†èŠ‚ã€‚</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=category-link>åç«¯å¼€å‘</a></div><span class=post-date>2025-12-30</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§ç®—æ³•æ·±åº¦è§£æï¼šä»Paxosåˆ°Raft" href=/blog/articles/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%BB%8Epaxos%E5%88%B0raft/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>å¾®æœåŠ¡æ¶æ„å®æˆ˜ï¼šä»ç†è®ºåˆ°è½åœ°çš„å®Œæ•´æŒ‡å—</h2></header><div class=entry-content><p>æ·±å…¥æ¢è®¨å¾®æœåŠ¡æ¶æ„çš„è®¾è®¡åŸåˆ™ã€æŠ€æœ¯é€‰å‹ã€æœåŠ¡æ‹†åˆ†ç­–ç•¥å’Œå®æˆ˜ç»éªŒï¼Œå¸®åŠ©ä½ æ„å»ºå¯æ‰©å±•ã€å¯ç»´æŠ¤çš„åç«¯ç³»ç»Ÿã€‚</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=category-link>åç«¯å¼€å‘</a></div><span class=post-date>2025-12-25</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to å¾®æœåŠ¡æ¶æ„å®æˆ˜ï¼šä»ç†è®ºåˆ°è½åœ°çš„å®Œæ•´æŒ‡å—" href=/blog/articles/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%AE%9E%E6%88%98%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E8%90%BD%E5%9C%B0%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>å¾®æœåŠ¡é€šä¿¡æ¨¡å¼æ·±åº¦è§£æ</h2></header><div class=entry-content><p>æŒæ¡å¾®æœåŠ¡é€šä¿¡çš„æ ¸å¿ƒæ¨¡å¼ï¼Œæ„å»ºé«˜æ•ˆå¯é çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2025-12-19</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to å¾®æœåŠ¡é€šä¿¡æ¨¡å¼æ·±åº¦è§£æ" href=/blog/articles/microservices-communication-patterns/></a></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>