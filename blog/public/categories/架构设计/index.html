<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>æ¶æ„è®¾è®¡ | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content><meta name=description content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·ï¼šåˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒ"><meta name=author content="util.cn Team"><link rel=canonical href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="æ¶æ„è®¾è®¡"><meta property="og:description" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·ï¼šåˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒ"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="æ¶æ„è®¾è®¡"><meta name=twitter:description content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·ï¼šåˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒ"></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>æ¶æ„è®¾è®¡</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>å¤§è§„æ¨¡å¾®æœåŠ¡ç³»ç»Ÿçš„æœåŠ¡æ²»ç†å®æˆ˜ï¼šä»æœåŠ¡å‘ç°åˆ°æµé‡æ§åˆ¶çš„å®Œæ•´ä½“ç³»</h2></header><div class=entry-content><p>å¼•è¨€ï¼šå¾®æœåŠ¡æ²»ç†çš„æŒ‘æˆ˜ éšç€å¾®æœåŠ¡æ•°é‡çš„å¢é•¿ï¼ŒæœåŠ¡æ²»ç†æˆä¸ºä¸å¯å›é¿çš„é—®é¢˜ã€‚å½“ä¸€ä¸ªç³»ç»Ÿä» 10 ä¸ªæœåŠ¡å¢é•¿åˆ° 100 ä¸ªã€ç”šè‡³ 1000 ä¸ªæœåŠ¡æ—¶ï¼Œä»¥ä¸‹é—®é¢˜ä¼šæ—¥ç›Šå‡¸æ˜¾ï¼š
æœåŠ¡å‘ç°ï¼šå¦‚ä½•åŠ¨æ€æ„ŸçŸ¥æœåŠ¡çš„ä¸Šä¸‹çº¿ï¼Ÿ è´Ÿè½½å‡è¡¡ï¼šå¦‚ä½•å°†æµé‡å‡åŒ€åˆ†é…åˆ°å¥åº·å®ä¾‹ï¼Ÿ æ•…éšœéš”ç¦»ï¼šå¦‚ä½•é˜²æ­¢çº§è”æ•…éšœï¼ˆé›ªå´©æ•ˆåº”ï¼‰ï¼Ÿ æµé‡æ§åˆ¶ï¼šå¦‚ä½•ä¿æŠ¤ç³»ç»Ÿä¸è¢«çªå‘æµé‡æ‰“å®ï¼Ÿ ç°åº¦å‘å¸ƒï¼šå¦‚ä½•å®‰å…¨åœ°å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Ÿ æœ¬æ–‡å°†ç³»ç»Ÿåœ°ä»‹ç»æœåŠ¡æ²»ç†çš„ç†è®ºä¸å®è·µã€‚
ä¸€ã€æœåŠ¡æ³¨å†Œä¸å‘ç° 1.1 æœåŠ¡æ³¨å†Œä¸­å¿ƒé€‰å‹ ç‰¹æ€§ Eureka Consul Nacos Etcd CAP AP CP AP/CP CP ä¸€è‡´æ€§åè®® æœ€ç»ˆä¸€è‡´ Raft Raft/Distro Raft å¥åº·æ£€æŸ¥ å®¢æˆ·ç«¯å¿ƒè·³ TCP/HTTP/gRPC TCP/HTTP/gRPC Lease è´Ÿè½½å‡è¡¡ Ribbon å†…ç½® å†…ç½® éœ€é›†æˆ é€‚ç”¨åœºæ™¯ é€šç”¨ å¼ºä¸€è‡´æ€§ é€šç”¨ Kubernetes 1.2 Nacos æœåŠ¡æ³¨å†Œå®æˆ˜ æœåŠ¡ç«¯é…ç½®ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 # application.yml (Nacos Server) spring: datasource: platform: mysql mode: mysql num: 1 user: root password: password url: jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8 nacos: raft: metadata: port: 8848 å®¢æˆ·ç«¯æ³¨å†Œï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2026-01-05</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to å¤§è§„æ¨¡å¾®æœåŠ¡ç³»ç»Ÿçš„æœåŠ¡æ²»ç†å®æˆ˜ï¼šä»æœåŠ¡å‘ç°åˆ°æµé‡æ§åˆ¶çš„å®Œæ•´ä½“ç³»" href=/blog/articles/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E5%AE%9E%E6%88%98%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E5%88%B0%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E7%9A%84%E5%AE%8C%E6%95%B4%E4%BD%93%E7%B3%BB/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§ä¿éšœæ–¹æ¡ˆè®¾è®¡ï¼šä»ç†è®ºåˆ°è½åœ°çš„å®Œæ•´æŒ‡å—</h2></header><div class=entry-content><p>å¼•è¨€ï¼šä¸€è‡´æ€§éš¾é¢˜çš„æœ¬è´¨ åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæ•°æ®åº“äº‹åŠ¡ï¼ˆACIDï¼‰ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„ä¸€è‡´æ€§ä¿è¯ã€‚ä½†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œåˆ†åŒºã€èŠ‚ç‚¹æ•…éšœã€æ—¶é’Ÿæ¼‚ç§»ç­‰ä¸ç¡®å®šæ€§å› ç´ ï¼Œä½¿å¾—å¼ºä¸€è‡´æ€§æˆä¸ºå¥¢ä¾ˆçš„é€‰æ‹©ã€‚
å¦‚ä½•åœ¨ä¸åŒä¸šåŠ¡åœºæ™¯ä¸‹é€‰æ‹©åˆé€‚çš„ä¸€è‡´æ€§æ–¹æ¡ˆï¼Ÿæœ¬æ–‡å°†ä»ç†è®ºå‡ºå‘ï¼Œç»“åˆå®é™…ä»£ç ï¼Œç³»ç»Ÿåœ°ä»‹ç»åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„å·¥ç¨‹å®è·µã€‚
ä¸€ã€ç†è®ºåŸºçŸ³ï¼šç†è§£ CAP ä¸ BASE 1.1 CAP å®šç†çš„å®è·µè§£è¯» ä¸€è‡´æ€§ (Consistency) â†— â†– / \ / \ å¯ç”¨æ€§ åˆ†åŒºå®¹é”™æ€§ (Availability) (Partition Tolerance) æ ¸å¿ƒè®¤çŸ¥ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒPï¼ˆåˆ†åŒºå®¹é”™ï¼‰æ˜¯å®¢è§‚å­˜åœ¨çš„ã€‚æˆ‘ä»¬çœŸæ­£é€‰æ‹©çš„æ˜¯åœ¨å‘ç”Ÿåˆ†åŒºæ—¶ï¼Œæ˜¯é€‰æ‹© Cï¼ˆä¸€è‡´æ€§ï¼‰è¿˜æ˜¯ Aï¼ˆå¯ç”¨æ€§ï¼‰ã€‚
åœºæ™¯åˆ†ç±»ï¼š
ä¸šåŠ¡åœºæ™¯ ä¸€æ€§æ€§è¦æ±‚ å¯ç”¨æ€§è¦æ±‚ å…¸å‹æ–¹æ¡ˆ é‡‘èè½¬è´¦ å¼ºä¸€è‡´æ€§ å¯é™çº§ 2PC/TCC + å†²çªç­‰å¾… è®¢å•æ”¯ä»˜ æœ€ç»ˆä¸€è‡´æ€§ é«˜å¯ç”¨ Saga + æœ¬åœ°æ¶ˆæ¯è¡¨ ç¤¾äº¤ç‚¹èµ æœ€ç»ˆä¸€è‡´æ€§ é«˜å¯ç”¨ å¼‚æ­¥å¤åˆ¶ + å†²çªå¤„ç† åº“å­˜æ‰£å‡ å¼ºä¸€è‡´æ€§ å¯é™çº§ åˆ†å¸ƒå¼é” + Redis 1.2 BASE ç†è®ºçš„å·¥ç¨‹å®è·µ BASEï¼ˆBasically Available, Soft state, Eventually consistentï¼‰æ˜¯å¯¹ CAP ä¸­ AP åœºæ™¯çš„è¡¥å……ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // è½¯çŠ¶æ€ç¤ºä¾‹ï¼šè®¢å•åˆ›å»ºåï¼Œè¿›å…¥"å¤„ç†ä¸­"çŠ¶æ€ type Order struct { ID string Status OrderStatus // è½¯çŠ¶æ€ï¼špending -> confirmed -> shipped CreatedAt time.Time UpdatedAt time.Time // çŠ¶æ€ä¼šæŒç»­å˜åŒ– } type OrderStatus int const ( StatusPending OrderStatus = iota // åˆå§‹çŠ¶æ€ StatusConfirmed // ä¸­é—´çŠ¶æ€ï¼ˆè½¯çŠ¶æ€ï¼‰ StatusShipped // æœ€ç»ˆçŠ¶æ€ ) // æœ€ç»ˆä¸€è‡´æ€§ï¼šç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œæ‰€æœ‰å‰¯æœ¬çš„çŠ¶æ€ä¼šæ”¶æ•› func (s *OrderService) ConfirmOrder(id string) error { // 1. æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆç«‹å³è¿”å›ï¼‰ if err := s.repo.UpdateStatus(id, StatusConfirmed); err != nil { return err } // 2. å¼‚æ­¥è§¦å‘åç»­æµç¨‹ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ go func() { s.inventoryClient.Deduct(id) // å¯èƒ½å¤±è´¥ï¼Œé‡è¯• s.shippingClient Arrange(id) // å¯èƒ½å¤±è´¥ï¼Œé‡è¯• s.notificationClient.Notify(id) // å¯èƒ½å¤±è´¥ï¼Œé‡è¯• }() return nil } äºŒã€å¼ºä¸€è‡´æ€§æ–¹æ¡ˆï¼š2PC ä¸ 3PC 2.1 ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰è¯¦è§£ æ¶æ„ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2026-01-05</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§ä¿éšœæ–¹æ¡ˆè®¾è®¡ï¼šä»ç†è®ºåˆ°è½åœ°çš„å®Œæ•´æŒ‡å—" href=/blog/articles/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%80%E8%87%B4%E6%80%A7%E4%BF%9D%E9%9A%9C%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E8%90%BD%E5%9C%B0%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¼“å­˜æ¶æ„æ¼”è¿›ï¼šä»å•ä¸€ Redis åˆ°å¤šå±‚ç¼“å­˜çš„å®æˆ˜ä¹‹è·¯</h2></header><div class=entry-content><p>å¼•è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜ï¼Ÿ åœ¨ä¸€ä¸ªå…¸å‹çš„ç”µå•†ç³»ç»Ÿä¸­ï¼Œè¯»æ“ä½œå æ¯”å¾€å¾€è¶…è¿‡ 80%ã€‚å¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½æ‰“åˆ°æ•°æ®åº“ï¼Œå•è¡¨çš„ QPS ä¸Šé™å¤§çº¦åœ¨ 1000-5000ï¼ˆå–å†³äºç¡¬ä»¶é…ç½®ï¼‰ã€‚å½“å¹¶å‘é‡è¾¾åˆ° 10 ä¸‡+ æ—¶ï¼Œæ•°æ®åº“å¿…ç„¶æˆä¸ºç“¶é¢ˆã€‚
ç¼“å­˜æ˜¯è§£å†³è¯»æ€§èƒ½é—®é¢˜çš„é“¶å¼¹ï¼Œä½†å®ƒä¹Ÿå¸¦æ¥äº†ä¸€ç³»åˆ—æŒ‘æˆ˜ï¼šæ•°æ®ä¸€è‡´æ€§ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆã€‚
ä¸€ã€ç¼“å­˜æ¶æ„çš„æ¼”è¿›è·¯å¾„ é˜¶æ®µ1ï¼šæ— ç¼“å­˜æ—¶ä»£ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ å®¢æˆ·ç«¯ â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚WebæœåŠ¡ â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ æ•°æ®åº“ â”‚ â† ç“¶é¢ˆ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ é—®é¢˜ï¼šæ•°æ®åº“æˆä¸ºå”¯ä¸€ç“¶é¢ˆï¼ŒQPS ä¸Šé™ä½ã€‚
é˜¶æ®µ2ï¼šå•ä¸€ Redis ç¼“å­˜ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ å®¢æˆ·ç«¯ â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚WebæœåŠ¡ â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â–¼ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Redis â”‚ â”‚ æ•°æ®åº“ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å®ç°ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 type CacheService struct { redis *redis.Client db *sql.DB } func (s *CacheService) GetUser(ctx context.Context, userID string) (*User, error) { // 1. å°è¯•ä» Redis è·å– cached, err := s.redis.Get(ctx, fmt.Sprintf("user:%s", userID)).Result() if err == nil { var user User json.Unmarshal([]byte(cached), &amp;user) return &amp;user, nil } // 2. Redis æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“ user := &amp;User{} if err := s.db.QueryRow("SELECT * FROM users WHERE id = ?", userID). Scan(user); err != nil { return nil, err } // 3. å†™å…¥ Redis data, _ := json.Marshal(user) s.redis.Set(ctx, fmt.Sprintf("user:%s", userID), data, 30*time.Minute) return user, nil } é—®é¢˜ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2026-01-05</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¼“å­˜æ¶æ„æ¼”è¿›ï¼šä»å•ä¸€ Redis åˆ°å¤šå±‚ç¼“å­˜çš„å®æˆ˜ä¹‹è·¯" href=/blog/articles/%E9%AB%98%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E7%BC%93%E5%AD%98%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E4%BB%8E%E5%8D%95%E4%B8%80-redis-%E5%88%B0%E5%A4%9A%E5%B1%82%E7%BC%93%E5%AD%98%E7%9A%84%E5%AE%9E%E6%88%98%E4%B9%8B%E8%B7%AF/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>å®¹å™¨åŒ–åº”ç”¨çš„å¯è§‚æµ‹æ€§æ¶æ„è®¾è®¡ï¼šMetricsã€Tracingã€Logging çš„å®Œæ•´å®è·µ</h2></header><div class=entry-content><p>å¼•è¨€ï¼šä»ç›‘æ§åˆ°å¯è§‚æµ‹æ€§ ä¼ ç»Ÿçš„ç›‘æ§ç³»ç»Ÿï¼ˆå¦‚ Nagiosã€Zabbixï¼‰ä¸“æ³¨äºåŸºç¡€è®¾æ–½ç›‘æ§ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œã€‚ä½†åœ¨å®¹å™¨åŒ–å’Œå¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œè¿™äº›è¿œè¿œä¸å¤Ÿã€‚
å¯è§‚æµ‹æ€§ï¼ˆObservabilityï¼‰çš„ä¸‰å¤§æ”¯æŸ±ï¼š
Metricsï¼ˆæŒ‡æ ‡ï¼‰ï¼šæ•°å€¼åŒ–çš„æ—¶é—´åºåˆ—æ•°æ®ï¼Œå‘Šè­¦åŸºç¡€ Tracingï¼ˆè¿½è¸ªï¼‰ï¼šè¯·æ±‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å®Œæ•´è·¯å¾„ Loggingï¼ˆæ—¥å¿—ï¼‰ï¼šç¦»æ•£äº‹ä»¶çš„è®°å½•ï¼Œé—®é¢˜è¯Šæ–­ æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ Kubernetes ç¯å¢ƒä¸‹æ„å»ºå®Œæ•´çš„å¯è§‚æµ‹æ€§ä½“ç³»ã€‚
ä¸€ã€Metricsï¼šä»é»‘ç›’åˆ°ç™½ç›’ 1.1 å››å¤§é»„é‡‘æŒ‡æ ‡ Latencyï¼ˆå»¶è¿Ÿï¼‰ï¼šè¯·æ±‚çš„å“åº”æ—¶é—´ Trafficï¼ˆæµé‡ï¼‰ï¼šæ¯ç§’è¯·æ±‚æ•°ï¼ˆQPSï¼‰ Errorsï¼ˆé”™è¯¯ç‡ï¼‰ï¼šå¤±è´¥è¯·æ±‚çš„ç™¾åˆ†æ¯” Saturationï¼ˆé¥±å’Œåº¦ï¼‰ï¼šèµ„æºä½¿ç”¨ç‡ 1.2 Prometheus + Grafana ç›‘æ§æ¶æ„ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Grafana â”‚ â”‚ ï¼ˆç»Ÿä¸€å¯è§†åŒ–å¤§ç›˜ï¼‰ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†‘ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Prometheus â”‚ â”‚ ï¼ˆæŒ‡æ ‡é‡‡é›† + å­˜å‚¨ + å‘Šè­¦ï¼‰ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Service A â”‚ â”‚ Service B â”‚ â”‚ Service C â”‚ â”‚ â”‚ â”‚ /metrics â”‚ â”‚ /metrics â”‚ â”‚ /metrics â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†“ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ AlertManager â”‚ â”‚ ï¼ˆå‘Šè­¦è·¯ç”±ï¼‰ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 1.3 è‡ªå®šä¹‰ Metricsï¼šGo + Prometheus ä¾èµ–ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2026-01-05</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to å®¹å™¨åŒ–åº”ç”¨çš„å¯è§‚æµ‹æ€§æ¶æ„è®¾è®¡ï¼šMetricsã€Tracingã€Logging çš„å®Œæ•´å®è·µ" href=/blog/articles/%E5%AE%B9%E5%99%A8%E5%8C%96%E5%BA%94%E7%94%A8%E7%9A%84%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1metricstracinglogging-%E7%9A%84%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>æ•°æ®åº“åˆ†åº“åˆ†è¡¨æ¶æ„è®¾è®¡æŒ‡å—ï¼šä»å•è¡¨åˆ°ç™¾äº¿çº§æ•°æ®çš„æ¼”è¿›ä¹‹è·¯</h2></header><div class=entry-content><p>å¼•è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿ MySQL å•è¡¨æ€§èƒ½ç“¶é¢ˆï¼š
æ•°æ®é‡ï¼šå•è¡¨è¶…è¿‡ 1000 ä¸‡è¡Œï¼ŒæŸ¥è¯¢æ€§èƒ½æ˜¾è‘—ä¸‹é™ ç´¢å¼•å¤§å°ï¼šç´¢å¼•æ ‘é«˜åº¦å¢åŠ ï¼Œç£ç›˜ I/O å¢å¤š é”ç«äº‰ï¼šé«˜å¹¶å‘ä¸‹é”ç­‰å¾…ä¸¥é‡ å¤‡ä»½æ¢å¤ï¼šå•è¡¨è¿‡å¤§ï¼Œå¤‡ä»½è€—æ—¶é•¿ åˆ†åº“åˆ†è¡¨æ˜¯çªç ´å•æœºæ•°æ®åº“ç“¶é¢ˆçš„æœ‰æ•ˆæ‰‹æ®µï¼Œä½†å®ƒä¹Ÿå¸¦æ¥äº†å¤æ‚çš„è·¯ç”±é€»è¾‘å’Œè¿ç»´æˆæœ¬ã€‚æœ¬æ–‡å°†ç³»ç»Ÿåœ°ä»‹ç»åˆ†åº“åˆ†è¡¨çš„å®è·µæ–¹æ¡ˆã€‚
ä¸€ã€å‚ç›´æ‹†åˆ† vs æ°´å¹³æ‹†åˆ† 1.1 å‚ç›´æ‹†åˆ†ï¼ˆæŒ‰ä¸šåŠ¡ç»´åº¦ï¼‰ å•ä½“æ•°æ®åº“ï¼š â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ single_database â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ user â”‚ â”‚ order â”‚ â”‚ product â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†“ å‚ç›´æ‹†åˆ† â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚user_db â”‚ â”‚order_db â”‚ â”‚product_dbâ”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ user â”‚ â”‚ order â”‚ â”‚ product â”‚ â”‚ profile â”‚ â”‚ payment â”‚ â”‚ inventoryâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ä¼˜ç‚¹ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2026-01-05</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to æ•°æ®åº“åˆ†åº“åˆ†è¡¨æ¶æ„è®¾è®¡æŒ‡å—ï¼šä»å•è¡¨åˆ°ç™¾äº¿çº§æ•°æ®çš„æ¼”è¿›ä¹‹è·¯" href=/blog/articles/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%8C%87%E5%8D%97%E4%BB%8E%E5%8D%95%E8%A1%A8%E5%88%B0%E7%99%BE%E4%BA%BF%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%9A%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>æ¶ˆæ¯é˜Ÿåˆ—æŠ€æœ¯é€‰å‹ä¸æ·±åº¦å¯¹æ¯”ï¼šKafka vs RabbitMQ vs RocketMQ vs Pulsar</h2></header><div class=entry-content><p>å¼•è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯å®ç°æœåŠ¡è§£è€¦ã€å¼‚æ­¥å¤„ç†ã€æµé‡å‰Šå³°çš„æ ¸å¿ƒç»„ä»¶ã€‚ä½†é¢å¯¹ Kafkaã€RabbitMQã€RocketMQã€Pulsar ç­‰ä¼—å¤šé€‰æ‹©ï¼Œå¦‚ä½•åšå‡ºæ­£ç¡®çš„å†³ç­–ï¼Ÿ
æœ¬æ–‡å°†ä»æ¶æ„è®¾è®¡ã€æ€§èƒ½ç‰¹æ€§ã€è¿ç»´æˆæœ¬ä¸‰ä¸ªç»´åº¦ï¼Œæ·±åº¦å¯¹æ¯”è¿™äº›æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¸®åŠ©ä½ åœ¨æŠ€æœ¯é€‰å‹æ—¶åšå‡ºæ˜æ™ºçš„å†³å®šã€‚
ä¸€ã€æ¶ˆæ¯é˜Ÿåˆ—çš„æ ¸å¿ƒåº”ç”¨åœºæ™¯ 1.1 æœåŠ¡è§£è€¦ åŒæ­¥è°ƒç”¨ï¼ˆç´§è€¦åˆï¼‰ï¼š è®¢å•æœåŠ¡ -> åº“å­˜æœåŠ¡ -> æ”¯ä»˜æœåŠ¡ -> ç‰©æµæœåŠ¡ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ä»»ä¸€æœåŠ¡æ•…éšœï¼Œæ•´ä¸ªé“¾è·¯å¤±è´¥ å¼‚æ­¥è°ƒç”¨ï¼ˆæ¾è€¦åˆï¼‰ï¼š è®¢å•æœåŠ¡ â”€â”¬â†’ æ¶ˆæ¯é˜Ÿåˆ— â”€â”¬â†’ åº“å­˜æœåŠ¡ â”‚ â”œâ†’ æ”¯ä»˜æœåŠ¡ â”‚ â””â†’ ç‰©æµæœåŠ¡ â”‚ â””â†’ ç‹¬ç«‹æ¼”è¿›ï¼Œäº’ä¸å½±å“ 1.2 å¼‚æ­¥å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // åŒæ­¥å¤„ç†ï¼šç”¨æˆ·ç­‰å¾… 3 ç§’ func CreateOrder(req *CreateOrderRequest) error { // 100msï¼šåˆ›å»ºè®¢å• if err := orderService.Create(req); err != nil { return err } // 2000msï¼šå‘é€é€šçŸ¥ notificationService.Send(req.UserID) // 1000msï¼šæ›´æ–°æ¨è recommendService.Update(req.UserID) return nil } // å¼‚æ­¥å¤„ç†ï¼šç”¨æˆ·ç­‰å¾… 100ms func CreateOrderAsync(req *CreateOrderRequest) error { // 100msï¼šåˆ›å»ºè®¢å• if err := orderService.Create(req); err != nil { return err } // å‘é€æ¶ˆæ¯ï¼Œå¼‚æ­¥å¤„ç† mq.Publish("order.created", req) return nil // ç«‹å³è¿”å› } // æ¶ˆè´¹è€…å¼‚æ­¥å¤„ç† func consumer() { for msg := range mq.Subscribe("order.created") { go func() { notificationService.Send(msg.UserID) recommendService.Update(msg.UserID) }() } } 1.3 æµé‡å‰Šå³° æ­£å¸¸æƒ…å†µï¼š 1000 QPS â”€â†’ è®¢å•æœåŠ¡ï¼ˆ1000 QPSï¼‰â”€â†’ æ•°æ®åº“ï¼ˆ1000 QPSï¼‰ ç§’æ€åœºæ™¯ï¼š 100000 QPS â”€â†’ æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç¼“å†²ï¼‰ â”€â†’ è®¢å•æœåŠ¡ï¼ˆ1000 QPSï¼‰â”€â†’ æ•°æ®åº“ï¼ˆ1000 QPSï¼‰ â†“ é˜Ÿåˆ—å †ç§¯ï¼ˆéé˜»å¡ï¼‰ äºŒã€ä¸»æµæ¶ˆæ¯é˜Ÿåˆ—æ·±åº¦å¯¹æ¯” 2.1 å¯¹æ¯”æ€»è§ˆ ç‰¹æ€§ Kafka RabbitMQ RocketMQ Pulsar æ¶æ„æ¨¡å‹ æ—¥å¿—å­˜å‚¨ äº¤æ¢æœº+é˜Ÿåˆ— ä¸»é¢˜+é˜Ÿåˆ— åˆ†å±‚å­˜å‚¨ ååé‡ ç™¾ä¸‡çº§/ç§’ ä¸‡çº§/ç§’ åä¸‡çº§/ç§’ ç™¾ä¸‡çº§/ç§’ å»¶è¿Ÿ ms çº§ Î¼s çº§ ms çº§ ms çº§ æ¶ˆæ¯å¯é æ€§ é«˜ï¼ˆå¤šå‰¯æœ¬ï¼‰ ä¸­ é«˜ é«˜ æ¶ˆæ¯é¡ºåº åˆ†åŒºå†…æœ‰åº é˜Ÿåˆ—å†…æœ‰åº ä¸¥æ ¼æœ‰åº å…¨å±€æœ‰åº åè®®æ”¯æŒ è‡ªæœ‰åè®® AMQP è‡ªæœ‰åè®® è‡ªæœ‰åè®® è¿ç»´å¤æ‚åº¦ ä¸­ é«˜ ä¸­ é«˜ ç¤¾åŒºæ´»è·ƒåº¦ â­â­â­â­â­ â­â­â­â­ â­â­â­ â­â­â­â­ 2.2 Kafkaï¼šæ—¥å¿—æ”¶é›†ä¸æµå¤„ç†ä¹‹ç‹ æ¶æ„è®¾è®¡ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2026-01-05</span><span class=post-author>æŠ€æœ¯å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to æ¶ˆæ¯é˜Ÿåˆ—æŠ€æœ¯é€‰å‹ä¸æ·±åº¦å¯¹æ¯”ï¼šKafka vs RabbitMQ vs RocketMQ vs Pulsar" href=/blog/articles/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%AF%B9%E6%AF%94kafka-vs-rabbitmq-vs-rocketmq-vs-pulsar/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>æŠ€æœ¯å€ºåŠ¡ç®¡ç†2.0ï¼šä»è´Ÿæ‹…åˆ°æˆ˜ç•¥èµ„äº§çš„é‡æ„æ€ç»´</h2></header><div class=entry-content><p>å¼•è¨€ æŠ€æœ¯å€ºåŠ¡ä¸ä¸€å®šæ˜¯åäº‹ã€‚åˆç†ç®¡ç†æŠ€æœ¯å€ºåŠ¡ï¼Œå¯ä»¥æˆä¸ºæ¨åŠ¨ä¸šåŠ¡å‘å±•çš„æˆ˜ç•¥èµ„äº§ã€‚æœ¬æ–‡å°†æ¢è®¨æŠ€æœ¯å€ºåŠ¡çš„æ–°æ€ç»´å’Œç®¡ç†æ–¹æ³•ã€‚
ä¸€ã€é‡æ–°å®šä¹‰æŠ€æœ¯å€ºåŠ¡ 1.1 æŠ€æœ¯å€ºåŠ¡ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 # æŠ€æœ¯å€ºåŠ¡åˆ†ç±»ä½“ç³» class TechnicalDebtTypes: """æŠ€æœ¯å€ºåŠ¡ç±»å‹""" categories = { "intentional": { "description": "æ•…æ„å€ºåŠ¡", "examples": [ "ä¸ºäº†å¿«é€Ÿäº¤ä»˜è€Œç®€åŒ–è®¾è®¡", "é€‰æ‹©æˆç†Ÿæ–¹æ¡ˆè€Œéæœ€ä¼˜æ–¹æ¡ˆ", "å»¶åä¼˜åŒ–å·¥ä½œ" ], "characteristics": [ "æœ‰æ˜ç¡®çš„å¿è¿˜è®¡åˆ’", "ç»è¿‡å›¢é˜Ÿè®¨è®º", "æœ‰ä¸šåŠ¡ä»·å€¼æ”¯æ’‘" ] }, "unintentional": { "description": "æ— æ„å€ºåŠ¡", "examples": [ "è®¾è®¡ç¼ºé™·", "ä»£ç è…åŒ–", "æŠ€æœ¯é€‰æ‹©å¤±è¯¯" ], "characteristics": [ "é€æ¸ç´¯ç§¯", "ä¸æ˜“å¯Ÿè§‰", "éœ€è¦ä¸»åŠ¨ç®¡ç†" ] }, "strategic": { "description": "æˆ˜ç•¥æ€§å€ºåŠ¡", "examples": [ "ä¸ºéªŒè¯æ¦‚å¿µè€Œåšçš„ç®€åŒ–", "ä¸ºæŠ¢å å¸‚åœºè€Œåšçš„å¦¥å", "ä¸ºå­¦ä¹ æ–°æŠ€æœ¯è€Œåšçš„è¯•éªŒ" ], "characteristics": [ "æœ‰æ˜ç¡®çš„æ—¶é—´çª—å£", "ä¸ä¸šåŠ¡ç›®æ ‡å¯¹é½", "é£é™©å¯æ§" ] } } 1.2 é‡åŒ–è¯„ä¼° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 # æŠ€æœ¯å€ºåŠ¡é‡åŒ– class TechnicalDebtQuantifier: """æŠ€æœ¯å€ºåŠ¡é‡åŒ–å™¨""" def __init__(self): self.metrics = { 'code_quality': self._assess_code_quality, 'test_coverage': self._assess_test_coverage, 'documentation': self._assess_documentation, 'security': self._assess_security, 'performance': self._assess_performance } def calculate_debt_score(self, codebase): """è®¡ç®—æŠ€æœ¯å€ºåŠ¡åˆ†æ•°""" scores = {} for metric_name, assessor in self.metrics.items(): scores[metric_name] = assessor(codebase) # åŠ æƒè®¡ç®—æ€»å€ºåŠ¡åˆ†æ•° weights = { 'code_quality': 0.3, 'test_coverage': 0.25, 'documentation': 0.15, 'security': 0.2, 'performance': 0.1 } total_score = sum( scores[metric] * weights[metric] for metric in scores ) return { 'total_score': total_score, 'breakdown': scores, 'debt_level': self._classify_debt_level(total_score) } def _assess_code_quality(self, codebase): """è¯„ä¼°ä»£ç è´¨é‡""" issues = { 'complexity': 0, 'duplication': 0, 'style': 0 } # åœˆå¤æ‚åº¦ for file in codebase.files: complexity = self._analyze_complexity(file) if complexity > 15: issues['complexity'] += 1 # ä»£ç é‡å¤ duplication = self._detect_duplication(codebase) issues['duplication'] = len(duplication) # ä»£ç é£æ ¼ style = self._check_style(codebase) issues['style'] = len(style) # è®¡ç®—å¾—åˆ† total_issues = sum(issues.values()) max_acceptable = len(codebase.files) * 3 return 1 - (total_issues / max_acceptable) def _classify_debt_level(self, score): """åˆ†ç±»å€ºåŠ¡ç­‰çº§""" if score > 0.8: return 'LOW' elif score > 0.6: return 'MEDIUM' elif score > 0.4: return 'HIGH' else: return 'CRITICAL' äºŒã€å¿è¿˜ç­–ç•¥ 2.1 é‡æ„ä¼˜å…ˆçº§ç®—æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 # é‡æ„ä¼˜å…ˆçº§è®¡ç®— class RefactoringPriorityCalculator: """é‡æ„ä¼˜å…ˆçº§è®¡ç®—å™¨""" def __init__(self): self.factors = { 'business_impact': 0.3, # ä¸šåŠ¡å½±å“ 'technical_risk': 0.25, # æŠ€æœ¯é£é™© 'developer_cost': 0.2, # å¼€å‘æˆæœ¬ 'user_value': 0.15, # ç”¨æˆ·ä»·å€¼ 'dependency': 0.1 # ä¾èµ–å…³ç³» } def calculate_priority(self, debt_items): """è®¡ç®—é‡æ„ä¼˜å…ˆçº§""" prioritized = [] for item in debt_items: score = 0 # ä¸šåŠ¡å½±å“ score += self._assess_business_impact(item) * self.factors['business_impact'] # æŠ€æœ¯é£é™© score += self._assess_technical_risk(item) * self.factors['technical_risk'] # å¼€å‘æˆæœ¬ï¼ˆæˆæœ¬è¶Šä½ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ cost = self._estimate_refactoring_cost(item) score += (1 - cost) * self.factors['developer_cost'] # ç”¨æˆ·ä»·å€¼ score += self._assess_user_value(item) * self.factors['user_value'] # ä¾èµ–å…³ç³»ï¼ˆè¢«ä¾èµ–è¶Šå¤šä¼˜å…ˆçº§è¶Šé«˜ï¼‰ dependencies = self._count_dependents(item) score += min(dependencies / 10, 1) * self.factors['dependency'] prioritized.append({ 'item': item, 'score': score, 'priority': self._classify_priority(score) }) # æŒ‰å¾—åˆ†æ’åº prioritized.sort(key=lambda x: x['score'], reverse=True) return prioritized def _classify_priority(self, score): """åˆ†ç±»ä¼˜å…ˆçº§""" if score > 0.8: return 'P0 - ç«‹å³å¤„ç†' elif score > 0.6: return 'P1 - è¿‘æœŸå¤„ç†' elif score > 0.4: return 'P2 - è®¡åˆ’å¤„ç†' else: return 'P3 - æœ‰æœºä¼šå†å¤„ç†' 2.2 æ¸è¿›å¼é‡æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // æ¸è¿›å¼é‡æ„ç­–ç•¥ class RefactoringStrategy { // ç­–ç•¥1: Strangler Fig Pattern (ç»æ€è€…æ¨¡å¼) static async stranglerFigPattern(oldModule, newImplementation) { // 1. åˆ›å»ºä»£ç†å±‚ const proxy = this.createProxy(oldModule); // 2. é€æ­¥åˆ‡æ¢å®ç° const routes = await this.getRoutes(); for (const route of routes) { // 3. ä¸ºæ¯ä¸ªè·¯ç”±åˆ›å»ºæ–°å®ç° await this.createNewImplementation(route, newImplementation); // 4. æ›´æ–°è·¯ç”±æŒ‡å‘æ–°å®ç° proxy.redirect(route, `/new/${route}`); } // 5. ç§»é™¤æ—§å®ç° await this.removeOldImplementation(oldModule); } // ç­–ç•¥2: Branch by Abstraction (åˆ†æ”¯æŠ½è±¡) static branchByAbstraction(oldCode) { // 1. åˆ›å»ºæŠ½è±¡å±‚ const abstraction = this.createAbstraction(oldCode); // 2. è®©æ–°ä»£ç ä½¿ç”¨æŠ½è±¡ // 3. é€æ­¥è¿ç§»æ—§ä»£ç åˆ°æŠ½è±¡ // 4. æ—§ä»£ç ä¹Ÿé€šè¿‡æŠ½è±¡å±‚ } // ç­–ç•¥3: Change Return Type (ä¿®æ”¹è¿”å›ç±»å‹) static changeReturnType(function, newType) { // 1. æ·»åŠ æ–°ç±»å‹çš„åŒ…è£…å™¨ // 2. è®©è°ƒç”¨è€…é€æ­¥è¿ç§»åˆ°æ–°ç±»å‹ // 3. ä¿®æ”¹å‡½æ•°è¿”å›æ–°ç±»å‹ // 4. ç§»é™¤æ—§ç±»å‹ } } ä¸‰ã€å€ºåŠ¡ç®¡ç†æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 # å€ºåŠ¡ç®¡ç†æœ€ä½³å®è·µ class TechnicalDebtManagement: """æŠ€æœ¯å€ºåŠ¡ç®¡ç†""" def __init__(self): self.register = DebtRegister() this.sprints = SprintPlanner() def manage_debt_in_sprint(self, sprint_capacity): """åœ¨Sprintä¸­ç®¡ç†å€ºåŠ¡""" # åˆ†é…20%æ—¶é—´ç»™æŠ€æœ¯å€ºåŠ¡ debt_capacity = sprint_capacity * 0.2 # é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„å€ºåŠ¡é¡¹ priority_items = self.register.get_priority_items() selected_items = self.select_items_within_capacity( priority_items, debt_capacity ) return { 'items_to_address': selected_items, 'estimated_impact': self._estimate_impact(selected_items) } def track_debt_trend(self): """è¿½è¸ªå€ºåŠ¡è¶‹åŠ¿""" history = self.register.get_history() # è®¡ç®—è¶‹åŠ¿ if len(history) > 1: recent_score = history[-1]['score'] previous_score = history[-2]['score'] if recent_score > previous_score: trend = 'IMPROVING' elif recent_score &lt; previous_score: trend = 'DEGRADING' else: trend = 'STABLE' return { 'trend': trend, 'current_score': recent_score, 'change': recent_score - previous_score } return {'trend': 'UNKNOWN', 'current_score': 0} def visualize_debt(self): """å¯è§†åŒ–æŠ€æœ¯å€ºåŠ¡""" # å€ºåŠ¡çƒ­åŠ›å›¾ return { 'type': 'heatmap', 'data': self.register.get_debt_by_module(), 'color_scale': { 'LOW': '#4CAF50', 'MEDIUM': '#FFC107', 'HIGH': '#FF5722', 'CRITICAL': '#B71C1C' } } æ€»ç»“ æŠ€æœ¯å€ºåŠ¡ç®¡ç†æ–°æ€ç»´ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/ class=category-link>è½¯ä»¶å·¥ç¨‹</a><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2025-12-31</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to æŠ€æœ¯å€ºåŠ¡ç®¡ç†2.0ï¼šä»è´Ÿæ‹…åˆ°æˆ˜ç•¥èµ„äº§çš„é‡æ„æ€ç»´" href=/blog/articles/%E6%8A%80%E6%9C%AF%E5%80%BA%E5%8A%A1%E7%AE%A1%E7%90%862.0%E4%BB%8E%E8%B4%9F%E6%8B%85%E5%88%B0%E6%88%98%E7%95%A5%E8%B5%84%E4%BA%A7%E7%9A%84%E9%87%8D%E6%9E%84%E6%80%9D%E7%BB%B4/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>é›¶ä¿¡ä»»æ¶æ„ä»ç†è®ºåˆ°å®è·µï¼šæ„å»ºæ°¸ä¸ä¿¡ä»»ã€å§‹ç»ˆéªŒè¯çš„å®‰å…¨ä½“ç³»</h2></header><div class=entry-content><p>å¼•è¨€ ä¼ ç»Ÿè¾¹ç•Œå®‰å…¨æ¨¡å‹å·²æ— æ³•åº”å¯¹ç°ä»£å¨èƒã€‚é›¶ä¿¡ä»»æ¶æ„ï¼ˆZero Trustï¼‰ä»¥"æ°¸ä¸ä¿¡ä»»ï¼Œå§‹ç»ˆéªŒè¯"ä¸ºæ ¸å¿ƒç†å¿µï¼Œæ­£åœ¨æˆä¸ºå®‰å…¨æ¶æ„çš„æ–°æ ‡å‡†ã€‚
ä¸€ã€é›¶ä¿¡ä»»æ ¸å¿ƒåŸåˆ™ 1.1 æ ¸å¿ƒæ¦‚å¿µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # é›¶ä¿¡ä»»æ¶æ„åŸåˆ™ class ZeroTrustPrinciples: """é›¶ä¿¡ä»»æ ¸å¿ƒåŸåˆ™""" principles = { "Verify Explicitly": "å§‹ç»ˆéªŒè¯ï¼Œæ°¸ä¸ä¿¡ä»»", "Use Least Privilege": "æœ€å°æƒé™è®¿é—®", "Assume Breach": "å‡è®¾å·²è¢«æ”»ç ´" } def __init__(self): # ä¿¡ä»»è¯„ä¼°æ¨¡å‹ self.trust_score = 0 self.context_factors = [ 'identity', 'device_health', 'location', 'behavior_pattern', 'time' ] 1.2 èº«ä»½ä¸è®¿é—®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 # ç°ä»£èº«ä»½è®¤è¯ç³»ç»Ÿ from datetime import datetime, timedelta import secrets class IdentityProvider: """èº«ä»½æä¾›å•†""" def __init__(self): self.sessions = {} self.mfa_providers = {} async def authenticate(self, credentials, context): """å¤šå› ç´ è®¤è¯""" # 1. éªŒè¯èº«ä»½ user = await self._verify_identity(credentials) # 2. æ£€æŸ¥è®¾å¤‡å¥åº· device_trust = await self._check_device_health(context['device_id']) # 3. è¯„ä¼°ä¸Šä¸‹æ–‡é£é™© risk_score = await self._assess_risk(context) # 4. å†³å®šè®¤è¯è¦æ±‚ if risk_score > 0.7: # é«˜é£é™©ï¼šéœ€è¦MFA mfa_required = True else: mfa_required = False # 5. æ‰§è¡Œè®¤è¯ if mfa_required: mfa_result = await self._perform_mfa(user['id']) if not mfa_result['success']: raise AuthenticationException("MFA failed") # 6. é¢å‘ä»¤ç‰Œ token = await self._issue_token(user, context) return { 'access_token': token, 'expires_in': 3600, 'refresh_enabled': True } async def _issue_token(self, user, context): """é¢å‘ä»¤ç‰Œ""" # JWTä»¤ç‰Œ payload = { 'user_id': user['id'], 'roles': user['roles'], 'permissions': user['permissions'], 'device_id': context['device_id'], 'location': context['location'], 'iat': datetime.now().timestamp(), 'exp': (datetime.now() + timedelta(hours=1)).timestamp() } # æ·»åŠ ä¿¡ä»»è¯„åˆ† trust_score = await self._calculate_trust_score(user, context) payload['trust_score'] = trust_score return self._encode_jwt(payload) # ç»†ç²’åº¦è®¿é—®æ§åˆ¶ class AccessControlEngine: """è®¿é—®æ§åˆ¶å¼•æ“""" def __init__(self, policy_engine): self.policy_engine = policy_engine async def check_access(self, request): """æ£€æŸ¥è®¿é—®æƒé™""" # ç­–ç•¥è¯„ä¼° decision = await self.policy_engine.evaluate({ 'subject': request.subject, 'action': request.action, 'resource': request.resource, 'context': request.context }) return decision['allow'], decision['reason'] # ç­–ç•¥å®šä¹‰ç¤ºä¾‹ ABAC_POLICIES = [ { "name": "Document Access Policy", "conditions": { "resource.type": "document", "resource.classification": ["public", "internal", "confidential"], "subject.roles": ["employee", "contractor", "partner"], "context.location": ["office", "remote"], "context.time": ["business_hours", "any"] }, "rules": [ { "effect": "allow", "conditions": { "resource.classification": "public", "subject.roles": ["employee", "contractor", "partner"] } }, { "effect": "allow", "conditions": { "resource.classification": "internal", "subject.roles": ["employee"], "context.location": ["office"] } }, { "effect": "deny", "conditions": { "resource.classification": "confidential", "subject.roles": ["contractor", "partner"] } } ] } ] 1.3 å¾®åˆ†æ®µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 # ç½‘ç»œå¾®åˆ†æ®µå®ç° class MicroSegmentation: """ç½‘ç»œå¾®åˆ†æ®µ""" def __init__(self): self.segments = {} self.policies = {} def create_segment(self, segment_config): """åˆ›å»ºç½‘æ®µ""" segment_id = segment_config['id'] self.segments[segment_id] = { 'name': segment_config['name'], 'workloads': [], 'allowed_traffic': segment_config['allowed_traffic'], 'inspection_level': segment_config['inspection_level'] } def apply_policy(self, policy): """åº”ç”¨ç­–ç•¥""" policy_id = policy['id'] self.policies[policy_id] = { 'source': policy['source_segment'], 'destination': policy['destination_segment'], 'ports': policy['ports'], 'protocols': policy['protocols'], 'action': policy['action'], # allow/deny/inspect 'inspection': policy.get('inspection', 'none') } def enforce_policy(self, traffic): """å¼ºåˆ¶æ‰§è¡Œç­–ç•¥""" # æŸ¥æ‰¾åŒ¹é…çš„ç­–ç•¥ for policy_id, policy in self.policies.items(): if self._traffic_matches_policy(traffic, policy): if policy['action'] == 'deny': return False, "Policy denied" elif policy['action'] == 'inspect': # æ·±åº¦åŒ…æ£€æµ‹ if not self._deep_inspect(traffic, policy['inspection']): return False, "Inspection failed" return True, "Allowed" äºŒã€é›¶ä¿¡ä»»æ¶æ„å®æ–½ 2.1 å®æ–½è·¯çº¿å›¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 # é›¶ä¿¡ä»»å®æ–½é˜¶æ®µ class ZeroTrustRoadmap: """é›¶ä¿¡ä»»å®æ–½è·¯çº¿å›¾""" phases = [ { "phase": 1, "name": "å‘ç°ä¸è¯„ä¼°", "duration": "1-3ä¸ªæœˆ", "tasks": [ "èµ„äº§å‘ç°ä¸åˆ†ç±»", "æ•°æ®æµåˆ†æ", "ç°æœ‰å®‰å…¨è¯„ä¼°", "åŸºçº¿å»ºç«‹" ] }, { "phase": 2, "name": "èº«ä»½ç°ä»£åŒ–", "duration": "3-6ä¸ªæœˆ", "tasks": [ "éƒ¨ç½²MFA", "å®æ–½SSO", "å»ºç«‹ç‰¹æƒè®¿é—®ç®¡ç†", "éƒ¨ç½²IAMç³»ç»Ÿ" ] }, { "phase": 3, "name": "è®¾å¤‡ä¿¡ä»»", "duration": "3-6ä¸ªæœˆ", "tasks": [ "éƒ¨ç½²MDM", "å®æ–½è®¾å¤‡å¥åº·æ£€æŸ¥", "å»ºç«‹è®¾å¤‡ä¿¡ä»»è¯„åˆ†", "éƒ¨ç½²EDR" ] }, { "phase": 4, "name": "ç½‘ç»œåˆ†æ®µ", "duration": "6-12ä¸ªæœˆ", "tasks": [ "å®æ–½è½¯ä»¶å®šä¹‰è¾¹ç•Œ", "éƒ¨ç½²å¾®éš”ç¦»", "å»ºç«‹é›¶ä¿¡ä»»ç½‘ç»œè®¿é—®", "å®æ–½ä¸œè¥¿å‘æµé‡ç›‘æ§" ] }, { "phase": 5, "name": "æ•°æ®ä¿æŠ¤", "duration": "6-12ä¸ªæœˆ", "tasks": [ "å®æ–½æ•°æ®åˆ†ç±»", "éƒ¨ç½²åŠ å¯†", "å»ºç«‹DLP", "å®æ–½CASB" ] } ] 2.2 ç›‘æ§ä¸å®¡è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 # é›¶ä¿¡ä»»ç›‘æ§ç³»ç»Ÿ class ZeroTrustMonitor: """é›¶ä¿¡ä»»ç›‘æ§""" def __init__(self): self.events = [] self.alerts = [] def log_access_event(self, event): """è®°å½•è®¿é—®äº‹ä»¶""" event_data = { 'timestamp': datetime.now(), 'subject': event['subject'], 'action': event['action'], 'resource': event['resource'], 'result': event['result'], 'context': event['context'], 'trust_score': event['trust_score'] } self.events.append(event_data) # å®æ—¶é£é™©è¯„ä¼° self._assess_risk(event_data) def _assess_risk(self, event): """è¯„ä¼°é£é™©""" # å¼‚å¸¸æ£€æµ‹ anomalies = self._detect_anomalies(event) if anomalies: alert = { 'level': 'high', 'type': 'anomaly_detected', 'details': anomalies, 'event': event } self.alerts.append(alert) self._trigger_alert(alert) def _detect_anomalies(self, event): """æ£€æµ‹å¼‚å¸¸""" anomalies = [] # 1. å¼‚å¸¸æ—¶é—´è®¿é—® hour = event['timestamp'].hour if hour &lt; 6 or hour > 22: anomalies.append("éå·¥ä½œæ—¶é—´è®¿é—®") # 2. å¼‚å¸¸ä½ç½®è®¿é—® if event['context']['location'] == 'unknown': anomalies.append("æœªçŸ¥ä½ç½®è®¿é—®") # 3. å¼‚å¸¸è®¾å¤‡ if event['context']['device_trust'] &lt; 0.5: anomalies.append("ä½ä¿¡ä»»è®¾å¤‡è®¿é—®") # 4. å¼‚å¸¸è¡Œä¸ºæ¨¡å¼ if self._is_unusual_behavior(event): anomalies.append("å¼‚å¸¸è¡Œä¸ºæ¨¡å¼") return anomalies æ€»ç»“ é›¶ä¿¡ä»»æ¶æ„æ˜¯ç°ä»£å®‰å…¨çš„å¿…ç„¶é€‰æ‹©ã€‚æˆåŠŸå®æ–½éœ€è¦ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%AE%89%E5%85%A8/ class=category-link>å®‰å…¨</a><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2025-12-31</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to é›¶ä¿¡ä»»æ¶æ„ä»ç†è®ºåˆ°å®è·µï¼šæ„å»ºæ°¸ä¸ä¿¡ä»»ã€å§‹ç»ˆéªŒè¯çš„å®‰å…¨ä½“ç³»" href=/blog/articles/%E9%9B%B6%E4%BF%A1%E4%BB%BB%E6%9E%B6%E6%9E%84%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E6%9E%84%E5%BB%BA%E6%B0%B8%E4%B8%8D%E4%BF%A1%E4%BB%BB%E5%A7%8B%E7%BB%88%E9%AA%8C%E8%AF%81%E7%9A%84%E5%AE%89%E5%85%A8%E4%BD%93%E7%B3%BB/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>åç«¯ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼šä»å•ä½“åˆ°å¾®æœåŠ¡çš„æ¼”è¿›ä¹‹è·¯</h2></header><div class=entry-content><p>å¼•è¨€ éšç€ä¸šåŠ¡è§„æ¨¡çš„ä¸æ–­æ‰©å¤§ï¼Œåç«¯ç³»ç»Ÿæ¶æ„éœ€è¦ä¸æ–­æ¼”è¿›ä»¥åº”å¯¹æ—¥ç›Šå¢é•¿çš„æŒ‘æˆ˜ã€‚ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡æ¶æ„ï¼Œä»å•æœºéƒ¨ç½²åˆ°åˆ†å¸ƒå¼é›†ç¾¤ï¼Œæ¯ä¸€æ¬¡æ¶æ„æ¼”è¿›éƒ½æ˜¯ä¸ºäº†è§£å†³ç‰¹å®šçš„ç—›ç‚¹ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨åç«¯ç³»ç»Ÿæ¶æ„è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™ã€æ¨¡å¼ä¸å®è·µã€‚
ä¸€ã€æ¶æ„æ¼”è¿›å†ç¨‹ 1.1 æ¶æ„æ¼”è¿›è·¯å¾„ å•ä½“åº”ç”¨ â†’ åˆ†å±‚æ¶æ„ â†’ SOA â†’ å¾®æœåŠ¡ â†’ Serverless æ¼”è¿›é˜¶æ®µå¯¹æ¯”
æ¶æ„ç±»å‹ ç‰¹ç‚¹ ä¼˜åŠ¿ æŒ‘æˆ˜ é€‚ç”¨åœºæ™¯ å•ä½“åº”ç”¨ å•ä¸€ä»£ç åº“ã€å•ä¸€éƒ¨ç½² å¼€å‘ç®€å•ã€éƒ¨ç½²å®¹æ˜“ æ‰©å±•æ€§å·®ã€æŠ€æœ¯æ ˆå›ºå®š å°å‹é¡¹ç›®ã€åˆåˆ›æœŸ åˆ†å±‚æ¶æ„ MVC/MVPåˆ†å±‚ èŒè´£æ¸…æ™°ã€æ˜“äºç»´æŠ¤ å±‚é—´è€¦åˆå¼º ä¸­å°å‹é¡¹ç›® SOA æœåŠ¡åŒ–ã€ESBæ€»çº¿ æœåŠ¡å¤ç”¨ã€æ¾è€¦åˆ ESBå•ç‚¹ã€å¤æ‚åº¦é«˜ ä¼ä¸šçº§åº”ç”¨ å¾®æœåŠ¡ ç‹¬ç«‹æœåŠ¡ã€è‡ªæ²»éƒ¨ç½² ç‹¬ç«‹æ‰©å±•ã€æŠ€æœ¯è‡ªç”± è¿ç»´å¤æ‚ã€åˆ†å¸ƒå¼äº‹åŠ¡ å¤§å‹å¤æ‚ç³»ç»Ÿ Serverless å‡½æ•°çº§ã€æŒ‰éœ€ä»˜è´¹ æè‡´å¼¹æ€§ã€æˆæœ¬ä¼˜åŒ– å‚å•†é”å®šã€å†·å¯åŠ¨ äº‹ä»¶é©±åŠ¨ã€æ³¢å³°æ˜æ˜¾ 1.2 å•ä½“æ¶æ„çš„å±€é™æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # å•ä½“åº”ç”¨çš„å…¸å‹é—®é¢˜ # é—®é¢˜1: ä»£ç è€¦åˆä¸¥é‡ # ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†æµç¨‹æ¶‰åŠå¤šä¸ªæ¨¡å— class OrderService: def create_order(self, user_id, items): # ç›´æ¥ä¾èµ–å¤šä¸ªæ¨¡å— user = UserService().get_user(user_id) inventory = InventoryService().check_stock(items) payment = PaymentService().process_payment(items) shipping = ShippingService().calculate_shipping(user.address) notification = NotificationService().send_confirmation(user.email) # å¦‚æœä»»ä½•ä¸€ä¸ªæ¨¡å—å‡ºé”™ï¼Œæ•´ä¸ªè®¢å•åˆ›å»ºå¤±è´¥ return Order(user=user, items=items, payment=payment) # é—®é¢˜2: éš¾ä»¥ç‹¬ç«‹æ‰©å±• # å½“è®¢å•æœåŠ¡å‹åŠ›å¤§æ—¶ï¼Œå¿…é¡»æ•´ä½“æ‰©å±• # æ— æ³•é’ˆå¯¹ç‰¹å®šç“¶é¢ˆæœåŠ¡å•ç‹¬æ‰©å®¹ # é—®é¢˜3: æŠ€æœ¯æ ˆé”å®š # æ•´ä¸ªåº”ç”¨å¿…é¡»ä½¿ç”¨ç›¸åŒçš„è¯­è¨€å’Œæ¡†æ¶ # æ— æ³•ä¸ºæ–°æœåŠ¡é€‰æ‹©æ›´é€‚åˆçš„æŠ€æœ¯ # é—®é¢˜4: éƒ¨ç½²é£é™©é«˜ # ä»»ä½•å°çš„ä¿®æ”¹éƒ½éœ€è¦é‡æ–°éƒ¨ç½²æ•´ä¸ªåº”ç”¨ # ä¸€å¤„bugå¯èƒ½å½±å“æ•´ä¸ªç³»ç»Ÿ äºŒã€å¾®æœåŠ¡æ¶æ„è®¾è®¡ 2.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 # ========== æœåŠ¡æ‹†åˆ†åŸåˆ™ ========== # 1. å•ä¸€èŒè´£åŸåˆ™ # æ¯ä¸ªæœåŠ¡ä¸“æ³¨äºä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ class UserService: """ç”¨æˆ·æœåŠ¡ - åªè´Ÿè´£ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡""" def create_user(self, data): pass def get_user(self, user_id): pass def update_user(self, user_id, data): pass class OrderService: """è®¢å•æœåŠ¡ - åªè´Ÿè´£è®¢å•ç›¸å…³çš„ä¸šåŠ¡""" def create_order(self, data): pass def get_order(self, order_id): pass def cancel_order(self, order_id): pass # 2. é™ç•Œä¸Šä¸‹æ–‡åŸåˆ™ # æŒ‰ç…§ä¸šåŠ¡é¢†åŸŸè¾¹ç•Œæ‹†åˆ†æœåŠ¡ # DDD (Domain-Driven Design) æˆ˜æœ¯æ¨¡å¼ # 3. æ•°æ®ç‹¬ç«‹æ€§åŸåˆ™ # æ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ class UserDatabase: """ç”¨æˆ·æœåŠ¡çš„æ•°æ®åº“""" def __init__(self): self.db = PostgreSQL('users_db') class OrderDatabase: """è®¢å•æœåŠ¡çš„æ•°æ®åº“""" def __init__(self): self.db = MongoDB('orders_db') # 4. APIç½‘å…³åŸåˆ™ # ç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±è½¬å‘ class APIGateway: """APIç½‘å…³ - æœåŠ¡ç»Ÿä¸€å…¥å£""" def __init__(self): self.routes = { '/api/users/*': UserService(), '/api/orders/*': OrderService(), '/api/products/*': ProductService(), '/api/payments/*': PaymentService() } def route(self, request): # è·¯ç”±åŒ¹é… for pattern, service in self.routes.items(): if request.path.match(pattern): return service.handle(request) # èšåˆå¤šä¸ªæœåŠ¡çš„å“åº” if request.path == '/api/dashboard': return self.aggregate_dashboard(request) def aggregate_dashboard(self, request): """èšåˆå¤šä¸ªæœåŠ¡çš„æ•°æ®""" user_data = self.call_service('/api/users/me', request) order_data = self.call_service('/api/orders/recent', request) notification_data = self.call_service('/api/notifications', request) return { 'user': user_data, 'orders': order_data, 'notifications': notification_data } 2.2 æœåŠ¡é€šä¿¡æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 # ========== åŒæ­¥é€šä¿¡: REST/gRPC ========== import requests from typing import Protocol # REST APIè°ƒç”¨ class OrderClient: """è®¢å•æœåŠ¡å®¢æˆ·ç«¯""" BASE_URL = "http://order-service:8080" def create_order(self, order_data: dict) -> dict: response = requests.post( f"{self.BASE_URL}/api/orders", json=order_data, timeout=5 # è¶…æ—¶æ§åˆ¶ ) response.raise_for_status() return response.json() def get_order(self, order_id: str) -> dict: response = requests.get( f"{self.BASE_URL}/api/orders/{order_id}", timeout=3 ) response.raise_for_status() return response.json() # gRPCè°ƒç”¨ (æ€§èƒ½æ›´é«˜) import grpc from generated import order_pb2, order_pb2_grpc class OrderGRPCClient: """è®¢å•æœåŠ¡gRPCå®¢æˆ·ç«¯""" def __init__(self): self.channel = grpc.insecure_channel('order-service:9090') self.stub = order_pb2_grpc.OrderServiceStub(self.channel) def create_order(self, order_data: dict) -> order_pb2.OrderResponse: request = order_pb2.CreateOrderRequest( user_id=order_data['user_id'], items=[ order_pb2.OrderItem( product_id=item['product_id'], quantity=item['quantity'] ) for item in order_data['items'] ] ) return self.stub.CreateOrder(request, timeout=5) # ========== å¼‚æ­¥é€šä¿¡: æ¶ˆæ¯é˜Ÿåˆ— ========== import asyncio from aio_pika import connect, Message class EventBus: """äº‹ä»¶æ€»çº¿ - å¼‚æ­¥æ¶ˆæ¯ä¼ é€’""" def __init__(self, amqp_url: str): self.connection = None self.channel = None self.amqp_url = amqp_url async def connect(self): """å»ºç«‹è¿æ¥""" self.connection = await connect(self.amqp_url) self.channel = await self.connection.channel() # å£°æ˜äº¤æ¢æœº await self.channel.declare_exchange( 'domain-events', 'topic', durable=True ) async def publish(self, event_type: str, event_data: dict): """å‘å¸ƒäº‹ä»¶""" exchange = await self.get_exchange() message = Message( json.dumps(event_data).encode(), content_type='application/json', delivery_mode=2 # æŒä¹…åŒ– ) await exchange.publish( message, routing_key=event_type ) async def subscribe(self, event_pattern: str, handler): """è®¢é˜…äº‹ä»¶""" exchange = await self.get_exchange() # å£°æ˜é˜Ÿåˆ— queue = await self.channel.declare_queue( f'{event_pattern}-queue', durable=True ) # ç»‘å®šäº¤æ¢æœº await queue.bind(exchange, routing_key=event_pattern) async with queue.iterator() as queue_iter: async for message in queue_iter: try: event_data = json.loads(message.body.decode()) await handler(event_data) await message.ack() except Exception as e: await message.nack() # äº‹ä»¶é©±åŠ¨æ¶æ„ç¤ºä¾‹ class OrderCreatedEvent: """è®¢å•åˆ›å»ºäº‹ä»¶""" def __init__(self, order_id, user_id, items): self.event_type = 'order.created' self.data = { 'order_id': order_id, 'user_id': user_id, 'items': items, 'timestamp': datetime.now().isoformat() } # è®¢å•æœåŠ¡å‘å¸ƒäº‹ä»¶ async def create_order_with_event(order_data): # åˆ›å»ºè®¢å• order = await order_repository.create(order_data) # å‘å¸ƒäº‹ä»¶ event_bus = EventBus() await event_bus.publish( 'order.created', OrderCreatedEvent( order.id, order.user_id, order.items ).data ) return order # åº“å­˜æœåŠ¡ç›‘å¬äº‹ä»¶ async def handle_order_created(event_data): """å¤„ç†è®¢å•åˆ›å»ºäº‹ä»¶ - æ‰£å‡åº“å­˜""" order_id = event_data['order_id'] items = event_data['items'] for item in items: await inventory_service.deduct_stock( item['product_id'], item['quantity'] ) await event_bus.publish( 'inventory.deducted', {'order_id': order_id, 'status': 'completed'} ) # é€šçŸ¥æœåŠ¡ç›‘å¬äº‹ä»¶ async def handle_inventory_deducted(event_data): """å¤„ç†åº“å­˜æ‰£å‡å®Œæˆäº‹ä»¶ - å‘é€é€šçŸ¥""" order_id = event_data['order_id'] order = await order_repository.get(order_id) await notification_service.send_order_confirmation( order.user_email, order_id ) 2.3 æœåŠ¡å‘ç°ä¸æ³¨å†Œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 # ========== æœåŠ¡æ³¨å†Œä¸­å¿ƒ ========== import asyncio from typing import Dict, List, Optional from datetime import datetime, timedelta class ServiceInstance: """æœåŠ¡å®ä¾‹""" def __init__(self, service_id: str, address: str, port: int): self.service_id = service_id self.address = address self.port = port self.last_heartbeat = datetime.now() @property def url(self) -> str: return f"http://{self.address}:{self.port}" def is_alive(self, timeout: int = 10) -> bool: """æ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜æ´»""" return (datetime.now() - self.last_heartbeat).seconds &lt; timeout class ServiceRegistry: """æœåŠ¡æ³¨å†Œä¸­å¿ƒ""" def __init__(self): self.services: Dict[str, List[ServiceInstance]] = {} def register(self, service_name: str, instance: ServiceInstance): """æ³¨å†ŒæœåŠ¡å®ä¾‹""" if service_name not in self.services: self.services[service_name] = [] # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ existing = next( (i for i in self.services[service_name] if i.service_id == instance.service_id), None ) if existing: # æ›´æ–°å¿ƒè·³æ—¶é—´ existing.last_heartbeat = datetime.now() else: # æ–°æ³¨å†Œ self.services[service_name].append(instance) print(f"Registered: {service_name} - {instance.url}") def deregister(self, service_name: str, service_id: str): """æ³¨é”€æœåŠ¡å®ä¾‹""" if service_name in self.services: self.services[service_name] = [ i for i in self.services[service_name] if i.service_id != service_id ] def discover(self, service_name: str) -> Optional[ServiceInstance]: """æœåŠ¡å‘ç° - è´Ÿè½½å‡è¡¡""" if service_name not in self.services: return None # è¿‡æ»¤æ‰å¤±æ•ˆçš„å®ä¾‹ alive_instances = [ i for i in self.services[service_name] if i.is_alive() ] if not alive_instances: return None # è½®è¯¢è´Ÿè½½å‡è¡¡ return alive_instances[hash(service_name) % len(alive_instances)] # æˆ–è€…ä½¿ç”¨éšæœºé€‰æ‹© # return random.choice(alive_instances) def heartbeat(self, service_name: str, service_id: str): """æ¥æ”¶å¿ƒè·³""" if service_name in self.services: for instance in self.services[service_name]: if instance.service_id == service_id: instance.last_heartbeat = datetime.now() # ========== æœåŠ¡å®¢æˆ·ç«¯ ========== class ServiceClient: """æœåŠ¡å®¢æˆ·ç«¯ - å¸¦æœåŠ¡å‘ç°""" def __init__(self, registry: ServiceRegistry): self.registry = registry self.cache = {} # ç¼“å­˜æœåŠ¡åœ°å€ async def call(self, service_name: str, endpoint: str, **kwargs): """è°ƒç”¨æœåŠ¡""" # ä»ç¼“å­˜æˆ–æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åœ°å€ instance = self.cache.get(service_name) if not instance or not instance.is_alive(): instance = self.registry.discover(service_name) if not instance: raise ServiceUnavailableException(f"Service {service_name} not found") self.cache[service_name] = instance # æ„å»ºè¯·æ±‚URL url = f"{instance.url}{endpoint}" try: response = requests.post(url, json=kwargs, timeout=5) response.raise_for_status() return response.json() except requests.RequestException as e: # è°ƒç”¨å¤±è´¥ï¼Œæ¸…é™¤ç¼“å­˜ self.cache.pop(service_name, None) raise e # ========== ä½¿ç”¨ç¤ºä¾‹ ========== # æœåŠ¡å¯åŠ¨æ—¶æ³¨å†Œ registry = ServiceRegistry() async def start_service(): service_instance = ServiceInstance( service_id=f"order-service-{os.getenv('INSTANCE_ID')}", address=os.getenv('SERVICE_ADDRESS'), port=int(os.getenv('SERVICE_PORT')) ) registry.register('order-service', service_instance) # å®šæœŸå‘é€å¿ƒè·³ while True: await asyncio.sleep(5) registry.heartbeat('order-service', service_instance.service_id) 2.4 åˆ†å¸ƒå¼é…ç½®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 # ========== é…ç½®ä¸­å¿ƒ ========== import asyncio import json from typing import Any, Callable from watchfiles import awatch class ConfigCenter: """åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ""" def __init__(self, config_dir: str = './config'): self.config_dir = config_dir self.configs = {} self.watchers = {} # config_key -> [callbacks] def load_config(self, service_name: str) -> dict: """åŠ è½½æœåŠ¡é…ç½®""" config_file = f"{self.config_dir}/{service_name}.json" try: with open(config_file) as f: config = json.load(f) self.configs[service_name] = config return config except FileNotFoundError: return {} def get_config(self, service_name: str, key: str = None) -> Any: """è·å–é…ç½®""" config = self.configs.get(service_name, {}) if key: return config.get(key) return config def watch_config(self, service_name: str, callback: Callable): """ç›‘å¬é…ç½®å˜åŒ–""" if service_name not in self.watchers: self.watchers[service_name] = [] self.watchers[service_name].append(callback) async def watch_changes(self): """ç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ–""" async for changes in awatch(self.config_dir): for change_type, config_path in changes: service_name = config_path.stem if change_type == Change.modified: # é‡æ–°åŠ è½½é…ç½® old_config = self.configs.get(service_name, {}) new_config = self.load_config(service_name) # è§¦å‘å›è°ƒ if service_name in self.watchers: for callback in self.watchers[service_name]: await callback(old_config, new_config) # ========== ä½¿ç”¨ç¤ºä¾‹ ========== config_center = ConfigCenter() # åŠ è½½é…ç½® app_config = config_center.load_config('order-service') # ç›‘å¬é…ç½®å˜åŒ– async def on_config_changed(old_config, new_config): """é…ç½®å˜åŒ–å¤„ç†""" if old_config.get('log_level') != new_config.get('log_level'): # é‡æ–°é…ç½®æ—¥å¿—çº§åˆ« logging.getLogger().setLevel(new_config['log_level']) if old_config.get('database') != new_config.get('database'): # é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥ await reconnect_database(new_config['database']) config_center.watch_config('order-service', on_config_changed) ä¸‰ã€æ•°æ®ä¸€è‡´æ€§è®¾è®¡ 3.1 åˆ†å¸ƒå¼äº‹åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 # ========== ä¸¤é˜¶æ®µæäº¤ (2PC) ========== class TwoPhaseCommit: """ä¸¤é˜¶æ®µæäº¤åè°ƒè€…""" def __init__(self): self.participants = [] def register_participant(self, participant): """æ³¨å†Œå‚ä¸è€…""" self.participants.append(participant) async def execute(self, transaction_data): """æ‰§è¡Œåˆ†å¸ƒå¼äº‹åŠ¡""" transaction_id = generate_transaction_id() # é˜¶æ®µ1: å‡†å¤‡é˜¶æ®µ prepared = [] for participant in self.participants: try: result = await participant.prepare(transaction_id, transaction_data) if result == 'PREPARED': prepared.append(participant) else: # ä»»ä½•å‚ä¸è€…æ‹’ç»ï¼Œå›æ»šæ‰€æœ‰ await self._rollback_all(transaction_id, prepared) return False except Exception as e: await self._rollback_all(transaction_id, prepared) raise e # é˜¶æ®µ2: æäº¤é˜¶æ®µ committed = [] for participant in prepared: try: await participant.commit(transaction_id) committed.append(participant) except Exception as e: # æäº¤å¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥ await self._rollback_all(transaction_id, committed) raise Exception(f"Commit failed: {e}") return True async def _rollback_all(self, transaction_id, participants): """å›æ»šæ‰€æœ‰å‚ä¸è€…""" for participant in participants: try: await participant.rollback(transaction_id) except Exception as e: logging.error(f"Rollback failed: {e}") # ========== Sagaæ¨¡å¼ ========== # é•¿äº‹åŠ¡çš„æ›¿ä»£æ–¹æ¡ˆ class SagaOrchestrator: """Sagaç¼–æ’å™¨""" def __init__(self): self.steps = [] self.compensations = [] def add_step(self, action, compensation): """æ·»åŠ æ­¥éª¤""" self.steps.append(action) self.compensations.append(compensation) async def execute(self, initial_data): """æ‰§è¡ŒSaga""" context = initial_data executed_steps = [] # æ‰§è¡Œæ¯ä¸ªæ­¥éª¤ for i, step in enumerate(self.steps): try: context = await step(context) executed_steps.append(i) except Exception as e: # å¤±è´¥ï¼Œæ‰§è¡Œè¡¥å¿ await self._compensate(executed_steps, context) raise e return context async def _compensate(self, executed_steps, context): """æ‰§è¡Œè¡¥å¿äº‹åŠ¡""" # é€†åºæ‰§è¡Œè¡¥å¿ for i in reversed(executed_steps): try: await self.compensations[i](context) except Exception as e: logging.error(f"Compensation failed: {e}") # è®¢å•Sagaç¤ºä¾‹ class OrderSaga: """è®¢å•å¤„ç†Saga""" def __init__(self): self.saga = SagaOrchestrator() self._setup_steps() def _setup_steps(self): """è®¾ç½®Sagaæ­¥éª¤""" # æ­¥éª¤1: åˆ›å»ºè®¢å• async def create_order(context): order = await order_repository.create(context['order_data']) context['order'] = order return context async def cancel_order(context): await order_repository.update_status( context['order'].id, 'CANCELLED' ) # æ­¥éª¤2: æ‰£å‡åº“å­˜ async def deduct_inventory(context): for item in context['order'].items: await inventory_service.deduct_stock( item.product_id, item.quantity ) return context async def restore_inventory(context): for item in context['order'].items: await inventory_service.restore_stock( item.product_id, item.quantity ) # æ­¥éª¤3: å¤„ç†æ”¯ä»˜ async def process_payment(context): payment = await payment_service.charge( context['order'].user_id, context['order'].total_amount ) context['payment'] = payment return context async def refund_payment(context): await payment_service.refund( context['payment'].transaction_id ) # æ­¥éª¤4: å‘é€é€šçŸ¥ async def send_notification(context): await notification_service.send( context['order'].user_email, 'Order Created', f'Your order {context["order"].id} has been created' ) return context async def cancel_notification(context): # é€šçŸ¥å¯èƒ½ä¸éœ€è¦è¡¥å¿ pass # æ·»åŠ æ­¥éª¤å’Œè¡¥å¿ self.saga.add_step(create_order, cancel_order) self.saga.add_step(deduct_inventory, restore_inventory) self.saga.add_step(process_payment, refund_payment) self.saga.add_step(send_notification, cancel_notification) async def execute(self, order_data): """æ‰§è¡Œè®¢å•Saga""" return await self.saga.execute({'order_data': order_data}) 3.2 æœ€ç»ˆä¸€è‡´æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 # ========== äº‹ä»¶æº¯æº ========== # é€šè¿‡äº‹ä»¶æµé‡å»ºçŠ¶æ€ class EventStore: """äº‹ä»¶å­˜å‚¨""" def __init__(self): self.events = [] async def append_event(self, aggregate_id: str, event: dict): """è¿½åŠ äº‹ä»¶""" event['aggregate_id'] = aggregate_id event['timestamp'] = datetime.now().isoformat() event['version'] = len(self.events) + 1 self.events.append(event) async def get_events(self, aggregate_id: str) -> List[dict]: """è·å–èšåˆçš„æ‰€æœ‰äº‹ä»¶""" return [ e for e in self.events if e['aggregate_id'] == aggregate_id ] class OrderAggregate: """è®¢å•èšåˆ - é€šè¿‡äº‹ä»¶é‡å»ºçŠ¶æ€""" def __init__(self, event_store: EventStore): self.event_store = event_store self.state = None async def rebuild(self, order_id: str): """ä»äº‹ä»¶æµé‡å»ºçŠ¶æ€""" events = await self.event_store.get_events(order_id) state = None for event in events: state = self._apply_event(state, event) self.state = state return state def _apply_event(self, state, event): """åº”ç”¨äº‹ä»¶åˆ°çŠ¶æ€""" event_type = event['type'] if event_type == 'OrderCreated': return { 'id': event['order_id'], 'user_id': event['user_id'], 'items': event['items'], 'status': 'CREATED' } elif event_type == 'PaymentCompleted': state['status'] = 'PAID' state['payment_id'] = event['payment_id'] return state elif event_type == 'OrderShipped': state['status'] = 'SHIPPED' state['shipping_id'] = event['shipping_id'] return state elif event_type == 'OrderCancelled': state['status'] = 'CANCELLED' return state return state async def create_order(self, user_id, items): """åˆ›å»ºè®¢å•""" event = { 'type': 'OrderCreated', 'order_id': generate_id(), 'user_id': user_id, 'items': items } await self.event_store.append_event(event['order_id'], event) return await self.rebuild(event['order_id']) # ========== CQRS ========== # å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦» class CommandBus: """å‘½ä»¤æ€»çº¿""" def __init__(self): self.handlers = {} def register(self, command_type: str, handler): """æ³¨å†Œå‘½ä»¤å¤„ç†å™¨""" self.handlers[command_type] = handler async def execute(self, command: dict): """æ‰§è¡Œå‘½ä»¤""" command_type = command['type'] if command_type not in self.handlers: raise ValueError(f"Unknown command: {command_type}") return await self.handlers[command_type](command) class QueryBus: """æŸ¥è¯¢æ€»çº¿""" def __init__(self): self.handlers = {} def register(self, query_type: str, handler): """æ³¨å†ŒæŸ¥è¯¢å¤„ç†å™¨""" self.handlers[query_type] = handler async def execute(self, query: dict): """æ‰§è¡ŒæŸ¥è¯¢""" query_type = query['type'] if query_type not in self.handlers: raise ValueError(f"Unknown query: {query_type}") return await self.handlers[query_type](query) # CQRSç¤ºä¾‹ class OrderService: """è®¢å•æœåŠ¡ - CQRS""" def __init__(self): self.command_bus = CommandBus() self.query_bus = QueryBus() self.event_store = EventStore() self.read_db = {} # è¯»æ¨¡å‹ self._register_handlers() def _register_handlers(self): """æ³¨å†Œå¤„ç†å™¨""" # å‘½ä»¤å¤„ç†å™¨ self.command_bus.register('CreateOrder', self._handle_create_order) self.command_bus.register('CancelOrder', self._handle_cancel_order) # æŸ¥è¯¢å¤„ç†å™¨ self.query_bus.register('GetOrder', self._handle_get_order) self.query_bus.register('ListOrders', self._handle_list_orders) async def _handle_create_order(self, command): """å¤„ç†åˆ›å»ºè®¢å•å‘½ä»¤""" event = { 'type': 'OrderCreated', 'order_id': command['order_id'], 'user_id': command['user_id'], 'items': command['items'] } await self.event_store.append_event(command['order_id'], event) # æ›´æ–°è¯»æ¨¡å‹ self._update_read_model(event) return event['order_id'] async def _handle_cancel_order(self, command): """å¤„ç†å–æ¶ˆè®¢å•å‘½ä»¤""" event = { 'type': 'OrderCancelled', 'order_id': command['order_id'] } await self.event_store.append_event(command['order_id'], event) # æ›´æ–°è¯»æ¨¡å‹ self._update_read_model(event) async def _handle_get_order(self, query): """å¤„ç†è·å–è®¢å•æŸ¥è¯¢""" return self.read_db.get(query['order_id']) async def _handle_list_orders(self, query): """å¤„ç†è®¢å•åˆ—è¡¨æŸ¥è¯¢""" user_id = query.get('user_id') orders = [ order for order in self.read_db.values() if not user_id or order['user_id'] == user_id ] return orders def _update_read_model(self, event): """æ›´æ–°è¯»æ¨¡å‹""" order_id = event['order_id'] if event['type'] == 'OrderCreated': self.read_db[order_id] = { 'id': order_id, 'user_id': event['user_id'], 'items': event['items'], 'status': 'CREATED' } elif event['type'] == 'OrderCancelled': if order_id in self.read_db: self.read_db[order_id]['status'] = 'CANCELLED' å››ã€å®¹é”™ä¸é«˜å¯ç”¨è®¾è®¡ 4.1 ç†”æ–­å™¨æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 import asyncio from enum import Enum from datetime import datetime, timedelta class CircuitState(Enum): CLOSED = 'CLOSED' # æ­£å¸¸çŠ¶æ€ OPEN = 'OPEN' # ç†”æ–­çŠ¶æ€ HALF_OPEN = 'HALF_OPEN' # åŠå¼€çŠ¶æ€ class CircuitBreaker: """ç†”æ–­å™¨""" def __init__( self, failure_threshold: int = 5, timeout: int = 60, half_open_attempts: int = 3 ): self.failure_threshold = failure_threshold self.timeout = timeout self.half_open_attempts = half_open_attempts self.state = CircuitState.CLOSED self.failure_count = 0 self.success_count = 0 self.last_failure_time = None async def call(self, func, *args, **kwargs): """é€šè¿‡ç†”æ–­å™¨è°ƒç”¨å‡½æ•°""" if self.state == CircuitState.OPEN: # ç†”æ–­çŠ¶æ€ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥è¿›å…¥åŠå¼€ if self._should_attempt_reset(): self.state = CircuitState.HALF_OPEN self.success_count = 0 else: raise CircuitBreakerOpenException( f"Circuit breaker is OPEN. Try again later." ) try: result = await func(*args, **kwargs) # æˆåŠŸï¼Œé‡ç½®è®¡æ•° self._on_success() return result except Exception as e: # å¤±è´¥ï¼Œå¢åŠ è®¡æ•° self._on_failure() raise e def _should_attempt_reset(self) -> bool: """æ£€æŸ¥æ˜¯å¦åº”è¯¥å°è¯•é‡ç½®""" if self.last_failure_time is None: return False elapsed = (datetime.now() - self.last_failure_time).seconds return elapsed >= self.timeout def _on_success(self): """å¤„ç†æˆåŠŸ""" if self.state == CircuitState.HALF_OPEN: self.success_count += 1 # åŠå¼€çŠ¶æ€ä¸‹è¿ç»­æˆåŠŸï¼Œæ¢å¤å…³é—­çŠ¶æ€ if self.success_count >= self.half_open_attempts: self.state = CircuitState.CLOSED self.failure_count = 0 elif self.state == CircuitState.CLOSED: self.failure_count = 0 def _on_failure(self): """å¤„ç†å¤±è´¥""" self.failure_count += 1 self.last_failure_time = datetime.now() # è¾¾åˆ°é˜ˆå€¼ï¼Œæ‰“å¼€ç†”æ–­å™¨ if self.failure_count >= self.failure_threshold: self.state = CircuitState.OPEN # ä½¿ç”¨ç¤ºä¾‹ async def call_external_service(url): """è°ƒç”¨å¤–éƒ¨æœåŠ¡""" response = await aiohttp.get(url) return await response.json() # åˆ›å»ºç†”æ–­å™¨ circuit_breaker = CircuitBreaker( failure_threshold=5, timeout=60, half_open_attempts=3 ) # é€šè¿‡ç†”æ–­å™¨è°ƒç”¨ try: result = await circuit_breaker.call( call_external_service, 'http://external-service/api/data' ) except CircuitBreakerOpenException: # ç†”æ–­å™¨æ‰“å¼€ï¼Œä½¿ç”¨é™çº§é€»è¾‘ result = get_cached_data() except Exception as e: # å…¶ä»–é”™è¯¯å¤„ç† logger.error(f"Service call failed: {e}") 4.2 é‡è¯•ä¸è¶…æ—¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 import asyncio from functools import wraps from typing import Callable, Type class RetryConfig: """é‡è¯•é…ç½®""" def __init__( self, max_attempts: int = 3, base_delay: float = 1.0, max_delay: float = 10.0, exponential_base: float = 2, jitter: bool = True, retry_exceptions: list = None ): self.max_attempts = max_attempts self.base_delay = base_delay self.max_delay = max_delay self.exponential_base = exponential_base self.jitter = jitter self.retry_exceptions = retry_exceptions or [Exception] def retry(config: RetryConfig = None): """é‡è¯•è£…é¥°å™¨""" if config is None: config = RetryConfig() def decorator(func: Callable): @wraps(func) async def wrapper(*args, **kwargs): last_exception = None for attempt in range(1, config.max_attempts + 1): try: return await func(*args, **kwargs) except tuple(config.retry_exceptions) as e: last_exception = e if attempt &lt; config.max_attempts: # è®¡ç®—å»¶è¿Ÿæ—¶é—´ delay = min( config.base_delay * (config.exponential_base ** (attempt - 1)), config.max_delay ) # æ·»åŠ æŠ–åŠ¨ if config.jitter: delay = delay * (0.5 + random.random() * 0.5) logger.warning( f"Attempt {attempt} failed: {e}. " f"Retrying in {delay:.2f}s..." ) await asyncio.sleep(delay) # æ‰€æœ‰å°è¯•éƒ½å¤±è´¥ raise last_exception return wrapper return decorator # è¶…æ—¶è£…é¥°å™¨ def timeout(seconds: float): """è¶…æ—¶è£…é¥°å™¨""" def decorator(func: Callable): @wraps(func) async def wrapper(*args, **kwargs): try: return await asyncio.wait_for( func(*args, **kwargs), timeout=seconds ) except asyncio.TimeoutError: raise TimeoutException( f"Function {func.__name__} timed out after {seconds}s" ) return wrapper return decorator # ä½¿ç”¨ç¤ºä¾‹ @retry(RetryConfig( max_attempts=3, base_delay=1.0, exponential_base=2, retry_exceptions=[ConnectionError, TimeoutError] )) @timeout(seconds=5) async def call_external_api(url): """è°ƒç”¨å¤–éƒ¨APIï¼Œå¸¦é‡è¯•å’Œè¶…æ—¶""" async with aiohttp.ClientSession() as session: async with session.get(url) as response: response.raise_for_status() return await response.json() 4.3 é™æµä¸é™çº§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 import time from collections import deque from typing import Callable, Any class RateLimiter: """é€Ÿç‡é™åˆ¶å™¨""" def __init__(self, rate: int, per: float): """ rate: å…è®¸çš„è¯·æ±‚æ•° per: æ—¶é—´çª—å£ï¼ˆç§’ï¼‰ """ self.rate = rate self.per = per self.allowance = rate self.last_check = time.time() def acquire(self, tokens: int = 1) -> bool: """è·å–ä»¤ç‰Œ""" current = time.time() elapsed = current - self.last_check # è¡¥å……ä»¤ç‰Œ self.allowance += elapsed * (self.rate / self.per) if self.allowance > self.rate: self.allowance = self.rate self.last_check = current # æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œ if self.allowance &lt; tokens: return False self.allowance -= tokens return True class TokenBucket: """ä»¤ç‰Œæ¡¶ç®—æ³•""" def __init__(self, capacity: int, refill_rate: float): """ capacity: æ¡¶å®¹é‡ refill_rate: å¡«å……é€Ÿç‡ï¼ˆæ¯ç§’ï¼‰ """ self.capacity = capacity self.refill_rate = refill_rate self.tokens = capacity self.last_refill = time.time() def consume(self, tokens: int = 1) -> bool: """æ¶ˆè´¹ä»¤ç‰Œ""" self._refill() if self.tokens >= tokens: self.tokens -= tokens return True return False def _refill(self): """è¡¥å……ä»¤ç‰Œ""" now = time.time() elapsed = now - self.last_refill refill_amount = elapsed * self.refill_rate self.tokens = min(self.capacity, self.tokens + refill_amount) self.last_refill = now class SlidingWindow: """æ»‘åŠ¨çª—å£é™æµ""" def __init__(self, limit: int, window: float): """ limit: çª—å£å†…æœ€å¤§è¯·æ±‚æ•° window: æ—¶é—´çª—å£ï¼ˆç§’ï¼‰ """ self.limit = limit self.window = window self.requests = deque() def is_allowed(self) -> bool: """æ£€æŸ¥æ˜¯å¦å…è®¸è¯·æ±‚""" now = time.time() # ç§»é™¤çª—å£å¤–çš„è¯·æ±‚ while self.requests and self.requests[0] &lt; now - self.window: self.requests.popleft() # æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶ if len(self.requests) >= self.limit: return False self.requests.append(now) return True # é™çº§è£…é¥°å™¨ class FallbackExecutor: """é™çº§æ‰§è¡Œå™¨""" def __init__(self): self.fallbacks = {} def register_fallback(self, func_name: str, fallback: Callable): """æ³¨å†Œé™çº§å‡½æ•°""" self.fallbacks[func_name] = fallback async def execute_with_fallback( self, func: Callable, *args, fallback_result: Any = None, **kwargs ): """æ‰§è¡Œå‡½æ•°ï¼Œå¤±è´¥æ—¶é™çº§""" try: return await func(*args, **kwargs) except Exception as e: func_name = func.__name__ # æŸ¥æ‰¾æ³¨å†Œçš„é™çº§å‡½æ•° if func_name in self.fallbacks: logger.warning(f"Function {func_name} failed, using fallback") return await self.fallbacks[func_name](*args, **kwargs) # ä½¿ç”¨é»˜è®¤é™çº§ç»“æœ if fallback_result is not None: logger.warning(f"Function {func_name} failed, using fallback result") return fallback_result # æ²¡æœ‰é™çº§æ–¹æ¡ˆï¼ŒæŠ›å‡ºå¼‚å¸¸ raise e # ä½¿ç”¨ç¤ºä¾‹ # åˆ›å»ºé™æµå™¨ rate_limiter = RateLimiter(rate=100, per=1) # 100è¯·æ±‚/ç§’ token_bucket = TokenBucket(capacity=10, refill_rate=1) # 10ä»¤ç‰Œå®¹é‡ï¼Œæ¯ç§’è¡¥å……1ä¸ª sliding_window = SlidingWindow(limit=100, window=60) # 60ç§’å†…æœ€å¤š100è¯·æ±‚ # åˆ›å»ºé™çº§æ‰§è¡Œå™¨ fallback_executor = FallbackExecutor() async def get_user_data(user_id): """è·å–ç”¨æˆ·æ•°æ®""" # æ£€æŸ¥é™æµ if not rate_limiter.acquire(): raise RateLimitException("Too many requests") # è°ƒç”¨æœåŠ¡ return await user_service.get_user(user_id) # æ³¨å†Œé™çº§å‡½æ•° async def get_user_data_fallback(user_id): """é™çº§ï¼šè¿”å›ç¼“å­˜çš„ç”¨æˆ·æ•°æ®""" return await cache.get(f"user:{user_id}") fallback_executor.register_fallback('get_user_data', get_user_data_fallback) # ä½¿ç”¨ try: result = await fallback_executor.execute_with_fallback( get_user_data, user_id='123' ) except Exception as e: logger.error(f"All attempts failed: {e}") äº”ã€å¯è§‚æµ‹æ€§è®¾è®¡ 5.1 æ—¥å¿—ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 import structlog from typing import Any class LogContext: """æ—¥å¿—ä¸Šä¸‹æ–‡""" def __init__(self): self.context = {} def set(self, key: str, value: Any): """è®¾ç½®ä¸Šä¸‹æ–‡""" self.context[key] = value def get(self, key: str, default=None): """è·å–ä¸Šä¸‹æ–‡""" return self.context.get(key, default) def clear(self): """æ¸…ç©ºä¸Šä¸‹æ–‡""" self.context.clear() # å…¨å±€æ—¥å¿—ä¸Šä¸‹æ–‡ log_context = LogContext() # é…ç½®structlog structlog.configure( processors=[ structlog.stdlib.filter_by_level, structlog.stdlib.add_logger_name, structlog.stdlib.add_log_level, structlog.stdlib.PositionalArgumentsFormatter(), structlog.processors.TimeStamper(fmt="iso"), structlog.processors.StackInfoRenderer(), structlog.processors.format_exc_info, structlog.processors.UnicodeDecoder(), # æ·»åŠ ä¸Šä¸‹æ–‡ lambda logger, method_name, event_dict: { **event_dict, **log_context.context }, # æ ¼å¼åŒ–è¾“å‡º structlog.processors.JSONRenderer() ], context_class=dict, logger_factory=structlog.stdlib.LoggerFactory(), cache_logger_on_first_use=True, ) class ServiceLogger: """æœåŠ¡æ—¥å¿—è®°å½•å™¨""" def __init__(self, service_name: str): self.service_name = service_name self.logger = structlog.get_logger() def log_request(self, request_id: str, method: str, path: str, **kwargs): """è®°å½•è¯·æ±‚""" self.logger.info( "incoming_request", request_id=request_id, service=self.service_name, method=method, path=path, **kwargs ) def log_response( self, request_id: str, status_code: int, duration_ms: float, **kwargs ): """è®°å½•å“åº”""" self.logger.info( "outgoing_response", request_id=request_id, service=self.service_name, status_code=status_code, duration_ms=duration_ms, **kwargs ) def log_error(self, error: Exception, **kwargs): """è®°å½•é”™è¯¯""" self.logger.error( "error_occurred", service=self.service_name, error_type=type(error).__name__, error_message=str(error), **kwargs ) def log_service_call( self, service_name: str, method: str, duration_ms: float, success: bool, **kwargs ): """è®°å½•æœåŠ¡è°ƒç”¨""" self.logger.info( "service_call", caller=self.service_name, service=service_name, method=method, duration_ms=duration_ms, success=success, **kwargs ) # ä¸­é—´ä»¶ç¤ºä¾‹ class LoggingMiddleware: """æ—¥å¿—ä¸­é—´ä»¶""" def __init__(self, logger: ServiceLogger): self.logger = logger async def process_request(self, request, call_next): """å¤„ç†è¯·æ±‚""" request_id = generate_request_id() start_time = time.time() # è®¾ç½®æ—¥å¿—ä¸Šä¸‹æ–‡ log_context.set('request_id', request_id) log_context.set('user_id', request.user_id) # è®°å½•è¯·æ±‚ self.logger.log_request( request_id=request_id, method=request.method, path=request.path ) try: # å¤„ç†è¯·æ±‚ response = await call_next(request) # è®°å½•å“åº” duration_ms = (time.time() - start_time) * 1000 self.logger.log_response( request_id=request_id, status_code=response.status_code, duration_ms=duration_ms ) return response except Exception as e: duration_ms = (time.time() - start_time) * 1000 self.logger.log_error( error=e, request_id=request_id, duration_ms=duration_ms ) raise finally: log_context.clear() 5.2 é“¾è·¯è¿½è¸ª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 from opentelemetry import trace from opentelemetry.sdk.trace import TracerProvider from opentelemetry.sdk.trace.export import BatchSpanProcessor from opentelemetry.exporter.jaeger.thrift import JaegerExporter # é…ç½®Tracer trace.set_tracer_provider(TracerProvider()) tracer_provider = trace.get_tracer_provider() # é…ç½®Jaegerå¯¼å‡ºå™¨ jaeger_exporter = JaegerExporter( agent_host_name="localhost", agent_port=6831, ) tracer_provider.add_span_processor( BatchSpanProcessor(jaeger_exporter) ) class TracingClient: """å¸¦è¿½è¸ªçš„å®¢æˆ·ç«¯""" def __init__(self, service_name: str): self.service_name = service_name self.tracer = trace.get_tracer(__name__) async def call_service( self, service_name: str, method: str, **kwargs ): """è°ƒç”¨æœåŠ¡å¹¶è¿½è¸ª""" with self.tracer.start_as_current_span( f"{service_name}.{method}", kind=trace.SpanKind.CLIENT ) as span: # æ·»åŠ å±æ€§ span.set_attribute("service", self.service_name) span.set_attribute("target_service", service_name) span.set_attribute("method", method) try: # æ³¨å…¥è¿½è¸ªä¸Šä¸‹æ–‡ headers = {} trace.inject(headers) # è°ƒç”¨æœåŠ¡ result = await self._make_request( service_name, method, headers=headers, **kwargs ) span.set_attribute("success", True) return result except Exception as e: span.record_exception(e) span.set_attribute("success", False) raise async def _make_request(self, service_name, method, headers, **kwargs): """å®é™…è¯·æ±‚é€»è¾‘""" # å®ç°æœåŠ¡è°ƒç”¨ pass # ä½¿ç”¨ç¤ºä¾‹ client = TracingClient("order-service") async def create_order(user_id, items): """åˆ›å»ºè®¢å• - å¸¦è¿½è¸ª""" with client.tracer.start_as_current_span("create_order") as span: span.set_attribute("user_id", user_id) span.set_attribute("item_count", len(items)) # è°ƒç”¨åº“å­˜æœåŠ¡ inventory_result = await client.call_service( "inventory-service", "check_stock", items=items ) # è°ƒç”¨æ”¯ä»˜æœåŠ¡ payment_result = await client.call_service( "payment-service", "process_payment", user_id=user_id, amount=calculate_amount(items) ) return { "inventory": inventory_result, "payment": payment_result } 5.3 æŒ‡æ ‡ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 from prometheus_client import Counter, Histogram, Gauge, start_http_server # å®šä¹‰æŒ‡æ ‡ request_count = Counter( 'http_requests_total', 'Total HTTP requests', ['method', 'endpoint', 'status'] ) request_duration = Histogram( 'http_request_duration_seconds', 'HTTP request duration', ['method', 'endpoint'] ) active_connections = Gauge( 'active_connections', 'Number of active connections' ) business_metric = Counter( 'business_operations_total', 'Total business operations', ['operation', 'status'] ) class MetricsMiddleware: """æŒ‡æ ‡æ”¶é›†ä¸­é—´ä»¶""" def __init__(self): self.active_connections = active_connections async def process_request(self, request, call_next): """å¤„ç†è¯·æ±‚å¹¶æ”¶é›†æŒ‡æ ‡""" # å¢åŠ æ´»è·ƒè¿æ¥æ•° self.active_connections.inc() start_time = time.time() try: response = await call_next(request) # è®°å½•è¯·æ±‚è®¡æ•° request_count.labels( method=request.method, endpoint=request.path, status=response.status_code ).inc() # è®°å½•è¯·æ±‚è€—æ—¶ duration = time.time() - start_time request_duration.labels( method=request.method, endpoint=request.path ).observe(duration) return response finally: # å‡å°‘æ´»è·ƒè¿æ¥æ•° self.active_connections.dec() class BusinessMetrics: """ä¸šåŠ¡æŒ‡æ ‡æ”¶é›†""" @staticmethod def record_operation(operation: str, success: bool): """è®°å½•ä¸šåŠ¡æ“ä½œ""" status = "success" if success else "failure" business_metric.labels( operation=operation, status=status ).inc() @staticmethod def record_order_created(order_value: float): """è®°å½•è®¢å•åˆ›å»º""" business_metric.labels( operation="order_created", status="success" ).inc() @staticmethod def record_payment_failed(amount: float, reason: str): """è®°å½•æ”¯ä»˜å¤±è´¥""" business_metric.labels( operation=f"payment_failed_{reason}", status="failure" ).inc() # ä½¿ç”¨ç¤ºä¾‹ async def create_order_logic(user_id, items): """åˆ›å»ºè®¢å•é€»è¾‘""" try: order = await order_service.create(user_id, items) BusinessMetrics.record_operation("order_created", True) return order except InventoryError as e: BusinessMetrics.record_operation("order_created", False) BusinessMetrics.record_operation("inventory_check_failed", False) raise except PaymentError as e: BusinessMetrics.record_operation("order_created", False) BusinessMetrics.record_payment_failed( order.total, e.reason ) raise # å¯åŠ¨æŒ‡æ ‡æœåŠ¡å™¨ start_http_server(8000) æ€»ç»“ åç«¯ç³»ç»Ÿæ¶æ„è®¾è®¡æ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘å¤šä¸ªç»´åº¦ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=category-link>åç«¯å¼€å‘</a><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2025-12-30</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to åç«¯ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼šä»å•ä½“åˆ°å¾®æœåŠ¡çš„æ¼”è¿›ä¹‹è·¯" href=/blog/articles/%E5%90%8E%E7%AB%AF%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BB%8E%E5%8D%95%E4%BD%93%E5%88%B0%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>ç°ä»£å‰ç«¯æ¶æ„æ·±åº¦è§£æï¼šæ„å»ºå¯æ‰©å±•çš„å¤§å‹åº”ç”¨</h2></header><div class=entry-content><p>å¼•è¨€ éšç€å‰ç«¯åº”ç”¨çš„å¤æ‚åº¦ä¸æ–­å¢åŠ ï¼Œä¼ ç»Ÿçš„å•ä½“å‰ç«¯æ¶æ„å·²éš¾ä»¥æ»¡è¶³å¤§å‹é¡¹ç›®çš„éœ€æ±‚ã€‚ç°ä»£å‰ç«¯æ¶æ„éœ€è¦è§£å†³ä»£ç åˆ†å‰²ã€å›¢é˜Ÿåä½œã€æ€§èƒ½ä¼˜åŒ–ã€å¯ç»´æŠ¤æ€§ç­‰å¤šæ–¹é¢çš„æŒ‘æˆ˜ã€‚æœ¬æ–‡å°†ä»æ¶æ„è®¾è®¡çš„è§’åº¦ï¼Œæ·±å…¥æ¢è®¨å¦‚ä½•æ„å»ºå¯æ‰©å±•çš„å¤§å‹å‰ç«¯åº”ç”¨ã€‚
ä¸€ã€å‰ç«¯æ¶æ„æ¼”è¿›å² 1.1 ä»é¡µé¢åˆ°åº”ç”¨çš„å‘å±•å†ç¨‹ jQueryæ—¶ä»£ â†’ AMD/RequireJS â†’ CommonJS/Node.js â†’ ES6 Modules â†’ ç°ä»£æ¡†æ¶æ—¶ä»£ å‘å±•é˜¶æ®µ
é˜¶æ®µ ç‰¹ç‚¹ ä»£è¡¨æŠ€æœ¯ å±€é™æ€§ é™æ€é¡µé¢ HTML + CSS + å°‘é‡JS jQueryã€Prototype ä»£ç å¤ç”¨å·® æ¨¡å—åŒ–åˆæœŸ RequireJSã€SeaJS AMDã€CMD åŠ è½½å¤æ‚ ç»„ä»¶åŒ– Reactã€Vueè¯ç”Ÿ Virtual DOM çŠ¶æ€ç®¡ç†æ··ä¹± å·¥ç¨‹åŒ– Webpackã€Rollup ES6 Modules æ„å»ºå¤æ‚åº¦é«˜ ç°ä»£åŒ– Next.jsã€Nuxt.js SSRã€SSR Streaming å­¦ä¹ æ›²çº¿é™¡å³­ 1.2 å½“å‰æ¶æ„æŒ‘æˆ˜ å¤§å‹å‰ç«¯åº”ç”¨é¢ä¸´çš„æ ¸å¿ƒé—®é¢˜
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // é—®é¢˜1: ä»£ç ç»„ç»‡æ··ä¹± // src/ // components/ // 1000+ ç»„ä»¶ // pages/ // 200+ é¡µé¢ // utils/ // å·¥å…·å‡½æ•°æ•£è½å„å¤„ // api/ // APIè°ƒç”¨ä¸è§„èŒƒ // é—®é¢˜2: çŠ¶æ€ç®¡ç†å¤æ‚ // - å…¨å±€çŠ¶æ€ä¸å±€éƒ¨çŠ¶æ€è¾¹ç•Œæ¨¡ç³Š // - çŠ¶æ€æµè½¬éš¾ä»¥è¿½è¸ª // - å¤šä¸ªçŠ¶æ€ç®¡ç†æ–¹æ¡ˆæ··ç”¨ // é—®é¢˜3: æ€§èƒ½ç“¶é¢ˆ // - é¦–å±åŠ è½½æ—¶é—´é•¿ // - è·¯ç”±åˆ‡æ¢å¡é¡¿ // - å†…å­˜æ³„æ¼é£é™© // é—®é¢˜4: å›¢é˜Ÿåä½œå›°éš¾ // - ä»£ç å†²çªé¢‘ç¹ // - å‘å¸ƒå‘¨æœŸé•¿ // - æŠ€æœ¯æ ˆä¸ç»Ÿä¸€ äºŒã€æ¶æ„è®¾è®¡åŸåˆ™ 2.1 SOLIDåŸåˆ™åœ¨å‰ç«¯çš„åº”ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 // S - å•ä¸€èŒè´£åŸåˆ™ // âŒ è¿åå•ä¸€èŒè´£ class UserComponent { render() { } fetchUser() { } validateInput() { } formatData() { } logAnalytics() { } } // âœ… éµå¾ªå•ä¸€èŒè´£ class UserComponent { constructor( private renderer: UserRenderer, private userService: UserService, private validator: InputValidator ) { } render() { this.renderer.render() } fetchUser() { this.userService.fetch() } } // O - å¼€é—­åŸåˆ™ // ä½¿ç”¨æ’ä»¶ç³»ç»Ÿæ‰©å±•åŠŸèƒ½ interface ComponentPlugin { install(component: any): void uninstall(component: any): void } class Component { private plugins: ComponentPlugin[] = [] use(plugin: ComponentPlugin) { this.plugins.push(plugin) plugin.install(this) return this } } // L - é‡Œæ°æ›¿æ¢åŸåˆ™ // åŸºç±»å¯è¢«å­ç±»æ— ç¼æ›¿æ¢ abstract class BaseStore&lt;T> { abstract get(id: string): Promise&lt;T> abstract set(id: string, data: T): Promise&lt;void> } class UserStore extends BaseStore&lt;User> { async get(id: string): Promise&lt;User> { } async set(id: string, data: User): Promise&lt;void> { } } // I - æ¥å£éš”ç¦»åŸåˆ™ // æ‹†åˆ†å¤§æ¥å£ä¸ºå°æ¥å£ interface ReadOnlyRepository&lt;T> { findById(id: string): Promise&lt;T> findAll(): Promise&lt;T[]> } interface WriteOnlyRepository&lt;T> { create(data: T): Promise&lt;T> update(id: string, data: Partial&lt;T>): Promise&lt;T> delete(id: string): Promise&lt;void> } // D - ä¾èµ–å€’ç½®åŸåˆ™ // ä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç° interface CacheService { get(key: string): Promise&lt;any> set(key: string, value: any): Promise&lt;void> } class UserService { constructor(private cache: CacheService) { } } 2.2 åˆ†å±‚æ¶æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 // æ ‡å‡†å‰ç«¯åˆ†å±‚æ¶æ„ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Presentation Layer â”‚ â”‚ (Components, Pages, UI Logic) â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ Business Logic Layer â”‚ â”‚ (Hooks, Composables, Use Cases) â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ Data Access Layer â”‚ â”‚ (API Client, Cache, State Management) â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ Infrastructure Layer â”‚ â”‚ (HTTP, WebSocket, LocalStorage) â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ // å®ç°ç¤ºä¾‹ // ========== Presentation Layer ========== // views/UserList.vue &lt;template> &lt;UserDataTable :users="users" :loading="loading" @refresh="handleRefresh" /> &lt;/template> // ========== Business Logic Layer ========== // composables/useUserList.ts export function useUserList() { const { users, loading, error, fetch } = userRepository() const refresh = async () => { await fetch() analytics.track('user_list_refreshed') } const filteredUsers = computed(() => { return users.value.filter(user => user.active) }) return { users: filteredUsers, loading, error, refresh } } // ========== Data Access Layer ========== // repositories/userRepository.ts export function userRepository() { const api = useApiClient() const cache = useCache() const fetch = async () => { const cached = await cache.get('users') if (cached) return cached const data = await api.get('/users') await cache.set('users', data, 300) // 5åˆ†é’Ÿ return data } return { users: ref([]), loading: ref(false), error: ref(null), fetch } } // ========== Infrastructure Layer =========== // utils/apiClient.ts class ApiClient { private baseURL: string private interceptors: RequestInterceptor[] async get&lt;T>(url: string): Promise&lt;T> { const request = new Request(this.baseURL + url) return this.execute&lt;T>(request) } } 2.3 é¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)åœ¨å‰ç«¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 // 1. é¢†åŸŸæ¨¡å‹å®šä¹‰ // domains/user/User.ts export class User { constructor( private readonly id: UserId, private readonly email: Email, private name: UserName, private status: UserStatus ) {} // é¢†åŸŸé€»è¾‘ activate(): void { if (this.status === UserStatus.ACTIVE) { throw new Error('User already active') } this.status = UserStatus.ACTIVE } deactivate(): void { this.status = UserStatus.INACTIVE } isActive(): boolean { return this.status === UserStatus.ACTIVE } } // å€¼å¯¹è±¡ export class Email { constructor(private readonly value: string) { if (!this.validate(value)) { throw new Error('Invalid email') } } private validate(email: string): boolean { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email) } getValue(): string { return this.value } } // 2. é¢†åŸŸæœåŠ¡ // domains/user/UserService.ts export class UserService { constructor( private userRepo: UserRepository, private emailService: EmailService ) {} async registerUser(data: RegisterUserData): Promise&lt;User> { // ä¸šåŠ¡è§„åˆ™éªŒè¯ if (await this.userRepo.existsByEmail(data.email)) { throw new Error('Email already registered') } // åˆ›å»ºé¢†åŸŸå¯¹è±¡ const user = new User( UserId.generate(), new Email(data.email), new UserName(data.name), UserStatus.PENDING ) // æŒä¹…åŒ– await this.userRepo.save(user) // å‘é€æ¬¢è¿é‚®ä»¶ await this.emailService.sendWelcome(user.email.getValue()) return user } } // 3. åº”ç”¨æœåŠ¡ï¼ˆç”¨ä¾‹ï¼‰ // application/useCases/RegisterUserUseCase.ts export class RegisterUserUseCase { constructor(private userService: UserService) { } async execute(request: RegisterUserRequest): Promise&lt;RegisterUserResponse> { try { const user = await this.userService.registerUser(request.data) return { success: true, userId: user.id.getValue(), message: 'Registration successful' } } catch (error) { return { success: false, error: error.message } } } } // 4. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ // components/RegisterForm.vue export default { setup() { const registerUser = useRegisterUserUseCase() const handleSubmit = async (formData) => { const result = await registerUser.execute({ data: { email: formData.email, name: formData.name, password: formData.password } }) if (result.success) { router.push(`/welcome/${result.userId}`) } else { showError(result.error) } } return { handleSubmit } } } ä¸‰ã€å¾®å‰ç«¯æ¶æ„ 3.1 å¾®å‰ç«¯æ¶æ„æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 // æ¨¡å¼1: è·¯ç”±åˆ†å‘ // ä¸»åº”ç”¨æ ¹æ®è·¯ç”±åŠ è½½ä¸åŒå­åº”ç”¨ const microApps = [ { name: 'user-center', entry: '//localhost:3001', container: '#subapp', activeRule: '/users' }, { name: 'order-system', entry: '//localhost:3002', container: '#subapp', activeRule: '/orders' } ] // æ¨¡å¼2: ç»„åˆå¼é›†æˆ // ä¸»åº”ç”¨æä¾›å®¹å™¨ï¼Œå­åº”ç”¨ä½œä¸ºç»„ä»¶æ¸²æŸ“ &lt;template> &lt;div> &lt;AppHeader /> &lt;MicroApp name="user-center" :props="userProps" /> &lt;AppFooter /> &lt;/div> &lt;/template> // æ¨¡å¼3: EMP (EMP Module Federation) // å»ä¸­å¿ƒåŒ–çš„æ¨¡å—å…±äº« // å­åº”ç”¨A new ModuleFederationPlugin({ name: 'appA', exposes: { './UserList': './src/components/UserList' }, shared: ['vue', 'vue-router'] }) // å­åº”ç”¨Bä½¿ç”¨Açš„ç»„ä»¶ import UserList from 'appA/UserList' 3.2 æ¨¡å—è”é‚¦å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 // webpack.config.js - ä¸»åº”ç”¨ const ModuleFederationPlugin = require('webpack/lib/container/ModuleFederationPlugin') module.exports = { plugins: [ new ModuleFederationPlugin({ name: 'host_app', remotes: { userApp: 'user_app@http://localhost:3001/remoteEntry.js', orderApp: 'order_app@http://localhost:3002/remoteEntry.js' }, shared: { vue: { singleton: true, requiredVersion: '^3.0.0' }, 'vue-router': { singleton: true } } }) ] } // åœ¨ä¸»åº”ç”¨ä¸­ä½¿ç”¨è¿œç¨‹æ¨¡å— // src/App.vue &lt;script> import { defineAsyncComponent } from 'vue' // åŠ¨æ€åŠ è½½è¿œç¨‹ç»„ä»¶ const UserDashboard = defineAsyncComponent(() => import('userApp/Dashboard') ) const OrderList = defineAsyncComponent(() => import('orderApp/OrderList') ) export default { components: { UserDashboard, OrderList } } &lt;/script> // å­åº”ç”¨é…ç½® - userApp // webpack.config.js module.exports = { plugins: [ new ModuleFederationPlugin({ name: 'user_app', filename: 'remoteEntry.js', exposes: { './Dashboard': './src/components/Dashboard.vue', './UserProfile': './src/components/UserProfile.vue', './UserStore': './src/stores/user' }, shared: { vue: { singleton: true, requiredVersion: '^3.0.0' } } }) ] } 3.3 å¾®å‰ç«¯é€šä¿¡æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 // ========== æ–¹æ¡ˆ1: è‡ªå®šä¹‰äº‹ä»¶æ€»çº¿ ========== // utils/eventBus.ts class MicroEventBus { private events: Map&lt;string, Set&lt;Function>> constructor() { this.events = new Map() } on(event: string, callback: Function) { if (!this.events.has(event)) { this.events.set(event, new Set()) } this.events.get(event)!.add(callback) } off(event: string, callback: Function) { this.events.get(event)?.delete(callback) } emit(event: string, data?: any) { this.events.get(event)?.forEach(callback => callback(data)) } } // å…¨å±€å•ä¾‹ export const microEventBus = new MicroEventBus() // å­åº”ç”¨A - å‘é€äº‹ä»¶ import { microEventBus } from './eventBus' microEventBus.emit('user:login', { userId: '123', userName: 'Alice' }) // å­åº”ç”¨B - ç›‘å¬äº‹ä»¶ microEventBus.on('user:login', (user) => { console.log('User logged in:', user) updateUI(user) }) // ========== æ–¹æ¡ˆ2: çŠ¶æ€å…±äº« ========== // stores/sharedStore.ts import { reactive, readonly } from 'vue' const state = reactive({ user: null, theme: 'light', locale: 'zh-CN' }) export const sharedStore = { state: readonly(state), setUser(user: any) { state.user = user }, setTheme(theme: string) { state.theme = theme }, setLocale(locale: string) { state.locale = locale } } // ========== æ–¹æ¡ˆ3: å…¨å±€çŠ¶æ€ç®¡ç† ========== // ä½¿ç”¨Piniaåˆ›å»ºè·¨åº”ç”¨store // stores/global.ts import { defineStore } from 'pinia' export const useGlobalStore = defineStore('global', { state: () => ({ currentUser: null, notifications: [] }), actions: { async login(credentials) { const user = await api.login(credentials) this.currentUser = user }, logout() { this.currentUser = null }, addNotification(notification) { this.notifications.push(notification) } } }) 3.4 æ ·å¼éš”ç¦» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 // ========== æ–¹æ¡ˆ1: CSS Modules ========== // components/UserCard.module.css .card { padding: 20px; border-radius: 8px; background: white; } .title { font-size: 18px; color: #333; } // components/UserCard.vue &lt;template> &lt;div :class="$style.card"> &lt;h3 :class="$style.title">{{ title }}&lt;/h3> &lt;/div> &lt;/template> &lt;script> import styles from './UserCard.module.css' export default { $style: styles } &lt;/script> // ========== æ–¹æ¡ˆ2: Shadow DOM ========== // components/ShadowWidget.ts class ShadowWidget extends HTMLElement { constructor() { super() // åˆ›å»ºShadow DOM const shadow = this.attachShadow({ mode: 'open' }) // éš”ç¦»çš„æ ·å¼ const style = document.createElement('style') style.textContent = ` .widget { padding: 20px; background: #f5f5f5; } .widget h3 { color: #333; margin: 0 0 10px 0; } ` // éš”ç¦»çš„å†…å®¹ const wrapper = document.createElement('div') wrapper.className = 'widget' wrapper.innerHTML = ` &lt;h3>Shadow DOM Widget&lt;/h3> &lt;p>This is isolated from host page styles&lt;/p> ` shadow.appendChild(style) shadow.appendChild(wrapper) } } customElements.define('shadow-widget', ShadowWidget) // ========== æ–¹æ¡ˆ3: CSS-in-JS ========== // ä½¿ç”¨styled-componentsæˆ–emotion import styled from 'styled-components' const Card = styled.div` padding: 20px; border-radius: 8px; background: white; h3 { font-size: 18px; color: #333; } ` // ç»„ä»¶è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ç±»å &lt;Card> &lt;h3>Title&lt;/h3> &lt;/Card> // ========== æ–¹æ¡ˆ4: å‘½åç©ºé—´ ========== // æ¨èçš„BEM + å‘½åç©ºé—´ç»„åˆ // [å­åº”ç”¨å]-[å—]__[å…ƒç´ ]--[ä¿®é¥°å™¨] .user-center-card__header--active { background: #007bff; } .order-system-list__item--highlighted { background: #ffc107; } å››ã€çŠ¶æ€ç®¡ç†æ¶æ„ 4.1 çŠ¶æ€ç®¡ç†é€‰å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 // ========== æ–¹æ¡ˆå¯¹æ¯” ========== // 1. Redux Toolkit - å¤æ‚åº”ç”¨ import { createSlice, configureStore } from '@reduxjs/toolkit' const userSlice = createSlice({ name: 'user', initialState: { user: null, status: 'idle' }, reducers: { setUser(state, action) { state.user = action.payload }, clearUser(state) { state.user = null } }, extraReducers: (builder) => { builder .addCase(fetchUser.pending, (state) => { state.status = 'loading' }) .addCase(fetchUser.fulfilled, (state, action) => { state.status = 'succeeded' state.user = action.payload }) } }) export const { setUser, clearUser } = userSlice.actions export default configureStore({ reducer: { user: userSlice.reducer } }) // 2. Zustand - è½»é‡çº§ import create from 'zustand' const useUserStore = create((set, get) => ({ user: null, status: 'idle', setUser: (user) => set({ user }), fetchUser: async (id) => { set({ status: 'loading' }) const user = await api.getUser(id) set({ user, status: 'succeeded' }) }, getUserAge: () => { const { user } = get() return user ? calculateAge(user.birthday) : 0 } })) // 3. Pinia - Vueæ¨è import { defineStore } from 'pinia' export const useUserStore = defineStore('user', { state: () => ({ user: null, status: 'idle' }), getters: { isLoggedIn: (state) => !!state.user, userName: (state) => state.user?.name || 'Guest' }, actions: { async fetchUser(id) { this.status = 'loading' this.user = await api.getUser(id) this.status = 'succeeded' } } }) // 4. Jotai - åŸå­åŒ–çŠ¶æ€ import { atom, useAtom } from 'jotai' // åŸå­çŠ¶æ€ const userAtom = atom(null) const statusAtom = atom('idle') // æ´¾ç”ŸåŸå­ const isLoggedInAtom = atom( (get) => !!get(userAtom) ) // ç»„ä»¶ä¸­ä½¿ç”¨ function UserProfile() { const [user, setUser] = useAtom(userAtom) const [status] = useAtom(statusAtom) const [isLoggedIn] = useAtom(isLoggedInAtom) // ... } 4.2 åˆ†å±‚çŠ¶æ€æ¶æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 // ========== çŠ¶æ€åˆ†å±‚è®¾è®¡ ========== // 1. æœåŠ¡ç«¯çŠ¶æ€ - React Query / SWR import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query' // è·å–æ•°æ® function useUser(id: string) { return useQuery({ queryKey: ['user', id], queryFn: () => api.getUser(id), staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ cacheTime: 10 * 60 * 1000 // 10åˆ†é’Ÿ }) } // ä¿®æ”¹æ•°æ® function useUpdateUser() { const queryClient = useQueryClient() return useMutation({ mutationFn: ({ id, data }) => api.updateUser(id, data), onSuccess: (data, variables) => { // è‡ªåŠ¨æ›´æ–°ç¼“å­˜ queryClient.setQueryData(['user', variables.id], data) // æˆ–ä½¿ç¼“å­˜å¤±æ•ˆ queryClient.invalidateQueries(['user', variables.id]) } }) } // 2. å…¨å±€UIçŠ¶æ€ - Zustand import create from 'zustand/vanilla' const uiStore = create((set) => ({ theme: 'light', sidebarOpen: true, modalOpen: false, toggleTheme: () => set((state) => ({ theme: state.theme === 'light' ? 'dark' : 'light' })), toggleSidebar: () => set((state) => ({ sidebarOpen: !state.sidebarOpen })), openModal: () => set({ modalOpen: true }), closeModal: () => set({ modalOpen: false }) })) // 3. è¡¨å•çŠ¶æ€ - åŸå­çŠ¶æ€ import { atom, useAtom } from 'jotai' const formDataAtom = atom({ username: '', email: '', password: '' }) const formErrorsAtom = atom({}) const useForm = () => { const [data, setData] = useAtom(formDataAtom) const [errors, setErrors] = useAtom(formErrorsAtom) const updateField = (field, value) => { setData((prev) => ({ ...prev, [field]: value })) } const validate = () => { const newErrors = {} if (!data.username) newErrors.username = 'Required' if (!data.email) newErrors.email = 'Required' setErrors(newErrors) return Object.keys(newErrors).length === 0 } return { data, errors, updateField, validate } } // ========== çŠ¶æ€ç»„åˆä½¿ç”¨ ========== function UserProfile({ userId }) { // æœåŠ¡ç«¯çŠ¶æ€ const { data: user, isLoading } = useUser(userId) const updateUser = useUpdateUser() // UIçŠ¶æ€ const { theme, toggleTheme } = useUiStore() // æœ¬åœ°çŠ¶æ€ const [isEditing, setIsEditing] = useState(false) if (isLoading) return &lt;Spinner /> return ( &lt;div className={theme}> {isEditing ? ( &lt;EditForm user={user} onSave={(data) => updateUser.mutate({ id: userId, data })} onCancel={() => setIsEditing(false)} /> ) : ( &lt;UserDetail user={user} onEdit={() => setIsEditing(true)} /> )} &lt;button onClick={toggleTheme}>Toggle Theme&lt;/button> &lt;/div> ) } 4.3 çŠ¶æ€æŒä¹…åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 // ========== æœ¬åœ°æŒä¹…åŒ–æ–¹æ¡ˆ ========== // 1. Zustand + localStorage import { persist } from 'zustand/middleware' export const useUserStore = create( persist( (set) => ({ user: null, token: null, setUser: (user) => set({ user }), setToken: (token) => set({ token }), logout: () => set({ user: null, token: null }) }), { name: 'user-storage', // éƒ¨åˆ†æŒä¹…åŒ– partialize: (state) => ({ user: state.user, token: state.token }) } ) ) // 2. Pinia + localStorage import { createPinia } from 'pinia' import piniaPluginPersistedstate from 'pinia-plugin-persistedstate' const pinia = createPinia() pinia.use(piniaPluginPersistedstate) export const useAuthStore = defineStore('auth', { state: () => ({ token: null, refreshToken: null }), actions: { setTokens(token, refreshToken) { this.token = token this.refreshToken = refreshToken } }, persist: { key: 'auth', storage: localStorage, pick: ['token', 'refreshToken'] } }) // 3. IndexedDB - å¤§é‡æ•°æ® import { openDB } from 'idb' const dbPromise = openDB('app-db', 1, { upgrade(db) { db.createObjectStore('cache') } }) export const idbStorage = { async getItem(key) { const db = await dbPromise return await db.get('cache', key) }, async setItem(key, value) { const db = await dbPromise return await db.put('cache', value, key) }, async removeItem(key) { const db = await dbPromise return await db.delete('cache', key) } } // 4. æœåŠ¡ç«¯çŠ¶æ€åŒæ­¥ import { useQuery, useMutation } from '@tanstack/react-query' // è‡ªåŠ¨åŒæ­¥åˆ°æœåŠ¡ç«¯ function useSyncedState(key, initialValue) { const queryClient = useQueryClient() const { data } = useQuery({ queryKey: ['state', key], queryFn: () => api.getState(key), initialData: initialValue }) const mutation = useMutation({ mutationFn: (value) => api.setState(key, value), onSuccess: () => { queryClient.invalidateQueries(['state', key]) } }) const setState = (value) => { mutation.mutate(value) } return [data, setState] } äº”ã€æ€§èƒ½ä¼˜åŒ–æ¶æ„ 5.1 ä»£ç åˆ†å‰²ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 // ========== è·¯ç”±çº§åˆ«åˆ†å‰² ========== // Vue Router const routes = [ { path: '/dashboard', component: () => import( /* webpackChunkName: "dashboard" */ './views/Dashboard.vue' ) }, { path: '/users', component: () => import( /* webpackChunkName: "users" */ './views/Users.vue' ) } ] // React Router const Dashboard = lazy(() => import('./views/Dashboard')) const Users = lazy(() => import('./views/Users')) function App() { return ( &lt;Suspense fallback={&lt;Spinner />}> &lt;Routes> &lt;Route path="/dashboard" element={&lt;Dashboard />} /> &lt;Route path="/users" element={&lt;Users />} /> &lt;/Routes> &lt;/Suspense> ) } // ========== ç»„ä»¶çº§åˆ«åˆ†å‰² ========== // Vue 3 - defineAsyncComponent const HeavyComponent = defineAsyncComponent({ loader: () => import('./HeavyComponent.vue'), loadingComponent: LoadingSpinner, errorComponent: ErrorDisplay, delay: 200, timeout: 5000 }) // React - lazy + Suspense const HeavyChart = lazy(() => import('./HeavyChart')) function Dashboard() { const [showChart, setShowChart] = useState(false) return ( &lt;div> &lt;button onClick={() => setShowChart(true)}> Show Chart &lt;/button> {showChart && ( &lt;Suspense fallback={&lt;Spinner />}> &lt;HeavyChart /> &lt;/Suspense> )} &lt;/div> ) } // ========== æ¡ä»¶åŠ è½½ ========== // åªåœ¨éœ€è¦æ—¶åŠ è½½åº“ const loadMonaco = async () => { const monaco = await import('monaco-editor') return monaco } const loadChartLibrary = async () => { if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) { return null // ç”¨æˆ·ä¸å–œæ¬¢åŠ¨ç”» } const chart = await import('echarts') return chart } // ========== é¢„åŠ è½½ç­–ç•¥ ========== // é¢„åŠ è½½ä¸‹ä¸€ä¸ªå¯èƒ½è®¿é—®çš„é¡µé¢ function ProductList({ products }) { const prefetch = usePrefetch() const handleMouseEnter = (productId) => { // é¼ æ ‡æ‚¬åœæ—¶é¢„åŠ è½½ prefetch(`/products/${productId}`) } return ( &lt;ul> {products.map(product => ( &lt;li key={product.id} onMouseEnter={() => handleMouseEnter(product.id)} > &lt;Link to={`/products/${product.id}`}> {product.name} &lt;/Link> &lt;/li> ))} &lt;/ul> ) } // Webpacké­”æ³•æ³¨é‡Š const ProductDetail = lazy(() => import( /* webpackPrefetch: true */ /* webpackChunkName: "product-detail" */ './ProductDetail' )) 5.2 æ¸²æŸ“ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 // ========== è™šæ‹Ÿåˆ—è¡¨ ========== import { useVirtualizer } from '@tanstack/react-virtual' function VirtualList({ items }) { const parentRef = useRef() const virtualizer = useVirtualizer({ count: items.length, getScrollElement: () => parentRef.current, estimateSize: () => 50, // æ¯é¡¹é«˜åº¦ overscan: 5 // é¢å¤–æ¸²æŸ“é¡¹æ•° }) return ( &lt;div ref={parentRef} style={{ height: '400px', overflow: 'auto' }}> &lt;div style={{ height: `${virtualizer.getTotalSize()}px`, position: 'relative' }} > {virtualizer.getVirtualItems().map(virtualItem => ( &lt;div key={virtualItem.key} style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: `${virtualItem.size}px`, transform: `translateY(${virtualItem.start}px)` }} > {items[virtualItem.index].content} &lt;/div> ))} &lt;/div> &lt;/div> ) } // ========== é˜²æŠ–/èŠ‚æµ ========== import { useDebouncedCallback, useThrottledCallback } from '@hooks' function SearchInput() { // é˜²æŠ–æœç´¢ const debouncedSearch = useDebouncedCallback( (query) => { performSearch(query) }, 500 // å»¶è¿Ÿ ) return ( &lt;input type="text" onChange={(e) => debouncedSearch(e.target.value)} /> ) } function ScrollHandler() { // èŠ‚æµæ»šåŠ¨äº‹ä»¶ const throttledScroll = useThrottledCallback( () => { updatePosition() }, 100 // é—´éš” ) useEffect(() => { window.addEventListener('scroll', throttledScroll) return () => window.removeEventListener('scroll', throttledScroll) }, [throttledScroll]) } // ========== Reactä¼˜åŒ– ========== import { memo, useMemo, useCallback, useRef } from 'react' // 1. ç»„ä»¶è®°å¿†åŒ– const ExpensiveComponent = memo(function ExpensiveComponent({ data }) { return &lt;div>{/* å¤æ‚æ¸²æŸ“ */}&lt;/div> }) // 2. è®¡ç®—ç¼“å­˜ function DataProcessor({ items }) { const sorted = useMemo(() => { return items.sort((a, b) => a.value - b.value) }, [items]) // åªåœ¨itemså˜åŒ–æ—¶é‡æ–°è®¡ç®— const filtered = useMemo(() => { return sorted.filter(item => item.active) }, [sorted]) return &lt;List items={filtered} /> } // 3. å‡½æ•°ç¨³å®šåŒ– function ParentComponent() { const [count, setCount] = useState(0) // ä¸ç¨³å®šçš„å‡½æ•°å¼•ç”¨ const handleClickBad = () => { setCount(count + 1) } // ç¨³å®šçš„å‡½æ•°å¼•ç”¨ const handleClickGood = useCallback(() => { setCount(c => c + 1) }, []) // ä¾èµ–ä¸ºç©ºï¼Œå‡½æ•°å¼•ç”¨ä¸å˜ return &lt;ChildComponent onClick={handleClickGood} /> } // 4. åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ– function TodoList({ todos, onToggle }) { const todoRefs = useRef(new Map()) const handleToggle = useCallback((id) => { // æ‰¹é‡æ›´æ–° startTransition(() => { onToggle(id) }) }, [onToggle]) return ( &lt;ul> {todos.map(todo => ( &lt;TodoItem key={todo.id} ref={(node) => { if (node) { todoRefs.current.set(todo.id, node) } else { todoRefs.current.delete(todo.id) } }} todo={todo} onToggle={handleToggle} /> ))} &lt;/ul> ) } const TodoItem = memo(function TodoItem({ todo, onToggle }) { return ( &lt;li onClick={() => onToggle(todo.id)}> {todo.text} &lt;/li> ) }) // ========== Vueä¼˜åŒ– ========== // 1. computedç¼“å­˜ export default { setup() { const items = ref([]) // è®¡ç®—å±æ€§è‡ªåŠ¨ç¼“å­˜ const filtered = computed(() => { return items.value.filter(item => item.active) }) const sorted = computed(() => { return filtered.value.sort((a, b) => a.value - b.value) }) return { sorted } } } // 2. v-once/v-memo &lt;template> &lt;!-- åªæ¸²æŸ“ä¸€æ¬¡ --> &lt;Logo v-once /> &lt;!-- æŒ‰æ¡ä»¶è®°å¿† --> &lt;div v-for="item in list" :key="item.id" v-memo="[item.id, item.selected]"> {{ item.text }} &lt;/div> &lt;/template> // 3. watchEffectä¼˜åŒ– watchEffect((onCleanup) => { const timer = setInterval(() => { updateData() }, 1000) onCleanup(() => { clearInterval(timer) // æ¸…ç†å‰¯ä½œç”¨ }) }) // 4. shallowRef/shallowReactive // å¤§å¯¹è±¡ä¼˜åŒ– const state = shallowReactive({ // åªé¡¶å±‚æ˜¯å“åº”å¼çš„ items: largeItemsArray }) // åªéœ€è¦é‡æ–°èµ‹å€¼æ—¶ä½¿ç”¨ const data = shallowRef(null) 5.3 èµ„æºä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 // ========== å›¾ç‰‡ä¼˜åŒ– ========== // 1. å“åº”å¼å›¾ç‰‡ &lt;picture> &lt;source media="(min-width: 1024px)" srcSet="image-large.webp" type="image/webp" /> &lt;source media="(min-width: 768px)" srcSet="image-medium.webp" type="image/webp" /> &lt;source srcSet="image-small.webp" type="image/webp" /> &lt;img src="image-fallback.jpg" alt="Description" loading="lazy" /> &lt;/picture> // 2. æ‡’åŠ è½½å›¾ç‰‡ import { lazyload } from '@utils/lazyload' function ImageWithLazy({ src, alt }) { const imgRef = useRef() const [isLoaded, setIsLoaded] = useState(false) useEffect(() => { const observer = new IntersectionObserver( (entries) => { entries.forEach(entry => { if (entry.isIntersecting) { const img = entry.target img.src = img.dataset.src observer.unobserve(img) } }) }, { rootMargin: '50px' } ) if (imgRef.current) { observer.observe(imgRef.current) } return () => observer.disconnect() }, []) return ( &lt;img ref={imgRef} data-src={src} alt={alt} onLoad={() => setIsLoaded(true)} style={{ opacity: isLoaded ? 1 : 0 }} /> ) } // 3. å›¾ç‰‡ç»„ä»¶å°è£… function OptimizedImage({ src, alt, width, height, priority = false }) { const [imageSrc, setImageSrc] = useState(null) useEffect(() => { const load = async () => { // ä½¿ç”¨WebPè½¬æ¢æœåŠ¡ const webpSrc = await convertToWebP(src, width) setImageSrc(webpSrc) } if (priority) { load() } else { const observer = new IntersectionObserver((entries) => { if (entries[0].isIntersecting) { load() observer.disconnect() } }) // ... observe logic } }, [src, width, priority]) return &lt;img src={imageSrc} alt={alt} loading={!priority ? 'lazy' : 'eager'} /> } // ========== å­—ä½“ä¼˜åŒ– ========== // 1. å­—ä½“é¢„åŠ è½½ &lt;link rel="preload" href="/fonts/main.woff2" as="font" type="font/woff2" crossOrigin="anonymous" /> // 2. å­—ä½“æ˜¾ç¤ºç­–ç•¥ @font-face { font-family: 'CustomFont'; src: url('/fonts/custom.woff2') format('woff2'); font-display: swap; /* ç«‹å³æ˜¾ç¤ºåå¤‡å­—ä½“ */ /* font-display: optional; çŸ­æš‚ç­‰å¾…åä½¿ç”¨åå¤‡å­—ä½“ */ /* font-display: fallback; çŸ­æš‚ç­‰å¾…ï¼Œéšè—çŸ­æ—¶é—´ */ } // 3. å­—ä½“å­é›†åŒ– // åªåŒ…å«ä½¿ç”¨çš„å­—ç¬¦ // ä½¿ç”¨fonttoolsæˆ–åœ¨çº¿å·¥å…·ç”Ÿæˆsubset // ========== ç¬¬ä¸‰æ–¹èµ„æºä¼˜åŒ– ========== // åŠ¨æ€åŠ è½½é‡å‹åº“ const loadGoogleMaps = () => { return new Promise((resolve) => { if (window.google) { resolve(window.google) return } const script = document.createElement('script') script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}` script.async = true script.onload = () => resolve(window.google) document.head.appendChild(script) }) } // ä½¿ç”¨åœºæ™¯ function MapComponent() { const [map, setMap] = useState(null) useEffect(() => { let mounted = true loadGoogleMaps().then(google => { if (mounted) { setMap(new google.maps.Map(/* ... */)) } }) return () => { mounted = false } }, []) return &lt;div ref={mapRef} /> } // ========== ç¼“å­˜ç­–ç•¥ ========== // Service Workerç¼“å­˜ // sw.js const CACHE_NAME = 'app-v1' const STATIC_CACHE = [ '/', '/styles/main.css', '/scripts/main.js' ] self.addEventListener('install', (event) => { event.waitUntil( caches.open(CACHE_NAME).then((cache) => { return cache.addAll(STATIC_CACHE) }) ) }) self.addEventListener('fetch', (event) => { event.respondWith( caches.match(event.request).then((response) => { return response || fetch(event.request) }) ) }) // ç½‘ç»œä¼˜å…ˆç­–ç•¥ async function networkFirst(request) { try { const response = await fetch(request) const cache = await caches.open(CACHE_NAME) cache.put(request, response.clone()) return response } catch { return caches.match(request) } } // ç¼“å­˜ä¼˜å…ˆç­–ç•¥ async function cacheFirst(request) { const cached = await caches.match(request) if (cached) return cached const response = await fetch(request) const cache = await caches.open(CACHE_NAME) cache.put(request, response.clone()) return response } // è¿‡æœŸç­–ç•¥ async function staleWhileRevalidate(request) { const cache = await caches.open(CACHE_NAME) const cached = await cache.match(request) const fetchPromise = fetch(request).then((response) => { cache.put(request, response.clone()) return response }) return cached || fetchPromise } å…­ã€æ„å»ºä¼˜åŒ– 6.1 Webpackä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 // webpack.config.js const path = require('path') const TerserPlugin = require('terser-webpack-plugin') const CssMinimizerPlugin = require('css-minimizer-webpack-plugin') module.exports = { // ========== 1. æ„å»ºæ¨¡å¼ ========== mode: 'production', // ========== 2. ä»£ç åˆ†å‰² ========== optimization: { splitChunks: { chunks: 'all', cacheGroups: { // æ¡†æ¶ä»£ç å•ç‹¬æ‰“åŒ… framework: { test: /[\\/]node_modules[\\/](react|react-dom|vue)[\\/]/, name: 'framework', priority: 40 }, // UIåº“å•ç‹¬æ‰“åŒ… ui: { test: /[\\/]node_modules[\\/](@mui|@ant-design|element-plus)[\\/]/, name: 'ui', priority: 30 }, // å·¥å…·åº“ lib: { test: /[\\/]node_modules[\\/](lodash|axios|dayjs)[\\/]/, name: 'lib', priority: 20 }, // å…¬å…±ä»£ç  commons: { minChunks: 2, priority: 10, reuseExistingChunk: true } } }, // è¿è¡Œæ—¶ä»£ç å•ç‹¬æå– runtimeChunk: 'single', // å‹ç¼©é…ç½® minimize: true, minimizer: [ new TerserPlugin({ terserOptions: { parse: { ecma: 8 }, compress: { ecma: 5, warnings: false, comparisons: false, inline: 2, drop_console: true }, mangle: { safari10: true }, output: { ecma: 5, comments: false, ascii_only: true } } }), new CssMinimizerPlugin() ] }, // ========== 3. æ¨¡å—è§£æ ========== resolve: { // è·¯å¾„åˆ«å alias: { '@': path.resolve(__dirname, 'src'), '@components': path.resolve(__dirname, 'src/components'), '@utils': path.resolve(__dirname, 'src/utils') }, // æ‰©å±•å extensions: ['.js', '.jsx', '.ts', '.tsx', '.vue', '.json'], // æ¨¡å—æŸ¥æ‰¾è·¯å¾„ modules: ['node_modules', path.resolve(__dirname, 'src')] }, // ========== 4. ç¼“å­˜é…ç½® ========== cache: { type: 'filesystem', buildDependencies: { config: [__filename] } }, // ========== 5. è¾“å‡ºé…ç½® ========== output: { path: path.resolve(__dirname, 'dist'), filename: 'js/[name].[contenthash:8].js', chunkFilename: 'js/[name].[contenthash:8].chunk.js', // èµ„æºæ–‡ä»¶å assetModuleFilename: 'assets/[name].[hash:8][ext]' }, // ========== 6. æ€§èƒ½ä¼˜åŒ– ========== performance: { hints: 'warning', maxAssetSize: 244 * 1024, // 244KB maxEntrypointSize: 244 * 1024 } } 6.2 Viteä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 // vite.config.ts import { defineConfig } from 'vite' import vue from '@vitejs/plugin-vue' import { visualizer } from 'rollup-plugin-visualizer' import viteCompression from 'vite-plugin-compression' export default defineConfig({ plugins: [ vue(), // æ„å»ºåˆ†æ visualizer({ open: true, gzipSize: true, brotliSize: true }), // Gzipå‹ç¼© viteCompression({ algorithm: 'gzip', ext: '.gz' }), // Brotliå‹ç¼© viteCompression({ algorithm: 'brotliCompress', ext: '.br' }) ], build: { // äº§ç‰©ç›®å½• outDir: 'dist', // é™æ€èµ„æºç›®å½• assetsDir: 'assets', // ç”Ÿæˆsource map sourcemap: false, // æ„å»ºåæ˜¯å¦ç”Ÿæˆ manifest.json manifest: true, // chunkå¤§å°è­¦å‘Šé˜ˆå€¼ chunkSizeWarningLimit: 1000, // ä»£ç åˆ†å‰² rollupOptions: { output: { // æ‰‹åŠ¨åˆ†åŒ… manualChunks: { 'vue-vendor': ['vue', 'vue-router', 'pinia'], 'ui-lib': ['element-plus'], 'utils': ['axios', 'lodash-es', 'dayjs'] }, // æ–‡ä»¶å‘½å chunkFileNames: 'js/[name]-[hash].js', entryFileNames: 'js/[name]-[hash].js', assetFileNames: '[ext]/[name]-[hash].[ext]' } }, // å‹ç¼© minify: 'terser', terserOptions: { compress: { drop_console: true, drop_debugger: true } } }, // ä¾èµ–ä¼˜åŒ– optimizeDeps: { include: ['vue', 'vue-router', 'pinia'], exclude: ['some-large-dep'] }, // CSSé…ç½® css: { modules: { localsConvention: 'camelCase' }, preprocessorOptions: { scss: { additionalData: `@import "@/styles/variables.scss";` } } }, // å¼€å‘æœåŠ¡å™¨ server: { port: 3000, open: true, proxy: { '/api': { target: 'http://localhost:8080', changeOrigin: true, rewrite: (path) => path.replace(/^\/api/, '') } } } }) ä¸ƒã€ç›‘æ§ä¸è°ƒè¯• 7.1 æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 // ========== Core Web Vitalsç›‘æ§ ========== // utils/performanceMonitor.ts interface PerformanceMetrics { FCP: number // First Contentful Paint LCP: number // Largest Contentful Paint FID: number // First Input Delay CLS: number // Cumulative Layout Shift TTFB: number // Time to First Byte } export class PerformanceMonitor { private metrics: Partial&lt;PerformanceMetrics> = {} async collectMetrics(): Promise&lt;PerformanceMetrics> { // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ await new Promise(resolve => window.addEventListener('load', resolve)) // FCP const fcpEntry = performance.getEntriesByName('first-contentful-paint')[0] as any this.metrics.FCP = fcpEntry?.startTime || 0 // LCP this.metrics.LCP = await this.getLCP() // FID this.metrics.FID = await this.getFID() // CLS this.metrics.CLS = await this.getCLS() // TTFB const navigation = performance.getEntriesByType('navigation')[0] as any this.metrics.TTFB = navigation?.responseStart || 0 return this.metrics as PerformanceMetrics } private getLCP(): Promise&lt;number> { return new Promise(resolve => { new PerformanceObserver((list) => { const entries = list.getEntries() const lastEntry = entries[entries.length - 1] as any resolve(lastEntry?.startTime || 0) }).observe({ entryTypes: ['largest-contentful-paint'] }) }) } private getFID(): Promise&lt;number> { return new Promise(resolve => { new PerformanceObserver((list) => { const firstInput = list.getEntries()[0] as any resolve(firstInput?.processingStart - firstInput?.startTime || 0) }).observe({ entryTypes: ['first-input'] }) }) } private getCLS(): Promise&lt;number> { return new Promise(resolve => { let clsValue = 0 new PerformanceObserver((list) => { for (const entry of list.getEntries() as any[]) { if (!entry.hadRecentInput) { clsValue += entry.value } } resolve(clsValue) }).observe({ entryTypes: ['layout-shift'] }) }) } reportToAnalytics(metrics: PerformanceMetrics) { // å‘é€åˆ°åˆ†æå¹³å° analytics.track('page_performance', { fcp: metrics.FCP, lcp: metrics.LCP, fid: metrics.FID, cls: metrics.CLS, ttfb: metrics.TTFB, url: window.location.href, userAgent: navigator.userAgent }) } } // ========== é”™è¯¯ç›‘æ§ ========== // utils/errorTracker.ts export class ErrorTracker { private errors: Error[] = [] init() { // å…¨å±€é”™è¯¯æ•è· window.addEventListener('error', (event) => { this.captureError(event.error || new Error(event.message)) }) // Promiseæ‹’ç»æ•è· window.addEventListener('unhandledrejection', (event) => { this.captureError(event.reason) }) // Vueé”™è¯¯å¤„ç† if (typeof app !== 'undefined' && app.config) { app.config.errorHandler = (err, instance, info) => { this.captureError(err, { componentName: instance?.$options?.name, lifecycle: info }) } } } captureError(error: Error, context?: any) { const errorInfo = { message: error.message, stack: error.stack, timestamp: Date.now(), url: window.location.href, userAgent: navigator.userAgent, context } this.errors.push(error as any) // å‘é€åˆ°é”™è¯¯è¿½è¸ªæœåŠ¡ this.sendToService(errorInfo) } private sendToService(errorInfo: any) { // å‘é€åˆ°Sentryã€è‡ªå»ºæœåŠ¡ç­‰ fetch('/api/errors', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(errorInfo) }).catch(console.error) } } // ========== ç”¨æˆ·è¡Œä¸ºè¿½è¸ª ========== // utils/analytics.ts export class UserBehaviorTracker { private events: any[] = [] trackPageView() { this.trackEvent('page_view', { url: window.location.href, referrer: document.referrer, title: document.title }) } trackClick(element: HTMLElement) { this.trackEvent('click', { tagName: element.tagName, id: element.id, className: element.className, text: element.textContent?.substring(0, 50) }) } trackScroll(depth: number) { this.trackEvent('scroll', { scrollDepth: depth, pageHeight: document.body.scrollHeight }) } trackEngagement(duration: number) { this.trackEvent('engagement', { duration, interactions: this.events.length }) } private trackEvent(type: string, data: any) { const event = { type, data, timestamp: Date.now() } this.events.push(event) this.sendEvent(event) } private sendEvent(event: any) { // æ‰¹é‡å‘é€æˆ–å®æ—¶å‘é€ if (this.events.length >= 10) { this.flush() } } flush() { if (this.events.length === 0) return fetch('/api/analytics/events', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ events: this.events }) }).then(() => { this.events = [] }).catch(console.error) } } 7.2 è°ƒè¯•å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 // ========== Vue DevToolsé›†æˆ ========== // å¼€å‘ç¯å¢ƒå¯ç”¨è°ƒè¯•åŠŸèƒ½ if (import.meta.env.DEV) { app.config.devtools = true // æ·»åŠ ç»„ä»¶åç§°ä¾¿äºè°ƒè¯• app.component('UserProfile', UserProfile) } // ========== React DevTools ========== // ä½¿ç”¨React Developer Tools Profiler import { Profiler } from 'react' function onRenderCallback( id, phase, actualDuration, baseDuration, startTime, commitTime ) { console.log({ id, phase, actualDuration, baseDuration, startTime, commitTime }) } &lt;Profiler id="UserProfile" onRender={onRenderCallback}> &lt;UserProfile /> &lt;/Profiler> // ========== è‡ªå®šä¹‰è°ƒè¯•å·¥å…· ========== // utils/debug.ts export const debug = { log: (...args: any[]) => { if (import.meta.env.DEV) { console.log('[DEBUG]', ...args) } }, group: (label: string, fn: () => void) => { if (import.meta.env.DEV) { console.group(label) fn() console.groupEnd() } }, time: (label: string) => { if (import.meta.env.DEV) { console.time(label) } }, timeEnd: (label: string) => { if (import.meta.env.DEV) { console.timeEnd(label) } }, track: (name: string, value: any) => { if (import.meta.env.DEV) { console.log(`[TRACK] ${name}:`, value) } } } // ä½¿ç”¨ç¤ºä¾‹ debug.time('dataFetch') fetchData().then(data => { debug.track('fetchedData', data) debug.timeEnd('dataFetch') }) æ€»ç»“ æ„å»ºç°ä»£å‰ç«¯æ¶æ„éœ€è¦ç»¼åˆè€ƒè™‘å¤šä¸ªç»´åº¦ï¼š
...</p></div><footer class=entry-footer><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class=category-link>å‰ç«¯å¼€å‘</a><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>æ¶æ„è®¾è®¡</a></div><span class=post-date>2025-12-30</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></footer><a class=entry-link aria-label="post link to ç°ä»£å‰ç«¯æ¶æ„æ·±åº¦è§£æï¼šæ„å»ºå¯æ‰©å±•çš„å¤§å‹åº”ç”¨" href=/blog/articles/%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E6%9E%84%E5%BB%BA%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E5%A4%A7%E5%9E%8B%E5%BA%94%E7%94%A8/></a></article><footer class=page-footer><nav class=pagination><a class=next href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/page/2/>&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>